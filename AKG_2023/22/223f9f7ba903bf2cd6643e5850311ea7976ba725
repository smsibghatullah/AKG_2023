)]}'
{"version": 3, "sources": ["/point_of_sale/static/lib/html2canvas.js", "/point_of_sale/static/lib/backbone/backbone.js", "/point_of_sale/static/lib/waitfont.js", "/point_of_sale/static/lib/sha1.js", "/point_of_sale/static/src/js/utils.js", "/point_of_sale/static/src/js/ClassRegistry.js", "/point_of_sale/static/src/js/PosComponent.js", "/point_of_sale/static/src/js/PosContext.js", "/point_of_sale/static/src/js/ComponentRegistry.js", "/point_of_sale/static/src/js/Registries.js", "/point_of_sale/static/src/js/db.js", "/point_of_sale/static/src/js/models.js", "/point_of_sale/static/src/js/keyboard.js", "/point_of_sale/static/src/js/barcode_reader.js", "/point_of_sale/static/src/js/printers.js", "/point_of_sale/static/src/js/Gui.js", "/point_of_sale/static/src/js/PopupControllerMixin.js", "/point_of_sale/static/src/js/ControlButtonsMixin.js", "/point_of_sale/static/src/js/Chrome.js", "/point_of_sale/static/src/js/devices.js", "/point_of_sale/static/src/js/payment.js", "/point_of_sale/static/src/js/custom_hooks.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ProductScreen.js", "/point_of_sale/static/src/js/Screens/ClientListScreen/ClientLine.js", "/point_of_sale/static/src/js/Screens/ClientListScreen/ClientDetailsEdit.js", "/point_of_sale/static/src/js/Screens/ClientListScreen/ClientListScreen.js", "/point_of_sale/static/src/js/Screens/TicketScreen/ControlButtons/InvoiceButton.js", "/point_of_sale/static/src/js/Screens/TicketScreen/ControlButtons/ReprintReceiptButton.js", "/point_of_sale/static/src/js/Screens/TicketScreen/OrderDetails.js", "/point_of_sale/static/src/js/Screens/TicketScreen/OrderlineDetails.js", "/point_of_sale/static/src/js/Screens/TicketScreen/ReprintReceiptScreen.js", "/point_of_sale/static/src/js/Screens/TicketScreen/TicketScreen.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PSNumpadInputButton.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentScreenNumpad.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentScreenElectronicPayment.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentScreenPaymentLines.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentScreenStatus.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentMethodButton.js", "/point_of_sale/static/src/js/Screens/PaymentScreen/PaymentScreen.js", "/point_of_sale/static/src/js/Screens/ProductScreen/Orderline.js", "/point_of_sale/static/src/js/Screens/ProductScreen/OrderSummary.js", "/point_of_sale/static/src/js/Screens/ProductScreen/OrderWidget.js", "/point_of_sale/static/src/js/Screens/ProductScreen/NumpadWidget.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ActionpadWidget.js", "/point_of_sale/static/src/js/Screens/ProductScreen/CategoryBreadcrumb.js", "/point_of_sale/static/src/js/Screens/ProductScreen/CategoryButton.js", "/point_of_sale/static/src/js/Screens/ProductScreen/CategorySimpleButton.js", "/point_of_sale/static/src/js/Screens/ProductScreen/HomeCategoryBreadcrumb.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ProductsWidgetControlPanel.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ProductItem.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ProductList.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ProductsWidget.js", "/point_of_sale/static/src/js/Screens/ReceiptScreen/WrappedProductNameLines.js", "/point_of_sale/static/src/js/Screens/ReceiptScreen/OrderReceipt.js", "/point_of_sale/static/src/js/Screens/ReceiptScreen/ReceiptScreen.js", "/point_of_sale/static/src/js/Screens/ScaleScreen/ScaleScreen.js", "/point_of_sale/static/src/js/ChromeWidgets/CashierName.js", "/point_of_sale/static/src/js/ChromeWidgets/ProxyStatus.js", "/point_of_sale/static/src/js/ChromeWidgets/SyncNotification.js", "/point_of_sale/static/src/js/ChromeWidgets/HeaderButton.js", "/point_of_sale/static/src/js/ChromeWidgets/SaleDetailsButton.js", "/point_of_sale/static/src/js/ChromeWidgets/CashMoveButton.js", "/point_of_sale/static/src/js/ChromeWidgets/TicketButton.js", "/point_of_sale/static/src/js/Misc/CurrencyAmount.js", "/point_of_sale/static/src/js/Misc/Draggable.js", "/point_of_sale/static/src/js/Misc/NotificationSound.js", "/point_of_sale/static/src/js/Misc/IndependentToOrderScreen.js", "/point_of_sale/static/src/js/Misc/AbstractReceiptScreen.js", "/point_of_sale/static/src/js/Misc/SearchBar.js", "/point_of_sale/static/src/js/ChromeWidgets/DebugWidget.js", "/point_of_sale/static/src/js/Popups/AbstractAwaitablePopup.js", "/point_of_sale/static/src/js/Popups/ErrorPopup.js", "/point_of_sale/static/src/js/Popups/ErrorBarcodePopup.js", "/point_of_sale/static/src/js/Popups/ConfirmPopup.js", "/point_of_sale/static/src/js/Popups/CashMovePopup.js", "/point_of_sale/static/src/js/Popups/ControlButtonPopup.js", "/point_of_sale/static/src/js/Popups/TextInputPopup.js", "/point_of_sale/static/src/js/Popups/TextAreaPopup.js", "/point_of_sale/static/src/js/Popups/ErrorTracebackPopup.js", "/point_of_sale/static/src/js/Popups/SelectionPopup.js", "/point_of_sale/static/src/js/Popups/EditListInput.js", "/point_of_sale/static/src/js/Popups/EditListPopup.js", "/point_of_sale/static/src/js/Popups/NumberPopup.js", "/point_of_sale/static/src/js/Popups/OfflineErrorPopup.js", "/point_of_sale/static/src/js/Popups/OrderImportPopup.js", "/point_of_sale/static/src/js/Popups/ProductConfiguratorPopup.js", "/point_of_sale/static/src/js/Popups/CashOpeningPopup.js", "/point_of_sale/static/src/js/Popups/ProductInfoPopup.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ControlButtons/OrderlineCustomerNoteButton.js", "/point_of_sale/static/src/js/Popups/ClosePosPopup.js", "/point_of_sale/static/src/js/Popups/MoneyDetailsPopup.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ControlButtons/SetPricelistButton.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ControlButtons/SetFiscalPositionButton.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ControlButtons/ProductInfoButton.js", "/point_of_sale/static/src/js/Screens/ProductScreen/ControlButtons/RefundButton.js", "/point_of_sale/static/src/js/ChromeWidgets/ClientScreenButton.js", "/point_of_sale/static/src/js/Misc/NumberBuffer.js", "/point_of_sale/static/src/js/Misc/MobileOrderWidget.js", "/point_of_sale/static/src/js/Notification.js", "/pos_create_product/static/src/js/WkCPAlertPopUp.js", "/pos_create_product/static/src/js/BarcodeErrorPopupWidget.js", "/pos_create_product/static/src/js/SuccessNotifyPopopWidget.js", "/pos_create_product/static/src/js/ProductCreatePopupWidget.js", "/pos_create_product/static/src/js/main.js", "/pos_discount/static/src/js/DiscountButton.js", "/pos_discount/static/src/js/models.js", "/pos_epson_printer/static/src/js/pos_epson_printer.js", "/pos_epson_printer/static/src/js/printers.js", "/pos_sale/static/src/js/models.js", "/pos_sale/static/src/js/SetSaleOrderButton.js", "/pos_sale/static/src/js/OrderManagementScreen/MobileSaleOrderManagementScreen.js", "/pos_sale/static/src/js/OrderManagementScreen/SaleOrderFetcher.js", "/pos_sale/static/src/js/OrderManagementScreen/SaleOrderList.js", "/pos_sale/static/src/js/OrderManagementScreen/SaleOrderManagementControlPanel.js", "/pos_sale/static/src/js/OrderManagementScreen/SaleOrderManagementScreen.js", "/pos_sale/static/src/js/OrderManagementScreen/SaleOrderRow.js", "/pos_sale/static/src/js/ProductScreen.js", "/pos_global_discount_selection/static/src/js/DiscountButton.js", "/pos_keyboard_shortcut/static/src/js/model.js", "/pos_keyboard_shortcut/static/src/js/main.js", "/pos_sale_product_configurator/static/src/js/models.js", "/pos_supplier_reference/static/src/js/models.js", "/pos_supplier_reference/static/src/js/Popups/ReferencePopup.js", "/pos_supplier_reference/static/src/js/PaymentScreen/PaymentScreen.js", "/pos_supplier_reference/static/src/js/TicketScreen/TicketScreen.js", "/pos_supplier_reference/static/src/js/ReceiptScreen/OrderReceipt.js"], "mappings": "AAAA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnzFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7iDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/JA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtQA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1jBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7sHA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/MA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzKA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9KA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5CA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpiBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5eA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/FA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrJA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvXA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjIA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvNA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzIA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/kBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9GA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChGA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjIA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtGA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3FA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5GA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjKA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7CA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1GA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/EA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvMA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1GA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpTA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtNA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClHA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzKA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnFA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7DA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpIA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjIA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjRA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/GA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxzBA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrEA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA", "sourcesContent": ["/*\n  html2canvas 0.4.1 <http://html2canvas.hertzen.com>\n  Copyright (c) 2013 Niklas von Hertzen\n\n  Released under MIT License\n*/\n\n(function(window, document, undefined){\n\n    \"use strict\";\n    \n    var _html2canvas = {},\n    previousElement,\n    computedCSS,\n    html2canvas;\n    \n    _html2canvas.Util = {};\n    \n    _html2canvas.Util.log = function(a) {\n      if (_html2canvas.logging && window.console && window.console.log) {\n        window.console.log(a);\n      }\n    };\n    \n    _html2canvas.Util.trimText = (function(isNative){\n      return function(input) {\n        return isNative ? isNative.apply(input) : ((input || '') + '').replace( /^\\s+|\\s+$/g , '' );\n      };\n    })(String.prototype.trim);\n    \n    _html2canvas.Util.asFloat = function(v) {\n      return parseFloat(v);\n    };\n    \n    (function() {\n      // TODO: support all possible length values\n      var TEXT_SHADOW_PROPERTY = /((rgba|rgb)\\([^\\)]+\\)(\\s-?\\d+px){0,})/g;\n      var TEXT_SHADOW_VALUES = /(-?\\d+px)|(#.+)|(rgb\\(.+\\))|(rgba\\(.+\\))/g;\n      _html2canvas.Util.parseTextShadows = function (value) {\n        if (!value || value === 'none') {\n          return [];\n        }\n    \n        // find multiple shadow declarations\n        var shadows = value.match(TEXT_SHADOW_PROPERTY),\n          results = [];\n        for (var i = 0; shadows && (i < shadows.length); i++) {\n          var s = shadows[i].match(TEXT_SHADOW_VALUES);\n          results.push({\n            color: s[0],\n            offsetX: s[1] ? s[1].replace('px', '') : 0,\n            offsetY: s[2] ? s[2].replace('px', '') : 0,\n            blur: s[3] ? s[3].replace('px', '') : 0\n          });\n        }\n        return results;\n      };\n    })();\n    \n    \n    _html2canvas.Util.parseBackgroundImage = function (value) {\n        var whitespace = ' \\r\\n\\t',\n            method, definition, prefix, prefix_i, block, results = [],\n            c, mode = 0, numParen = 0, quote, args;\n    \n        var appendResult = function(){\n            if(method) {\n                if(definition.substr( 0, 1 ) === '\"') {\n                    definition = definition.substr( 1, definition.length - 2 );\n                }\n                if(definition) {\n                    args.push(definition);\n                }\n                if(method.substr( 0, 1 ) === '-' &&\n                        (prefix_i = method.indexOf( '-', 1 ) + 1) > 0) {\n                    prefix = method.substr( 0, prefix_i);\n                    method = method.substr( prefix_i );\n                }\n                results.push({\n                    prefix: prefix,\n                    method: method.toLowerCase(),\n                    value: block,\n                    args: args\n                });\n            }\n            args = []; //for some odd reason, setting .length = 0 didn't work in safari\n            method =\n                prefix =\n                definition =\n                block = '';\n        };\n    \n        appendResult();\n        for(var i = 0, ii = value.length; i<ii; i++) {\n            c = value[i];\n            if(mode === 0 && whitespace.indexOf( c ) > -1){\n                continue;\n            }\n            switch(c) {\n                case '\"':\n                    if(!quote) {\n                        quote = c;\n                    }\n                    else if(quote === c) {\n                        quote = null;\n                    }\n                    break;\n    \n                case '(':\n                    if(quote) { break; }\n                    else if(mode === 0) {\n                        mode = 1;\n                        block += c;\n                        continue;\n                    } else {\n                        numParen++;\n                    }\n                    break;\n    \n                case ')':\n                    if(quote) { break; }\n                    else if(mode === 1) {\n                        if(numParen === 0) {\n                            mode = 0;\n                            block += c;\n                            appendResult();\n                            continue;\n                        } else {\n                            numParen--;\n                        }\n                    }\n                    break;\n    \n                case ',':\n                    if(quote) { break; }\n                    else if(mode === 0) {\n                        appendResult();\n                        continue;\n                    }\n                    else if (mode === 1) {\n                        if(numParen === 0 && !method.match(/^url$/i)) {\n                            args.push(definition);\n                            definition = '';\n                            block += c;\n                            continue;\n                        }\n                    }\n                    break;\n            }\n    \n            block += c;\n            if(mode === 0) { method += c; }\n            else { definition += c; }\n        }\n        appendResult();\n    \n        return results;\n    };\n    \n    _html2canvas.Util.Bounds = function (element) {\n      var clientRect, bounds = {};\n    \n      if (element.getBoundingClientRect){\n        clientRect = element.getBoundingClientRect();\n    \n        // TODO add scroll position to bounds, so no scrolling of window necessary\n        bounds.top = clientRect.top;\n        bounds.bottom = clientRect.bottom || (clientRect.top + clientRect.height);\n        bounds.left = clientRect.left;\n    \n        bounds.width = element.offsetWidth;\n        bounds.height = element.offsetHeight;\n      }\n    \n      return bounds;\n    };\n    \n    // TODO ideally, we'd want everything to go through this function instead of Util.Bounds,\n    // but would require further work to calculate the correct positions for elements with offsetParents\n    _html2canvas.Util.OffsetBounds = function (element) {\n      var parent = element.offsetParent ? _html2canvas.Util.OffsetBounds(element.offsetParent) : {top: 0, left: 0};\n    \n      return {\n        top: element.offsetTop + parent.top,\n        bottom: element.offsetTop + element.offsetHeight + parent.top,\n        left: element.offsetLeft + parent.left,\n        width: element.offsetWidth,\n        height: element.offsetHeight\n      };\n    };\n    \n    function toPX(element, attribute, value ) {\n        var rsLeft = element.runtimeStyle && element.runtimeStyle[attribute],\n            left,\n            style = element.style;\n    \n        // Check if we are not dealing with pixels, (Opera has issues with this)\n        // Ported from jQuery css.js\n        // From the awesome hack by Dean Edwards\n        // http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291\n    \n        // If we're not dealing with a regular pixel number\n        // but a number that has a weird ending, we need to convert it to pixels\n    \n        if ( !/^-?[0-9]+\\.?[0-9]*(?:px)?$/i.test( value ) && /^-?\\d/.test(value) ) {\n            // Remember the original values\n            left = style.left;\n    \n            // Put in the new values to get a computed value out\n            if (rsLeft) {\n                element.runtimeStyle.left = element.currentStyle.left;\n            }\n            style.left = attribute === \"fontSize\" ? \"1em\" : (value || 0);\n            value = style.pixelLeft + \"px\";\n    \n            // Revert the changed values\n            style.left = left;\n            if (rsLeft) {\n                element.runtimeStyle.left = rsLeft;\n            }\n        }\n    \n        if (!/^(thin|medium|thick)$/i.test(value)) {\n            return Math.round(parseFloat(value)) + \"px\";\n        }\n    \n        return value;\n    }\n    \n    function asInt(val) {\n        return parseInt(val, 10);\n    }\n    \n    function parseBackgroundSizePosition(value, element, attribute, index) {\n        value = (value || '').split(',');\n        value = value[index || 0] || value[0] || 'auto';\n        value = _html2canvas.Util.trimText(value).split(' ');\n    \n        if(attribute === 'backgroundSize' && (!value[0] || value[0].match(/cover|contain|auto/))) {\n            //these values will be handled in the parent function\n        } else {\n            value[0] = (value[0].indexOf( \"%\" ) === -1) ? toPX(element, attribute + \"X\", value[0]) : value[0];\n            if(value[1] === undefined) {\n                if(attribute === 'backgroundSize') {\n                    value[1] = 'auto';\n                    return value;\n                } else {\n                    // IE 9 doesn't return double digit always\n                    value[1] = value[0];\n                }\n            }\n            value[1] = (value[1].indexOf(\"%\") === -1) ? toPX(element, attribute + \"Y\", value[1]) : value[1];\n        }\n        return value;\n    }\n    \n    _html2canvas.Util.getCSS = function (element, attribute, index) {\n        if (previousElement !== element) {\n          computedCSS = document.defaultView.getComputedStyle(element, null);\n        }\n    \n        var value = computedCSS[attribute];\n    \n        if (/^background(Size|Position)$/.test(attribute)) {\n            return parseBackgroundSizePosition(value, element, attribute, index);\n        } else if (/border(Top|Bottom)(Left|Right)Radius/.test(attribute)) {\n          var arr = value.split(\" \");\n          if (arr.length <= 1) {\n              arr[1] = arr[0];\n          }\n          return arr.map(asInt);\n        }\n    \n      return value;\n    };\n    \n    _html2canvas.Util.resizeBounds = function( current_width, current_height, target_width, target_height, stretch_mode ){\n      var target_ratio = target_width / target_height,\n        current_ratio = current_width / current_height,\n        output_width, output_height;\n    \n      if(!stretch_mode || stretch_mode === 'auto') {\n        output_width = target_width;\n        output_height = target_height;\n      } else if(target_ratio < current_ratio ^ stretch_mode === 'contain') {\n        output_height = target_height;\n        output_width = target_height * current_ratio;\n      } else {\n        output_width = target_width;\n        output_height = target_width / current_ratio;\n      }\n    \n      return {\n        width: output_width,\n        height: output_height\n      };\n    };\n    \n    function backgroundBoundsFactory( prop, el, bounds, image, imageIndex, backgroundSize ) {\n        var bgposition =  _html2canvas.Util.getCSS( el, prop, imageIndex ) ,\n        topPos,\n        left,\n        percentage,\n        val;\n    \n        if (bgposition.length === 1){\n          val = bgposition[0];\n    \n          bgposition = [];\n    \n          bgposition[0] = val;\n          bgposition[1] = val;\n        }\n    \n        if (bgposition[0].toString().indexOf(\"%\") !== -1){\n          percentage = (parseFloat(bgposition[0])/100);\n          left = bounds.width * percentage;\n          if(prop !== 'backgroundSize') {\n            left -= (backgroundSize || image).width*percentage;\n          }\n        } else {\n          if(prop === 'backgroundSize') {\n            if(bgposition[0] === 'auto') {\n              left = image.width;\n            } else {\n              if (/contain|cover/.test(bgposition[0])) {\n                var resized = _html2canvas.Util.resizeBounds(image.width, image.height, bounds.width, bounds.height, bgposition[0]);\n                left = resized.width;\n                topPos = resized.height;\n              } else {\n                left = parseInt(bgposition[0], 10);\n              }\n            }\n          } else {\n            left = parseInt( bgposition[0], 10);\n          }\n        }\n    \n    \n        if(bgposition[1] === 'auto') {\n          topPos = left / image.width * image.height;\n        } else if (bgposition[1].toString().indexOf(\"%\") !== -1){\n          percentage = (parseFloat(bgposition[1])/100);\n          topPos =  bounds.height * percentage;\n          if(prop !== 'backgroundSize') {\n            topPos -= (backgroundSize || image).height * percentage;\n          }\n    \n        } else {\n          topPos = parseInt(bgposition[1],10);\n        }\n    \n        return [left, topPos];\n    }\n    \n    _html2canvas.Util.BackgroundPosition = function( el, bounds, image, imageIndex, backgroundSize ) {\n        var result = backgroundBoundsFactory( 'backgroundPosition', el, bounds, image, imageIndex, backgroundSize );\n        return { left: result[0], top: result[1] };\n    };\n    \n    _html2canvas.Util.BackgroundSize = function( el, bounds, image, imageIndex ) {\n        var result = backgroundBoundsFactory( 'backgroundSize', el, bounds, image, imageIndex );\n        return { width: result[0], height: result[1] };\n    };\n    \n    _html2canvas.Util.Extend = function (options, defaults) {\n      for (var key in options) {\n        if (options.hasOwnProperty(key)) {\n          defaults[key] = options[key];\n        }\n      }\n      return defaults;\n    };\n    \n    \n    /*\n     * Derived from jQuery.contents()\n     * Copyright 2010, John Resig\n     * Dual licensed under the MIT or GPL Version 2 licenses.\n     * http://jquery.org/license\n     */\n    _html2canvas.Util.Children = function( elem ) {\n      var children;\n      try {\n        children = (elem.nodeName && elem.nodeName.toUpperCase() === \"IFRAME\") ? elem.contentDocument || elem.contentWindow.document : (function(array) {\n          var ret = [];\n          if (array !== null) {\n            (function(first, second ) {\n              var i = first.length,\n              j = 0;\n    \n              if (typeof second.length === \"number\") {\n                for (var l = second.length; j < l; j++) {\n                  first[i++] = second[j];\n                }\n              } else {\n                while (second[j] !== undefined) {\n                  first[i++] = second[j++];\n                }\n              }\n    \n              first.length = i;\n    \n              return first;\n            })(ret, array);\n          }\n          return ret;\n        })(elem.childNodes);\n    \n      } catch (ex) {\n        _html2canvas.Util.log(\"html2canvas.Util.Children failed with exception: \" + ex.message);\n        children = [];\n      }\n      return children;\n    };\n    \n    _html2canvas.Util.isTransparent = function(backgroundColor) {\n      return (backgroundColor === \"transparent\" || backgroundColor === \"rgba(0, 0, 0, 0)\" || backgroundColor === undefined);\n    };\n    _html2canvas.Util.Font = (function () {\n    \n      var fontData = {};\n    \n      return function(font, fontSize, doc) {\n        if (fontData[font + \"-\" + fontSize] !== undefined) {\n          return fontData[font + \"-\" + fontSize];\n        }\n    \n        var container = doc.createElement('div'),\n        img = doc.createElement('img'),\n        span = doc.createElement('span'),\n        sampleText = 'Hidden Text',\n        baseline,\n        middle,\n        metricsObj;\n    \n        container.style.visibility = \"hidden\";\n        container.style.fontFamily = font;\n        container.style.fontSize = fontSize;\n        container.style.margin = 0;\n        container.style.padding = 0;\n    \n        doc.body.appendChild(container);\n    \n        // http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever (handtinywhite.gif)\n        img.src = \"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=\";\n        img.width = 1;\n        img.height = 1;\n    \n        img.style.margin = 0;\n        img.style.padding = 0;\n        img.style.verticalAlign = \"baseline\";\n    \n        span.style.fontFamily = font;\n        span.style.fontSize = fontSize;\n        span.style.margin = 0;\n        span.style.padding = 0;\n    \n        span.appendChild(doc.createTextNode(sampleText));\n        container.appendChild(span);\n        container.appendChild(img);\n        baseline = (img.offsetTop - span.offsetTop) + 1;\n    \n        container.removeChild(span);\n        container.appendChild(doc.createTextNode(sampleText));\n    \n        container.style.lineHeight = \"normal\";\n        img.style.verticalAlign = \"super\";\n    \n        middle = (img.offsetTop-container.offsetTop) + 1;\n        metricsObj = {\n          baseline: baseline,\n          lineWidth: 1,\n          middle: middle\n        };\n    \n        fontData[font + \"-\" + fontSize] = metricsObj;\n    \n        doc.body.removeChild(container);\n    \n        return metricsObj;\n      };\n    })();\n    \n    (function(){\n      var Util = _html2canvas.Util,\n        Generate = {};\n    \n      _html2canvas.Generate = Generate;\n    \n      var reGradients = [\n      /^(-webkit-linear-gradient)\\(([a-z\\s]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\n      /^(-o-linear-gradient)\\(([a-z\\s]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\n      /^(-webkit-gradient)\\((linear|radial),\\s((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?),\\s(?:\\d{1,3}%?)\\s(?:\\d{1,3}%?))([\\w\\d\\.\\s,%\\(\\)\\-]+)\\)$/,\n      /^(-moz-linear-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?))([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\n      /^(-webkit-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s([a-z\\-]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\n      /^(-moz-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s?([a-z\\-]*)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/,\n      /^(-o-radial-gradient)\\(((?:\\d{1,3}%?)\\s(?:\\d{1,3}%?)),\\s(\\w+)\\s([a-z\\-]+)([\\w\\d\\.\\s,%\\(\\)]+)\\)$/\n      ];\n    \n      /*\n     * TODO: Add IE10 vendor prefix (-ms) support\n     * TODO: Add W3C gradient (linear-gradient) support\n     * TODO: Add old Webkit -webkit-gradient(radial, ...) support\n     * TODO: Maybe some RegExp optimizations are possible ;o)\n     */\n      Generate.parseGradient = function(css, bounds) {\n        var gradient, i, len = reGradients.length, m1, stop, m2, m2Len, step, m3, tl,tr,br,bl;\n    \n        for(i = 0; i < len; i+=1){\n          m1 = css.match(reGradients[i]);\n          if(m1) {\n            break;\n          }\n        }\n    \n        if(m1) {\n          switch(m1[1]) {\n            case '-webkit-linear-gradient':\n            case '-o-linear-gradient':\n    \n              gradient = {\n                type: 'linear',\n                x0: null,\n                y0: null,\n                x1: null,\n                y1: null,\n                colorStops: []\n              };\n    \n              // get coordinates\n              m2 = m1[2].match(/\\w+/g);\n              if(m2){\n                m2Len = m2.length;\n                for(i = 0; i < m2Len; i+=1){\n                  switch(m2[i]) {\n                    case 'top':\n                      gradient.y0 = 0;\n                      gradient.y1 = bounds.height;\n                      break;\n    \n                    case 'right':\n                      gradient.x0 = bounds.width;\n                      gradient.x1 = 0;\n                      break;\n    \n                    case 'bottom':\n                      gradient.y0 = bounds.height;\n                      gradient.y1 = 0;\n                      break;\n    \n                    case 'left':\n                      gradient.x0 = 0;\n                      gradient.x1 = bounds.width;\n                      break;\n                  }\n                }\n              }\n              if(gradient.x0 === null && gradient.x1 === null){ // center\n                gradient.x0 = gradient.x1 = bounds.width / 2;\n              }\n              if(gradient.y0 === null && gradient.y1 === null){ // center\n                gradient.y0 = gradient.y1 = bounds.height / 2;\n              }\n    \n              // get colors and stops\n              m2 = m1[3].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}(?:%|px))?)+/g);\n              if(m2){\n                m2Len = m2.length;\n                step = 1 / Math.max(m2Len - 1, 1);\n                for(i = 0; i < m2Len; i+=1){\n                  m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%|px)?/);\n                  if(m3[2]){\n                    stop = parseFloat(m3[2]);\n                    if(m3[3] === '%'){\n                      stop /= 100;\n                    } else { // px - stupid opera\n                      stop /= bounds.width;\n                    }\n                  } else {\n                    stop = i * step;\n                  }\n                  gradient.colorStops.push({\n                    color: m3[1],\n                    stop: stop\n                  });\n                }\n              }\n              break;\n    \n            case '-webkit-gradient':\n    \n              gradient = {\n                type: m1[2] === 'radial' ? 'circle' : m1[2], // TODO: Add radial gradient support for older mozilla definitions\n                x0: 0,\n                y0: 0,\n                x1: 0,\n                y1: 0,\n                colorStops: []\n              };\n    \n              // get coordinates\n              m2 = m1[3].match(/(\\d{1,3})%?\\s(\\d{1,3})%?,\\s(\\d{1,3})%?\\s(\\d{1,3})%?/);\n              if(m2){\n                gradient.x0 = (m2[1] * bounds.width) / 100;\n                gradient.y0 = (m2[2] * bounds.height) / 100;\n                gradient.x1 = (m2[3] * bounds.width) / 100;\n                gradient.y1 = (m2[4] * bounds.height) / 100;\n              }\n    \n              // get colors and stops\n              m2 = m1[4].match(/((?:from|to|color-stop)\\((?:[0-9\\.]+,\\s)?(?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)\\))+/g);\n              if(m2){\n                m2Len = m2.length;\n                for(i = 0; i < m2Len; i+=1){\n                  m3 = m2[i].match(/(from|to|color-stop)\\(([0-9\\.]+)?(?:,\\s)?((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\)/);\n                  stop = parseFloat(m3[2]);\n                  if(m3[1] === 'from') {\n                    stop = 0.0;\n                  }\n                  if(m3[1] === 'to') {\n                    stop = 1.0;\n                  }\n                  gradient.colorStops.push({\n                    color: m3[3],\n                    stop: stop\n                  });\n                }\n              }\n              break;\n    \n            case '-moz-linear-gradient':\n    \n              gradient = {\n                type: 'linear',\n                x0: 0,\n                y0: 0,\n                x1: 0,\n                y1: 0,\n                colorStops: []\n              };\n    \n              // get coordinates\n              m2 = m1[2].match(/(\\d{1,3})%?\\s(\\d{1,3})%?/);\n    \n              // m2[1] == 0%   -> left\n              // m2[1] == 50%  -> center\n              // m2[1] == 100% -> right\n    \n              // m2[2] == 0%   -> top\n              // m2[2] == 50%  -> center\n              // m2[2] == 100% -> bottom\n    \n              if(m2){\n                gradient.x0 = (m2[1] * bounds.width) / 100;\n                gradient.y0 = (m2[2] * bounds.height) / 100;\n                gradient.x1 = bounds.width - gradient.x0;\n                gradient.y1 = bounds.height - gradient.y0;\n              }\n    \n              // get colors and stops\n              m2 = m1[3].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}%)?)+/g);\n              if(m2){\n                m2Len = m2.length;\n                step = 1 / Math.max(m2Len - 1, 1);\n                for(i = 0; i < m2Len; i+=1){\n                  m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%)?/);\n                  if(m3[2]){\n                    stop = parseFloat(m3[2]);\n                    if(m3[3]){ // percentage\n                      stop /= 100;\n                    }\n                  } else {\n                    stop = i * step;\n                  }\n                  gradient.colorStops.push({\n                    color: m3[1],\n                    stop: stop\n                  });\n                }\n              }\n              break;\n    \n            case '-webkit-radial-gradient':\n            case '-moz-radial-gradient':\n            case '-o-radial-gradient':\n    \n              gradient = {\n                type: 'circle',\n                x0: 0,\n                y0: 0,\n                x1: bounds.width,\n                y1: bounds.height,\n                cx: 0,\n                cy: 0,\n                rx: 0,\n                ry: 0,\n                colorStops: []\n              };\n    \n              // center\n              m2 = m1[2].match(/(\\d{1,3})%?\\s(\\d{1,3})%?/);\n              if(m2){\n                gradient.cx = (m2[1] * bounds.width) / 100;\n                gradient.cy = (m2[2] * bounds.height) / 100;\n              }\n    \n              // size\n              m2 = m1[3].match(/\\w+/);\n              m3 = m1[4].match(/[a-z\\-]*/);\n              if(m2 && m3){\n                switch(m3[0]){\n                  case 'farthest-corner':\n                  case 'cover': // is equivalent to farthest-corner\n                  case '': // mozilla removes \"cover\" from definition :(\n                    tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2));\n                    tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\n                    br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\n                    bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2));\n                    gradient.rx = gradient.ry = Math.max(tl, tr, br, bl);\n                    break;\n                  case 'closest-corner':\n                    tl = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.cy, 2));\n                    tr = Math.sqrt(Math.pow(gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\n                    br = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.y1 - gradient.cy, 2));\n                    bl = Math.sqrt(Math.pow(gradient.x1 - gradient.cx, 2) + Math.pow(gradient.cy, 2));\n                    gradient.rx = gradient.ry = Math.min(tl, tr, br, bl);\n                    break;\n                  case 'farthest-side':\n                    if(m2[0] === 'circle'){\n                      gradient.rx = gradient.ry = Math.max(\n                        gradient.cx,\n                        gradient.cy,\n                        gradient.x1 - gradient.cx,\n                        gradient.y1 - gradient.cy\n                        );\n                    } else { // ellipse\n    \n                      gradient.type = m2[0];\n    \n                      gradient.rx = Math.max(\n                        gradient.cx,\n                        gradient.x1 - gradient.cx\n                        );\n                      gradient.ry = Math.max(\n                        gradient.cy,\n                        gradient.y1 - gradient.cy\n                        );\n                    }\n                    break;\n                  case 'closest-side':\n                  case 'contain': // is equivalent to closest-side\n                    if(m2[0] === 'circle'){\n                      gradient.rx = gradient.ry = Math.min(\n                        gradient.cx,\n                        gradient.cy,\n                        gradient.x1 - gradient.cx,\n                        gradient.y1 - gradient.cy\n                        );\n                    } else { // ellipse\n    \n                      gradient.type = m2[0];\n    \n                      gradient.rx = Math.min(\n                        gradient.cx,\n                        gradient.x1 - gradient.cx\n                        );\n                      gradient.ry = Math.min(\n                        gradient.cy,\n                        gradient.y1 - gradient.cy\n                        );\n                    }\n                    break;\n    \n                // TODO: add support for \"30px 40px\" sizes (webkit only)\n                }\n              }\n    \n              // color stops\n              m2 = m1[5].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\)(?:\\s\\d{1,3}(?:%|px))?)+/g);\n              if(m2){\n                m2Len = m2.length;\n                step = 1 / Math.max(m2Len - 1, 1);\n                for(i = 0; i < m2Len; i+=1){\n                  m3 = m2[i].match(/((?:rgb|rgba)\\(\\d{1,3},\\s\\d{1,3},\\s\\d{1,3}(?:,\\s[0-9\\.]+)?\\))\\s*(\\d{1,3})?(%|px)?/);\n                  if(m3[2]){\n                    stop = parseFloat(m3[2]);\n                    if(m3[3] === '%'){\n                      stop /= 100;\n                    } else { // px - stupid opera\n                      stop /= bounds.width;\n                    }\n                  } else {\n                    stop = i * step;\n                  }\n                  gradient.colorStops.push({\n                    color: m3[1],\n                    stop: stop\n                  });\n                }\n              }\n              break;\n          }\n        }\n    \n        return gradient;\n      };\n    \n      function addScrollStops(grad) {\n        return function(colorStop) {\n          try {\n            grad.addColorStop(colorStop.stop, colorStop.color);\n          }\n          catch(e) {\n            Util.log(['failed to add color stop: ', e, '; tried to add: ', colorStop]);\n          }\n        };\n      }\n    \n      Generate.Gradient = function(src, bounds) {\n        if(bounds.width === 0 || bounds.height === 0) {\n          return;\n        }\n    \n        var canvas = document.createElement('canvas'),\n        ctx = canvas.getContext('2d'),\n        gradient, grad;\n    \n        canvas.width = bounds.width;\n        canvas.height = bounds.height;\n    \n        // TODO: add support for multi defined background gradients\n        gradient = _html2canvas.Generate.parseGradient(src, bounds);\n    \n        if(gradient) {\n          switch(gradient.type) {\n            case 'linear':\n              grad = ctx.createLinearGradient(gradient.x0, gradient.y0, gradient.x1, gradient.y1);\n              gradient.colorStops.forEach(addScrollStops(grad));\n              ctx.fillStyle = grad;\n              ctx.fillRect(0, 0, bounds.width, bounds.height);\n              break;\n    \n            case 'circle':\n              grad = ctx.createRadialGradient(gradient.cx, gradient.cy, 0, gradient.cx, gradient.cy, gradient.rx);\n              gradient.colorStops.forEach(addScrollStops(grad));\n              ctx.fillStyle = grad;\n              ctx.fillRect(0, 0, bounds.width, bounds.height);\n              break;\n    \n            case 'ellipse':\n              var canvasRadial = document.createElement('canvas'),\n                ctxRadial = canvasRadial.getContext('2d'),\n                ri = Math.max(gradient.rx, gradient.ry),\n                di = ri * 2;\n    \n              canvasRadial.width = canvasRadial.height = di;\n    \n              grad = ctxRadial.createRadialGradient(gradient.rx, gradient.ry, 0, gradient.rx, gradient.ry, ri);\n              gradient.colorStops.forEach(addScrollStops(grad));\n    \n              ctxRadial.fillStyle = grad;\n              ctxRadial.fillRect(0, 0, di, di);\n    \n              ctx.fillStyle = gradient.colorStops[gradient.colorStops.length - 1].color;\n              ctx.fillRect(0, 0, canvas.width, canvas.height);\n              ctx.drawImage(canvasRadial, gradient.cx - gradient.rx, gradient.cy - gradient.ry, 2 * gradient.rx, 2 * gradient.ry);\n              break;\n          }\n        }\n    \n        return canvas;\n      };\n    \n      Generate.ListAlpha = function(number) {\n        var tmp = \"\",\n        modulus;\n    \n        do {\n          modulus = number % 26;\n          tmp = String.fromCharCode((modulus) + 64) + tmp;\n          number = number / 26;\n        }while((number*26) > 26);\n    \n        return tmp;\n      };\n    \n      Generate.ListRoman = function(number) {\n        var romanArray = [\"M\", \"CM\", \"D\", \"CD\", \"C\", \"XC\", \"L\", \"XL\", \"X\", \"IX\", \"V\", \"IV\", \"I\"],\n        decimal = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1],\n        roman = \"\",\n        v,\n        len = romanArray.length;\n    \n        if (number <= 0 || number >= 4000) {\n          return number;\n        }\n    \n        for (v=0; v < len; v+=1) {\n          while (number >= decimal[v]) {\n            number -= decimal[v];\n            roman += romanArray[v];\n          }\n        }\n    \n        return roman;\n      };\n    })();\n    function h2cRenderContext(width, height) {\n      var storage = [];\n      return {\n        storage: storage,\n        width: width,\n        height: height,\n        clip: function() {\n          storage.push({\n            type: \"function\",\n            name: \"clip\",\n            'arguments': arguments\n          });\n        },\n        translate: function() {\n          storage.push({\n            type: \"function\",\n            name: \"translate\",\n            'arguments': arguments\n          });\n        },\n        fill: function() {\n          storage.push({\n            type: \"function\",\n            name: \"fill\",\n            'arguments': arguments\n          });\n        },\n        save: function() {\n          storage.push({\n            type: \"function\",\n            name: \"save\",\n            'arguments': arguments\n          });\n        },\n        restore: function() {\n          storage.push({\n            type: \"function\",\n            name: \"restore\",\n            'arguments': arguments\n          });\n        },\n        fillRect: function () {\n          storage.push({\n            type: \"function\",\n            name: \"fillRect\",\n            'arguments': arguments\n          });\n        },\n        createPattern: function() {\n          storage.push({\n            type: \"function\",\n            name: \"createPattern\",\n            'arguments': arguments\n          });\n        },\n        drawShape: function() {\n    \n          var shape = [];\n    \n          storage.push({\n            type: \"function\",\n            name: \"drawShape\",\n            'arguments': shape\n          });\n    \n          return {\n            moveTo: function() {\n              shape.push({\n                name: \"moveTo\",\n                'arguments': arguments\n              });\n            },\n            lineTo: function() {\n              shape.push({\n                name: \"lineTo\",\n                'arguments': arguments\n              });\n            },\n            arcTo: function() {\n              shape.push({\n                name: \"arcTo\",\n                'arguments': arguments\n              });\n            },\n            bezierCurveTo: function() {\n              shape.push({\n                name: \"bezierCurveTo\",\n                'arguments': arguments\n              });\n            },\n            quadraticCurveTo: function() {\n              shape.push({\n                name: \"quadraticCurveTo\",\n                'arguments': arguments\n              });\n            }\n          };\n    \n        },\n        drawImage: function () {\n          storage.push({\n            type: \"function\",\n            name: \"drawImage\",\n            'arguments': arguments\n          });\n        },\n        fillText: function () {\n          storage.push({\n            type: \"function\",\n            name: \"fillText\",\n            'arguments': arguments\n          });\n        },\n        setVariable: function (variable, value) {\n          storage.push({\n            type: \"variable\",\n            name: variable,\n            'arguments': value\n          });\n          return value;\n        }\n      };\n    }\n    _html2canvas.Parse = function (images, options) {\n      window.scroll(0,0);\n    \n      var element = (( options.elements === undefined ) ? document.body : options.elements[0]), // select body by default\n      numDraws = 0,\n      doc = element.ownerDocument,\n      Util = _html2canvas.Util,\n      support = Util.Support(options, doc),\n      ignoreElementsRegExp = new RegExp(\"(\" + options.ignoreElements + \")\"),\n      body = doc.body,\n      getCSS = Util.getCSS,\n      pseudoHide = \"___html2canvas___pseudoelement\",\n      hidePseudoElements = doc.createElement('style');\n    \n      hidePseudoElements.innerHTML = '.' + pseudoHide + '-before:before { content: \"\" !important; display: none !important; }' +\n      '.' + pseudoHide + '-after:after { content: \"\" !important; display: none !important; }';\n    \n      body.appendChild(hidePseudoElements);\n    \n      images = images || {};\n    \n      function documentWidth () {\n        return Math.max(\n          Math.max(doc.body.scrollWidth, doc.documentElement.scrollWidth),\n          Math.max(doc.body.offsetWidth, doc.documentElement.offsetWidth),\n          Math.max(doc.body.clientWidth, doc.documentElement.clientWidth)\n          );\n      }\n    \n      function documentHeight () {\n        return Math.max(\n          Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight),\n          Math.max(doc.body.offsetHeight, doc.documentElement.offsetHeight),\n          Math.max(doc.body.clientHeight, doc.documentElement.clientHeight)\n          );\n      }\n    \n      function getCSSInt(element, attribute) {\n        var val = parseInt(getCSS(element, attribute), 10);\n        return (isNaN(val)) ? 0 : val; // borders in old IE are throwing 'medium' for demo.html\n      }\n    \n      function renderRect (ctx, x, y, w, h, bgcolor) {\n        if (bgcolor !== \"transparent\"){\n          ctx.setVariable(\"fillStyle\", bgcolor);\n          ctx.fillRect(x, y, w, h);\n          numDraws+=1;\n        }\n      }\n    \n      function capitalize(m, p1, p2) {\n        if (m.length > 0) {\n          return p1 + p2.toUpperCase();\n        }\n      }\n    \n      function textTransform (text, transform) {\n        switch(transform){\n          case \"lowercase\":\n            return text.toLowerCase();\n          case \"capitalize\":\n            return text.replace( /(^|\\s|:|-|\\(|\\))([a-z])/g, capitalize);\n          case \"uppercase\":\n            return text.toUpperCase();\n          default:\n            return text;\n        }\n      }\n    \n      function noLetterSpacing(letter_spacing) {\n        return (/^(normal|none|0px)$/.test(letter_spacing));\n      }\n    \n      function drawText(currentText, x, y, ctx){\n        if (currentText !== null && Util.trimText(currentText).length > 0) {\n          ctx.fillText(currentText, x, y);\n          numDraws+=1;\n        }\n      }\n    \n      function setTextVariables(ctx, el, text_decoration, color) {\n        var align = false,\n        bold = getCSS(el, \"fontWeight\"),\n        family = getCSS(el, \"fontFamily\"),\n        size = getCSS(el, \"fontSize\"),\n        shadows = Util.parseTextShadows(getCSS(el, \"textShadow\"));\n    \n        switch(parseInt(bold, 10)){\n          case 401:\n            bold = \"bold\";\n            break;\n          case 400:\n            bold = \"normal\";\n            break;\n        }\n    \n        ctx.setVariable(\"fillStyle\", color);\n        ctx.setVariable(\"font\", [getCSS(el, \"fontStyle\"), getCSS(el, \"fontVariant\"), bold, size, family].join(\" \"));\n        ctx.setVariable(\"textAlign\", (align) ? \"right\" : \"left\");\n    \n        if (shadows.length) {\n          // TODO: support multiple text shadows\n          // apply the first text shadow\n          ctx.setVariable(\"shadowColor\", shadows[0].color);\n          ctx.setVariable(\"shadowOffsetX\", shadows[0].offsetX);\n          ctx.setVariable(\"shadowOffsetY\", shadows[0].offsetY);\n          ctx.setVariable(\"shadowBlur\", shadows[0].blur);\n        }\n    \n        if (text_decoration !== \"none\"){\n          return Util.Font(family, size, doc);\n        }\n      }\n    \n      function renderTextDecoration(ctx, text_decoration, bounds, metrics, color) {\n        switch(text_decoration) {\n          case \"underline\":\n            // Draws a line at the baseline of the font\n            // TODO As some browsers display the line as more than 1px if the font-size is big, need to take that into account both in position and size\n            renderRect(ctx, bounds.left, Math.round(bounds.top + metrics.baseline + metrics.lineWidth), bounds.width, 1, color);\n            break;\n          case \"overline\":\n            renderRect(ctx, bounds.left, Math.round(bounds.top), bounds.width, 1, color);\n            break;\n          case \"line-through\":\n            // TODO try and find exact position for line-through\n            renderRect(ctx, bounds.left, Math.ceil(bounds.top + metrics.middle + metrics.lineWidth), bounds.width, 1, color);\n            break;\n        }\n      }\n    \n      function getTextBounds(state, text, textDecoration, isLast, transform) {\n        var bounds;\n        if (support.rangeBounds && !transform) {\n          if (textDecoration !== \"none\" || Util.trimText(text).length !== 0) {\n            bounds = textRangeBounds(text, state.node, state.textOffset);\n          }\n          state.textOffset += text.length;\n        } else if (state.node && typeof state.node.nodeValue === \"string\" ){\n          var newTextNode = (isLast) ? state.node.splitText(text.length) : null;\n          bounds = textWrapperBounds(state.node, transform);\n          state.node = newTextNode;\n        }\n        return bounds;\n      }\n    \n      function textRangeBounds(text, textNode, textOffset) {\n        var range = doc.createRange();\n        range.setStart(textNode, textOffset);\n        range.setEnd(textNode, textOffset + text.length);\n        return range.getBoundingClientRect();\n      }\n    \n      function textWrapperBounds(oldTextNode, transform) {\n        var parent = oldTextNode.parentNode,\n        wrapElement = doc.createElement('wrapper'),\n        backupText = oldTextNode.cloneNode(true);\n    \n        wrapElement.appendChild(oldTextNode.cloneNode(true));\n        parent.replaceChild(wrapElement, oldTextNode);\n    \n        var bounds = transform ? Util.OffsetBounds(wrapElement) : Util.Bounds(wrapElement);\n        parent.replaceChild(backupText, wrapElement);\n        return bounds;\n      }\n    \n      function renderText(el, textNode, stack) {\n        var ctx = stack.ctx,\n        color = getCSS(el, \"color\"),\n        textDecoration = getCSS(el, \"textDecoration\"),\n        textAlign = getCSS(el, \"textAlign\"),\n        metrics,\n        textList,\n        state = {\n          node: textNode,\n          textOffset: 0\n        };\n    \n        if (Util.trimText(textNode.nodeValue).length > 0) {\n          textNode.nodeValue = textTransform(textNode.nodeValue, getCSS(el, \"textTransform\"));\n          textAlign = textAlign.replace([\"-webkit-auto\"],[\"auto\"]);\n    \n          textList = (!options.letterRendering && /^(left|right|justify|auto|center)$/.test(textAlign) && noLetterSpacing(getCSS(el, \"letterSpacing\"))) ?\n          textNode.nodeValue.split(/(\\b| )/)\n          : textNode.nodeValue.split(\"\");\n    \n          metrics = setTextVariables(ctx, el, textDecoration, color);\n    \n          if (options.chinese) {\n            textList.forEach(function(word, index) {\n              if (/.*[\\u4E00-\\u9FA5].*$/.test(word)) {\n                word = word.split(\"\");\n                word.unshift(index, 1);\n                textList.splice.apply(textList, word);\n              }\n            });\n          }\n    \n          textList.forEach(function(text, index) {\n            var bounds = getTextBounds(state, text, textDecoration, (index < textList.length - 1), stack.transform.matrix);\n            if (bounds) {\n              drawText(text, bounds.left, bounds.bottom, ctx);\n              renderTextDecoration(ctx, textDecoration, bounds, metrics, color);\n            }\n          });\n        }\n      }\n    \n      function listPosition (element, val) {\n        var boundElement = doc.createElement( \"boundelement\" ),\n        originalType,\n        bounds;\n    \n        boundElement.style.display = \"inline\";\n    \n        originalType = element.style.listStyleType;\n        element.style.listStyleType = \"none\";\n    \n        boundElement.appendChild(doc.createTextNode(val));\n    \n        element.insertBefore(boundElement, element.firstChild);\n    \n        bounds = Util.Bounds(boundElement);\n        element.removeChild(boundElement);\n        element.style.listStyleType = originalType;\n        return bounds;\n      }\n    \n      function elementIndex(el) {\n        var i = -1,\n        count = 1,\n        childs = el.parentNode.childNodes;\n    \n        if (el.parentNode) {\n          while(childs[++i] !== el) {\n            if (childs[i].nodeType === 1) {\n              count++;\n            }\n          }\n          return count;\n        } else {\n          return -1;\n        }\n      }\n    \n      function listItemText(element, type) {\n        var currentIndex = elementIndex(element), text;\n        switch(type){\n          case \"decimal\":\n            text = currentIndex;\n            break;\n          case \"decimal-leading-zero\":\n            text = (currentIndex.toString().length === 1) ? currentIndex = \"0\" + currentIndex.toString() : currentIndex.toString();\n            break;\n          case \"upper-roman\":\n            text = _html2canvas.Generate.ListRoman( currentIndex );\n            break;\n          case \"lower-roman\":\n            text = _html2canvas.Generate.ListRoman( currentIndex ).toLowerCase();\n            break;\n          case \"lower-alpha\":\n            text = _html2canvas.Generate.ListAlpha( currentIndex ).toLowerCase();\n            break;\n          case \"upper-alpha\":\n            text = _html2canvas.Generate.ListAlpha( currentIndex );\n            break;\n        }\n    \n        return text + \". \";\n      }\n    \n      function renderListItem(element, stack, elBounds) {\n        var x,\n        text,\n        ctx = stack.ctx,\n        type = getCSS(element, \"listStyleType\"),\n        listBounds;\n    \n        if (/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(type)) {\n          text = listItemText(element, type);\n          listBounds = listPosition(element, text);\n          setTextVariables(ctx, element, \"none\", getCSS(element, \"color\"));\n    \n          if (getCSS(element, \"listStylePosition\") === \"inside\") {\n            ctx.setVariable(\"textAlign\", \"left\");\n            x = elBounds.left;\n          } else {\n            return;\n          }\n    \n          drawText(text, x, listBounds.bottom, ctx);\n        }\n      }\n    \n      function loadImage (src){\n        var img = images[src];\n        return (img && img.succeeded === true) ? img.img : false;\n      }\n    \n      function clipBounds(src, dst){\n        var x = Math.max(src.left, dst.left),\n        y = Math.max(src.top, dst.top),\n        x2 = Math.min((src.left + src.width), (dst.left + dst.width)),\n        y2 = Math.min((src.top + src.height), (dst.top + dst.height));\n    \n        return {\n          left:x,\n          top:y,\n          width:x2-x,\n          height:y2-y\n        };\n      }\n    \n      function setZ(element, stack, parentStack){\n        var newContext,\n        isPositioned = stack.cssPosition !== 'static',\n        zIndex = isPositioned ? getCSS(element, 'zIndex') : 'auto',\n        opacity = getCSS(element, 'opacity'),\n        isFloated = getCSS(element, 'cssFloat') !== 'none';\n    \n        // https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Understanding_z_index/The_stacking_context\n        // When a new stacking context should be created:\n        // the root element (HTML),\n        // positioned (absolutely or relatively) with a z-index value other than \"auto\",\n        // elements with an opacity value less than 1. (See the specification for opacity),\n        // on mobile WebKit and Chrome 22+, position: fixed always creates a new stacking context, even when z-index is \"auto\" (See this post)\n    \n        stack.zIndex = newContext = h2czContext(zIndex);\n        newContext.isPositioned = isPositioned;\n        newContext.isFloated = isFloated;\n        newContext.opacity = opacity;\n        newContext.ownStacking = (zIndex !== 'auto' || opacity < 1);\n    \n        if (parentStack) {\n          parentStack.zIndex.children.push(stack);\n        }\n      }\n    \n      function renderImage(ctx, element, image, bounds, borders) {\n    \n        var paddingLeft = getCSSInt(element, 'paddingLeft'),\n        paddingTop = getCSSInt(element, 'paddingTop'),\n        paddingRight = getCSSInt(element, 'paddingRight'),\n        paddingBottom = getCSSInt(element, 'paddingBottom');\n    \n        drawImage(\n          ctx,\n          image,\n          0, //sx\n          0, //sy\n          image.width, //sw\n          image.height, //sh\n          bounds.left + paddingLeft + borders[3].width, //dx\n          bounds.top + paddingTop + borders[0].width, // dy\n          bounds.width - (borders[1].width + borders[3].width + paddingLeft + paddingRight), //dw\n          bounds.height - (borders[0].width + borders[2].width + paddingTop + paddingBottom) //dh\n          );\n      }\n    \n      function getBorderData(element) {\n        return [\"Top\", \"Right\", \"Bottom\", \"Left\"].map(function(side) {\n          return {\n            width: getCSSInt(element, 'border' + side + 'Width'),\n            color: getCSS(element, 'border' + side + 'Color')\n          };\n        });\n      }\n    \n      function getBorderRadiusData(element) {\n        return [\"TopLeft\", \"TopRight\", \"BottomRight\", \"BottomLeft\"].map(function(side) {\n          return getCSS(element, 'border' + side + 'Radius');\n        });\n      }\n    \n      var getCurvePoints = (function(kappa) {\n    \n        return function(x, y, r1, r2) {\n          var ox = (r1) * kappa, // control point offset horizontal\n          oy = (r2) * kappa, // control point offset vertical\n          xm = x + r1, // x-middle\n          ym = y + r2; // y-middle\n          return {\n            topLeft: bezierCurve({\n              x:x,\n              y:ym\n            }, {\n              x:x,\n              y:ym - oy\n            }, {\n              x:xm - ox,\n              y:y\n            }, {\n              x:xm,\n              y:y\n            }),\n            topRight: bezierCurve({\n              x:x,\n              y:y\n            }, {\n              x:x + ox,\n              y:y\n            }, {\n              x:xm,\n              y:ym - oy\n            }, {\n              x:xm,\n              y:ym\n            }),\n            bottomRight: bezierCurve({\n              x:xm,\n              y:y\n            }, {\n              x:xm,\n              y:y + oy\n            }, {\n              x:x + ox,\n              y:ym\n            }, {\n              x:x,\n              y:ym\n            }),\n            bottomLeft: bezierCurve({\n              x:xm,\n              y:ym\n            }, {\n              x:xm - ox,\n              y:ym\n            }, {\n              x:x,\n              y:y + oy\n            }, {\n              x:x,\n              y:y\n            })\n          };\n        };\n      })(4 * ((Math.sqrt(2) - 1) / 3));\n    \n      function bezierCurve(start, startControl, endControl, end) {\n    \n        var lerp = function (a, b, t) {\n          return {\n            x:a.x + (b.x - a.x) * t,\n            y:a.y + (b.y - a.y) * t\n          };\n        };\n    \n        return {\n          start: start,\n          startControl: startControl,\n          endControl: endControl,\n          end: end,\n          subdivide: function(t) {\n            var ab = lerp(start, startControl, t),\n            bc = lerp(startControl, endControl, t),\n            cd = lerp(endControl, end, t),\n            abbc = lerp(ab, bc, t),\n            bccd = lerp(bc, cd, t),\n            dest = lerp(abbc, bccd, t);\n            return [bezierCurve(start, ab, abbc, dest), bezierCurve(dest, bccd, cd, end)];\n          },\n          curveTo: function(borderArgs) {\n            borderArgs.push([\"bezierCurve\", startControl.x, startControl.y, endControl.x, endControl.y, end.x, end.y]);\n          },\n          curveToReversed: function(borderArgs) {\n            borderArgs.push([\"bezierCurve\", endControl.x, endControl.y, startControl.x, startControl.y, start.x, start.y]);\n          }\n        };\n      }\n    \n      function parseCorner(borderArgs, radius1, radius2, corner1, corner2, x, y) {\n        if (radius1[0] > 0 || radius1[1] > 0) {\n          borderArgs.push([\"line\", corner1[0].start.x, corner1[0].start.y]);\n          corner1[0].curveTo(borderArgs);\n          corner1[1].curveTo(borderArgs);\n        } else {\n          borderArgs.push([\"line\", x, y]);\n        }\n    \n        if (radius2[0] > 0 || radius2[1] > 0) {\n          borderArgs.push([\"line\", corner2[0].start.x, corner2[0].start.y]);\n        }\n      }\n    \n      function drawSide(borderData, radius1, radius2, outer1, inner1, outer2, inner2) {\n        var borderArgs = [];\n    \n        if (radius1[0] > 0 || radius1[1] > 0) {\n          borderArgs.push([\"line\", outer1[1].start.x, outer1[1].start.y]);\n          outer1[1].curveTo(borderArgs);\n        } else {\n          borderArgs.push([ \"line\", borderData.c1[0], borderData.c1[1]]);\n        }\n    \n        if (radius2[0] > 0 || radius2[1] > 0) {\n          borderArgs.push([\"line\", outer2[0].start.x, outer2[0].start.y]);\n          outer2[0].curveTo(borderArgs);\n          borderArgs.push([\"line\", inner2[0].end.x, inner2[0].end.y]);\n          inner2[0].curveToReversed(borderArgs);\n        } else {\n          borderArgs.push([ \"line\", borderData.c2[0], borderData.c2[1]]);\n          borderArgs.push([ \"line\", borderData.c3[0], borderData.c3[1]]);\n        }\n    \n        if (radius1[0] > 0 || radius1[1] > 0) {\n          borderArgs.push([\"line\", inner1[1].end.x, inner1[1].end.y]);\n          inner1[1].curveToReversed(borderArgs);\n        } else {\n          borderArgs.push([ \"line\", borderData.c4[0], borderData.c4[1]]);\n        }\n    \n        return borderArgs;\n      }\n    \n      function calculateCurvePoints(bounds, borderRadius, borders) {\n    \n        var x = bounds.left,\n        y = bounds.top,\n        width = bounds.width,\n        height = bounds.height,\n    \n        tlh = borderRadius[0][0],\n        tlv = borderRadius[0][1],\n        trh = borderRadius[1][0],\n        trv = borderRadius[1][1],\n        brh = borderRadius[2][0],\n        brv = borderRadius[2][1],\n        blh = borderRadius[3][0],\n        blv = borderRadius[3][1],\n    \n        topWidth = width - trh,\n        rightHeight = height - brv,\n        bottomWidth = width - brh,\n        leftHeight = height - blv;\n    \n        return {\n          topLeftOuter: getCurvePoints(\n            x,\n            y,\n            tlh,\n            tlv\n            ).topLeft.subdivide(0.5),\n    \n          topLeftInner: getCurvePoints(\n            x + borders[3].width,\n            y + borders[0].width,\n            Math.max(0, tlh - borders[3].width),\n            Math.max(0, tlv - borders[0].width)\n            ).topLeft.subdivide(0.5),\n    \n          topRightOuter: getCurvePoints(\n            x + topWidth,\n            y,\n            trh,\n            trv\n            ).topRight.subdivide(0.5),\n    \n          topRightInner: getCurvePoints(\n            x + Math.min(topWidth, width + borders[3].width),\n            y + borders[0].width,\n            (topWidth > width + borders[3].width) ? 0 :trh - borders[3].width,\n            trv - borders[0].width\n            ).topRight.subdivide(0.5),\n    \n          bottomRightOuter: getCurvePoints(\n            x + bottomWidth,\n            y + rightHeight,\n            brh,\n            brv\n            ).bottomRight.subdivide(0.5),\n    \n          bottomRightInner: getCurvePoints(\n            x + Math.min(bottomWidth, width + borders[3].width),\n            y + Math.min(rightHeight, height + borders[0].width),\n            Math.max(0, brh - borders[1].width),\n            Math.max(0, brv - borders[2].width)\n            ).bottomRight.subdivide(0.5),\n    \n          bottomLeftOuter: getCurvePoints(\n            x,\n            y + leftHeight,\n            blh,\n            blv\n            ).bottomLeft.subdivide(0.5),\n    \n          bottomLeftInner: getCurvePoints(\n            x + borders[3].width,\n            y + leftHeight,\n            Math.max(0, blh - borders[3].width),\n            Math.max(0, blv - borders[2].width)\n            ).bottomLeft.subdivide(0.5)\n        };\n      }\n    \n      function getBorderClip(element, borderPoints, borders, radius, bounds) {\n        var backgroundClip = getCSS(element, 'backgroundClip'),\n        borderArgs = [];\n    \n        switch(backgroundClip) {\n          case \"content-box\":\n          case \"padding-box\":\n            parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftInner, borderPoints.topRightInner, bounds.left + borders[3].width, bounds.top + borders[0].width);\n            parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightInner, borderPoints.bottomRightInner, bounds.left + bounds.width - borders[1].width, bounds.top + borders[0].width);\n            parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightInner, borderPoints.bottomLeftInner, bounds.left + bounds.width - borders[1].width, bounds.top + bounds.height - borders[2].width);\n            parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftInner, borderPoints.topLeftInner, bounds.left + borders[3].width, bounds.top + bounds.height - borders[2].width);\n            break;\n    \n          default:\n            parseCorner(borderArgs, radius[0], radius[1], borderPoints.topLeftOuter, borderPoints.topRightOuter, bounds.left, bounds.top);\n            parseCorner(borderArgs, radius[1], radius[2], borderPoints.topRightOuter, borderPoints.bottomRightOuter, bounds.left + bounds.width, bounds.top);\n            parseCorner(borderArgs, radius[2], radius[3], borderPoints.bottomRightOuter, borderPoints.bottomLeftOuter, bounds.left + bounds.width, bounds.top + bounds.height);\n            parseCorner(borderArgs, radius[3], radius[0], borderPoints.bottomLeftOuter, borderPoints.topLeftOuter, bounds.left, bounds.top + bounds.height);\n            break;\n        }\n    \n        return borderArgs;\n      }\n    \n      function parseBorders(element, bounds, borders){\n        var x = bounds.left,\n        y = bounds.top,\n        width = bounds.width,\n        height = bounds.height,\n        borderSide,\n        bx,\n        by,\n        bw,\n        bh,\n        borderArgs,\n        // http://www.w3.org/TR/css3-background/#the-border-radius\n        borderRadius = getBorderRadiusData(element),\n        borderPoints = calculateCurvePoints(bounds, borderRadius, borders),\n        borderData = {\n          clip: getBorderClip(element, borderPoints, borders, borderRadius, bounds),\n          borders: []\n        };\n    \n        for (borderSide = 0; borderSide < 4; borderSide++) {\n    \n          if (borders[borderSide].width > 0) {\n            bx = x;\n            by = y;\n            bw = width;\n            bh = height - (borders[2].width);\n    \n            switch(borderSide) {\n              case 0:\n                // top border\n                bh = borders[0].width;\n    \n                borderArgs = drawSide({\n                  c1: [bx, by],\n                  c2: [bx + bw, by],\n                  c3: [bx + bw - borders[1].width, by + bh],\n                  c4: [bx + borders[3].width, by + bh]\n                }, borderRadius[0], borderRadius[1],\n                borderPoints.topLeftOuter, borderPoints.topLeftInner, borderPoints.topRightOuter, borderPoints.topRightInner);\n                break;\n              case 1:\n                // right border\n                bx = x + width - (borders[1].width);\n                bw = borders[1].width;\n    \n                borderArgs = drawSide({\n                  c1: [bx + bw, by],\n                  c2: [bx + bw, by + bh + borders[2].width],\n                  c3: [bx, by + bh],\n                  c4: [bx, by + borders[0].width]\n                }, borderRadius[1], borderRadius[2],\n                borderPoints.topRightOuter, borderPoints.topRightInner, borderPoints.bottomRightOuter, borderPoints.bottomRightInner);\n                break;\n              case 2:\n                // bottom border\n                by = (by + height) - (borders[2].width);\n                bh = borders[2].width;\n    \n                borderArgs = drawSide({\n                  c1: [bx + bw, by + bh],\n                  c2: [bx, by + bh],\n                  c3: [bx + borders[3].width, by],\n                  c4: [bx + bw - borders[3].width, by]\n                }, borderRadius[2], borderRadius[3],\n                borderPoints.bottomRightOuter, borderPoints.bottomRightInner, borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner);\n                break;\n              case 3:\n                // left border\n                bw = borders[3].width;\n    \n                borderArgs = drawSide({\n                  c1: [bx, by + bh + borders[2].width],\n                  c2: [bx, by],\n                  c3: [bx + bw, by + borders[0].width],\n                  c4: [bx + bw, by + bh]\n                }, borderRadius[3], borderRadius[0],\n                borderPoints.bottomLeftOuter, borderPoints.bottomLeftInner, borderPoints.topLeftOuter, borderPoints.topLeftInner);\n                break;\n            }\n    \n            borderData.borders.push({\n              args: borderArgs,\n              color: borders[borderSide].color\n            });\n    \n          }\n        }\n    \n        return borderData;\n      }\n    \n      function createShape(ctx, args) {\n        var shape = ctx.drawShape();\n        args.forEach(function(border, index) {\n          shape[(index === 0) ? \"moveTo\" : border[0] + \"To\" ].apply(null, border.slice(1));\n        });\n        return shape;\n      }\n    \n      function renderBorders(ctx, borderArgs, color) {\n        if (color !== \"transparent\") {\n          ctx.setVariable( \"fillStyle\", color);\n          createShape(ctx, borderArgs);\n          ctx.fill();\n          numDraws+=1;\n        }\n      }\n    \n      function renderFormValue (el, bounds, stack){\n    \n        var valueWrap = doc.createElement('valuewrap'),\n        cssPropertyArray = ['lineHeight','textAlign','fontFamily','color','fontSize','paddingLeft','paddingTop','width','height','border','borderLeftWidth','borderTopWidth'],\n        textValue,\n        textNode;\n    \n        cssPropertyArray.forEach(function(property) {\n          try {\n            valueWrap.style[property] = getCSS(el, property);\n          } catch(e) {\n            // Older IE has issues with \"border\"\n            Util.log(\"html2canvas: Parse: Exception caught in renderFormValue: \" + e.message);\n          }\n        });\n    \n        valueWrap.style.borderColor = \"black\";\n        valueWrap.style.borderStyle = \"solid\";\n        valueWrap.style.display = \"block\";\n        valueWrap.style.position = \"absolute\";\n    \n        if (/^(submit|reset|button|text|password)$/.test(el.type) || el.nodeName === \"SELECT\"){\n          valueWrap.style.lineHeight = getCSS(el, \"height\");\n        }\n    \n        valueWrap.style.top = bounds.top + \"px\";\n        valueWrap.style.left = bounds.left + \"px\";\n    \n        textValue = (el.nodeName === \"SELECT\") ? (el.options[el.selectedIndex] || 0).text : el.value;\n        if(!textValue) {\n          textValue = el.placeholder;\n        }\n    \n        textNode = doc.createTextNode(textValue);\n    \n        valueWrap.appendChild(textNode);\n        body.appendChild(valueWrap);\n    \n        renderText(el, textNode, stack);\n        body.removeChild(valueWrap);\n      }\n    \n      function drawImage (ctx) {\n        ctx.drawImage.apply(ctx, Array.prototype.slice.call(arguments, 1));\n        numDraws+=1;\n      }\n    \n      function getPseudoElement(el, which) {\n        var elStyle = window.getComputedStyle(el, which);\n        if(!elStyle || !elStyle.content || elStyle.content === \"none\" || elStyle.content === \"-moz-alt-content\" || elStyle.display === \"none\") {\n          return;\n        }\n        var content = elStyle.content + '',\n        first = content.substr( 0, 1 );\n        //strips quotes\n        if(first === content.substr( content.length - 1 ) && first.match(/'|\"/)) {\n          content = content.substr( 1, content.length - 2 );\n        }\n    \n        var isImage = content.substr( 0, 3 ) === 'url',\n        elps = document.createElement( isImage ? 'img' : 'span' );\n    \n        elps.className = pseudoHide + \"-before \" + pseudoHide + \"-after\";\n    \n        Object.keys(elStyle).filter(indexedProperty).forEach(function(prop) {\n          // Prevent assigning of read only CSS Rules, ex. length, parentRule\n          try {\n            elps.style[prop] = elStyle[prop];\n          } catch (e) {\n            Util.log(['Tried to assign readonly property ', prop, 'Error:', e]);\n          }\n        });\n    \n        if(isImage) {\n          elps.src = Util.parseBackgroundImage(content)[0].args[0];\n        } else {\n          elps.innerHTML = content;\n        }\n        return elps;\n      }\n    \n      function indexedProperty(property) {\n        return (isNaN(window.parseInt(property, 10)));\n      }\n    \n      function injectPseudoElements(el, stack) {\n        var before = getPseudoElement(el, ':before'),\n        after = getPseudoElement(el, ':after');\n        if(!before && !after) {\n          return;\n        }\n    \n        if(before) {\n          el.className += \" \" + pseudoHide + \"-before\";\n          el.parentNode.insertBefore(before, el);\n          parseElement(before, stack, true);\n          el.parentNode.removeChild(before);\n          el.className = el.className.replace(pseudoHide + \"-before\", \"\").trim();\n        }\n    \n        if (after) {\n          el.className += \" \" + pseudoHide + \"-after\";\n          el.appendChild(after);\n          parseElement(after, stack, true);\n          el.removeChild(after);\n          el.className = el.className.replace(pseudoHide + \"-after\", \"\").trim();\n        }\n    \n      }\n    \n      function renderBackgroundRepeat(ctx, image, backgroundPosition, bounds) {\n        var offsetX = Math.round(bounds.left + backgroundPosition.left),\n        offsetY = Math.round(bounds.top + backgroundPosition.top);\n    \n        ctx.createPattern(image);\n        ctx.translate(offsetX, offsetY);\n        ctx.fill();\n        ctx.translate(-offsetX, -offsetY);\n      }\n    \n      function backgroundRepeatShape(ctx, image, backgroundPosition, bounds, left, top, width, height) {\n        var args = [];\n        args.push([\"line\", Math.round(left), Math.round(top)]);\n        args.push([\"line\", Math.round(left + width), Math.round(top)]);\n        args.push([\"line\", Math.round(left + width), Math.round(height + top)]);\n        args.push([\"line\", Math.round(left), Math.round(height + top)]);\n        createShape(ctx, args);\n        ctx.save();\n        ctx.clip();\n        renderBackgroundRepeat(ctx, image, backgroundPosition, bounds);\n        ctx.restore();\n      }\n    \n      function renderBackgroundColor(ctx, backgroundBounds, bgcolor) {\n        renderRect(\n          ctx,\n          backgroundBounds.left,\n          backgroundBounds.top,\n          backgroundBounds.width,\n          backgroundBounds.height,\n          bgcolor\n          );\n      }\n    \n      function renderBackgroundRepeating(el, bounds, ctx, image, imageIndex) {\n        var backgroundSize = Util.BackgroundSize(el, bounds, image, imageIndex),\n        backgroundPosition = Util.BackgroundPosition(el, bounds, image, imageIndex, backgroundSize),\n        backgroundRepeat = getCSS(el, \"backgroundRepeat\").split(\",\").map(Util.trimText);\n    \n        image = resizeImage(image, backgroundSize);\n    \n        backgroundRepeat = backgroundRepeat[imageIndex] || backgroundRepeat[0];\n    \n        switch (backgroundRepeat) {\n          case \"repeat-x\":\n            backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\n              bounds.left, bounds.top + backgroundPosition.top, 99999, image.height);\n            break;\n    \n          case \"repeat-y\":\n            backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\n              bounds.left + backgroundPosition.left, bounds.top, image.width, 99999);\n            break;\n    \n          case \"no-repeat\":\n            backgroundRepeatShape(ctx, image, backgroundPosition, bounds,\n              bounds.left + backgroundPosition.left, bounds.top + backgroundPosition.top, image.width, image.height);\n            break;\n    \n          default:\n            renderBackgroundRepeat(ctx, image, backgroundPosition, {\n              top: bounds.top,\n              left: bounds.left,\n              width: image.width,\n              height: image.height\n            });\n            break;\n        }\n      }\n    \n      function renderBackgroundImage(element, bounds, ctx) {\n        var backgroundImage = getCSS(element, \"backgroundImage\"),\n        backgroundImages = Util.parseBackgroundImage(backgroundImage),\n        image,\n        imageIndex = backgroundImages.length;\n    \n        while(imageIndex--) {\n          backgroundImage = backgroundImages[imageIndex];\n    \n          if (!backgroundImage.args || backgroundImage.args.length === 0) {\n            continue;\n          }\n    \n          var key = backgroundImage.method === 'url' ?\n          backgroundImage.args[0] :\n          backgroundImage.value;\n    \n          image = loadImage(key);\n    \n          // TODO add support for background-origin\n          if (image) {\n            renderBackgroundRepeating(element, bounds, ctx, image, imageIndex);\n          } else {\n            Util.log(\"html2canvas: Error loading background:\", backgroundImage);\n          }\n        }\n      }\n    \n      function resizeImage(image, bounds) {\n        if(image.width === bounds.width && image.height === bounds.height) {\n          return image;\n        }\n    \n        var ctx, canvas = doc.createElement('canvas');\n        canvas.width = bounds.width;\n        canvas.height = bounds.height;\n        ctx = canvas.getContext(\"2d\");\n        drawImage(ctx, image, 0, 0, image.width, image.height, 0, 0, bounds.width, bounds.height );\n        return canvas;\n      }\n    \n      function setOpacity(ctx, element, parentStack) {\n        return ctx.setVariable(\"globalAlpha\", getCSS(element, \"opacity\") * ((parentStack) ? parentStack.opacity : 1));\n      }\n    \n      function removePx(str) {\n        return str.replace(\"px\", \"\");\n      }\n    \n      var transformRegExp = /(matrix)\\((.+)\\)/;\n    \n      function getTransform(element, parentStack) {\n        var transform = getCSS(element, \"transform\") || getCSS(element, \"-webkit-transform\") || getCSS(element, \"-moz-transform\") || getCSS(element, \"-ms-transform\") || getCSS(element, \"-o-transform\");\n        var transformOrigin = getCSS(element, \"transform-origin\") || getCSS(element, \"-webkit-transform-origin\") || getCSS(element, \"-moz-transform-origin\") || getCSS(element, \"-ms-transform-origin\") || getCSS(element, \"-o-transform-origin\") || \"0px 0px\";\n    \n        transformOrigin = transformOrigin.split(\" \").map(removePx).map(Util.asFloat);\n    \n        var matrix;\n        if (transform && transform !== \"none\") {\n          var match = transform.match(transformRegExp);\n          if (match) {\n            switch(match[1]) {\n              case \"matrix\":\n                matrix = match[2].split(\",\").map(Util.trimText).map(Util.asFloat);\n                break;\n            }\n          }\n        }\n    \n        return {\n          origin: transformOrigin,\n          matrix: matrix\n        };\n      }\n    \n      function createStack(element, parentStack, bounds, transform) {\n        var ctx = h2cRenderContext((!parentStack) ? documentWidth() : bounds.width , (!parentStack) ? documentHeight() : bounds.height),\n        stack = {\n          ctx: ctx,\n          opacity: setOpacity(ctx, element, parentStack),\n          cssPosition: getCSS(element, \"position\"),\n          borders: getBorderData(element),\n          transform: transform,\n          clip: (parentStack && parentStack.clip) ? Util.Extend( {}, parentStack.clip ) : null\n        };\n    \n        setZ(element, stack, parentStack);\n    \n        // TODO correct overflow for absolute content residing under a static position\n        if (options.useOverflow === true && /(hidden|scroll|auto)/.test(getCSS(element, \"overflow\")) === true && /(BODY)/i.test(element.nodeName) === false){\n          stack.clip = (stack.clip) ? clipBounds(stack.clip, bounds) : bounds;\n        }\n    \n        return stack;\n      }\n    \n      function getBackgroundBounds(borders, bounds, clip) {\n        var backgroundBounds = {\n          left: bounds.left + borders[3].width,\n          top: bounds.top + borders[0].width,\n          width: bounds.width - (borders[1].width + borders[3].width),\n          height: bounds.height - (borders[0].width + borders[2].width)\n        };\n    \n        if (clip) {\n          backgroundBounds = clipBounds(backgroundBounds, clip);\n        }\n    \n        return backgroundBounds;\n      }\n    \n      function getBounds(element, transform) {\n        var bounds = (transform.matrix) ? Util.OffsetBounds(element) : Util.Bounds(element);\n        transform.origin[0] += bounds.left;\n        transform.origin[1] += bounds.top;\n        return bounds;\n      }\n    \n      function renderElement(element, parentStack, pseudoElement, ignoreBackground) {\n        var transform = getTransform(element, parentStack),\n        bounds = getBounds(element, transform),\n        image,\n        stack = createStack(element, parentStack, bounds, transform),\n        borders = stack.borders,\n        ctx = stack.ctx,\n        backgroundBounds = getBackgroundBounds(borders, bounds, stack.clip),\n        borderData = parseBorders(element, bounds, borders),\n        backgroundColor = (ignoreElementsRegExp.test(element.nodeName)) ? \"#efefef\" : getCSS(element, \"backgroundColor\");\n    \n    \n        createShape(ctx, borderData.clip);\n    \n        ctx.save();\n        ctx.clip();\n    \n        if (backgroundBounds.height > 0 && backgroundBounds.width > 0 && !ignoreBackground) {\n          renderBackgroundColor(ctx, bounds, backgroundColor);\n          renderBackgroundImage(element, backgroundBounds, ctx);\n        } else if (ignoreBackground) {\n          stack.backgroundColor =  backgroundColor;\n        }\n    \n        ctx.restore();\n    \n        borderData.borders.forEach(function(border) {\n          renderBorders(ctx, border.args, border.color);\n        });\n    \n        if (!pseudoElement) {\n          injectPseudoElements(element, stack);\n        }\n    \n        switch(element.nodeName){\n          case \"IMG\":\n            if ((image = loadImage(element.getAttribute('src')))) {\n              renderImage(ctx, element, image, bounds, borders);\n            } else {\n              Util.log(\"html2canvas: Error loading <img>:\" + element.getAttribute('src'));\n            }\n            break;\n          case \"INPUT\":\n            // TODO add all relevant type's, i.e. HTML5 new stuff\n            // todo add support for placeholder attribute for browsers which support it\n            if (/^(text|url|email|submit|button|reset)$/.test(element.type) && (element.value || element.placeholder || \"\").length > 0){\n              renderFormValue(element, bounds, stack);\n            }\n            break;\n          case \"TEXTAREA\":\n            if ((element.value || element.placeholder || \"\").length > 0){\n              renderFormValue(element, bounds, stack);\n            }\n            break;\n          case \"SELECT\":\n            if ((element.options||element.placeholder || \"\").length > 0){\n              renderFormValue(element, bounds, stack);\n            }\n            break;\n          case \"LI\":\n            renderListItem(element, stack, backgroundBounds);\n            break;\n          case \"CANVAS\":\n            renderImage(ctx, element, element, bounds, borders);\n            break;\n        }\n    \n        return stack;\n      }\n    \n      function isElementVisible(element) {\n        return (getCSS(element, 'display') !== \"none\" && getCSS(element, 'visibility') !== \"hidden\" && !element.hasAttribute(\"data-html2canvas-ignore\"));\n      }\n    \n      function parseElement (element, stack, pseudoElement) {\n        if (isElementVisible(element)) {\n          stack = renderElement(element, stack, pseudoElement, false) || stack;\n          if (!ignoreElementsRegExp.test(element.nodeName)) {\n            parseChildren(element, stack, pseudoElement);\n          }\n        }\n      }\n    \n      function parseChildren(element, stack, pseudoElement) {\n        Util.Children(element).forEach(function(node) {\n          if (node.nodeType === node.ELEMENT_NODE) {\n            parseElement(node, stack, pseudoElement);\n          } else if (node.nodeType === node.TEXT_NODE) {\n            renderText(element, node, stack);\n          }\n        });\n      }\n    \n      function init() {\n        var background = getCSS(document.documentElement, \"backgroundColor\"),\n          transparentBackground = (Util.isTransparent(background) && element === document.body),\n          stack = renderElement(element, null, false, transparentBackground);\n        parseChildren(element, stack);\n    \n        if (transparentBackground) {\n          background = stack.backgroundColor;\n        }\n    \n        body.removeChild(hidePseudoElements);\n        return {\n          backgroundColor: background,\n          stack: stack\n        };\n      }\n    \n      return init();\n    };\n    \n    function h2czContext(zindex) {\n      return {\n        zindex: zindex,\n        children: []\n      };\n    }\n    \n    _html2canvas.Preload = function( options ) {\n    \n      var images = {\n        numLoaded: 0,   // also failed are counted here\n        numFailed: 0,\n        numTotal: 0,\n        cleanupDone: false\n      },\n      pageOrigin,\n      Util = _html2canvas.Util,\n      methods,\n      i,\n      count = 0,\n      element = options.elements[0] || document.body,\n      doc = element.ownerDocument,\n      domImages = element.getElementsByTagName('img'), // Fetch images of the present element only\n      imgLen = domImages.length,\n      link = doc.createElement(\"a\"),\n      supportCORS = (function( img ){\n        return (img.crossOrigin !== undefined);\n      })(new Image()),\n      timeoutTimer;\n    \n      link.href = window.location.href;\n      pageOrigin  = link.protocol + link.host;\n    \n      function isSameOrigin(url){\n        link.href = url;\n        link.href = link.href; // YES, BELIEVE IT OR NOT, that is required for IE9 - http://jsfiddle.net/niklasvh/2e48b/\n        var origin = link.protocol + link.host;\n        return (origin === pageOrigin);\n      }\n    \n      function start(){\n        Util.log(\"html2canvas: start: images: \" + images.numLoaded + \" / \" + images.numTotal + \" (failed: \" + images.numFailed + \")\");\n        if (!images.firstRun && images.numLoaded >= images.numTotal){\n          Util.log(\"Finished loading images: # \" + images.numTotal + \" (failed: \" + images.numFailed + \")\");\n    \n          if (typeof options.complete === \"function\"){\n            options.complete(images);\n          }\n    \n        }\n      }\n    \n      // TODO modify proxy to serve images with CORS enabled, where available\n      function proxyGetImage(url, img, imageObj){\n        var callback_name,\n        scriptUrl = options.proxy,\n        script;\n    \n        link.href = url;\n        url = link.href; // work around for pages with base href=\"\" set - WARNING: this may change the url\n    \n        callback_name = 'html2canvas_' + (count++);\n        imageObj.callbackname = callback_name;\n    \n        if (scriptUrl.indexOf(\"?\") > -1) {\n          scriptUrl += \"&\";\n        } else {\n          scriptUrl += \"?\";\n        }\n        scriptUrl += 'url=' + encodeURIComponent(url) + '&callback=' + callback_name;\n        script = doc.createElement(\"script\");\n    \n        window[callback_name] = function(a){\n          if (a.substring(0,6) === \"error:\"){\n            imageObj.succeeded = false;\n            images.numLoaded++;\n            images.numFailed++;\n            start();\n          } else {\n            setImageLoadHandlers(img, imageObj);\n            img.src = a;\n          }\n          window[callback_name] = undefined; // to work with IE<9  // NOTE: that the undefined callback property-name still exists on the window object (for IE<9)\n          try {\n            delete window[callback_name];  // for all browser that support this\n          } catch(ex) {}\n          script.parentNode.removeChild(script);\n          script = null;\n          delete imageObj.script;\n          delete imageObj.callbackname;\n        };\n    \n        script.setAttribute(\"type\", \"text/javascript\");\n        script.setAttribute(\"src\", scriptUrl);\n        imageObj.script = script;\n        window.document.body.appendChild(script);\n    \n      }\n    \n      function loadPseudoElement(element, type) {\n        var style = window.getComputedStyle(element, type),\n        content = style.content;\n        if (content.substr(0, 3) === 'url') {\n          methods.loadImage(_html2canvas.Util.parseBackgroundImage(content)[0].args[0]);\n        }\n        loadBackgroundImages(style.backgroundImage, element);\n      }\n    \n      function loadPseudoElementImages(element) {\n        loadPseudoElement(element, \":before\");\n        loadPseudoElement(element, \":after\");\n      }\n    \n      function loadGradientImage(backgroundImage, bounds) {\n        var img = _html2canvas.Generate.Gradient(backgroundImage, bounds);\n    \n        if (img !== undefined){\n          images[backgroundImage] = {\n            img: img,\n            succeeded: true\n          };\n          images.numTotal++;\n          images.numLoaded++;\n          start();\n        }\n      }\n    \n      function invalidBackgrounds(background_image) {\n        return (background_image && background_image.method && background_image.args && background_image.args.length > 0 );\n      }\n    \n      function loadBackgroundImages(background_image, el) {\n        var bounds;\n    \n        _html2canvas.Util.parseBackgroundImage(background_image).filter(invalidBackgrounds).forEach(function(background_image) {\n          if (background_image.method === 'url') {\n            methods.loadImage(background_image.args[0]);\n          } else if(background_image.method.match(/\\-?gradient$/)) {\n            if(bounds === undefined) {\n              bounds = _html2canvas.Util.Bounds(el);\n            }\n            loadGradientImage(background_image.value, bounds);\n          }\n        });\n      }\n    \n      function getImages (el) {\n        var elNodeType = false;\n    \n        // Firefox fails with permission denied on pages with iframes\n        try {\n          Util.Children(el).forEach(getImages);\n        }\n        catch( e ) {}\n    \n        try {\n          elNodeType = el.nodeType;\n        } catch (ex) {\n          elNodeType = false;\n          Util.log(\"html2canvas: failed to access some element's nodeType - Exception: \" + ex.message);\n        }\n    \n        if (elNodeType === 1 || elNodeType === undefined) {\n          loadPseudoElementImages(el);\n          try {\n            loadBackgroundImages(Util.getCSS(el, 'backgroundImage'), el);\n          } catch(e) {\n            Util.log(\"html2canvas: failed to get background-image - Exception: \" + e.message);\n          }\n          loadBackgroundImages(el);\n        }\n      }\n    \n      function setImageLoadHandlers(img, imageObj) {\n        img.onload = function() {\n          if ( imageObj.timer !== undefined ) {\n            // CORS succeeded\n            window.clearTimeout( imageObj.timer );\n          }\n    \n          images.numLoaded++;\n          imageObj.succeeded = true;\n          img.onerror = img.onload = null;\n          start();\n        };\n        img.onerror = function() {\n          if (img.crossOrigin === \"anonymous\") {\n            // CORS failed\n            window.clearTimeout( imageObj.timer );\n    \n            // let's try with proxy instead\n            if ( options.proxy ) {\n              var src = img.src;\n              img = new Image();\n              imageObj.img = img;\n              img.src = src;\n    \n              proxyGetImage( img.src, img, imageObj );\n              return;\n            }\n          }\n    \n          images.numLoaded++;\n          images.numFailed++;\n          imageObj.succeeded = false;\n          img.onerror = img.onload = null;\n          start();\n        };\n      }\n    \n      methods = {\n        loadImage: function( src ) {\n          var img, imageObj;\n          if ( src && images[src] === undefined ) {\n            img = new Image();\n            if ( src.match(/data:image\\/.*;base64,/i) ) {\n              img.src = src.replace(/url\\(['\"]{0,}|['\"]{0,}\\)$/ig, '');\n              imageObj = images[src] = {\n                img: img\n              };\n              images.numTotal++;\n              setImageLoadHandlers(img, imageObj);\n            } else if ( isSameOrigin( src ) || options.allowTaint ===  true ) {\n              imageObj = images[src] = {\n                img: img\n              };\n              images.numTotal++;\n              setImageLoadHandlers(img, imageObj);\n              img.src = src;\n            } else if ( supportCORS && !options.allowTaint && options.useCORS ) {\n              // attempt to load with CORS\n    \n              img.crossOrigin = \"anonymous\";\n              imageObj = images[src] = {\n                img: img\n              };\n              images.numTotal++;\n              setImageLoadHandlers(img, imageObj);\n              img.src = src;\n            } else if ( options.proxy ) {\n              imageObj = images[src] = {\n                img: img\n              };\n              images.numTotal++;\n              proxyGetImage( src, img, imageObj );\n            }\n          }\n    \n        },\n        cleanupDOM: function(cause) {\n          var img, src;\n          if (!images.cleanupDone) {\n            if (cause && typeof cause === \"string\") {\n              Util.log(\"html2canvas: Cleanup because: \" + cause);\n            } else {\n              Util.log(\"html2canvas: Cleanup after timeout: \" + options.timeout + \" ms.\");\n            }\n    \n            for (src in images) {\n              if (images.hasOwnProperty(src)) {\n                img = images[src];\n                if (typeof img === \"object\" && img.callbackname && img.succeeded === undefined) {\n                  // cancel proxy image request\n                  window[img.callbackname] = undefined; // to work with IE<9  // NOTE: that the undefined callback property-name still exists on the window object (for IE<9)\n                  try {\n                    delete window[img.callbackname];  // for all browser that support this\n                  } catch(ex) {}\n                  if (img.script && img.script.parentNode) {\n                    img.script.setAttribute(\"src\", \"about:blank\");  // try to cancel running request\n                    img.script.parentNode.removeChild(img.script);\n                  }\n                  images.numLoaded++;\n                  images.numFailed++;\n                  Util.log(\"html2canvas: Cleaned up failed img: '\" + src + \"' Steps: \" + images.numLoaded + \" / \" + images.numTotal);\n                }\n              }\n            }\n    \n            // cancel any pending requests\n            if(window.stop !== undefined) {\n              window.stop();\n            } else if(document.execCommand !== undefined) {\n              document.execCommand(\"Stop\", false);\n            }\n            if (document.close !== undefined) {\n              document.close();\n            }\n            images.cleanupDone = true;\n            if (!(cause && typeof cause === \"string\")) {\n              start();\n            }\n          }\n        },\n    \n        renderingDone: function() {\n          if (timeoutTimer) {\n            window.clearTimeout(timeoutTimer);\n          }\n        }\n      };\n    \n      if (options.timeout > 0) {\n        timeoutTimer = window.setTimeout(methods.cleanupDOM, options.timeout);\n      }\n    \n      Util.log('html2canvas: Preload starts: finding background-images');\n      images.firstRun = true;\n    \n      getImages(element);\n    \n      Util.log('html2canvas: Preload: Finding images');\n      // load <img> images\n      for (i = 0; i < imgLen; i+=1){\n        methods.loadImage( domImages[i].getAttribute( \"src\" ) );\n      }\n    \n      images.firstRun = false;\n      Util.log('html2canvas: Preload: Done.');\n      if (images.numTotal === images.numLoaded) {\n        start();\n      }\n    \n      return methods;\n    };\n    \n    _html2canvas.Renderer = function(parseQueue, options){\n    \n      // http://www.w3.org/TR/CSS21/zindex.html\n      function createRenderQueue(parseQueue) {\n        var queue = [],\n        rootContext;\n    \n        rootContext = (function buildStackingContext(rootNode) {\n          var rootContext = {};\n          function insert(context, node, specialParent) {\n            var zi = (node.zIndex.zindex === 'auto') ? 0 : Number(node.zIndex.zindex),\n            contextForChildren = context, // the stacking context for children\n            isPositioned = node.zIndex.isPositioned,\n            isFloated = node.zIndex.isFloated,\n            stub = {node: node},\n            childrenDest = specialParent; // where children without z-index should be pushed into\n    \n            if (node.zIndex.ownStacking) {\n              // '!' comes before numbers in sorted array\n              contextForChildren = stub.context = { '!': [{node:node, children: []}]};\n              childrenDest = undefined;\n            } else if (isPositioned || isFloated) {\n              childrenDest = stub.children = [];\n            }\n    \n            if (zi === 0 && specialParent) {\n              specialParent.push(stub);\n            } else {\n              if (!context[zi]) { context[zi] = []; }\n              context[zi].push(stub);\n            }\n    \n            node.zIndex.children.forEach(function(childNode) {\n              insert(contextForChildren, childNode, childrenDest);\n            });\n          }\n          insert(rootContext, rootNode);\n          return rootContext;\n        })(parseQueue);\n    \n        function sortZ(context) {\n          Object.keys(context).sort().forEach(function(zi) {\n            var nonPositioned = [],\n            floated = [],\n            positioned = [],\n            list = [];\n    \n            // positioned after static\n            context[zi].forEach(function(v) {\n              if (v.node.zIndex.isPositioned || v.node.zIndex.opacity < 1) {\n                // http://www.w3.org/TR/css3-color/#transparency\n                // non-positioned element with opactiy < 1 should be stacked as if it were a positioned element with \u2018z-index: 0\u2019 and \u2018opacity: 1\u2019.\n                positioned.push(v);\n              } else if (v.node.zIndex.isFloated) {\n                floated.push(v);\n              } else {\n                nonPositioned.push(v);\n              }\n            });\n    \n            (function walk(arr) {\n              arr.forEach(function(v) {\n                list.push(v);\n                if (v.children) { walk(v.children); }\n              });\n            })(nonPositioned.concat(floated, positioned));\n    \n            list.forEach(function(v) {\n              if (v.context) {\n                sortZ(v.context);\n              } else {\n                queue.push(v.node);\n              }\n            });\n          });\n        }\n    \n        sortZ(rootContext);\n    \n        return queue;\n      }\n    \n      function getRenderer(rendererName) {\n        var renderer;\n    \n        if (typeof options.renderer === \"string\" && _html2canvas.Renderer[rendererName] !== undefined) {\n          renderer = _html2canvas.Renderer[rendererName](options);\n        } else if (typeof rendererName === \"function\") {\n          renderer = rendererName(options);\n        } else {\n          throw new Error(\"Unknown renderer\");\n        }\n    \n        if ( typeof renderer !== \"function\" ) {\n          throw new Error(\"Invalid renderer defined\");\n        }\n        return renderer;\n      }\n    \n      return getRenderer(options.renderer)(parseQueue, options, document, createRenderQueue(parseQueue.stack), _html2canvas);\n    };\n    \n    _html2canvas.Util.Support = function (options, doc) {\n    \n      function supportSVGRendering() {\n        var img = new Image(),\n        canvas = doc.createElement(\"canvas\"),\n        ctx = (canvas.getContext === undefined) ? false : canvas.getContext(\"2d\");\n        if (ctx === false) {\n          return false;\n        }\n        canvas.width = canvas.height = 10;\n        img.src = [\n        \"data:image/svg+xml,\",\n        \"<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>\",\n        \"<foreignObject width='10' height='10'>\",\n        \"<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>\",\n        \"sup\",\n        \"</div>\",\n        \"</foreignObject>\",\n        \"</svg>\"\n        ].join(\"\");\n        try {\n          ctx.drawImage(img, 0, 0);\n          canvas.toDataURL();\n        } catch(e) {\n          return false;\n        }\n        _html2canvas.Util.log('html2canvas: Parse: SVG powered rendering available');\n        return true;\n      }\n    \n      // Test whether we can use ranges to measure bounding boxes\n      // Opera doesn't provide valid bounds.height/bottom even though it supports the method.\n    \n      function supportRangeBounds() {\n        var r, testElement, rangeBounds, rangeHeight, support = false;\n    \n        if (doc.createRange) {\n          r = doc.createRange();\n          if (r.getBoundingClientRect) {\n            testElement = doc.createElement('boundtest');\n            testElement.style.height = \"123px\";\n            testElement.style.display = \"block\";\n            doc.body.appendChild(testElement);\n    \n            r.selectNode(testElement);\n            rangeBounds = r.getBoundingClientRect();\n            rangeHeight = rangeBounds.height;\n    \n            if (rangeHeight === 123) {\n              support = true;\n            }\n            doc.body.removeChild(testElement);\n          }\n        }\n    \n        return support;\n      }\n    \n      return {\n        rangeBounds: supportRangeBounds(),\n        svgRendering: options.svgRendering && supportSVGRendering()\n      };\n    };\n    window.html2canvas = function(elements, opts) {\n      elements = (elements.length) ? elements : [elements];\n      var queue,\n      canvas,\n      options = {\n        // general\n        logging: false,\n        elements: elements,\n        background: \"#fff\",\n    \n        // preload options\n        proxy: null,\n        timeout: 0,    // no timeout\n        useCORS: false, // try to load images as CORS (where available), before falling back to proxy\n        allowTaint: false, // whether to allow images to taint the canvas, won't need proxy if set to true\n    \n        // parse options\n        svgRendering: false, // use svg powered rendering where available (FF11+)\n        ignoreElements: \"IFRAME|OBJECT|PARAM\",\n        useOverflow: true,\n        letterRendering: false,\n        chinese: false,\n    \n        // render options\n    \n        width: null,\n        height: null,\n        taintTest: true, // do a taint test with all images before applying to canvas\n        renderer: \"Canvas\"\n      };\n    \n      options = _html2canvas.Util.Extend(opts, options);\n    \n      _html2canvas.logging = options.logging;\n      options.complete = function( images ) {\n    \n        if (typeof options.onpreloaded === \"function\") {\n          if ( options.onpreloaded( images ) === false ) {\n            return;\n          }\n        }\n        queue = _html2canvas.Parse( images, options );\n    \n        if (typeof options.onparsed === \"function\") {\n          if ( options.onparsed( queue ) === false ) {\n            return;\n          }\n        }\n    \n        canvas = _html2canvas.Renderer( queue, options );\n    \n        if (typeof options.onrendered === \"function\") {\n          options.onrendered( canvas );\n        }\n    \n    \n      };\n    \n      // for pages without images, we still want this to be async, i.e. return methods before executing\n      window.setTimeout( function(){\n        _html2canvas.Preload( options );\n      }, 0 );\n    \n      return {\n        render: function( queue, opts ) {\n          return _html2canvas.Renderer( queue, _html2canvas.Util.Extend(opts, options) );\n        },\n        parse: function( images, opts ) {\n          return _html2canvas.Parse( images, _html2canvas.Util.Extend(opts, options) );\n        },\n        preload: function( opts ) {\n          return _html2canvas.Preload( _html2canvas.Util.Extend(opts, options) );\n        },\n        log: _html2canvas.Util.log\n      };\n    };\n    \n    window.html2canvas.log = _html2canvas.Util.log; // for renderers\n    window.html2canvas.Renderer = {\n      Canvas: undefined // We are assuming this will be used\n    };\n    _html2canvas.Renderer.Canvas = function(options) {\n      options = options || {};\n    \n      var doc = document,\n      safeImages = [],\n      testCanvas = document.createElement(\"canvas\"),\n      testctx = testCanvas.getContext(\"2d\"),\n      Util = _html2canvas.Util,\n      canvas = options.canvas || doc.createElement('canvas');\n    \n      function createShape(ctx, args) {\n        ctx.beginPath();\n        args.forEach(function(arg) {\n          ctx[arg.name].apply(ctx, arg['arguments']);\n        });\n        ctx.closePath();\n      }\n    \n      function safeImage(item) {\n        if (safeImages.indexOf(item['arguments'][0].src ) === -1) {\n          testctx.drawImage(item['arguments'][0], 0, 0);\n          try {\n            testctx.getImageData(0, 0, 1, 1);\n          } catch(e) {\n            testCanvas = doc.createElement(\"canvas\");\n            testctx = testCanvas.getContext(\"2d\");\n            return false;\n          }\n          safeImages.push(item['arguments'][0].src);\n        }\n        return true;\n      }\n    \n      function renderItem(ctx, item) {\n        switch(item.type){\n          case \"variable\":\n            ctx[item.name] = item['arguments'];\n            break;\n          case \"function\":\n            switch(item.name) {\n              case \"createPattern\":\n                if (item['arguments'][0].width > 0 && item['arguments'][0].height > 0) {\n                  try {\n                    ctx.fillStyle = ctx.createPattern(item['arguments'][0], \"repeat\");\n                  }\n                  catch(e) {\n                    Util.log(\"html2canvas: Renderer: Error creating pattern\", e.message);\n                  }\n                }\n                break;\n              case \"drawShape\":\n                createShape(ctx, item['arguments']);\n                break;\n              case \"drawImage\":\n                if (item['arguments'][8] > 0 && item['arguments'][7] > 0) {\n                  if (!options.taintTest || (options.taintTest && safeImage(item))) {\n                    ctx.drawImage.apply( ctx, item['arguments'] );\n                  }\n                }\n                break;\n              default:\n                ctx[item.name].apply(ctx, item['arguments']);\n            }\n            break;\n        }\n      }\n    \n      return function(parsedData, options, document, queue, _html2canvas) {\n        var ctx = canvas.getContext(\"2d\"),\n        newCanvas,\n        bounds,\n        fstyle,\n        zStack = parsedData.stack;\n    \n        canvas.width = canvas.style.width =  options.width || zStack.ctx.width;\n        canvas.height = canvas.style.height = options.height || zStack.ctx.height;\n    \n        fstyle = ctx.fillStyle;\n        ctx.fillStyle = (Util.isTransparent(zStack.backgroundColor) && options.background !== undefined) ? options.background : parsedData.backgroundColor;\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        ctx.fillStyle = fstyle;\n    \n        queue.forEach(function(storageContext) {\n          // set common settings for canvas\n          ctx.textBaseline = \"bottom\";\n          ctx.save();\n    \n          if (storageContext.transform.matrix) {\n            ctx.translate(storageContext.transform.origin[0], storageContext.transform.origin[1]);\n            ctx.transform.apply(ctx, storageContext.transform.matrix);\n            ctx.translate(-storageContext.transform.origin[0], -storageContext.transform.origin[1]);\n          }\n    \n          if (storageContext.clip){\n            ctx.beginPath();\n            ctx.rect(storageContext.clip.left, storageContext.clip.top, storageContext.clip.width, storageContext.clip.height);\n            ctx.clip();\n          }\n    \n          if (storageContext.ctx.storage) {\n            storageContext.ctx.storage.forEach(function(item) {\n              renderItem(ctx, item);\n            });\n          }\n    \n          ctx.restore();\n        });\n    \n        Util.log(\"html2canvas: Renderer: Canvas renderer done - returning canvas obj\");\n    \n        if (options.elements.length === 1) {\n          if (typeof options.elements[0] === \"object\" && options.elements[0].nodeName !== \"BODY\") {\n            // crop image to the bounds of selected (single) element\n            bounds = _html2canvas.Util.Bounds(options.elements[0]);\n            newCanvas = document.createElement('canvas');\n            newCanvas.width = Math.ceil(bounds.width);\n            newCanvas.height = Math.ceil(bounds.height);\n            ctx = newCanvas.getContext(\"2d\");\n    \n            ctx.drawImage(canvas, bounds.left, bounds.top, bounds.width, bounds.height, 0, 0, bounds.width, bounds.height);\n            canvas = null;\n            return newCanvas;\n          }\n        }\n    \n        return canvas;\n      };\n    };\n    })(window,document);", "//     Backbone.js 1.1.0\n\n//     (c) 2010-2011 Jeremy Ashkenas, DocumentCloud Inc.\n//     (c) 2011-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Backbone may be freely distributed under the MIT license.\n//     For all details and documentation:\n//     http://backbonejs.org\n\n(function(){\n\n  // Initial Setup\n  // -------------\n\n  // Save a reference to the global object (`window` in the browser, `exports`\n  // on the server).\n  var root = this;\n\n  // Save the previous value of the `Backbone` variable, so that it can be\n  // restored later on, if `noConflict` is used.\n  var previousBackbone = root.Backbone;\n\n  // Create local references to array methods we'll want to use later.\n  var array = [];\n  var push = array.push;\n  var slice = array.slice;\n  var splice = array.splice;\n\n  // The top-level namespace. All public Backbone classes and modules will\n  // be attached to this. Exported for both the browser and the server.\n  var Backbone;\n  if (typeof exports !== 'undefined') {\n    Backbone = exports;\n  } else {\n    Backbone = root.Backbone = {};\n  }\n\n  // Current version of the library. Keep in sync with `package.json`.\n  Backbone.VERSION = '1.1.0';\n\n  // Require Underscore, if we're on the server, and it's not already present.\n  var _ = root._;\n  if (!_ && (typeof require !== 'undefined')) _ = require('underscore');\n\n  // For Backbone's purposes, jQuery, Zepto, Ender, or My Library (kidding) owns\n  // the `$` variable.\n  Backbone.$ = root.jQuery || root.Zepto || root.ender || root.$;\n\n  // Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable\n  // to its previous owner. Returns a reference to this Backbone object.\n  Backbone.noConflict = function() {\n    root.Backbone = previousBackbone;\n    return this;\n  };\n\n  // Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option\n  // will fake `\"PATCH\"`, `\"PUT\"` and `\"DELETE\"` requests via the `_method` parameter and\n  // set a `X-Http-Method-Override` header.\n  Backbone.emulateHTTP = false;\n\n  // Turn on `emulateJSON` to support legacy servers that can't deal with direct\n  // `application/json` requests ... will encode the body as\n  // `application/x-www-form-urlencoded` instead and will send the model in a\n  // form param named `model`.\n  Backbone.emulateJSON = false;\n\n  // Backbone.Events\n  // ---------------\n\n  // A module that can be mixed in to *any object* in order to provide it with\n  // custom events. You may bind with `on` or remove with `off` callback\n  // functions to an event; `trigger`-ing an event fires all callbacks in\n  // succession.\n  //\n  //     var object = {};\n  //     _.extend(object, Backbone.Events);\n  //     object.on('expand', function(){ alert('expanded'); });\n  //     object.trigger('expand');\n  //\n  var Events = Backbone.Events = {\n\n    // Bind an event to a `callback` function. Passing `\"all\"` will bind\n    // the callback to all events fired.\n    on: function(name, callback, context) {\n      if (!eventsApi(this, 'on', name, [callback, context]) || !callback) return this;\n      this._events || (this._events = {});\n      var events = this._events[name] || (this._events[name] = []);\n      events.push({callback: callback, context: context, ctx: context || this});\n      return this;\n    },\n\n    // Bind an event to only be triggered a single time. After the first time\n    // the callback is invoked, it will be removed.\n    once: function(name, callback, context) {\n      if (!eventsApi(this, 'once', name, [callback, context]) || !callback) return this;\n      var self = this;\n      var once = _.once(function() {\n        self.off(name, once);\n        callback.apply(this, arguments);\n      });\n      once._callback = callback;\n      return this.on(name, once, context);\n    },\n\n    // Remove one or many callbacks. If `context` is null, removes all\n    // callbacks with that function. If `callback` is null, removes all\n    // callbacks for the event. If `name` is null, removes all bound\n    // callbacks for all events.\n    off: function(name, callback, context) {\n      var retain, ev, events, names, i, l, j, k;\n      if (!this._events || !eventsApi(this, 'off', name, [callback, context])) return this;\n      if (!name && !callback && !context) {\n        this._events = {};\n        return this;\n      }\n      names = name ? [name] : _.keys(this._events);\n      for (i = 0, l = names.length; i < l; i++) {\n        name = names[i];\n        if (events = this._events[name]) {\n          this._events[name] = retain = [];\n          if (callback || context) {\n            for (j = 0, k = events.length; j < k; j++) {\n              ev = events[j];\n              if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n                  (context && context !== ev.context)) {\n                retain.push(ev);\n              }\n            }\n          }\n          if (!retain.length) delete this._events[name];\n        }\n      }\n\n      return this;\n    },\n\n    // Trigger one or many events, firing all bound callbacks. Callbacks are\n    // passed the same arguments as `trigger` is, apart from the event name\n    // (unless you're listening on `\"all\"`, which will cause your callback to\n    // receive the true name of the event as the first argument).\n    trigger: function(name) {\n      if (!this._events) return this;\n      var args = slice.call(arguments, 1);\n      if (!eventsApi(this, 'trigger', name, args)) return this;\n      var events = this._events[name];\n      var allEvents = this._events.all;\n      if (events) triggerEvents(events, args);\n      if (allEvents) triggerEvents(allEvents, arguments);\n      return this;\n    },\n\n    // Tell this object to stop listening to either specific events ... or\n    // to every object it's currently listening to.\n    stopListening: function(obj, name, callback) {\n      var listeningTo = this._listeningTo;\n      if (!listeningTo) return this;\n      var remove = !name && !callback;\n      if (!callback && typeof name === 'object') callback = this;\n      if (obj) (listeningTo = {})[obj._listenId] = obj;\n      for (var id in listeningTo) {\n        obj = listeningTo[id];\n        obj.off(name, callback, this);\n        if (remove || _.isEmpty(obj._events)) delete this._listeningTo[id];\n      }\n      return this;\n    }\n\n  };\n\n  // Regular expression used to split event strings.\n  var eventSplitter = /\\s+/;\n\n  // Implement fancy features of the Events API such as multiple event\n  // names `\"change blur\"` and jQuery-style event maps `{change: action}`\n  // in terms of the existing API.\n  var eventsApi = function(obj, action, name, rest) {\n    if (!name) return true;\n\n    // Handle event maps.\n    if (typeof name === 'object') {\n      for (var key in name) {\n        obj[action].apply(obj, [key, name[key]].concat(rest));\n      }\n      return false;\n    }\n\n    // Handle space separated event names.\n    if (eventSplitter.test(name)) {\n      var names = name.split(eventSplitter);\n      for (var i = 0, l = names.length; i < l; i++) {\n        obj[action].apply(obj, [names[i]].concat(rest));\n      }\n      return false;\n    }\n\n    return true;\n  };\n\n  // A difficult-to-believe, but optimized internal dispatch function for\n  // triggering events. Tries to keep the usual cases speedy (most internal\n  // Backbone events have 3 arguments).\n  var triggerEvents = function(events, args) {\n    var ev, i = -1, l = events.length, a1 = args[0], a2 = args[1], a3 = args[2];\n    switch (args.length) {\n      case 0: while (++i < l) (ev = events[i]).callback.call(ev.ctx); return;\n      case 1: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1); return;\n      case 2: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2); return;\n      case 3: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); return;\n      default: while (++i < l) (ev = events[i]).callback.apply(ev.ctx, args);\n    }\n  };\n\n  var listenMethods = {listenTo: 'on', listenToOnce: 'once'};\n\n  // Inversion-of-control versions of `on` and `once`. Tell *this* object to\n  // listen to an event in another object ... keeping track of what it's\n  // listening to.\n  _.each(listenMethods, function(implementation, method) {\n    Events[method] = function(obj, name, callback) {\n      var listeningTo = this._listeningTo || (this._listeningTo = {});\n      var id = obj._listenId || (obj._listenId = _.uniqueId('l'));\n      listeningTo[id] = obj;\n      if (!callback && typeof name === 'object') callback = this;\n      obj[implementation](name, callback, this);\n      return this;\n    };\n  });\n\n  // Aliases for backwards compatibility.\n  Events.bind   = Events.on;\n  Events.unbind = Events.off;\n\n  // Allow the `Backbone` object to serve as a global event bus, for folks who\n  // want global \"pubsub\" in a convenient place.\n  _.extend(Backbone, Events);\n\n  // Backbone.Model\n  // --------------\n\n  // Backbone **Models** are the basic data object in the framework --\n  // frequently representing a row in a table in a database on your server.\n  // A discrete chunk of data and a bunch of useful, related methods for\n  // performing computations and transformations on that data.\n\n  // Create a new model with the specified attributes. A client id (`cid`)\n  // is automatically generated and assigned for you.\n  var Model = Backbone.Model = function(attributes, options) {\n    var attrs = attributes || {};\n    options || (options = {});\n    this.cid = _.uniqueId('c');\n    this.attributes = {};\n    if (options.collection) this.collection = options.collection;\n    if (options.parse) attrs = this.parse(attrs, options) || {};\n    attrs = _.defaults({}, attrs, _.result(this, 'defaults'));\n    this.set(attrs, options);\n    this.changed = {};\n    this.initialize.apply(this, arguments);\n  };\n\n  // Attach all inheritable methods to the Model prototype.\n  _.extend(Model.prototype, Events, {\n\n    // A hash of attributes whose current and previous value differ.\n    changed: null,\n\n    // The value returned during the last failed validation.\n    validationError: null,\n\n    // The default name for the JSON `id` attribute is `\"id\"`. MongoDB and\n    // CouchDB users may want to set this to `\"_id\"`.\n    idAttribute: 'id',\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // Return a copy of the model's `attributes` object.\n    toJSON: function(options) {\n      return _.clone(this.attributes);\n    },\n\n    // Proxy `Backbone.sync` by default -- but override this if you need\n    // custom syncing semantics for *this* particular model.\n    sync: function() {\n      return Backbone.sync.apply(this, arguments);\n    },\n\n    // Get the value of an attribute.\n    get: function(attr) {\n      return this.attributes[attr];\n    },\n\n    // Get the HTML-escaped value of an attribute.\n    escape: function(attr) {\n      return _.escape(this.get(attr));\n    },\n\n    // Returns `true` if the attribute contains a value that is not null\n    // or undefined.\n    has: function(attr) {\n      return this.get(attr) != null;\n    },\n\n    // Set a hash of model attributes on the object, firing `\"change\"`. This is\n    // the core primitive operation of a model, updating the data and notifying\n    // anyone who needs to know about the change in state. The heart of the beast.\n    set: function(key, val, options) {\n      var attr, attrs, unset, changes, silent, changing, prev, current;\n      if (key == null) return this;\n\n      // Handle both `\"key\", value` and `{key: value}` -style arguments.\n      if (typeof key === 'object') {\n        attrs = key;\n        options = val;\n      } else {\n        (attrs = {})[key] = val;\n      }\n\n      options || (options = {});\n\n      // Run validation.\n      if (!this._validate(attrs, options)) return false;\n\n      // Extract attributes and options.\n      unset           = options.unset;\n      silent          = options.silent;\n      changes         = [];\n      changing        = this._changing;\n      this._changing  = true;\n\n      if (!changing) {\n        this._previousAttributes = _.clone(this.attributes);\n        this.changed = {};\n      }\n      current = this.attributes, prev = this._previousAttributes;\n\n      // Check for changes of `id`.\n      if (this.idAttribute in attrs) this.id = attrs[this.idAttribute];\n\n      // For each `set` attribute, update or delete the current value.\n      for (attr in attrs) {\n        val = attrs[attr];\n        if (!_.isEqual(current[attr], val)) changes.push(attr);\n        if (!_.isEqual(prev[attr], val)) {\n          this.changed[attr] = val;\n        } else {\n          delete this.changed[attr];\n        }\n        unset ? delete current[attr] : current[attr] = val;\n      }\n\n      // Trigger all relevant attribute changes.\n      if (!silent) {\n        if (changes.length) this._pending = true;\n        for (var i = 0, l = changes.length; i < l; i++) {\n          this.trigger('change:' + changes[i], this, current[changes[i]], options);\n        }\n      }\n\n      // You might be wondering why there's a `while` loop here. Changes can\n      // be recursively nested within `\"change\"` events.\n      if (changing) return this;\n      if (!silent) {\n        while (this._pending) {\n          this._pending = false;\n          this.trigger('change', this, options);\n        }\n      }\n      this._pending = false;\n      this._changing = false;\n      return this;\n    },\n\n    // Remove an attribute from the model, firing `\"change\"`. `unset` is a noop\n    // if the attribute doesn't exist.\n    unset: function(attr, options) {\n      return this.set(attr, void 0, _.extend({}, options, {unset: true}));\n    },\n\n    // Clear all attributes on the model, firing `\"change\"`.\n    clear: function(options) {\n      var attrs = {};\n      for (var key in this.attributes) attrs[key] = void 0;\n      return this.set(attrs, _.extend({}, options, {unset: true}));\n    },\n\n    // Determine if the model has changed since the last `\"change\"` event.\n    // If you specify an attribute name, determine if that attribute has changed.\n    hasChanged: function(attr) {\n      if (attr == null) return !_.isEmpty(this.changed);\n      return _.has(this.changed, attr);\n    },\n\n    // Return an object containing all the attributes that have changed, or\n    // false if there are no changed attributes. Useful for determining what\n    // parts of a view need to be updated and/or what attributes need to be\n    // persisted to the server. Unset attributes will be set to undefined.\n    // You can also pass an attributes object to diff against the model,\n    // determining if there *would be* a change.\n    changedAttributes: function(diff) {\n      if (!diff) return this.hasChanged() ? _.clone(this.changed) : false;\n      var val, changed = false;\n      var old = this._changing ? this._previousAttributes : this.attributes;\n      for (var attr in diff) {\n        if (_.isEqual(old[attr], (val = diff[attr]))) continue;\n        (changed || (changed = {}))[attr] = val;\n      }\n      return changed;\n    },\n\n    // Get the previous value of an attribute, recorded at the time the last\n    // `\"change\"` event was fired.\n    previous: function(attr) {\n      if (attr == null || !this._previousAttributes) return null;\n      return this._previousAttributes[attr];\n    },\n\n    // Get all of the attributes of the model at the time of the previous\n    // `\"change\"` event.\n    previousAttributes: function() {\n      return _.clone(this._previousAttributes);\n    },\n\n    // Fetch the model from the server. If the server's representation of the\n    // model differs from its current attributes, they will be overridden,\n    // triggering a `\"change\"` event.\n    fetch: function(options) {\n      options = options ? _.clone(options) : {};\n      if (options.parse === void 0) options.parse = true;\n      var model = this;\n      var success = options.success;\n      options.success = function(resp) {\n        if (!model.set(model.parse(resp, options), options)) return false;\n        if (success) success(model, resp, options);\n        model.trigger('sync', model, resp, options);\n      };\n      wrapError(this, options);\n      return this.sync('read', this, options);\n    },\n\n    // Set a hash of model attributes, and sync the model to the server.\n    // If the server returns an attributes hash that differs, the model's\n    // state will be `set` again.\n    save: function(key, val, options) {\n      var attrs, method, xhr, attributes = this.attributes;\n\n      // Handle both `\"key\", value` and `{key: value}` -style arguments.\n      if (key == null || typeof key === 'object') {\n        attrs = key;\n        options = val;\n      } else {\n        (attrs = {})[key] = val;\n      }\n\n      options = _.extend({validate: true}, options);\n\n      // If we're not waiting and attributes exist, save acts as\n      // `set(attr).save(null, opts)` with validation. Otherwise, check if\n      // the model will be valid when the attributes, if any, are set.\n      if (attrs && !options.wait) {\n        if (!this.set(attrs, options)) return false;\n      } else {\n        if (!this._validate(attrs, options)) return false;\n      }\n\n      // Set temporary attributes if `{wait: true}`.\n      if (attrs && options.wait) {\n        this.attributes = _.extend({}, attributes, attrs);\n      }\n\n      // After a successful server-side save, the client is (optionally)\n      // updated with the server-side state.\n      if (options.parse === void 0) options.parse = true;\n      var model = this;\n      var success = options.success;\n      options.success = function(resp) {\n        // Ensure attributes are restored during synchronous saves.\n        model.attributes = attributes;\n        var serverAttrs = model.parse(resp, options);\n        if (options.wait) serverAttrs = _.extend(attrs || {}, serverAttrs);\n        if (_.isObject(serverAttrs) && !model.set(serverAttrs, options)) {\n          return false;\n        }\n        if (success) success(model, resp, options);\n        model.trigger('sync', model, resp, options);\n      };\n      wrapError(this, options);\n\n      method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n      if (method === 'patch') options.attrs = attrs;\n      xhr = this.sync(method, this, options);\n\n      // Restore attributes.\n      if (attrs && options.wait) this.attributes = attributes;\n\n      return xhr;\n    },\n\n    // Destroy this model on the server if it was already persisted.\n    // Optimistically removes the model from its collection, if it has one.\n    // If `wait: true` is passed, waits for the server to respond before removal.\n    destroy: function(options) {\n      options = options ? _.clone(options) : {};\n      var model = this;\n      var success = options.success;\n\n      var destroy = function() {\n        model.trigger('destroy', model, model.collection, options);\n      };\n\n      options.success = function(resp) {\n        if (options.wait || model.isNew()) destroy();\n        if (success) success(model, resp, options);\n        if (!model.isNew()) model.trigger('sync', model, resp, options);\n      };\n\n      if (this.isNew()) {\n        options.success();\n        return false;\n      }\n      wrapError(this, options);\n\n      var xhr = this.sync('delete', this, options);\n      if (!options.wait) destroy();\n      return xhr;\n    },\n\n    // Default URL for the model's representation on the server -- if you're\n    // using Backbone's restful methods, override this to change the endpoint\n    // that will be called.\n    url: function() {\n      var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url') || urlError();\n      if (this.isNew()) return base;\n      return base + (base.charAt(base.length - 1) === '/' ? '' : '/') + encodeURIComponent(this.id);\n    },\n\n    // **parse** converts a response into the hash of attributes to be `set` on\n    // the model. The default implementation is just to pass the response along.\n    parse: function(resp, options) {\n      return resp;\n    },\n\n    // Create a new model with identical attributes to this one.\n    clone: function() {\n      return new this.constructor(this.attributes);\n    },\n\n    // A model is new if it has never been saved to the server, and lacks an id.\n    isNew: function() {\n      return this.id == null;\n    },\n\n    // Check if the model is currently in a valid state.\n    isValid: function(options) {\n      return this._validate({}, _.extend(options || {}, { validate: true }));\n    },\n\n    // Run validation against the next complete set of model attributes,\n    // returning `true` if all is well. Otherwise, fire an `\"invalid\"` event.\n    _validate: function(attrs, options) {\n      if (!options.validate || !this.validate) return true;\n      attrs = _.extend({}, this.attributes, attrs);\n      var error = this.validationError = this.validate(attrs, options) || null;\n      if (!error) return true;\n      this.trigger('invalid', this, error, _.extend(options, {validationError: error}));\n      return false;\n    }\n\n  });\n\n  // Underscore methods that we want to implement on the Model.\n  var modelMethods = ['keys', 'values', 'pairs', 'invert', 'pick', 'omit'];\n\n  // Mix in each Underscore method as a proxy to `Model#attributes`.\n  _.each(modelMethods, function(method) {\n    Model.prototype[method] = function() {\n      var args = slice.call(arguments);\n      args.unshift(this.attributes);\n      return _[method].apply(_, args);\n    };\n  });\n\n  // Backbone.Collection\n  // -------------------\n\n  // If models tend to represent a single row of data, a Backbone Collection is\n  // more analagous to a table full of data ... or a small slice or page of that\n  // table, or a collection of rows that belong together for a particular reason\n  // -- all of the messages in this particular folder, all of the documents\n  // belonging to this particular author, and so on. Collections maintain\n  // indexes of their models, both in order, and for lookup by `id`.\n\n  // Create a new **Collection**, perhaps to contain a specific type of `model`.\n  // If a `comparator` is specified, the Collection will maintain\n  // its models in sort order, as they're added and removed.\n  var Collection = Backbone.Collection = function(models, options) {\n    options || (options = {});\n    if (options.model) this.model = options.model;\n    if (options.comparator !== void 0) this.comparator = options.comparator;\n    this._reset();\n    this.initialize.apply(this, arguments);\n    if (models) this.reset(models, _.extend({silent: true}, options));\n  };\n\n  // Default options for `Collection#set`.\n  var setOptions = {add: true, remove: true, merge: true};\n  var addOptions = {add: true, remove: false};\n\n  // Define the Collection's inheritable methods.\n  _.extend(Collection.prototype, Events, {\n\n    // The default model for a collection is just a **Backbone.Model**.\n    // This should be overridden in most cases.\n    model: Model,\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // The JSON representation of a Collection is an array of the\n    // models' attributes.\n    toJSON: function(options) {\n      return this.map(function(model){ return model.toJSON(options); });\n    },\n\n    // Proxy `Backbone.sync` by default.\n    sync: function() {\n      return Backbone.sync.apply(this, arguments);\n    },\n\n    // Add a model, or list of models to the set.\n    add: function(models, options) {\n      return this.set(models, _.extend({merge: false}, options, addOptions));\n    },\n\n    // Remove a model, or a list of models from the set.\n    remove: function(models, options) {\n      var singular = !_.isArray(models);\n      models = singular ? [models] : _.clone(models);\n      options || (options = {});\n      var i, l, index, model;\n      for (i = 0, l = models.length; i < l; i++) {\n        model = models[i] = this.get(models[i]);\n        if (!model) continue;\n        delete this._byId[model.id];\n        delete this._byId[model.cid];\n        index = this.indexOf(model);\n        this.models.splice(index, 1);\n        this.length--;\n        if (!options.silent) {\n          options.index = index;\n          model.trigger('remove', model, this, options);\n        }\n        this._removeReference(model);\n      }\n      return singular ? models[0] : models;\n    },\n\n    // Update a collection by `set`-ing a new list of models, adding new ones,\n    // removing models that are no longer present, and merging models that\n    // already exist in the collection, as necessary. Similar to **Model#set**,\n    // the core operation for updating the data contained by the collection.\n    set: function(models, options) {\n      options = _.defaults({}, options, setOptions);\n      if (options.parse) models = this.parse(models, options);\n      var singular = !_.isArray(models);\n      models = singular ? (models ? [models] : []) : _.clone(models);\n      var i, l, id, model, attrs, existing, sort;\n      var at = options.at;\n      var targetModel = this.model;\n      var sortable = this.comparator && (at == null) && options.sort !== false;\n      var sortAttr = _.isString(this.comparator) ? this.comparator : null;\n      var toAdd = [], toRemove = [], modelMap = {};\n      var add = options.add, merge = options.merge, remove = options.remove;\n      var order = !sortable && add && remove ? [] : false;\n\n      // Turn bare objects into model references, and prevent invalid models\n      // from being added.\n      for (i = 0, l = models.length; i < l; i++) {\n        attrs = models[i];\n        if (attrs instanceof Model) {\n          id = model = attrs;\n        } else {\n          id = attrs[targetModel.prototype.idAttribute];\n        }\n\n        // If a duplicate is found, prevent it from being added and\n        // optionally merge it into the existing model.\n        if (existing = this.get(id)) {\n          if (remove) modelMap[existing.cid] = true;\n          if (merge) {\n            attrs = attrs === model ? model.attributes : attrs;\n            if (options.parse) attrs = existing.parse(attrs, options);\n            existing.set(attrs, options);\n            if (sortable && !sort && existing.hasChanged(sortAttr)) sort = true;\n          }\n          models[i] = existing;\n\n        // If this is a new, valid model, push it to the `toAdd` list.\n        } else if (add) {\n          model = models[i] = this._prepareModel(attrs, options);\n          if (!model) continue;\n          toAdd.push(model);\n\n          // Listen to added models' events, and index models for lookup by\n          // `id` and by `cid`.\n          model.on('all', this._onModelEvent, this);\n          this._byId[model.cid] = model;\n          if (model.id != null) this._byId[model.id] = model;\n        }\n        if (order) order.push(existing || model);\n      }\n\n      // Remove nonexistent models if appropriate.\n      if (remove) {\n        for (i = 0, l = this.length; i < l; ++i) {\n          if (!modelMap[(model = this.models[i]).cid]) toRemove.push(model);\n        }\n        if (toRemove.length) this.remove(toRemove, options);\n      }\n\n      // See if sorting is needed, update `length` and splice in new models.\n      if (toAdd.length || (order && order.length)) {\n        if (sortable) sort = true;\n        this.length += toAdd.length;\n        if (at != null) {\n          for (i = 0, l = toAdd.length; i < l; i++) {\n            this.models.splice(at + i, 0, toAdd[i]);\n          }\n        } else {\n          if (order) this.models.length = 0;\n          var orderedModels = order || toAdd;\n          for (i = 0, l = orderedModels.length; i < l; i++) {\n            this.models.push(orderedModels[i]);\n          }\n        }\n      }\n\n      // Silently sort the collection if appropriate.\n      if (sort) this.sort({silent: true});\n\n      // Unless silenced, it's time to fire all appropriate add/sort events.\n      if (!options.silent) {\n        for (i = 0, l = toAdd.length; i < l; i++) {\n          (model = toAdd[i]).trigger('add', model, this, options);\n        }\n        if (sort || (order && order.length)) this.trigger('sort', this, options);\n      }\n      \n      // Return the added (or merged) model (or models).\n      return singular ? models[0] : models;\n    },\n\n    // When you have more items than you want to add or remove individually,\n    // you can reset the entire set with a new list of models, without firing\n    // any granular `add` or `remove` events. Fires `reset` when finished.\n    // Useful for bulk operations and optimizations.\n    reset: function(models, options) {\n      options || (options = {});\n      for (var i = 0, l = this.models.length; i < l; i++) {\n        this._removeReference(this.models[i]);\n      }\n      options.previousModels = this.models;\n      this._reset();\n      models = this.add(models, _.extend({silent: true}, options));\n      if (!options.silent) this.trigger('reset', this, options);\n      return models;\n    },\n\n    // Add a model to the end of the collection.\n    push: function(model, options) {\n      return this.add(model, _.extend({at: this.length}, options));\n    },\n\n    // Remove a model from the end of the collection.\n    pop: function(options) {\n      var model = this.at(this.length - 1);\n      this.remove(model, options);\n      return model;\n    },\n\n    // Add a model to the beginning of the collection.\n    unshift: function(model, options) {\n      return this.add(model, _.extend({at: 0}, options));\n    },\n\n    // Remove a model from the beginning of the collection.\n    shift: function(options) {\n      var model = this.at(0);\n      this.remove(model, options);\n      return model;\n    },\n\n    // Slice out a sub-array of models from the collection.\n    slice: function() {\n      return slice.apply(this.models, arguments);\n    },\n\n    // Get a model from the set by id.\n    get: function(obj) {\n      if (obj == null) return void 0;\n      return this._byId[obj.id] || this._byId[obj.cid] || this._byId[obj];\n    },\n\n    // Get the model at the given index.\n    at: function(index) {\n      return this.models[index];\n    },\n\n    // Return models with matching attributes. Useful for simple cases of\n    // `filter`.\n    where: function(attrs, first) {\n      if (_.isEmpty(attrs)) return first ? void 0 : [];\n      return this[first ? 'find' : 'filter'](function(model) {\n        for (var key in attrs) {\n          if (attrs[key] !== model.get(key)) return false;\n        }\n        return true;\n      });\n    },\n\n    // Return the first model with matching attributes. Useful for simple cases\n    // of `find`.\n    findWhere: function(attrs) {\n      return this.where(attrs, true);\n    },\n\n    // Force the collection to re-sort itself. You don't need to call this under\n    // normal circumstances, as the set will maintain sort order as each item\n    // is added.\n    sort: function(options) {\n      if (!this.comparator) throw new Error('Cannot sort a set without a comparator');\n      options || (options = {});\n\n      // Run sort based on type of `comparator`.\n      if (_.isString(this.comparator) || this.comparator.length === 1) {\n        this.models = this.sortBy(this.comparator, this);\n      } else {\n        this.models.sort(_.bind(this.comparator, this));\n      }\n\n      if (!options.silent) this.trigger('sort', this, options);\n      return this;\n    },\n\n    // Pluck an attribute from each model in the collection.\n    pluck: function(attr) {\n      return _.invoke(this.models, 'get', attr);\n    },\n\n    // Fetch the default set of models for this collection, resetting the\n    // collection when they arrive. If `reset: true` is passed, the response\n    // data will be passed through the `reset` method instead of `set`.\n    fetch: function(options) {\n      options = options ? _.clone(options) : {};\n      if (options.parse === void 0) options.parse = true;\n      var success = options.success;\n      var collection = this;\n      options.success = function(resp) {\n        var method = options.reset ? 'reset' : 'set';\n        collection[method](resp, options);\n        if (success) success(collection, resp, options);\n        collection.trigger('sync', collection, resp, options);\n      };\n      wrapError(this, options);\n      return this.sync('read', this, options);\n    },\n\n    // Create a new instance of a model in this collection. Add the model to the\n    // collection immediately, unless `wait: true` is passed, in which case we\n    // wait for the server to agree.\n    create: function(model, options) {\n      options = options ? _.clone(options) : {};\n      if (!(model = this._prepareModel(model, options))) return false;\n      if (!options.wait) this.add(model, options);\n      var collection = this;\n      var success = options.success;\n      options.success = function(model, resp, options) {\n        if (options.wait) collection.add(model, options);\n        if (success) success(model, resp, options);\n      };\n      model.save(null, options);\n      return model;\n    },\n\n    // **parse** converts a response into a list of models to be added to the\n    // collection. The default implementation is just to pass it through.\n    parse: function(resp, options) {\n      return resp;\n    },\n\n    // Create a new collection with an identical list of models as this one.\n    clone: function() {\n      return new this.constructor(this.models);\n    },\n\n    // Private method to reset all internal state. Called when the collection\n    // is first initialized or reset.\n    _reset: function() {\n      this.length = 0;\n      this.models = [];\n      this._byId  = {};\n    },\n\n    // Prepare a hash of attributes (or other model) to be added to this\n    // collection.\n    _prepareModel: function(attrs, options) {\n      if (attrs instanceof Model) {\n        if (!attrs.collection) attrs.collection = this;\n        return attrs;\n      }\n      options = options ? _.clone(options) : {};\n      options.collection = this;\n      var model = new this.model(attrs, options);\n      if (!model.validationError) return model;\n      this.trigger('invalid', this, model.validationError, options);\n      return false;\n    },\n\n    // Internal method to sever a model's ties to a collection.\n    _removeReference: function(model) {\n      if (this === model.collection) delete model.collection;\n      model.off('all', this._onModelEvent, this);\n    },\n\n    // Internal method called every time a model in the set fires an event.\n    // Sets need to update their indexes when models change ids. All other\n    // events simply proxy through. \"add\" and \"remove\" events that originate\n    // in other collections are ignored.\n    _onModelEvent: function(event, model, collection, options) {\n      if ((event === 'add' || event === 'remove') && collection !== this) return;\n      if (event === 'destroy') this.remove(model, options);\n      if (model && event === 'change:' + model.idAttribute) {\n        delete this._byId[model.previous(model.idAttribute)];\n        if (model.id != null) this._byId[model.id] = model;\n      }\n      this.trigger.apply(this, arguments);\n    }\n\n  });\n\n  // Underscore methods that we want to implement on the Collection.\n  // 90% of the core usefulness of Backbone Collections is actually implemented\n  // right here:\n  var methods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl',\n    'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select',\n    'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke',\n    'max', 'min', 'toArray', 'size', 'first', 'head', 'take', 'initial', 'rest',\n    'tail', 'drop', 'last', 'without', 'difference', 'indexOf', 'shuffle',\n    'lastIndexOf', 'isEmpty', 'chain'];\n\n  // Mix in each Underscore method as a proxy to `Collection#models`.\n  _.each(methods, function(method) {\n    Collection.prototype[method] = function() {\n      var args = slice.call(arguments);\n      args.unshift(this.models);\n      return _[method].apply(_, args);\n    };\n  });\n\n  // Underscore methods that take a property name as an argument.\n  var attributeMethods = ['groupBy', 'countBy', 'sortBy'];\n\n  // Use attributes instead of properties.\n  _.each(attributeMethods, function(method) {\n    Collection.prototype[method] = function(value, context) {\n      var iterator = _.isFunction(value) ? value : function(model) {\n        return model.get(value);\n      };\n      return _[method](this.models, iterator, context);\n    };\n  });\n\n  // Backbone.View\n  // -------------\n\n  // Backbone Views are almost more convention than they are actual code. A View\n  // is simply a JavaScript object that represents a logical chunk of UI in the\n  // DOM. This might be a single item, an entire list, a sidebar or panel, or\n  // even the surrounding frame which wraps your whole app. Defining a chunk of\n  // UI as a **View** allows you to define your DOM events declaratively, without\n  // having to worry about render order ... and makes it easy for the view to\n  // react to specific changes in the state of your models.\n\n  // Creating a Backbone.View creates its initial element outside of the DOM,\n  // if an existing element is not provided...\n  var View = Backbone.View = function(options) {\n    this.cid = _.uniqueId('view');\n    options || (options = {});\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n    this.delegateEvents();\n  };\n\n  // Cached regex to split keys for `delegate`.\n  var delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\n  // List of view options to be merged as properties.\n  var viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n\n  // Set up all inheritable **Backbone.View** properties and methods.\n  _.extend(View.prototype, Events, {\n\n    // The default `tagName` of a View's element is `\"div\"`.\n    tagName: 'div',\n\n    // jQuery delegate for element lookup, scoped to DOM elements within the\n    // current view. This should be preferred to global lookups where possible.\n    $: function(selector) {\n      return this.$el.find(selector);\n    },\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // **render** is the core function that your view should override, in order\n    // to populate its element (`this.el`), with the appropriate HTML. The\n    // convention is for **render** to always return `this`.\n    render: function() {\n      return this;\n    },\n\n    // Remove this view by taking the element out of the DOM, and removing any\n    // applicable Backbone.Events listeners.\n    remove: function() {\n      this.$el.remove();\n      this.stopListening();\n      return this;\n    },\n\n    // Change the view's element (`this.el` property), including event\n    // re-delegation.\n    setElement: function(element, delegate) {\n      if (this.$el) this.undelegateEvents();\n      this.$el = element instanceof Backbone.$ ? element : Backbone.$(element);\n      this.el = this.$el[0];\n      if (delegate !== false) this.delegateEvents();\n      return this;\n    },\n\n    // Set callbacks, where `this.events` is a hash of\n    //\n    // *{\"event selector\": \"callback\"}*\n    //\n    //     {\n    //       'mousedown .title':  'edit',\n    //       'click .button':     'save',\n    //       'click .open':       function(e) { ... }\n    //     }\n    //\n    // pairs. Callbacks will be bound to the view, with `this` set properly.\n    // Uses event delegation for efficiency.\n    // Omitting the selector binds the event to `this.el`.\n    // This only works for delegate-able events: not `focus`, `blur`, and\n    // not `change`, `submit`, and `reset` in Internet Explorer.\n    delegateEvents: function(events) {\n      if (!(events || (events = _.result(this, 'events')))) return this;\n      this.undelegateEvents();\n      for (var key in events) {\n        var method = events[key];\n        if (!_.isFunction(method)) method = this[events[key]];\n        if (!method) continue;\n\n        var match = key.match(delegateEventSplitter);\n        var eventName = match[1], selector = match[2];\n        method = _.bind(method, this);\n        eventName += '.delegateEvents' + this.cid;\n        if (selector === '') {\n          this.$el.on(eventName, method);\n        } else {\n          this.$el.on(eventName, selector, method);\n        }\n      }\n      return this;\n    },\n\n    // Clears all callbacks previously bound to the view with `delegateEvents`.\n    // You usually don't need to use this, but may wish to if you have multiple\n    // Backbone views attached to the same DOM element.\n    undelegateEvents: function() {\n      this.$el.off('.delegateEvents' + this.cid);\n      return this;\n    },\n\n    // Ensure that the View has a DOM element to render into.\n    // If `this.el` is a string, pass it through `$()`, take the first\n    // matching element, and re-assign it to `el`. Otherwise, create\n    // an element from the `id`, `className` and `tagName` properties.\n    _ensureElement: function() {\n      if (!this.el) {\n        var attrs = _.extend({}, _.result(this, 'attributes'));\n        if (this.id) attrs.id = _.result(this, 'id');\n        if (this.className) attrs['class'] = _.result(this, 'className');\n        var $el = Backbone.$('<' + _.result(this, 'tagName') + '>').attr(attrs);\n        this.setElement($el, false);\n      } else {\n        this.setElement(_.result(this, 'el'), false);\n      }\n    }\n\n  });\n\n  // Backbone.sync\n  // -------------\n\n  // Override this function to change the manner in which Backbone persists\n  // models to the server. You will be passed the type of request, and the\n  // model in question. By default, makes a RESTful Ajax request\n  // to the model's `url()`. Some possible customizations could be:\n  //\n  // * Use `setTimeout` to batch rapid-fire updates into a single request.\n  // * Send up the models as XML instead of JSON.\n  // * Persist models via WebSockets instead of Ajax.\n  //\n  // Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests\n  // as `POST`, with a `_method` parameter containing the true HTTP method,\n  // as well as all requests with the body as `application/x-www-form-urlencoded`\n  // instead of `application/json` with the model in a param named `model`.\n  // Useful when interfacing with server-side languages like **PHP** that make\n  // it difficult to read the body of `PUT` requests.\n  Backbone.sync = function(method, model, options) {\n    var type = methodMap[method];\n\n    // Default options, unless specified.\n    _.defaults(options || (options = {}), {\n      emulateHTTP: Backbone.emulateHTTP,\n      emulateJSON: Backbone.emulateJSON\n    });\n\n    // Default JSON-request options.\n    var params = {type: type, dataType: 'json'};\n\n    // Ensure that we have a URL.\n    if (!options.url) {\n      params.url = _.result(model, 'url') || urlError();\n    }\n\n    // Ensure that we have the appropriate request data.\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n      params.contentType = 'application/json';\n      params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n\n    // For older servers, emulate JSON by encoding the request into an HTML-form.\n    if (options.emulateJSON) {\n      params.contentType = 'application/x-www-form-urlencoded';\n      params.data = params.data ? {model: params.data} : {};\n    }\n\n    // For older servers, emulate HTTP by mimicking the HTTP method with `_method`\n    // And an `X-HTTP-Method-Override` header.\n    if (options.emulateHTTP && (type === 'PUT' || type === 'DELETE' || type === 'PATCH')) {\n      params.type = 'POST';\n      if (options.emulateJSON) params.data._method = type;\n      var beforeSend = options.beforeSend;\n      options.beforeSend = function(xhr) {\n        xhr.setRequestHeader('X-HTTP-Method-Override', type);\n        if (beforeSend) return beforeSend.apply(this, arguments);\n      };\n    }\n\n    // Don't process data on a non-GET request.\n    if (params.type !== 'GET' && !options.emulateJSON) {\n      params.processData = false;\n    }\n\n    // If we're sending a `PATCH` request, and we're in an old Internet Explorer\n    // that still has ActiveX enabled by default, override jQuery to use that\n    // for XHR instead. Remove this line when jQuery supports `PATCH` on IE8.\n    if (params.type === 'PATCH' && noXhrPatch) {\n      params.xhr = function() {\n        return new ActiveXObject(\"Microsoft.XMLHTTP\");\n      };\n    }\n\n    // Make the request, allowing the user to override any Ajax options.\n    var xhr = options.xhr = Backbone.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    return xhr;\n  };\n\n  var noXhrPatch = typeof window !== 'undefined' && !!window.ActiveXObject && !(window.XMLHttpRequest && (new XMLHttpRequest).dispatchEvent);\n\n  // Map from CRUD to HTTP for our default `Backbone.sync` implementation.\n  var methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch':  'PATCH',\n    'delete': 'DELETE',\n    'read':   'GET'\n  };\n\n  // Set the default implementation of `Backbone.ajax` to proxy through to `$`.\n  // Override this if you'd like to use a different library.\n  Backbone.ajax = function() {\n    return Backbone.$.ajax.apply(Backbone.$, arguments);\n  };\n\n  // Backbone.Router\n  // ---------------\n\n  // Routers map faux-URLs to actions, and fire events when routes are\n  // matched. Creating a new one sets its `routes` hash, if not set statically.\n  var Router = Backbone.Router = function(options) {\n    options || (options = {});\n    if (options.routes) this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n  };\n\n  // Cached regular expressions for matching named param parts and splatted\n  // parts of route strings.\n  var optionalParam = /\\((.*?)\\)/g;\n  var namedParam    = /(\\(\\?)?:\\w+/g;\n  var splatParam    = /\\*\\w+/g;\n  var escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n  // Set up all inheritable **Backbone.Router** properties and methods.\n  _.extend(Router.prototype, Events, {\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // Manually bind a single named route to a callback. For example:\n    //\n    //     this.route('search/:query/p:num', 'search', function(query, num) {\n    //       ...\n    //     });\n    //\n    route: function(route, name, callback) {\n      if (!_.isRegExp(route)) route = this._routeToRegExp(route);\n      if (_.isFunction(name)) {\n        callback = name;\n        name = '';\n      }\n      if (!callback) callback = this[name];\n      var router = this;\n      Backbone.history.route(route, function(fragment) {\n        var args = router._extractParameters(route, fragment);\n        callback && callback.apply(router, args);\n        router.trigger.apply(router, ['route:' + name].concat(args));\n        router.trigger('route', name, args);\n        Backbone.history.trigger('route', router, name, args);\n      });\n      return this;\n    },\n\n    // Simple proxy to `Backbone.history` to save a fragment into the history.\n    navigate: function(fragment, options) {\n      Backbone.history.navigate(fragment, options);\n      return this;\n    },\n\n    // Bind all defined routes to `Backbone.history`. We have to reverse the\n    // order of the routes here to support behavior where the most general\n    // routes can be defined at the bottom of the route map.\n    _bindRoutes: function() {\n      if (!this.routes) return;\n      this.routes = _.result(this, 'routes');\n      var route, routes = _.keys(this.routes);\n      while ((route = routes.pop()) != null) {\n        this.route(route, this.routes[route]);\n      }\n    },\n\n    // Convert a route string into a regular expression, suitable for matching\n    // against the current location hash.\n    _routeToRegExp: function(route) {\n      route = route.replace(escapeRegExp, '\\\\$&')\n                   .replace(optionalParam, '(?:$1)?')\n                   .replace(namedParam, function(match, optional) {\n                     return optional ? match : '([^\\/]+)';\n                   })\n                   .replace(splatParam, '(.*?)');\n      return new RegExp('^' + route + '$');\n    },\n\n    // Given a route, and a URL fragment that it matches, return the array of\n    // extracted decoded parameters. Empty or unmatched parameters will be\n    // treated as `null` to normalize cross-browser behavior.\n    _extractParameters: function(route, fragment) {\n      var params = route.exec(fragment).slice(1);\n      return _.map(params, function(param) {\n        return param ? decodeURIComponent(param) : null;\n      });\n    }\n\n  });\n\n  // Backbone.History\n  // ----------------\n\n  // Handles cross-browser history management, based on either\n  // [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n  // [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n  // and URL fragments. If the browser supports neither (old IE, natch),\n  // falls back to polling.\n  var History = Backbone.History = function() {\n    this.handlers = [];\n    _.bindAll(this, 'checkUrl');\n\n    // Ensure that `History` can be used outside of the browser.\n    if (typeof window !== 'undefined') {\n      this.location = window.location;\n      this.history = window.history;\n    }\n  };\n\n  // Cached regex for stripping a leading hash/slash and trailing space.\n  var routeStripper = /^[#\\/]|\\s+$/g;\n\n  // Cached regex for stripping leading and trailing slashes.\n  var rootStripper = /^\\/+|\\/+$/g;\n\n  // Cached regex for detecting MSIE.\n  var isExplorer = /msie [\\w.]+/;\n\n  // Cached regex for removing a trailing slash.\n  var trailingSlash = /\\/$/;\n\n  // Cached regex for stripping urls of hash and query.\n  var pathStripper = /[?#].*$/;\n\n  // Has the history handling already been started?\n  History.started = false;\n\n  // Set up all inheritable **Backbone.History** properties and methods.\n  _.extend(History.prototype, Events, {\n\n    // The default interval to poll for hash changes, if necessary, is\n    // twenty times a second.\n    interval: 50,\n\n    // Gets the true hash value. Cannot use location.hash directly due to bug\n    // in Firefox where location.hash will always be decoded.\n    getHash: function(window) {\n      var match = (window || this).location.href.match(/#(.*)$/);\n      return match ? match[1] : '';\n    },\n\n    // Get the cross-browser normalized URL fragment, either from the URL,\n    // the hash, or the override.\n    getFragment: function(fragment, forcePushState) {\n      if (fragment == null) {\n        if (this._hasPushState || !this._wantsHashChange || forcePushState) {\n          fragment = this.location.pathname;\n          var root = this.root.replace(trailingSlash, '');\n          if (!fragment.indexOf(root)) fragment = fragment.slice(root.length);\n        } else {\n          fragment = this.getHash();\n        }\n      }\n      return fragment.replace(routeStripper, '');\n    },\n\n    // Start the hash change handling, returning `true` if the current URL matches\n    // an existing route, and `false` otherwise.\n    start: function(options) {\n      if (History.started) throw new Error(\"Backbone.history has already been started\");\n      History.started = true;\n\n      // Figure out the initial configuration. Do we need an iframe?\n      // Is pushState desired ... is it available?\n      this.options          = _.extend({root: '/'}, this.options, options);\n      this.root             = this.options.root;\n      this._wantsHashChange = this.options.hashChange !== false;\n      this._wantsPushState  = !!this.options.pushState;\n      this._hasPushState    = !!(this.options.pushState && this.history && this.history.pushState);\n      var fragment          = this.getFragment();\n      var docMode           = document.documentMode;\n      var oldIE             = (isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= 7));\n\n      // Normalize root to always include a leading and trailing slash.\n      this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n      if (oldIE && this._wantsHashChange) {\n        this.iframe = Backbone.$('<iframe src=\"javascript:0\" tabindex=\"-1\" />').hide().appendTo('body')[0].contentWindow;\n        this.navigate(fragment);\n      }\n\n      // Depending on whether we're using pushState or hashes, and whether\n      // 'onhashchange' is supported, determine how we check the URL state.\n      if (this._hasPushState) {\n        Backbone.$(window).on('popstate', this.checkUrl);\n      } else if (this._wantsHashChange && ('onhashchange' in window) && !oldIE) {\n        Backbone.$(window).on('hashchange', this.checkUrl);\n      } else if (this._wantsHashChange) {\n        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n      }\n\n      // Determine if we need to change the base url, for a pushState link\n      // opened by a non-pushState browser.\n      this.fragment = fragment;\n      var loc = this.location;\n      var atRoot = loc.pathname.replace(/[^\\/]$/, '$&/') === this.root;\n\n      // Transition from hashChange to pushState or vice versa if both are\n      // requested.\n      if (this._wantsHashChange && this._wantsPushState) {\n\n        // If we've started off with a route from a `pushState`-enabled\n        // browser, but we're currently in a browser that doesn't support it...\n        if (!this._hasPushState && !atRoot) {\n          this.fragment = this.getFragment(null, true);\n          this.location.replace(this.root + this.location.search + '#' + this.fragment);\n          // Return immediately as browser will do redirect to new url\n          return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n        } else if (this._hasPushState && atRoot && loc.hash) {\n          this.fragment = this.getHash().replace(routeStripper, '');\n          this.history.replaceState({}, document.title, this.root + this.fragment + loc.search);\n        }\n\n      }\n\n      if (!this.options.silent) return this.loadUrl();\n    },\n\n    // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n    // but possibly useful for unit testing Routers.\n    stop: function() {\n      Backbone.$(window).off('popstate', this.checkUrl).off('hashchange', this.checkUrl);\n      clearInterval(this._checkUrlInterval);\n      History.started = false;\n    },\n\n    // Add a route to be tested when the fragment changes. Routes added later\n    // may override previous routes.\n    route: function(route, callback) {\n      this.handlers.unshift({route: route, callback: callback});\n    },\n\n    // Checks the current URL to see if it has changed, and if it has,\n    // calls `loadUrl`, normalizing across the hidden iframe.\n    checkUrl: function(e) {\n      var current = this.getFragment();\n      if (current === this.fragment && this.iframe) {\n        current = this.getFragment(this.getHash(this.iframe));\n      }\n      if (current === this.fragment) return false;\n      if (this.iframe) this.navigate(current);\n      this.loadUrl();\n    },\n\n    // Attempt to load the current URL fragment. If a route succeeds with a\n    // match, returns `true`. If no defined routes matches the fragment,\n    // returns `false`.\n    loadUrl: function(fragment) {\n      fragment = this.fragment = this.getFragment(fragment);\n      return _.any(this.handlers, function(handler) {\n        if (handler.route.test(fragment)) {\n          handler.callback(fragment);\n          return true;\n        }\n      });\n    },\n\n    // Save a fragment into the hash history, or replace the URL state if the\n    // 'replace' option is passed. You are responsible for properly URL-encoding\n    // the fragment in advance.\n    //\n    // The options object can contain `trigger: true` if you wish to have the\n    // route callback be fired (not usually desirable), or `replace: true`, if\n    // you wish to modify the current URL without adding an entry to the history.\n    navigate: function(fragment, options) {\n      if (!History.started) return false;\n      if (!options || options === true) options = {trigger: !!options};\n\n      var url = this.root + (fragment = this.getFragment(fragment || ''));\n\n      // Strip the fragment of the query and hash for matching.\n      fragment = fragment.replace(pathStripper, '');\n\n      if (this.fragment === fragment) return;\n      this.fragment = fragment;\n\n      // Don't include a trailing slash on the root.\n      if (fragment === '' && url !== '/') url = url.slice(0, -1);\n\n      // If pushState is available, we use it to set the fragment as a real URL.\n      if (this._hasPushState) {\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n      } else if (this._wantsHashChange) {\n        this._updateHash(this.location, fragment, options.replace);\n        if (this.iframe && (fragment !== this.getFragment(this.getHash(this.iframe)))) {\n          // Opening and closing the iframe tricks IE7 and earlier to push a\n          // history entry on hash-tag change.  When replace is true, we don't\n          // want this.\n          if(!options.replace) this.iframe.document.open().close();\n          this._updateHash(this.iframe.location, fragment, options.replace);\n        }\n\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n      } else {\n        return this.location.assign(url);\n      }\n      if (options.trigger) return this.loadUrl(fragment);\n    },\n\n    // Update the hash location, either replacing the current entry, or adding\n    // a new one to the browser history.\n    _updateHash: function(location, fragment, replace) {\n      if (replace) {\n        var href = location.href.replace(/(javascript:|#).*$/, '');\n        location.replace(href + '#' + fragment);\n      } else {\n        // Some browsers require that `hash` contains a leading #.\n        location.hash = '#' + fragment;\n      }\n    }\n\n  });\n\n  // Create the default Backbone.history.\n  Backbone.history = new History;\n\n  // Helpers\n  // -------\n\n  // Helper function to correctly set up the prototype chain, for subclasses.\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\n  // class properties to be extended.\n  var extend = function(protoProps, staticProps) {\n    var parent = this;\n    var child;\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (protoProps && _.has(protoProps, 'constructor')) {\n      child = protoProps.constructor;\n    } else {\n      child = function(){ return parent.apply(this, arguments); };\n    }\n\n    // Add static properties to the constructor function, if supplied.\n    _.extend(child, parent, staticProps);\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function(){ this.constructor = child; };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate;\n\n    // Add prototype properties (instance properties) to the subclass,\n    // if supplied.\n    if (protoProps) _.extend(child.prototype, protoProps);\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    return child;\n  };\n\n  // Set up inheritance for the model, collection, router, view and history.\n  Model.extend = Collection.extend = Router.extend = View.extend = History.extend = extend;\n\n  // Throw an error when a URL is needed, and none is supplied.\n  var urlError = function() {\n    throw new Error('A \"url\" property or function must be specified');\n  };\n\n  // Wrap an optional error callback with a fallback error event.\n  var wrapError = function(model, options) {\n    var error = options.error;\n    options.error = function(resp) {\n      if (error) error(model, resp, options);\n      model.trigger('error', model, resp, options);\n    };\n  };\n\n}).call(this);\n", "// http://stackoverflow.com/questions/4383226/using-jquery-to-know-when-font-face-fonts-are-loaded\n(function(){\n    function waitForWebfonts(fonts, callback) {\n        var loadedFonts = 0;\n        for(var i = 0, l = fonts.length; i < l; ++i) {\n            (function(font) {\n                var node = document.createElement('span');\n                // Characters that vary significantly among different fonts\n                node.innerHTML = 'giItT1WQy@!-/#';\n                // Visible - so we can measure it - but not on the screen\n                node.style.position      = 'absolute';\n                node.style.left          = '-10000px';\n                node.style.top           = '-10000px';\n                // Large font size makes even subtle changes obvious\n                node.style.fontSize      = '300px';\n                // Reset any font properties\n                node.style.fontFamily    = 'sans-serif';\n                node.style.fontVariant   = 'normal';\n                node.style.fontStyle     = 'normal';\n                node.style.fontWeight    = 'normal';\n                node.style.letterSpacing = '0';\n                document.body.appendChild(node);\n\n                // Remember width with no applied web font\n                var width = node.offsetWidth;\n\n                node.style.fontFamily = font;\n\n                var interval;\n                function checkFont() {\n                    // Compare current width with original width\n                    if(node && node.offsetWidth != width) {\n                        ++loadedFonts;\n                        node.parentNode.removeChild(node);\n                        node = null;\n                    }\n\n                    // If all fonts have been loaded\n                    if(loadedFonts >= fonts.length) {\n                        if(interval) {\n                            clearInterval(interval);\n                        }\n                        if(loadedFonts == fonts.length) {\n                            callback();\n                            return true;\n                        }\n                    }\n                };\n\n                if(!checkFont()) {\n                    interval = setInterval(checkFont, 50);\n                }\n            })(fonts[i]);\n        }\n    }\n    window.waitForWebfonts = waitForWebfonts;\n})();\n\n\n", "/* from http://www.movable-type.co.uk/scripts/sha1.html */\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\n/*  SHA-1 implementation in JavaScript                  (c) Chris Veness 2002-2014 / MIT Licence  */\n/*                                                                                                */\n/*  - see http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html                              */\n/*        http://csrc.nist.gov/groups/ST/toolkit/examples.html                                    */\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\n\n/* jshint node:true *//* global define, escape, unescape */\n'use strict';\n\n\n/**\n * SHA-1 hash function reference implementation.\n *\n * @namespace\n */\nvar Sha1 = {};\n\n\n/**\n * Generates SHA-1 hash of string.\n *\n * @param   {string} msg - (Unicode) string to be hashed.\n * @returns {string} Hash of msg as hex character string.\n */\nSha1.hash = function(msg) {\n    // convert string to UTF-8, as SHA only deals with byte-streams\n    msg = msg.utf8Encode();\n\n    // constants [\u00a74.2.1]\n    var K = [ 0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6 ];\n\n    // PREPROCESSING\n\n    msg += String.fromCharCode(0x80);  // add trailing '1' bit (+ 0's padding) to string [\u00a75.1.1]\n\n    // convert string msg into 512-bit/16-integer blocks arrays of ints [\u00a75.2.1]\n    var l = msg.length/4 + 2; // length (in 32-bit integers) of msg + \u20181\u2019 + appended length\n    var N = Math.ceil(l/16);  // number of 16-integer-blocks required to hold 'l' ints\n    var M = new Array(N);\n\n    for (var i=0; i<N; i++) {\n        M[i] = new Array(16);\n        for (var j=0; j<16; j++) {  // encode 4 chars per integer, big-endian encoding\n            M[i][j] = (msg.charCodeAt(i*64+j*4)<<24) | (msg.charCodeAt(i*64+j*4+1)<<16) |\n                (msg.charCodeAt(i*64+j*4+2)<<8) | (msg.charCodeAt(i*64+j*4+3));\n        } // note running off the end of msg is ok 'cos bitwise ops on NaN return 0\n    }\n    // add length (in bits) into final pair of 32-bit integers (big-endian) [\u00a75.1.1]\n    // note: most significant word would be (len-1)*8 >>> 32, but since JS converts\n    // bitwise-op args to 32 bits, we need to simulate this by arithmetic operators\n    M[N-1][14] = ((msg.length-1)*8) / Math.pow(2, 32); M[N-1][14] = Math.floor(M[N-1][14]);\n    M[N-1][15] = ((msg.length-1)*8) & 0xffffffff;\n\n    // set initial hash value [\u00a75.3.1]\n    var H0 = 0x67452301;\n    var H1 = 0xefcdab89;\n    var H2 = 0x98badcfe;\n    var H3 = 0x10325476;\n    var H4 = 0xc3d2e1f0;\n\n    // HASH COMPUTATION [\u00a76.1.2]\n\n    var W = new Array(80); var a, b, c, d, e;\n    for (var i=0; i<N; i++) {\n\n        // 1 - prepare message schedule 'W'\n        for (var t=0;  t<16; t++) W[t] = M[i][t];\n        for (var t=16; t<80; t++) W[t] = Sha1.ROTL(W[t-3] ^ W[t-8] ^ W[t-14] ^ W[t-16], 1);\n\n        // 2 - initialise five working variables a, b, c, d, e with previous hash value\n        a = H0; b = H1; c = H2; d = H3; e = H4;\n\n        // 3 - main loop\n        for (var t=0; t<80; t++) {\n            var s = Math.floor(t/20); // seq for blocks of 'f' functions and 'K' constants\n            var T = (Sha1.ROTL(a,5) + Sha1.f(s,b,c,d) + e + K[s] + W[t]) & 0xffffffff;\n            e = d;\n            d = c;\n            c = Sha1.ROTL(b, 30);\n            b = a;\n            a = T;\n        }\n\n        // 4 - compute the new intermediate hash value (note 'addition modulo 2^32')\n        H0 = (H0+a) & 0xffffffff;\n        H1 = (H1+b) & 0xffffffff;\n        H2 = (H2+c) & 0xffffffff;\n        H3 = (H3+d) & 0xffffffff;\n        H4 = (H4+e) & 0xffffffff;\n    }\n\n    return Sha1.toHexStr(H0) + Sha1.toHexStr(H1) + Sha1.toHexStr(H2) +\n           Sha1.toHexStr(H3) + Sha1.toHexStr(H4);\n};\n\n\n/**\n * Function 'f' [\u00a74.1.1].\n * @private\n */\nSha1.f = function(s, x, y, z)  {\n    switch (s) {\n        case 0: return (x & y) ^ (~x & z);           // Ch()\n        case 1: return  x ^ y  ^  z;                 // Parity()\n        case 2: return (x & y) ^ (x & z) ^ (y & z);  // Maj()\n        case 3: return  x ^ y  ^  z;                 // Parity()\n    }\n};\n\n/**\n * Rotates left (circular left shift) value x by n positions [\u00a73.2.5].\n * @private\n */\nSha1.ROTL = function(x, n) {\n    return (x<<n) | (x>>>(32-n));\n};\n\n\n/**\n * Hexadecimal representation of a number.\n * @private\n */\nSha1.toHexStr = function(n) {\n    // note can't use toString(16) as it is implementation-dependant,\n    // and in IE returns signed numbers when used on full words\n    var s=\"\", v;\n    for (var i=7; i>=0; i--) { v = (n>>>(i*4)) & 0xf; s += v.toString(16); }\n    return s;\n};\n\n\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\n\n\n/** Extend String object with method to encode multi-byte string to utf8\n *  - monsur.hossa.in/2012/07/20/utf-8-in-javascript.html */\nif (typeof String.prototype.utf8Encode == 'undefined') {\n    String.prototype.utf8Encode = function() {\n        return unescape( encodeURIComponent( this ) );\n    };\n}\n\n/** Extend String object with method to decode utf8 string to multi-byte */\nif (typeof String.prototype.utf8Decode == 'undefined') {\n    String.prototype.utf8Decode = function() {\n        try {\n            return decodeURIComponent( escape( this ) );\n        } catch (e) {\n            return this; // invalid UTF-8? return as-is\n        }\n    };\n}\n\n\n/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */\nif (typeof module != 'undefined' && module.exports) module.exports = Sha1; // CommonJs export\nif (typeof define == 'function' && define.amd) define([], function() { return Sha1; }); // AMD\n", "odoo.define('point_of_sale.utils', function (require) {\n    'use strict';\n\n    const { EventBus } = owl.core;\n    const { ConnectionAbortedError, ConnectionLostError } = require('@web/core/network/rpc_service');\n\n    function getFileAsText(file) {\n        return new Promise((resolve, reject) => {\n            if (!file) {\n                reject();\n            } else {\n                const reader = new FileReader();\n                reader.addEventListener('load', function () {\n                    resolve(reader.result);\n                });\n                reader.addEventListener('abort', reject);\n                reader.addEventListener('error', reject);\n                reader.readAsText(file);\n            }\n        });\n    }\n\n    /**\n     * This global variable is used by nextFrame to store the timer and\n     * be able to cancel it before another request for animation frame.\n     */\n    let timer = null;\n\n    /**\n     * Wait for the next animation frame to finish.\n     */\n    const nextFrame = () => {\n        return new Promise((resolve) => {\n            cancelAnimationFrame(timer);\n            timer = requestAnimationFrame(() => {\n                resolve();\n            });\n        });\n    };\n\n    function isConnectionError(error) {\n        const _error = identifyError(error);\n        return _error instanceof ConnectionAbortedError || _error instanceof ConnectionLostError;\n    }\n\n    function identifyError(error) {\n        if (!error) return error;\n        let errorToHandle;\n        if (error.legacy) {\n            // error.message is either RPCError or ConnectionLostError\n            errorToHandle = error.message;\n        } else if (error.event && error.event.type == 'abort') {\n            // Check if there is event and if the event type is abort.\n            // If so, then it's supposed to be a ConnectionAbortedError,\n            // however, it was stripped in the patch of rpc in `mapLegacyEnvToWowlEnv`.\n            // We recreate the error object here so that in the actual handler,\n            // ConnectionAbortedError and ConnectionLostError are handled properly.\n            errorToHandle = new ConnectionAbortedError(error.message);\n        } else if (error instanceof Error) {\n            errorToHandle = error;\n        }\n        return errorToHandle || error;\n    }\n\n    return { getFileAsText, nextFrame, posbus: new EventBus(), identifyError, isConnectionError };\n});\n", "odoo.define('point_of_sale.ClassRegistry', function (require) {\n    'use strict';\n\n    /**\n     * **Usage:**\n     * ```\n     * const Registry = new ClassRegistry();\n     *\n     * class A {}\n     * Registry.add(A);\n     *\n     * const AExt1 = A => class extends A {}\n     * Registry.extend(A, AExt1)\n     *\n     * const B = A => class extends A {}\n     * Registry.addByExtending(B, A)\n     *\n     * const AExt2 = A => class extends A {}\n     * Registry.extend(A, AExt2)\n     *\n     * Registry.get(A)\n     * // above returns: AExt2 -> AExt1 -> A\n     * // Basically, 'A' in the registry points to\n     * // the inheritance chain above.\n     *\n     * Registry.get(B)\n     * // above returns: B -> AExt2 -> AExt1 -> A\n     * // Even though B extends A before applying all\n     * // the extensions of A, when getting it from the\n     * // registry, the return points to a class with\n     * // inheritance chain that includes all the extensions\n     * // of 'A'.\n     *\n     * Registry.freeze()\n     * // Example 'B' above is lazy. Basically, it is only\n     * // computed when we call `get` from the registry.\n     * // If we know that no more dynamic inheritances will happen,\n     * // we can freeze the registry and cache the final form\n     * // of each class in the registry.\n     * ```\n     *\n     * IMPROVEMENT:\n     * * So far, mixin can be accomplished by creating a method\n     *  the takes a class and returns a class expression. This is then\n     *  used before the extends keyword like so:\n     *\n     *  ```js\n     *  class A {}\n     *  Registry.add(A)\n     *  const Mixin = x => class extends x {}\n     *  //                          apply mixin\n     *  //                              |\n     *  //                              v\n     *  const B = x => class extends Mixin(x) {}\n     *  Registry.addByExtending(B, A)\n     *  ```\n     *\n     *  In the example, `|B| => B -> Mixin -> A`, and this is pretty convenient\n     *  already. However, this can still be improved since classes are only\n     *  compiled after `Registry.freeze()`. Perhaps, we can make the\n     *  Mixins extensible as well, such as so:\n     *\n     *  ```\n     *  class A {}\n     *  Registry.add(A)\n     *  const Mixin = x => class extends x {}\n     *  Registry.add(Mixin)\n     *  const OtherMixin = x => class extends x {}\n     *  Registry.add(OtherMixin)\n     *  const B = x => class extends x {}\n     *  Registry.addByExtending(B, A, [Mixin, OtherMixin])\n     *  const ExtendMixin = x => class extends x {}\n     *  Registry.extend(Mixin, ExtendMixin)\n     *  ```\n     *\n     *  In the above, after `Registry.freeze()`,\n     *  `|B| => B -> OtherMixin -> ExtendMixin -> Mixin -> A`\n     */\n    class ClassRegistry {\n        constructor() {\n            // base name map\n            this.baseNameMap = {};\n            // Object that maps `baseClass` to the class implementation extended in-place.\n            this.includedMap = new Map();\n            // Object that maps `baseClassCB` to the array of callbacks to generate the extended class.\n            this.extendedCBMap = new Map();\n            // Object that maps `baseClassCB` extended class to the `baseClass` of its super in the includedMap.\n            this.extendedSuperMap = new Map();\n            // For faster access, we can `freeze` the registry so that instead of dynamically generating\n            // the extended classes, it is taken from the cache instead.\n            this.cache = new Map();\n        }\n        /**\n         * Add a new class in the Registry.\n         * @param {Function} baseClass `class`\n         */\n        add(baseClass) {\n            this.includedMap.set(baseClass, []);\n            this.baseNameMap[baseClass.name] = baseClass;\n        }\n        /**\n         * Add a new class in the Registry based on other class\n         * in the registry.\n         * @param {Function} baseClassCB `class -> class`\n         * @param {Function} base `class | class -> class`\n         */\n        addByExtending(baseClassCB, base) {\n            this.extendedCBMap.set(baseClassCB, [baseClassCB]);\n            this.extendedSuperMap.set(baseClassCB, base);\n            this.baseNameMap[baseClassCB.name] = baseClassCB;\n        }\n        /**\n         * Extend in-place a class in the registry. E.g.\n         * ```\n         * // Using the following notation:\n         * //  * |A| -  compiled class in the registry\n         * //  *  A  -  class or an extension callback\n         * //  * |A| => A2 -> A1 -> A\n         * //       -  the above means, compiled class A\n         * //          points to the class inheritance derived from\n         * //          A2(A1(A))\n         *\n         * class A {};\n         * Registry.add(A);\n         * // |A| => A\n         *\n         * let A1 = x => class extends x {};\n         * Registry.extend(A, A1);\n         * // |A| => A1 -> A\n         *\n         * let B = x => class extends x {};\n         * Registry.addByExtending(B, A);\n         * // |B| => B -> |A|\n         * // |B| => B -> A1 -> A\n         *\n         * let B1 = x => class extends x {};\n         * Registry.extend(B, B1);\n         * // |B| => B1 -> B -> |A|\n         *\n         * let C = x => class extends x {};\n         * Registry.addByExtending(C, B);\n         * // |C| => C -> |B|\n         *\n         * let B2 = x => class extends x {};\n         * Registry.extend(B, B2);\n         * // |B| => B2 -> B1 -> B -> |A|\n         *\n         * // Overall:\n         * // |A| => A1 -> A\n         * // |B| => B2 -> B1 -> B -> A1 -> A\n         * // |C| => C -> B2 -> B1 -> B -> A1 -> A\n         * ```\n         * @param {Function} base `class | class -> class`\n         * @param {Function} extensionCB `class -> class`\n         */\n        extend(base, extensionCB) {\n            if (typeof base === 'string') {\n                base = this.baseNameMap[base];\n            }\n            let extensionArray;\n            if (this.includedMap.get(base)) {\n                extensionArray = this.includedMap.get(base);\n            } else if (this.extendedCBMap.get(base)) {\n                extensionArray = this.extendedCBMap.get(base);\n            } else {\n                throw new Error(\n                    `'${base.name}' is not in the Registry. Add it to Registry before extending.`\n                );\n            }\n            extensionArray.push(extensionCB);\n            const locOfNewExtension = extensionArray.length - 1;\n            const self = this;\n            const oldCompiled = this.isFrozen ? this.cache.get(base) : null;\n            return {\n                remove() {\n                    extensionArray.splice(locOfNewExtension, 1);\n                    self._recompute(base, oldCompiled);\n                },\n                compile() {\n                    self._recompute(base);\n                }\n            };\n        }\n        _compile(base) {\n            let res;\n            if (this.includedMap.has(base)) {\n                res = this.includedMap.get(base).reduce((acc, ext) => ext(acc), base);\n            } else {\n                const superClass = this.extendedSuperMap.get(base);\n                const extensionCBs = this.extendedCBMap.get(base);\n                res = extensionCBs.reduce((acc, ext) => ext(acc), this._compile(superClass));\n            }\n            Object.defineProperty(res, 'name', { value: base.name });\n            return res;\n        }\n        /**\n         * Return the compiled class (containing all the extensions) of the base class.\n         * @param {Function} base `class | class -> class` function used in adding the class\n         */\n        get(base) {\n            if (typeof base === 'string') {\n                base = this.baseNameMap[base];\n            }\n            if (this.isFrozen) {\n                return this.cache.get(base);\n            }\n            return this._compile(base);\n        }\n        /**\n         * Uses the callbacks registered in the registry to compile the classes.\n         */\n        freeze() {\n            // Step: Compile the `included classes`.\n            for (let [baseClass, extensionCBs] of this.includedMap.entries()) {\n                const compiled = extensionCBs.reduce((acc, ext) => ext(acc), baseClass);\n                this.cache.set(baseClass, compiled);\n            }\n\n            // Step: Compile the `extended classes` based on `included classes`.\n            // Also gather those the are based on `extended classes`.\n            const remaining = [];\n            for (let [baseClassCB, extensionCBArray] of this.extendedCBMap.entries()) {\n                const compiled = this.cache.get(this.extendedSuperMap.get(baseClassCB));\n                if (!compiled) {\n                    remaining.push([baseClassCB, extensionCBArray]);\n                    continue;\n                }\n                const extendedClass = extensionCBArray.reduce(\n                    (acc, extensionCB) => extensionCB(acc),\n                    compiled\n                );\n                this.cache.set(baseClassCB, extendedClass);\n            }\n\n            // Step: Compile the `extended classes` based on `extended classes`.\n            for (let [baseClassCB, extensionCBArray] of remaining) {\n                const compiled = this.cache.get(this.extendedSuperMap.get(baseClassCB));\n                const extendedClass = extensionCBArray.reduce(\n                    (acc, extensionCB) => extensionCB(acc),\n                    compiled\n                );\n                this.cache.set(baseClassCB, extendedClass);\n            }\n\n            // Step: Set the name of the compiled classess\n            for (let [base, compiledClass] of this.cache.entries()) {\n                Object.defineProperty(compiledClass, 'name', { value: base.name });\n            }\n\n            // Step: Set the flag to true;\n            this.isFrozen = true;\n        }\n        _recompute(base, old) {\n            if (typeof base === 'string') {\n                base = this.baseNameMap[base];\n            }\n            return old ? old : this._compile(base);\n        }\n    }\n\n    return ClassRegistry;\n});\n", "odoo.define('point_of_sale.PosComponent', function (require) {\n    'use strict';\n\n    const { Component } = owl;\n\n    class PosComponent extends Component {\n        /**\n         * This function is available to all Components that inherit this class.\n         * The goal of this function is to show an awaitable dialog (popup) that\n         * returns a response after user interaction. See the following for quick\n         * demonstration:\n         *\n         * ```\n         * async getUserName() {\n         *   const userResponse = await this.showPopup(\n         *     'TextInputPopup',\n         *     { title: 'What is your name?' }\n         *   );\n         *   // at this point, the TextInputPopup is displayed. Depending on how the popup is defined,\n         *   // say the input contains the name, the result of the interaction with the user is\n         *   // saved in `userResponse`.\n         *   console.log(userResponse); // logs { confirmed: true, payload: <name> }\n         * }\n         * ```\n         *\n         * @param {String} name Name of the popup component\n         * @param {Object} props Object that will be used to render to popup\n         */\n        showPopup(name, props) {\n            return new Promise((resolve) => {\n                this.trigger('show-popup', { name, props, resolve });\n            });\n        }\n        showTempScreen(name, props) {\n            return new Promise((resolve) => {\n                this.trigger('show-temp-screen', { name, props, resolve });\n            });\n        }\n        showScreen(name, props) {\n            this.trigger('show-main-screen', { name, props });\n        }\n        /**\n         * @param {String} name 'bell' | 'error'\n         */\n        playSound(name) {\n            this.trigger('play-sound', name);\n        }\n        /**\n         * Control the SyncNotification component.\n         * @param {String} status 'connected' | 'connecting' | 'disconnected' | 'error'\n         * @param {String} pending number of pending orders to sync\n         */\n        setSyncStatus(status, pending) {\n            this.trigger('set-sync-status', { status, pending });\n        }\n        showNotification(message, duration = 2000) {\n            this.trigger('show-notification', { message, duration });\n        }\n        closeNotification() {\n            this.trigger('close-notification');\n        }\n    }\n\n    return PosComponent;\n});\n", "odoo.define('point_of_sale.PosContext', function (require) {\n    'use strict';\n\n    const { Context } = owl;\n\n    // Create global context objects\n    // e.g. component.env.device = new Context({ isMobile: false });\n    return {\n        orderManagement: new Context({ searchString: '', selectedOrder: null }),\n        chrome: new Context({ showOrderSelector: true }),\n    };\n});\n", "odoo.define('point_of_sale.ComponentRegistry', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ClassRegistry = require('point_of_sale.ClassRegistry');\n\n    class ComponentRegistry extends ClassRegistry {\n        freeze() {\n            super.freeze();\n            // Make sure PosComponent has the compiled classes.\n            // This way, we don't need to explicitly declare that\n            // a set of components is children of another.\n            PosComponent.components = {};\n            for (let [base, compiledClass] of this.cache.entries()) {\n                PosComponent.components[base.name] = compiledClass;\n            }\n        }\n        _recompute(base, old) {\n            const res = super._recompute(base, old);\n            if (typeof base === 'string') {\n                base = this.baseNameMap[base];\n            }\n            PosComponent.components[base.name] = res;\n            return res;\n        }\n    }\n\n    return ComponentRegistry;\n});\n", "odoo.define('point_of_sale.Registries', function(require) {\n    'use strict';\n\n    /**\n     * This definition contains all the instances of ClassRegistry.\n     */\n\n    const ComponentRegistry = require('point_of_sale.ComponentRegistry');\n\n    return { Component: new ComponentRegistry() };\n});\n", "odoo.define('point_of_sale.DB', function (require) {\n\"use strict\";\n\nvar core = require('web.core');\nvar utils = require('web.utils');\n/* The PosDB holds reference to data that is either\n * - static: does not change between pos reloads\n * - persistent : must stay between reloads ( orders )\n */\n\nvar PosDB = core.Class.extend({\n    name: 'openerp_pos_db', //the prefix of the localstorage data\n    limit: 100,  // the maximum number of results returned by a search\n    init: function(options){\n        options = options || {};\n        this.name = options.name || this.name;\n        this.limit = options.limit || this.limit;\n        \n        if (options.uuid) {\n            this.name = this.name + '_' + options.uuid;\n        }\n\n        //cache the data in memory to avoid roundtrips to the localstorage\n        this.cache = {};\n\n        this.product_by_id = {};\n        this.product_by_barcode = {};\n        this.product_by_category_id = {};\n        this.product_packaging_by_barcode = {};\n\n        this.partner_sorted = [];\n        this.partner_by_id = {};\n        this.partner_by_barcode = {};\n        this.partner_search_string = \"\";\n        this.partner_write_date = null;\n\n        this.category_by_id = {};\n        this.root_category_id  = 0;\n        this.category_products = {};\n        this.category_ancestors = {};\n        this.category_childs = {};\n        this.category_parent    = {};\n        this.category_search_string = {};\n    },\n\n    /** \n     * sets an uuid to prevent conflict in locally stored data between multiple PoS Configs. By\n     * using the uuid of the config the local storage from other configs will not get effected nor\n     * loaded in sessions that don't belong to them.\n     *\n     * @param {string} uuid Unique identifier of the PoS Config linked to the current session.\n     */\n    set_uuid: function(uuid){\n        this.name = this.name + '_' + uuid;\n    },\n\n    /* returns the category object from its id. If you pass a list of id as parameters, you get\n     * a list of category objects. \n     */  \n    get_category_by_id: function(categ_id){\n        if(categ_id instanceof Array){\n            var list = [];\n            for(var i = 0, len = categ_id.length; i < len; i++){\n                var cat = this.category_by_id[categ_id[i]];\n                if(cat){\n                    list.push(cat);\n                }else{\n                    console.error(\"get_category_by_id: no category has id:\",categ_id[i]);\n                }\n            }\n            return list;\n        }else{\n            return this.category_by_id[categ_id];\n        }\n    },\n    /* returns a list of the category's child categories ids, or an empty list \n     * if a category has no childs */\n    get_category_childs_ids: function(categ_id){\n        return this.category_childs[categ_id] || [];\n    },\n    /* returns a list of all ancestors (parent, grand-parent, etc) categories ids\n     * starting from the root category to the direct parent */\n    get_category_ancestors_ids: function(categ_id){\n        return this.category_ancestors[categ_id] || [];\n    },\n    /* returns the parent category's id of a category, or the root_category_id if no parent.\n     * the root category is parent of itself. */\n    get_category_parent_id: function(categ_id){\n        return this.category_parent[categ_id] || this.root_category_id;\n    },\n    /* adds categories definitions to the database. categories is a list of categories objects as\n     * returned by the openerp server. Categories must be inserted before the products or the \n     * product/ categories association may (will) not work properly */\n    add_categories: function(categories){\n        var self = this;\n        if(!this.category_by_id[this.root_category_id]){\n            this.category_by_id[this.root_category_id] = {\n                id : this.root_category_id,\n                name : 'Root',\n            };\n        }\n        categories.forEach(function(cat){\n            self.category_by_id[cat.id] = cat;\n        });\n        categories.forEach(function(cat){\n            var parent_id = cat.parent_id[0];\n            if(!(parent_id && self.category_by_id[parent_id])){\n                parent_id = self.root_category_id;\n            }\n            self.category_parent[cat.id] = parent_id;\n            if(!self.category_childs[parent_id]){\n                self.category_childs[parent_id] = [];\n            }\n            self.category_childs[parent_id].push(cat.id);\n        });\n        function make_ancestors(cat_id, ancestors){\n            self.category_ancestors[cat_id] = ancestors;\n\n            ancestors = ancestors.slice(0);\n            ancestors.push(cat_id);\n\n            var childs = self.category_childs[cat_id] || [];\n            for(var i=0, len = childs.length; i < len; i++){\n                make_ancestors(childs[i], ancestors);\n            }\n        }\n        make_ancestors(this.root_category_id, []);\n    },\n    category_contains: function(categ_id, product_id) {\n        var product = this.product_by_id[product_id];\n        if (product) {\n            var cid = product.pos_categ_id[0];\n            while (cid && cid !== categ_id){\n                cid = this.category_parent[cid];\n            }\n            return !!cid;\n        }\n        return false;\n    },\n    /* loads a record store from the database. returns default if nothing is found */\n    load: function(store,deft){\n        if(this.cache[store] !== undefined){\n            return this.cache[store];\n        }\n        var data = localStorage[this.name + '_' + store];\n        if(data !== undefined && data !== \"\"){\n            data = JSON.parse(data);\n            this.cache[store] = data;\n            return data;\n        }else{\n            return deft;\n        }\n    },\n    /* saves a record store to the database */\n    save: function(store,data){\n        localStorage[this.name + '_' + store] = JSON.stringify(data);\n        this.cache[store] = data;\n    },\n    _product_search_string: function(product){\n        var str = product.display_name;\n        if (product.barcode) {\n            str += '|' + product.barcode;\n        }\n        if (product.default_code) {\n            str += '|' + product.default_code;\n        }\n        if (product.description) {\n            str += '|' + product.description;\n        }\n        if (product.description_sale) {\n            str += '|' + product.description_sale;\n        }\n        str  = product.id + ':' + str.replace(/:/g,'') + '\\n';\n        return str;\n    },\n    add_products: function(products){\n        var stored_categories = this.product_by_category_id;\n\n        if(!products instanceof Array){\n            products = [products];\n        }\n        for(var i = 0, len = products.length; i < len; i++){\n            var product = products[i];\n            if (product.id in this.product_by_id) continue;\n            if (product.available_in_pos){\n                var search_string = utils.unaccent(this._product_search_string(product));\n                var categ_id = product.pos_categ_id ? product.pos_categ_id[0] : this.root_category_id;\n                product.product_tmpl_id = product.product_tmpl_id[0];\n                if(!stored_categories[categ_id]){\n                    stored_categories[categ_id] = [];\n                }\n                stored_categories[categ_id].push(product.id);\n\n                if(this.category_search_string[categ_id] === undefined){\n                    this.category_search_string[categ_id] = '';\n                }\n                this.category_search_string[categ_id] += search_string;\n\n                var ancestors = this.get_category_ancestors_ids(categ_id) || [];\n\n                for(var j = 0, jlen = ancestors.length; j < jlen; j++){\n                    var ancestor = ancestors[j];\n                    if(! stored_categories[ancestor]){\n                        stored_categories[ancestor] = [];\n                    }\n                    stored_categories[ancestor].push(product.id);\n\n                    if( this.category_search_string[ancestor] === undefined){\n                        this.category_search_string[ancestor] = '';\n                    }\n                    this.category_search_string[ancestor] += search_string;\n                }\n            }\n            this.product_by_id[product.id] = product;\n            if(product.barcode){\n                this.product_by_barcode[product.barcode] = product;\n            }\n        }\n    },\n    add_packagings: function(product_packagings){\n        var self = this;\n        _.map(product_packagings, function (product_packaging) {\n            if (_.find(self.product_by_id, {'id': product_packaging.product_id[0]})) {\n                self.product_packaging_by_barcode[product_packaging.barcode] = product_packaging;\n            }\n        });\n    },\n    _partner_search_string: function(partner){\n        var str =  partner.name || '';\n        if(partner.barcode){\n            str += '|' + partner.barcode;\n        }\n        if(partner.address){\n            str += '|' + partner.address;\n        }\n        if(partner.phone){\n            str += '|' + partner.phone.split(' ').join('');\n        }\n        if(partner.mobile){\n            str += '|' + partner.mobile.split(' ').join('');\n        }\n        if(partner.email){\n            str += '|' + partner.email;\n        }\n        if(partner.vat){\n            str += '|' + partner.vat;\n        }\n        str = '' + partner.id + ':' + str.replace(':', '').replace(/\\n/g, ' ') + '\\n';\n        return str;\n    },\n    add_partners: function(partners){\n        var updated_count = 0;\n        var new_write_date = '';\n        var partner;\n        for(var i = 0, len = partners.length; i < len; i++){\n            partner = partners[i];\n\n            var local_partner_date = (this.partner_write_date || '').replace(/^(\\d{4}-\\d{2}-\\d{2}) ((\\d{2}:?){3})$/, '$1T$2Z');\n            var dist_partner_date = (partner.write_date || '').replace(/^(\\d{4}-\\d{2}-\\d{2}) ((\\d{2}:?){3})$/, '$1T$2Z');\n            if (    this.partner_write_date &&\n                    this.partner_by_id[partner.id] &&\n                    new Date(local_partner_date).getTime() + 1000 >=\n                    new Date(dist_partner_date).getTime() ) {\n                // FIXME: The write_date is stored with milisec precision in the database\n                // but the dates we get back are only precise to the second. This means when\n                // you read partners modified strictly after time X, you get back partners that were\n                // modified X - 1 sec ago. \n                continue;\n            } else if ( new_write_date < partner.write_date ) { \n                new_write_date  = partner.write_date;\n            }\n            if (!this.partner_by_id[partner.id]) {\n                this.partner_sorted.push(partner.id);\n            }\n            this.partner_by_id[partner.id] = partner;\n\n            updated_count += 1;\n        }\n\n        this.partner_write_date = new_write_date || this.partner_write_date;\n\n        if (updated_count) {\n            // If there were updates, we need to completely \n            // rebuild the search string and the barcode indexing\n\n            this.partner_search_string = \"\";\n            this.partner_by_barcode = {};\n\n            for (var id in this.partner_by_id) {\n                partner = this.partner_by_id[id];\n\n                if(partner.barcode){\n                    this.partner_by_barcode[partner.barcode] = partner;\n                }\n                partner.address = (partner.street ? partner.street + ', ': '') +\n                                  (partner.zip ? partner.zip + ', ': '') +\n                                  (partner.city ? partner.city + ', ': '') +\n                                  (partner.state_id ? partner.state_id[1] + ', ': '') +\n                                  (partner.country_id ? partner.country_id[1]: '');\n                this.partner_search_string += this._partner_search_string(partner);\n            }\n\n            this.partner_search_string = utils.unaccent(this.partner_search_string);\n        }\n        return updated_count;\n    },\n    get_partner_write_date: function(){\n        return this.partner_write_date || \"1970-01-01 00:00:00\";\n    },\n    get_partner_by_id: function(id){\n        return this.partner_by_id[id];\n    },\n    get_partner_by_barcode: function(barcode){\n        return this.partner_by_barcode[barcode];\n    },\n    get_partners_sorted: function(max_count){\n        max_count = max_count ? Math.min(this.partner_sorted.length, max_count) : this.partner_sorted.length;\n        var partners = [];\n        for (var i = 0; i < max_count; i++) {\n            partners.push(this.partner_by_id[this.partner_sorted[i]]);\n        }\n        return partners;\n    },\n    search_partner: function(query){\n        try {\n            query = query.replace(/[\\[\\]\\(\\)\\+\\*\\?\\.\\-\\!\\&\\^\\$\\|\\~\\_\\{\\}\\:\\,\\\\\\/]/g,'.');\n            query = query.replace(/ /g,'.+');\n            var re = RegExp(\"([0-9]+):.*?\"+utils.unaccent(query),\"gi\");\n        }catch(e){\n            return [];\n        }\n        var results = [];\n        for(var i = 0; i < this.limit; i++){\n            var r = re.exec(this.partner_search_string);\n            if(r){\n                var id = Number(r[1]);\n                results.push(this.get_partner_by_id(id));\n            }else{\n                break;\n            }\n        }\n        return results;\n    },\n    /* removes all the data from the database. TODO : being able to selectively remove data */\n    clear: function(){\n        for(var i = 0, len = arguments.length; i < len; i++){\n            localStorage.removeItem(this.name + '_' + arguments[i]);\n        }\n    },\n    /* this internal methods returns the count of properties in an object. */\n    _count_props : function(obj){\n        var count = 0;\n        for(var prop in obj){\n            if(obj.hasOwnProperty(prop)){\n                count++;\n            }\n        }\n        return count;\n    },\n    get_product_by_id: function(id){\n        return this.product_by_id[id];\n    },\n    get_product_by_barcode: function(barcode){\n        if(this.product_by_barcode[barcode]){\n            return this.product_by_barcode[barcode];\n        } else if (this.product_packaging_by_barcode[barcode]) {\n            return this.product_by_id[this.product_packaging_by_barcode[barcode].product_id[0]];\n        }\n        return undefined;\n    },\n    get_product_by_category: function(category_id){\n        var product_ids  = this.product_by_category_id[category_id];\n        var list = [];\n        if (product_ids) {\n            for (var i = 0, len = Math.min(product_ids.length, this.limit); i < len; i++) {\n                const product = this.product_by_id[product_ids[i]];\n                if (!(product.active && product.available_in_pos)) continue;\n                list.push(product);\n            }\n        }\n        return list;\n    },\n    /* returns a list of products with :\n     * - a category that is or is a child of category_id,\n     * - a name, package or barcode containing the query (case insensitive) \n     */\n    search_product_in_category: function(category_id, query){\n        try {\n            query = query.replace(/[\\[\\]\\(\\)\\+\\*\\?\\.\\-\\!\\&\\^\\$\\|\\~\\_\\{\\}\\:\\,\\\\\\/]/g,'.');\n            query = query.replace(/ /g,'.+');\n            var re = RegExp(\"([0-9]+):.*?\"+utils.unaccent(query),\"gi\");\n        }catch(e){\n            return [];\n        }\n        var results = [];\n        for(var i = 0; i < this.limit; i++){\n            var r = re.exec(this.category_search_string[category_id]);\n            if(r){\n                var id = Number(r[1]);\n                const product = this.get_product_by_id(id);\n                if (!(product.active && product.available_in_pos)) continue;\n                results.push(product);\n            }else{\n                break;\n            }\n        }\n        return results;\n    },\n    /* from a product id, and a list of category ids, returns\n     * true if the product belongs to one of the provided category\n     * or one of its child categories.\n     */\n    is_product_in_category: function(category_ids, product_id) {\n        if (!(category_ids instanceof Array)) {\n            category_ids = [category_ids];\n        }\n        var cat = this.get_product_by_id(product_id).pos_categ_id[0];\n        while (cat) {\n            for (var i = 0; i < category_ids.length; i++) {\n                if (cat == category_ids[i]) {   // The == is important, ids may be strings\n                    return true;\n                }\n            }\n            cat = this.get_category_parent_id(cat);\n        }\n        return false;\n    },\n\n    /* paid orders */\n    add_order: function(order){\n        var order_id = order.uid;\n        var orders  = this.load('orders',[]);\n\n        // if the order was already stored, we overwrite its data\n        for(var i = 0, len = orders.length; i < len; i++){\n            if(orders[i].id === order_id){\n                orders[i].data = order;\n                this.save('orders',orders);\n                return order_id;\n            }\n        }\n\n        // Only necessary when we store a new, validated order. Orders\n        // that where already stored should already have been removed.\n        this.remove_unpaid_order(order);\n\n        orders.push({id: order_id, data: order});\n        this.save('orders',orders);\n        return order_id;\n    },\n    remove_order: function(order_id){\n        var orders = this.load('orders',[]);\n        orders = _.filter(orders, function(order){\n            return order.id !== order_id;\n        });\n        this.save('orders',orders);\n    },\n    remove_all_orders: function(){\n        this.save('orders',[]);\n    },\n    get_orders: function(){\n        return this.load('orders',[]);\n    },\n    get_order: function(order_id){\n        var orders = this.get_orders();\n        for(var i = 0, len = orders.length; i < len; i++){\n            if(orders[i].id === order_id){\n                return orders[i];\n            }\n        }\n        return undefined;\n    },\n\n    /* working orders */\n    save_unpaid_order: function(order){\n        var order_id = order.uid;\n        var orders = this.load('unpaid_orders',[]);\n        var serialized = order.export_as_JSON();\n\n        for (var i = 0; i < orders.length; i++) {\n            if (orders[i].id === order_id){\n                orders[i].data = serialized;\n                this.save('unpaid_orders',orders);\n                return order_id;\n            }\n        }\n\n        orders.push({id: order_id, data: serialized});\n        this.save('unpaid_orders',orders);\n        return order_id;\n    },\n    remove_unpaid_order: function(order){\n        var orders = this.load('unpaid_orders',[]);\n        orders = _.filter(orders, function(o){\n            return o.id !== order.uid;\n        });\n        this.save('unpaid_orders',orders);\n    },\n    remove_all_unpaid_orders: function(){\n        this.save('unpaid_orders',[]);\n    },\n    get_unpaid_orders: function(){\n        var saved = this.load('unpaid_orders',[]);\n        var orders = [];\n        for (var i = 0; i < saved.length; i++) {\n            orders.push(saved[i].data);\n        }\n        return orders;\n    },\n    /**\n     * Return the orders with requested ids if they are unpaid.\n     * @param {array<number>} ids order_ids.\n     * @return {array<object>} list of orders.\n     */\n    get_unpaid_orders_to_sync: function(ids){\n        var saved = this.load('unpaid_orders',[]);\n        var orders = [];\n        saved.forEach(function(o) {\n            if (ids.includes(o.id) && (o.data.server_id || o.data.lines.length)){\n                orders.push(o);\n            }\n        });\n        return orders;\n    },\n    /**\n     * Add a given order to the orders to be removed from the server.\n     *\n     * If an order is removed from a table it also has to be removed from the server to prevent it from reapearing \n     * after syncing. This function will add the server_id of the order to a list of orders still to be removed.\n     * @param {object} order object.\n     */\n    set_order_to_remove_from_server: function(order){\n        if (order.server_id !== undefined) {\n            var to_remove = this.load('unpaid_orders_to_remove',[]);\n            to_remove.push(order.server_id);\n            this.save('unpaid_orders_to_remove', to_remove);\n        }\n    },\n    /**\n     * Get a list of server_ids of orders to be removed.\n     * @return {array<number>} list of server_ids.\n     */\n    get_ids_to_remove_from_server: function(){\n        return this.load('unpaid_orders_to_remove',[]);\n    },\n    /**\n     * Remove server_ids from the list of orders to be removed.\n     * @param {array<number>} ids\n     */\n    set_ids_removed_from_server: function(ids){\n        var to_remove = this.load('unpaid_orders_to_remove',[]);\n        \n        to_remove = _.filter(to_remove, function(id){\n            return !ids.includes(id);\n        });\n        this.save('unpaid_orders_to_remove', to_remove);\n    },\n    set_cashier: function(cashier) {\n        // Always update if the user is the same as before\n        this.save('cashier', cashier || null);\n    },\n    get_cashier: function() {\n        return this.load('cashier');\n    }\n});\n\nreturn PosDB;\n\n});\n\n", "/* global Backbone, waitForWebfonts */\nodoo.define('point_of_sale.models', function (require) {\n\"use strict\";\n\nconst { Context } = owl;\nvar BarcodeParser = require('barcodes.BarcodeParser');\nvar BarcodeReader = require('point_of_sale.BarcodeReader');\nvar PosDB = require('point_of_sale.DB');\nvar devices = require('point_of_sale.devices');\nvar concurrency = require('web.concurrency');\nvar config = require('web.config');\nvar core = require('web.core');\nvar field_utils = require('web.field_utils');\nvar time = require('web.time');\nvar utils = require('web.utils');\nvar { Gui } = require('point_of_sale.Gui');\n\nvar QWeb = core.qweb;\nvar _t = core._t;\nvar Mutex = concurrency.Mutex;\nvar round_di = utils.round_decimals;\nvar round_pr = utils.round_precision;\n\nvar exports = {};\n\n// The PosModel contains the Point Of Sale's representation of the backend.\n// Since the PoS must work in standalone ( Without connection to the server )\n// it must contains a representation of the server's PoS backend.\n// (taxes, product list, configuration options, etc.)  this representation\n// is fetched and stored by the PosModel at the initialisation.\n// this is done asynchronously, a ready deferred alows the GUI to wait interactively\n// for the loading to be completed\n// There is a single instance of the PosModel for each Front-End instance, it is usually called\n// 'pos' and is available to all widgets extending PosWidget.\n\nexports.PosModel = Backbone.Model.extend({\n    initialize: function(attributes) {\n        Backbone.Model.prototype.initialize.call(this, attributes);\n        var  self = this;\n        this.flush_mutex = new Mutex();                   // used to make sure the orders are sent to the server once at time\n\n        this.env = this.get('env');\n        this.rpc = this.get('rpc');\n        this.session = this.get('session');\n        this.do_action = this.get('do_action');\n        this.setLoadingMessage = this.get('setLoadingMessage');\n        this.setLoadingProgress = this.get('setLoadingProgress');\n        this.showLoadingSkip = this.get('showLoadingSkip');\n\n        this.proxy = new devices.ProxyDevice(this);              // used to communicate to the hardware devices via a local proxy\n        this.barcode_reader = new BarcodeReader({'pos': this, proxy:this.proxy});\n\n        this.proxy_queue = new devices.JobQueue();           // used to prevent parallels communications to the proxy\n        this.db = new PosDB();                       // a local database used to search trough products and categories & store pending orders\n        this.debug = config.isDebug(); //debug mode\n\n        // Business data; loaded from the server at launch\n        this.company_logo = null;\n        this.company_logo_base64 = '';\n        this.currency = null;\n        this.company = null;\n        this.user = null;\n        this.users = [];\n        this.employee = {name: null, id: null, barcode: null, user_id:null, pin:null};\n        this.employees = [];\n        this.partners = [];\n        this.taxes = [];\n        this.pos_session = null;\n        this.config = null;\n        this.units = [];\n        this.units_by_id = {};\n        this.uom_unit_id = null;\n        this.default_pricelist = null;\n        this.order_sequence = 1;\n        window.posmodel = this;\n\n        // Object mapping the order's name (which contains the uid) to it's server_id after\n        // validation (order paid then sent to the backend).\n        this.validated_orders_name_server_id_map = {};\n\n        // Record<orderlineId, { 'qty': number, 'orderline': { qty: number, refundedQty: number, orderUid: string }, 'destinationOrderUid': string }>\n        this.toRefundLines = {};\n        this.TICKET_SCREEN_STATE = {\n            syncedOrders: {\n                currentPage: 1,\n                cache: {},\n                toShow: [],\n                nPerPage: 80,\n                totalCount: null,\n            },\n            ui: {\n                selectedSyncedOrderId: null,\n                searchDetails: this.getDefaultSearchDetails(),\n                filter: null,\n                // maps the order's backendId to it's selected orderline\n                selectedOrderlineIds: {},\n                highlightHeaderNote: false,\n            },\n        };\n\n        // Extract the config id from the url.\n        var given_config = new RegExp('[\\?&]config_id=([^&#]*)').exec(window.location.href);\n        this.config_id = given_config && given_config[1] && parseInt(given_config[1]) || false;\n\n        // these dynamic attributes can be watched for change by other models or widgets\n        this.set({\n            'synch':            { status:'connected', pending:0 },\n            'orders':           new OrderCollection(),\n            'selectedOrder':    null,\n            'selectedClient':   null,\n            'cashier':          null,\n            'selectedCategoryId': null,\n        });\n\n        this.get('orders').on('remove', function(order,_unused_,options){\n            self.on_removed_order(order,options.index,options.reason);\n        });\n\n        // Forward the 'client' attribute on the selected order to 'selectedClient'\n        function update_client() {\n            var order = self.get_order();\n            this.set('selectedClient', order ? order.get_client() : null );\n        }\n        this.get('orders').on('add remove change', update_client, this);\n        this.on('change:selectedOrder', update_client, this);\n\n        // We fetch the backend data on the server asynchronously. this is done only when the pos user interface is launched,\n        // Any change on this data made on the server is thus not reflected on the point of sale until it is relaunched.\n        // when all the data has loaded, we compute some stuff, and declare the Pos ready to be used.\n        this.ready = this.load_server_data().then(function(){\n            return self.after_load_server_data();\n        });\n    },\n    getDefaultSearchDetails: function() {\n        return {\n            fieldName: 'RECEIPT_NUMBER',\n            searchTerm: '',\n        };\n    },\n    load_product_uom_unit: async function() {\n        const params = {\n            model: 'ir.model.data',\n            method:'check_object_reference',\n            args: ['uom', 'product_uom_unit'],\n        };\n\n        const uom_id = await this.rpc(params);\n        this.uom_unit_id = uom_id[1];\n    },\n\n    after_load_server_data: async function(){\n        await this.load_product_uom_unit();\n        await this.load_orders();\n        this.set_start_order();\n        if(this.config.use_proxy){\n            if (this.config.iface_customer_facing_display) {\n                this.on('change:selectedOrder', this.send_current_order_to_customer_facing_display, this);\n            }\n\n            return this.connect_to_proxy();\n        }\n        if(this.config.limited_products_loading) {\n            await this.loadLimitedProducts();\n            if(this.config.product_load_background)\n                this.loadProductsBackground();\n        }\n        if(this.config.partner_load_background )\n            this.loadPartnersBackground();\n        return Promise.resolve();\n    },\n    // releases ressources holds by the model at the end of life of the posmodel\n    destroy: function(){\n        // FIXME, should wait for flushing, return a deferred to indicate successfull destruction\n        // this.flush();\n        this.proxy.disconnect();\n        this.barcode_reader.disconnect_from_proxy();\n    },\n\n    connect_to_proxy: function () {\n        var self = this;\n        return new Promise(function (resolve, reject) {\n            self.barcode_reader.disconnect_from_proxy();\n            self.setLoadingMessage(_t('Connecting to the IoT Box'), 0);\n            self.showLoadingSkip(function () {\n                self.proxy.stop_searching();\n            });\n            self.proxy.autoconnect({\n                force_ip: self.config.proxy_ip || undefined,\n                progress: function(prog){\n                    self.setLoadingProgress(prog);\n                },\n            }).then(\n                function () {\n                    if (self.config.iface_scan_via_proxy) {\n                        self.barcode_reader.connect_to_proxy();\n                    }\n                    resolve();\n                },\n                function (statusText, url) {\n                    // this should reject so that it can be captured when we wait for pos.ready\n                    // in the chrome component.\n                    // then, if it got really rejected, we can show the error.\n                    if (statusText == 'error' && window.location.protocol == 'https:') {\n                        reject({\n                            title: _t('HTTPS connection to IoT Box failed'),\n                            body: _.str.sprintf(\n                              _t('Make sure you are using IoT Box v18.12 or higher. Navigate to %s to accept the certificate of your IoT Box.'),\n                              url\n                            ),\n                            popup: 'alert',\n                        });\n                    } else {\n                        resolve();\n                    }\n                }\n            );\n        });\n    },\n\n    // Server side model loaders. This is the list of the models that need to be loaded from\n    // the server. The models are loaded one by one by this list's order. The 'loaded' callback\n    // is used to store the data in the appropriate place once it has been loaded. This callback\n    // can return a promise that will pause the loading of the next module.\n    // a shared temporary dictionary is available for loaders to communicate private variables\n    // used during loading such as object ids, etc.\n    models: [\n    {\n        label:  'version',\n        loaded: function (self) {\n            return self.session.rpc('/web/webclient/version_info',{}).then(function (version) {\n                self.version = version;\n            });\n        },\n\n    },{\n        model:  'res.company',\n        fields: [ 'currency_id', 'email', 'website', 'company_registry', 'vat', 'name', 'phone', 'partner_id' , 'country_id', 'state_id', 'tax_calculation_rounding_method'],\n        ids:    function(self){ return [self.session.user_context.allowed_company_ids[0]]; },\n        loaded: function(self,companies){ self.company = companies[0]; },\n    },{\n        model:  'decimal.precision',\n        fields: ['name','digits'],\n        loaded: function(self,dps){\n            self.dp  = {};\n            for (var i = 0; i < dps.length; i++) {\n                self.dp[dps[i].name] = dps[i].digits;\n            }\n        },\n    },{\n        model:  'uom.uom',\n        fields: [],\n        domain: null,\n        context: function(self){ return { active_test: false }; },\n        loaded: function(self,units){\n            self.units = units;\n            _.each(units, function(unit){\n                self.units_by_id[unit.id] = unit;\n            });\n        }\n    },{\n        model:  'res.country.state',\n        fields: ['name', 'country_id'],\n        loaded: function(self,states){\n            self.states = states;\n        },\n    },{\n        model:  'res.country',\n        fields: ['name', 'vat_label', 'code'],\n        loaded: function(self,countries){\n            self.countries = countries;\n            self.company.country = null;\n            for (var i = 0; i < countries.length; i++) {\n                if (countries[i].id === self.company.country_id[0]){\n                    self.company.country = countries[i];\n                }\n            }\n        },\n    },{\n        model:  'res.lang',\n        fields: ['name', 'code'],\n        loaded: function (self, langs){\n            self.langs = langs;\n        },\n    },{\n        model:  'account.tax',\n        fields: ['name','amount', 'price_include', 'include_base_amount', 'is_base_affected', 'amount_type', 'children_tax_ids'],\n        domain: function(self) {return [['company_id', '=', self.company && self.company.id || false]]},\n        loaded: function(self, taxes){\n            self.taxes = taxes;\n            self.taxes_by_id = {};\n            _.each(taxes, function(tax){\n                self.taxes_by_id[tax.id] = tax;\n            });\n            _.each(self.taxes_by_id, function(tax) {\n                tax.children_tax_ids = _.map(tax.children_tax_ids, function (child_tax_id) {\n                    return self.taxes_by_id[child_tax_id];\n                });\n            });\n            return new Promise(function (resolve, reject) {\n              var tax_ids = _.pluck(self.taxes, 'id');\n              self.rpc({\n                  model: 'account.tax',\n                  method: 'get_real_tax_amount',\n                  args: [tax_ids],\n              }).then(function (taxes) {\n                  _.each(taxes, function (tax) {\n                      self.taxes_by_id[tax.id].amount = tax.amount;\n                  });\n                  resolve();\n              });\n            });\n        },\n    },{\n        model:  'pos.session',\n        fields: ['id', 'name', 'user_id', 'config_id', 'start_at', 'stop_at', 'sequence_number', 'payment_method_ids', 'cash_register_id', 'state', 'update_stock_at_closing'],\n        domain: function(self){\n            var domain = [\n                ['state','in',['opening_control','opened']],\n                ['rescue', '=', false],\n            ];\n            if (self.config_id) domain.push(['config_id', '=', self.config_id]);\n            return domain;\n        },\n        loaded: function(self, pos_sessions, tmp){\n            self.pos_session = pos_sessions[0];\n            self.pos_session.login_number = odoo.login_number;\n            self.config_id = self.config_id || self.pos_session && self.pos_session.config_id[0];\n            tmp.payment_method_ids = pos_sessions[0].payment_method_ids;\n        },\n    },{\n        model: 'pos.config',\n        fields: [],\n        domain: function(self){ return [['id','=', self.config_id]]; },\n        loaded: function(self,configs){\n            self.config = configs[0];\n            self.config.use_proxy = self.config.is_posbox && (\n                                    self.config.iface_electronic_scale ||\n                                    self.config.iface_print_via_proxy  ||\n                                    self.config.iface_scan_via_proxy   ||\n                                    self.config.iface_customer_facing_display_via_proxy);\n\n            self.db.set_uuid(self.config.uuid);\n            self.set_cashier(self.get_cashier());\n            // We need to do it here, since only then the local storage has the correct uuid\n            self.db.save('pos_session_id', self.pos_session.id);\n\n            var orders = self.db.get_orders();\n            for (var i = 0; i < orders.length; i++) {\n                self.pos_session.sequence_number = Math.max(self.pos_session.sequence_number, orders[i].data.sequence_number+1);\n            }\n       },\n    },{\n        model: 'pos.bill',\n        fields: ['name', 'value'],\n        domain: function (self) {\n            return [['id', 'in', self.config.default_bill_ids]];\n        },\n        loaded: function (self, bills) {\n            self.bills = bills;\n        },\n      }, {\n        model:  'res.partner',\n        label: 'load_partners',\n        fields: ['name','street','city','state_id','country_id','vat','lang',\n                 'phone','zip','mobile','email','barcode','write_date',\n                 'property_account_position_id','property_product_pricelist'],\n        domain: async function(self){\n            if(self.config.limited_partners_loading) {\n                const result = await self.rpc({\n                      model: 'pos.config',\n                      method: 'get_limited_partners_loading',\n                      args: [self.config.id],\n                });\n                return [['id','in', result.map(elem => elem[0])]];\n            }\n            return [];\n        },\n        loaded: function(self,partners){\n            self.partners = partners;\n            self.db.add_partners(partners);\n        },\n    },{\n      model: 'stock.picking.type',\n      fields: ['use_create_lots', 'use_existing_lots'],\n      domain: function(self){ return [['id', '=', self.config.picking_type_id[0]]]; },\n      loaded: function(self, picking_type) {\n          self.picking_type = picking_type[0];\n      },\n    },{\n        model:  'res.users',\n        fields: ['name','company_id', 'id', 'groups_id', 'lang'],\n        domain: function(self){ return [['company_ids', 'in', self.config.company_id[0]],'|', ['groups_id','=', self.config.group_pos_manager_id[0]],['groups_id','=', self.config.group_pos_user_id[0]]]; },\n        loaded: function(self,users){\n            users.forEach(function(user) {\n                user.role = 'cashier';\n                user.groups_id.some(function(group_id) {\n                    if (group_id === self.config.group_pos_manager_id[0]) {\n                        user.role = 'manager';\n                        return true;\n                    }\n                });\n                if (user.id === self.session.uid) {\n                    self.user = user;\n                    self.employee.name = user.name;\n                    self.employee.role = user.role;\n                    self.employee.user_id = [user.id, user.name];\n                }\n            });\n            self.users = users;\n            self.employees = [self.employee];\n            self.set_cashier(self.employee);\n        },\n    },{\n        model:  'product.pricelist',\n        fields: ['name', 'display_name', 'discount_policy'],\n        domain: function(self) {\n            if (self.config.use_pricelist) {\n                return [['id', 'in', self.config.available_pricelist_ids]];\n            } else {\n                return [['id', '=', self.config.pricelist_id[0]]];\n            }\n        },\n        loaded: function(self, pricelists){\n            _.map(pricelists, function (pricelist) { pricelist.items = []; });\n            self.default_pricelist = _.findWhere(pricelists, {id: self.config.pricelist_id[0]});\n            self.pricelists = pricelists;\n        },\n    },{\n        model:  'account.bank.statement',\n        fields: ['id', 'balance_start'],\n        domain: function(self){ return [['id', '=', self.pos_session.cash_register_id[0]]]; },\n        loaded: function(self, statement){\n            self.bank_statement = statement[0];\n        },\n    },{\n        model:  'product.pricelist.item',\n        domain: function(self) { return [['pricelist_id', 'in', _.pluck(self.pricelists, 'id')]]; },\n        loaded: function(self, pricelist_items){\n            var pricelist_by_id = {};\n            _.each(self.pricelists, function (pricelist) {\n                pricelist_by_id[pricelist.id] = pricelist;\n            });\n\n            _.each(pricelist_items, function (item) {\n                var pricelist = pricelist_by_id[item.pricelist_id[0]];\n                pricelist.items.push(item);\n                item.base_pricelist = pricelist_by_id[item.base_pricelist_id[0]];\n            });\n        },\n    },{\n        model:  'product.category',\n        fields: ['name', 'parent_id'],\n        loaded: function(self, product_categories){\n            var category_by_id = {};\n            _.each(product_categories, function (category) {\n                category_by_id[category.id] = category;\n            });\n            _.each(product_categories, function (category) {\n                category.parent = category_by_id[category.parent_id[0]];\n            });\n\n            self.product_categories = product_categories;\n        },\n    },{\n        model: 'res.currency',\n        fields: ['name','symbol','position','rounding','rate'],\n        ids:    function(self){ return [self.config.currency_id[0], self.company.currency_id[0]]; },\n        loaded: function(self, currencies){\n            self.currency = currencies[0];\n            if (self.currency.rounding > 0 && self.currency.rounding < 1) {\n                self.currency.decimals = Math.ceil(Math.log(1.0 / self.currency.rounding) / Math.log(10));\n            } else {\n                self.currency.decimals = 0;\n            }\n\n            self.company_currency = currencies[1];\n        },\n    },{\n        model:  'pos.category',\n        fields: ['id', 'name', 'parent_id', 'child_id', 'write_date'],\n        domain: function(self) {\n            return self.config.limit_categories && self.config.iface_available_categ_ids.length ? [['id', 'in', self.config.iface_available_categ_ids]] : [];\n        },\n        loaded: function(self, categories){\n            self.db.add_categories(categories);\n        },\n    },{\n        model:  'product.product',\n        label: 'load_products',\n        condition: function (self) { return !self.config.limited_products_loading; },\n        fields: ['display_name', 'lst_price', 'standard_price', 'categ_id', 'pos_categ_id', 'taxes_id',\n                 'barcode', 'default_code', 'to_weight', 'uom_id', 'description_sale', 'description',\n                 'product_tmpl_id','tracking', 'write_date', 'available_in_pos', 'attribute_line_ids', 'active'],\n        order:  _.map(['sequence','default_code','name'], function (name) { return {name: name}; }),\n        domain: function(self){\n            var domain = ['&', '&', ['sale_ok','=',true],['available_in_pos','=',true],'|',['company_id','=',self.config.company_id[0]],['company_id','=',false]];\n            if (self.config.limit_categories &&  self.config.iface_available_categ_ids.length) {\n                domain.unshift('&');\n                domain.push(['pos_categ_id', 'in', self.config.iface_available_categ_ids]);\n            }\n            if (self.config.iface_tipproduct){\n              domain.unshift(['id', '=', self.config.tip_product_id[0]]);\n              domain.unshift('|');\n            }\n\n            return domain;\n        },\n        context: function(self){ return { display_default_code: false }; },\n        loaded: function(self, products){\n            var using_company_currency = self.config.currency_id[0] === self.company.currency_id[0];\n            var conversion_rate = self.currency.rate / self.company_currency.rate;\n            self.db.add_products(_.map(products, function (product) {\n                if (!using_company_currency) {\n                    product.lst_price = round_pr(product.lst_price * conversion_rate, self.currency.rounding);\n                }\n                product.categ = _.findWhere(self.product_categories, {'id': product.categ_id[0]});\n                product.pos = self;\n                return new exports.Product({}, product);\n            }));\n        },\n    },{\n        model: 'product.packaging',\n        fields: ['name', 'barcode', 'product_id', 'qty'],\n        domain: function(self){return [['barcode', '!=', '']]; },\n        loaded: function(self, product_packagings) {\n            self.db.add_packagings(product_packagings);\n        }\n    },{\n        model: 'product.attribute',\n        fields: ['name', 'display_type'],\n        condition: function (self) { return self.config.product_configurator; },\n        domain: function(){ return [['create_variant', '=', 'no_variant']]; },\n        loaded: function(self, product_attributes, tmp) {\n            tmp.product_attributes_by_id = {};\n            _.map(product_attributes, function (product_attribute) {\n                tmp.product_attributes_by_id[product_attribute.id] = product_attribute;\n            });\n        }\n    },{\n        model: 'product.attribute.value',\n        fields: ['name', 'attribute_id', 'is_custom', 'html_color'],\n        condition: function (self) { return self.config.product_configurator; },\n        domain: function(self, tmp){ return [['attribute_id', 'in', _.keys(tmp.product_attributes_by_id).map(parseFloat)]]; },\n        loaded: function(self, pavs, tmp) {\n            tmp.pav_by_id = {};\n            _.map(pavs, function (pav) {\n                tmp.pav_by_id[pav.id] = pav;\n            });\n        }\n    }, {\n        model: 'product.template.attribute.value',\n        fields: ['product_attribute_value_id', 'attribute_id', 'attribute_line_id', 'price_extra'],\n        condition: function (self) { return self.config.product_configurator; },\n        domain: function(self, tmp){ return [['attribute_id', 'in', _.keys(tmp.product_attributes_by_id).map(parseFloat)]]; },\n        loaded: function(self, ptavs, tmp) {\n            self.attributes_by_ptal_id = {};\n            _.map(ptavs, function (ptav) {\n                if (!self.attributes_by_ptal_id[ptav.attribute_line_id[0]]){\n                    self.attributes_by_ptal_id[ptav.attribute_line_id[0]] = {\n                        id: ptav.attribute_line_id[0],\n                        name: tmp.product_attributes_by_id[ptav.attribute_id[0]].name,\n                        display_type: tmp.product_attributes_by_id[ptav.attribute_id[0]].display_type,\n                        values: [],\n                    };\n                }\n                self.attributes_by_ptal_id[ptav.attribute_line_id[0]].values.push({\n                    id: ptav.product_attribute_value_id[0],\n                    name: tmp.pav_by_id[ptav.product_attribute_value_id[0]].name,\n                    is_custom: tmp.pav_by_id[ptav.product_attribute_value_id[0]].is_custom,\n                    html_color: tmp.pav_by_id[ptav.product_attribute_value_id[0]].html_color,\n                    price_extra: ptav.price_extra,\n                });\n            });\n        }\n    },{\n        model: 'account.cash.rounding',\n        fields: ['name', 'rounding', 'rounding_method'],\n        domain: function(self){return [['id', '=', self.config.rounding_method[0]]]; },\n        loaded: function(self, cash_rounding) {\n            self.cash_rounding = cash_rounding;\n        }\n    },{\n        model:  'pos.payment.method',\n        fields: ['name', 'is_cash_count', 'use_payment_terminal', 'split_transactions', 'type'],\n        domain: function(self){return ['|',['active', '=', false], ['active', '=', true]]; },\n        loaded: function(self, payment_methods) {\n            self.payment_methods = payment_methods.sort(function(a,b){\n                // prefer cash payment_method to be first in the list\n                if (a.is_cash_count && !b.is_cash_count) {\n                    return -1;\n                } else if (!a.is_cash_count && b.is_cash_count) {\n                    return 1;\n                } else {\n                    return a.id - b.id;\n                }\n            });\n            self.payment_methods_by_id = {};\n            _.each(self.payment_methods, function(payment_method) {\n                self.payment_methods_by_id[payment_method.id] = payment_method;\n\n                var PaymentInterface = self.electronic_payment_interfaces[payment_method.use_payment_terminal];\n                if (PaymentInterface) {\n                    payment_method.payment_terminal = new PaymentInterface(self, payment_method);\n                }\n            });\n        }\n    },{\n        model:  'account.fiscal.position',\n        fields: [],\n        domain: function(self){ return [['id','in',self.config.fiscal_position_ids]]; },\n        loaded: function(self, fiscal_positions){\n            self.fiscal_positions = fiscal_positions;\n        }\n    }, {\n        model:  'account.fiscal.position.tax',\n        fields: [],\n        domain: function(self){\n            var fiscal_position_tax_ids = [];\n\n            self.fiscal_positions.forEach(function (fiscal_position) {\n                fiscal_position.tax_ids.forEach(function (tax_id) {\n                    fiscal_position_tax_ids.push(tax_id);\n                });\n            });\n\n            return [['id','in',fiscal_position_tax_ids]];\n        },\n        loaded: function(self, fiscal_position_taxes){\n            self.fiscal_position_taxes = fiscal_position_taxes;\n            self.fiscal_positions.forEach(function (fiscal_position) {\n                fiscal_position.fiscal_position_taxes_by_id = {};\n                fiscal_position.tax_ids.forEach(function (tax_id) {\n                    var fiscal_position_tax = _.find(fiscal_position_taxes, function (fiscal_position_tax) {\n                        return fiscal_position_tax.id === tax_id;\n                    });\n\n                    fiscal_position.fiscal_position_taxes_by_id[fiscal_position_tax.id] = fiscal_position_tax;\n                });\n            });\n        }\n    },  {\n        label: 'fonts',\n        loaded: function(){\n            return new Promise(function (resolve, reject) {\n                // Waiting for fonts to be loaded to prevent receipt printing\n                // from printing empty receipt while loading Inconsolata\n                // ( The font used for the receipt )\n                waitForWebfonts(['Lato','Inconsolata'], function () {\n                    resolve();\n                });\n                // The JS used to detect font loading is not 100% robust, so\n                // do not wait more than 5sec\n                setTimeout(resolve, 5000);\n            });\n        },\n    },{\n        label: 'pictures',\n        loaded: function (self) {\n            self.company_logo = new Image();\n            return new Promise(function (resolve, reject) {\n                self.company_logo.onload = function () {\n                    var img = self.company_logo;\n                    var ratio = 1;\n                    var targetwidth = 300;\n                    var maxheight = 150;\n                    if( img.width !== targetwidth ){\n                        ratio = targetwidth / img.width;\n                    }\n                    if( img.height * ratio > maxheight ){\n                        ratio = maxheight / img.height;\n                    }\n                    var width  = Math.floor(img.width * ratio);\n                    var height = Math.floor(img.height * ratio);\n                    var c = document.createElement('canvas');\n                    c.width  = width;\n                    c.height = height;\n                    var ctx = c.getContext('2d');\n                    ctx.drawImage(self.company_logo,0,0, width, height);\n\n                    self.company_logo_base64 = c.toDataURL();\n                    resolve();\n                };\n                self.company_logo.onerror = function () {\n                    reject();\n                };\n                self.company_logo.crossOrigin = \"anonymous\";\n                self.company_logo.src = '/web/binary/company_logo' + '?dbname=' + self.session.db + '&company=' + self.company.id + '&_' + Math.random();\n            });\n        },\n    }, {\n        label: 'barcodes',\n        loaded: function(self) {\n            var barcode_parser = new BarcodeParser({'nomenclature_id': self.config.barcode_nomenclature_id});\n            self.barcode_reader.set_barcode_parser(barcode_parser);\n            return barcode_parser.is_loaded();\n        },\n    },\n    ],\n\n    // loads all the needed data on the sever. returns a promise indicating when all the data has loaded.\n    load_server_data: function(){\n        var self = this;\n        var progress = 0;\n        var progress_step = 1.0 / self.models.length;\n        var tmp = {}; // this is used to share a temporary state between models loaders\n\n        var loaded = new Promise(function (resolve, reject) {\n            async function load_model(index) {\n                if (index >= self.models.length) {\n                    resolve();\n                } else {\n                    var model = self.models[index];\n                    self.setLoadingMessage(_t('Loading')+' '+(model.label || model.model || ''), progress);\n\n                    var cond = typeof model.condition === 'function'  ? model.condition(self,tmp) : true;\n                    if (!cond) {\n                        load_model(index+1);\n                        return;\n                    }\n\n                    var fields =  typeof model.fields === 'function'  ? model.fields(self,tmp)  : model.fields;\n                    var domain =  typeof model.domain === 'function'  ? await model.domain(self,tmp)  : model.domain;\n                    var context = typeof model.context === 'function' ? model.context(self,tmp) : model.context || {};\n                    var ids     = typeof model.ids === 'function'     ? model.ids(self,tmp) : model.ids;\n                    var order   = typeof model.order === 'function'   ? model.order(self,tmp):    model.order;\n                    progress += progress_step;\n\n                    if(model.model ){\n                        var params = {\n                            model: model.model,\n                            context: _.extend(context, self.session.user_context || {}),\n                        };\n\n                        if (model.ids) {\n                            params.method = 'read';\n                            params.args = [ids, fields];\n                        } else {\n                            params.method = 'search_read';\n                            params.domain = domain;\n                            params.fields = fields;\n                            params.orderBy = order;\n                        }\n\n                        self.rpc(params).then(function (result) {\n                            try { // catching exceptions in model.loaded(...)\n                                Promise.resolve(model.loaded(self, result, tmp))\n                                    .then(function () { load_model(index + 1); },\n                                        function (err) { reject(err); });\n                            } catch (err) {\n                                console.error(err.message, err.stack);\n                                reject(err);\n                            }\n                        }, function (err) {\n                            reject(err);\n                        });\n                    } else if (model.loaded) {\n                        try { // catching exceptions in model.loaded(...)\n                            Promise.resolve(model.loaded(self, tmp))\n                                .then(function () { load_model(index +1); },\n                                    function (err) { reject(err); });\n                        } catch (err) {\n                            reject(err);\n                        }\n                    } else {\n                        load_model(index + 1);\n                    }\n                }\n            }\n\n            try {\n                return load_model(0);\n            } catch (err) {\n                return Promise.reject(err);\n            }\n        });\n\n        return loaded;\n    },\n\n    prepare_new_partners_domain: function(){\n        return [['write_date','>', this.db.get_partner_write_date()]];\n    },\n\n    // reload the list of partner, returns as a promise that resolves if there were\n    // updated partners, and fails if not\n    load_new_partners: function(){\n        var self = this;\n        return new Promise(function (resolve, reject) {\n            var fields = _.find(self.models, function(model){ return model.label === 'load_partners'; }).fields;\n            var domain = self.prepare_new_partners_domain();\n            self.rpc({\n                model: 'res.partner',\n                method: 'search_read',\n                args: [domain, fields],\n            }, {\n                timeout: 3000,\n                shadow: true,\n            })\n            .then(function (partners) {\n                if (self.db.add_partners(partners)) {   // check if the partners we got were real updates\n                    resolve();\n                } else {\n                    reject('Failed in updating partners.');\n                }\n            }, function (type, err) { reject(); });\n        });\n    },\n\n    // this is called when an order is removed from the order collection. It ensures that there is always an existing\n    // order and a valid selected order\n    on_removed_order: function(removed_order,index,reason){\n        var order_list = this.get_order_list();\n        if( (reason === 'abandon' || removed_order.temporary) && order_list.length > 0){\n            // when we intentionally remove an unfinished order, and there is another existing one\n            this.set_order(order_list[index] || order_list[order_list.length - 1], { silent: true });\n        }else{\n            // when the order was automatically removed after completion,\n            // or when we intentionally delete the only concurrent order\n            this.add_new_order({ silent: true });\n        }\n        // Remove the link between the refund orderlines when deleting an order\n        // that contains a refund.\n        for (const line of removed_order.get_orderlines()) {\n            if (line.refunded_orderline_id) {\n                delete this.toRefundLines[line.refunded_orderline_id];\n            }\n        }\n    },\n\n    // returns the user who is currently the cashier for this point of sale\n    get_cashier: function(){\n        // reset the cashier to the current user if session is new\n        if (this.db.load('pos_session_id') !== this.pos_session.id) {\n            this.set_cashier(this.employee);\n        }\n        return this.db.get_cashier() || this.get('cashier') || this.employee;\n    },\n    // changes the current cashier\n    set_cashier: function(employee){\n        this.set('cashier', employee);\n        this.db.set_cashier(this.get('cashier'));\n    },\n    // creates a new empty order and sets it as the current order\n    add_new_order: function(options){\n        var order = new exports.Order({},{pos:this});\n        this.get('orders').add(order);\n        this.set('selectedOrder', order, options);\n        return order;\n    },\n    /**\n     * Load the locally saved unpaid orders for this PoS Config.\n     *\n     * First load all orders belonging to the current session.\n     * Second load all orders belonging to the same config but from other sessions,\n     * Only if tho order has orderlines.\n     */\n    load_orders: async function(){\n        var jsons = this.db.get_unpaid_orders();\n        await this._loadMissingProducts(jsons);\n        var orders = [];\n\n        for (var i = 0; i < jsons.length; i++) {\n            var json = jsons[i];\n            if (json.pos_session_id === this.pos_session.id) {\n                orders.push(new exports.Order({},{\n                    pos:  this,\n                    json: json,\n                }));\n            }\n        }\n        for (var i = 0; i < jsons.length; i++) {\n            var json = jsons[i];\n            if (json.pos_session_id !== this.pos_session.id && json.lines.length > 0) {\n                orders.push(new exports.Order({},{\n                    pos:  this,\n                    json: json,\n                }));\n            } else if (json.pos_session_id !== this.pos_session.id) {\n                this.db.remove_unpaid_order(jsons[i]);\n            }\n        }\n\n        orders = orders.sort(function(a,b){\n            return a.sequence_number - b.sequence_number;\n        });\n\n        if (orders.length) {\n            this.get('orders').add(orders);\n        }\n    },\n    async _loadMissingProducts(orders) {\n        const missingProductIds = new Set([]);\n        for (const order of orders) {\n            for (const line of order.lines) {\n                const productId = line[2].product_id;\n                if (missingProductIds.has(productId)) continue;\n                if (!this.db.get_product_by_id(productId)) {\n                    missingProductIds.add(productId);\n                }\n            }\n        }\n        const productModel = _.find(this.models, function(model){return model.model === 'product.product';});\n        const fields = productModel.fields;\n        const products = await this.rpc({\n            model: 'product.product',\n            method: 'read',\n            args: [[...missingProductIds], fields],\n            context: Object.assign(this.session.user_context, { display_default_code: false }),\n        });\n        productModel.loaded(this, products);\n    },\n    async _loadMissingPartners(orders) {\n        const missingPartnerIds = new Set([]);\n        for (const order of orders) {\n            const partnerId = order.partner_id;\n            if(missingPartnerIds.has(partnerId)) continue;\n            if (partnerId && !this.db.get_partner_by_id(partnerId)) {\n                missingPartnerIds.add(partnerId);\n            }\n        }\n        const partnerModel = _.find(this.models, function(model){return model.model === 'res.partner';});\n        const fields = partnerModel.fields;\n        if(missingPartnerIds) {\n            const partners = await this.rpc({\n                model: 'res.partner',\n                method: 'read',\n                args: [[...missingPartnerIds], fields],\n                context: Object.assign(this.session.user_context, { display_default_code: false }),\n            });\n            partnerModel.loaded(this, partners);\n        }\n    },\n    // Load the products following specific rules into the `db`\n    loadLimitedProducts: async function() {\n        let product_model = _.find(this.models, (model) => model.model === 'product.product');\n        const products = await this.rpc({\n            model: 'pos.config',\n            method: 'get_limited_products_loading',\n            args: [this.config_id, product_model.fields],\n            context: { ...this.session.user_context, ...product_model.context() },\n        });\n        product_model.loaded(this, products);\n        return products.length\n    },\n    loadProductsBackground: async function() {\n        let page = 0;\n        let product_model = _.find(this.models, (model) => model.model === 'product.product');\n        let products = [];\n        do {\n            products = await this.rpc({\n                model: 'product.product',\n                method: 'search_read',\n                kwargs: {\n                    'domain': product_model.domain(this),\n                    'fields': product_model.fields,\n                    'offset': page * this.env.pos.config.limited_products_amount,\n                    'limit': this.env.pos.config.limited_products_amount\n                },\n                context: { ...this.session.user_context, ...product_model.context() },\n            });\n            product_model.loaded(this, products);\n            page += 1;\n        } while(products.length == this.config.limited_products_amount);\n    },\n    loadPartnersBackground: async function() {\n        let i = 1;\n        let PartnerIds = [];\n        var fields = _.find(this.env.pos.models, function(model){ return model.label === 'load_partners'; }).fields;\n        do {\n            PartnerIds = await this.rpc({\n                model: 'res.partner',\n                method: 'search_read',\n                args: [[], fields],\n                kwargs: {\n                    limit: this.env.pos.config.limited_partners_amount,\n                    offset: this.env.pos.config.limited_partners_amount * i\n                },\n                context: this.env.session.user_context,\n            });\n            this.env.pos.db.add_partners(PartnerIds);\n            i += 1;\n        } while(PartnerIds.length);\n    },\n    set_start_order: function(){\n        var orders = this.get('orders').models;\n\n        if (orders.length && !this.get('selectedOrder')) {\n            this.set('selectedOrder',orders[0]);\n        } else {\n            this.add_new_order();\n        }\n    },\n\n    // return the current order\n    get_order: function(){\n        return this.get('selectedOrder');\n    },\n\n    get_client: function() {\n        var order = this.get_order();\n        if (order) {\n            return order.get_client();\n        }\n        return null;\n    },\n\n    // change the current order\n    set_order: function(order, options){\n        this.set({ selectedOrder: order }, options);\n    },\n\n    // return the list of unpaid orders\n    get_order_list: function(){\n        return this.get('orders').models;\n    },\n\n    //removes the current order\n    delete_current_order: function(){\n        var order = this.get_order();\n        if (order) {\n            order.destroy({'reason':'abandon'});\n        }\n    },\n\n    _convert_product_img_to_base64: function (product, url) {\n        return new Promise(function (resolve, reject) {\n            var img = new Image();\n\n            img.onload = function () {\n                var canvas = document.createElement('CANVAS');\n                var ctx = canvas.getContext('2d');\n\n                canvas.height = this.height;\n                canvas.width = this.width;\n                ctx.drawImage(this,0,0);\n\n                var dataURL = canvas.toDataURL('image/jpeg');\n                product.image_base64 = dataURL;\n                canvas = null;\n\n                resolve();\n            };\n            img.crossOrigin = 'use-credentials';\n            img.src = url;\n        });\n    },\n\n    send_current_order_to_customer_facing_display: function() {\n        var self = this;\n        this.render_html_for_customer_facing_display().then(function (rendered_html) {\n            if (self.env.pos.customer_display) {\n                var $renderedHtml = $('<div>').html(rendered_html);\n                $(self.env.pos.customer_display.document.body).html($renderedHtml.find('.pos-customer_facing_display'));\n                var orderlines = $(self.env.pos.customer_display.document.body).find('.pos_orderlines_list');\n                orderlines.scrollTop(orderlines.prop(\"scrollHeight\"));\n            } else if (self.env.pos.proxy.posbox_supports_display) {\n                self.proxy.update_customer_facing_display(rendered_html);\n            }\n        });\n    },\n\n    /**\n     * @returns {Promise<string>}\n     */\n    render_html_for_customer_facing_display: function () {\n        var self = this;\n        var order = this.get_order();\n\n        // If we're using an external device like the IoT Box, we\n        // cannot get /web/image?model=product.product because the\n        // IoT Box is not logged in and thus doesn't have the access\n        // rights to access product.product. So instead we'll base64\n        // encode it and embed it in the HTML.\n        var get_image_promises = [];\n\n        if (order) {\n            order.get_orderlines().forEach(function (orderline) {\n                var product = orderline.product;\n                var image_url = `/web/image?model=product.product&field=image_128&id=${product.id}&write_date=${product.write_date}&unique=1`;\n\n                // only download and convert image if we haven't done it before\n                if (! product.image_base64) {\n                    get_image_promises.push(self._convert_product_img_to_base64(product, image_url));\n                }\n            });\n        }\n\n        return Promise.all(get_image_promises).then(function () {\n            return QWeb.render('CustomerFacingDisplayOrder', {\n                pos: self.env.pos,\n                origin: window.location.origin,\n                order: order,\n            });\n        });\n    },\n\n    // saves the order locally and try to send it to the backend.\n    // it returns a promise that succeeds after having tried to send the order and all the other pending orders.\n    push_orders: function (order, opts) {\n        opts = opts || {};\n        var self = this;\n\n        if (order) {\n            this.db.add_order(order.export_as_JSON());\n        }\n\n        return new Promise((resolve, reject) => {\n            self.flush_mutex.exec(async () => {\n                try {\n                    resolve(await self._flush_orders(self.db.get_orders(), opts));\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        });\n    },\n\n    push_single_order: function (order, opts) {\n        opts = opts || {};\n        const self = this;\n        const order_id = self.db.add_order(order.export_as_JSON());\n\n        return new Promise((resolve, reject) => {\n            self.flush_mutex.exec(async () => {\n                const order = self.db.get_order(order_id);\n                try {\n                    resolve(await self._flush_orders([order], opts));\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        });\n    },\n\n    // saves the order locally and try to send it to the backend and make an invoice\n    // returns a promise that succeeds when the order has been posted and successfully generated\n    // an invoice. This method can fail in various ways:\n    // error-no-client: the order must have an associated partner_id. You can retry to make an invoice once\n    //     this error is solved\n    // error-transfer: there was a connection error during the transfer. You can retry to make the invoice once\n    //     the network connection is up\n\n    push_and_invoice_order: function (order) {\n        var self = this;\n        return new Promise((resolve, reject) => {\n            if (!order.get_client()) {\n                reject({ code: 400, message: 'Missing Customer', data: {} });\n            } else {\n                var order_id = self.db.add_order(order.export_as_JSON());\n                self.flush_mutex.exec(async () => {\n                    try {\n                        const server_ids = await self._flush_orders([self.db.get_order(order_id)], {\n                            timeout: 30000,\n                            to_invoice: true,\n                        });\n                        if (server_ids.length) {\n                            const [orderWithInvoice] = await self.rpc({\n                                method: 'read',\n                                model: 'pos.order',\n                                args: [server_ids, ['account_move']],\n                                kwargs: { load: false },\n                            });\n                            await self\n                                .do_action('account.account_invoices', {\n                                    additional_context: {\n                                        active_ids: [orderWithInvoice.account_move],\n                                    },\n                                })\n                                .catch(() => {\n                                    reject({ code: 401, message: 'Backend Invoice', data: { order: order } });\n                                });\n                        } else {\n                            reject({ code: 401, message: 'Backend Invoice', data: { order: order } });\n                        }\n                        resolve(server_ids);\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            }\n        });\n    },\n\n    // wrapper around the _save_to_server that updates the synch status widget\n    // Resolves to the backend ids of the synced orders.\n    _flush_orders: function(orders, options) {\n        var self = this;\n        this.set_synch('connecting', orders.length);\n\n        return this._save_to_server(orders, options).then(function (server_ids) {\n            self.set_synch('connected');\n            for (let i = 0; i < server_ids.length; i++) {\n                self.validated_orders_name_server_id_map[server_ids[i].pos_reference] = server_ids[i].id;\n            }\n            return _.pluck(server_ids, 'id');\n        }).catch(function(error){\n            self.set_synch(self.get('failed') ? 'error' : 'disconnected');\n            throw error;\n        }).finally(function() {\n            self._after_flush_orders(orders);\n        });\n    },\n    /**\n     * Hook method after _flush_orders resolved or rejected.\n     * It aims to:\n     *   - remove the refund orderlines from toRefundLines\n     *   - invalidate cache of refunded synced orders\n     */\n    _after_flush_orders: function(orders) {\n        const refundedOrderIds = new Set();\n        for (const order of orders) {\n            for (const line of order.data.lines) {\n                const refundDetail = this.toRefundLines[line[2].refunded_orderline_id];\n                if (!refundDetail) continue;\n                // Collect the backend id of the refunded orders.\n                refundedOrderIds.add(refundDetail.orderline.orderBackendId);\n                // Reset the refund detail for the orderline.\n                delete this.toRefundLines[refundDetail.orderline.id];\n            }\n        }\n        this._invalidateSyncedOrdersCache([...refundedOrderIds]);\n    },\n    _invalidateSyncedOrdersCache: function(ids) {\n        for (const id of ids) {\n            delete this.TICKET_SCREEN_STATE.syncedOrders.cache[id];\n        }\n    },\n    set_synch: function(status, pending) {\n        if (['connected', 'connecting', 'error', 'disconnected'].indexOf(status) === -1) {\n            console.error(status, ' is not a known connection state.');\n        }\n        pending = pending || this.db.get_orders().length + this.db.get_ids_to_remove_from_server().length;\n        this.set('synch', { status, pending });\n    },\n\n    // send an array of orders to the server\n    // available options:\n    // - timeout: timeout for the rpc call in ms\n    // returns a promise that resolves with the list of\n    // server generated ids for the sent orders\n    _save_to_server: function (orders, options) {\n        if (!orders || !orders.length) {\n            return Promise.resolve([]);\n        }\n\n        options = options || {};\n\n        var self = this;\n        var timeout = typeof options.timeout === 'number' ? options.timeout : 30000 * orders.length;\n\n        // Keep the order ids that are about to be sent to the\n        // backend. In between create_from_ui and the success callback\n        // new orders may have been added to it.\n        var order_ids_to_sync = _.pluck(orders, 'id');\n\n        // we try to send the order. shadow prevents a spinner if it takes too long. (unless we are sending an invoice,\n        // then we want to notify the user that we are waiting on something )\n        var args = [_.map(orders, function (order) {\n                order.to_invoice = options.to_invoice || false;\n                return order;\n            })];\n        args.push(options.draft || false);\n        return this.rpc({\n                model: 'pos.order',\n                method: 'create_from_ui',\n                args: args,\n                kwargs: {context: this.session.user_context},\n            }, {\n                timeout: timeout,\n                shadow: !options.to_invoice\n            })\n            .then(function (server_ids) {\n                _.each(order_ids_to_sync, function (order_id) {\n                    self.db.remove_order(order_id);\n                });\n                self.set('failed',false);\n                return server_ids;\n            }).catch(function (error){\n                console.warn('Failed to send orders:', orders);\n                if(error.code === 200 ){    // Business Logic Error, not a connection problem\n                    // Hide error if already shown before ...\n                    if ((!self.get('failed') || options.show_error) && !options.to_invoice) {\n                        self.set('failed',error);\n                        throw error;\n                    }\n                }\n                throw error;\n            });\n    },\n\n    /**\n     * Remove orders with given ids from the database.\n     * @param {array<number>} server_ids ids of the orders to be removed.\n     * @param {dict} options.\n     * @param {number} options.timeout optional timeout parameter for the rpc call.\n     * @return {Promise<array<number>>} returns a promise of the ids successfully removed.\n     */\n    _remove_from_server: function (server_ids, options) {\n        options = options || {};\n        if (!server_ids || !server_ids.length) {\n            return Promise.resolve([]);\n        }\n\n        var self = this;\n        var timeout = typeof options.timeout === 'number' ? options.timeout : 7500 * server_ids.length;\n\n        return this.rpc({\n                model: 'pos.order',\n                method: 'remove_from_ui',\n                args: [server_ids],\n                kwargs: {context: this.session.user_context},\n            }, {\n                timeout: timeout,\n                shadow: true,\n            })\n            .then(function (data) {\n                return self._post_remove_from_server(server_ids, data)\n            }).catch(function (reason){\n                var error = reason.message;\n                if(error.code === 200 ){    // Business Logic Error, not a connection problem\n                    //if warning do not need to display traceback!!\n                    if (error.data.exception_type == 'warning') {\n                        delete error.data.debug;\n                    }\n                }\n                // important to throw error here and let the rendering component handle the\n                // error\n                console.warn('Failed to remove orders:', server_ids);\n                throw error;\n            });\n    },\n\n    // to override\n    _post_remove_from_server(server_ids, data) {\n        this.db.set_ids_removed_from_server(server_ids);\n        return server_ids;\n    },\n\n    // Exports the paid orders (the ones waiting for internet connection)\n    export_paid_orders: function() {\n        return JSON.stringify({\n            'paid_orders':  this.db.get_orders(),\n            'session':      this.pos_session.name,\n            'session_id':    this.pos_session.id,\n            'date':         (new Date()).toUTCString(),\n            'version':      this.version.server_version_info,\n        },null,2);\n    },\n\n    // Exports the unpaid orders (the tabs)\n    export_unpaid_orders: function() {\n        return JSON.stringify({\n            'unpaid_orders': this.db.get_unpaid_orders(),\n            'session':       this.pos_session.name,\n            'session_id':    this.pos_session.id,\n            'date':          (new Date()).toUTCString(),\n            'version':       this.version.server_version_info,\n        },null,2);\n    },\n\n    // This imports paid or unpaid orders from a json file whose\n    // contents are provided as the string str.\n    // It returns a report of what could and what could not be\n    // imported.\n    import_orders: function(str) {\n        var json = JSON.parse(str);\n        var report = {\n            // Number of paid orders that were imported\n            paid: 0,\n            // Number of unpaid orders that were imported\n            unpaid: 0,\n            // Orders that were not imported because they already exist (uid conflict)\n            unpaid_skipped_existing: 0,\n            // Orders that were not imported because they belong to another session\n            unpaid_skipped_session:  0,\n            // The list of session ids to which skipped orders belong.\n            unpaid_skipped_sessions: [],\n        };\n\n        if (json.paid_orders) {\n            for (var i = 0; i < json.paid_orders.length; i++) {\n                this.db.add_order(json.paid_orders[i].data);\n            }\n            report.paid = json.paid_orders.length;\n            this.push_orders();\n        }\n\n        if (json.unpaid_orders) {\n\n            var orders  = [];\n            var existing = this.get_order_list();\n            var existing_uids = {};\n            var skipped_sessions = {};\n\n            for (var i = 0; i < existing.length; i++) {\n                existing_uids[existing[i].uid] = true;\n            }\n\n            for (var i = 0; i < json.unpaid_orders.length; i++) {\n                var order = json.unpaid_orders[i];\n                if (order.pos_session_id !== this.pos_session.id) {\n                    report.unpaid_skipped_session += 1;\n                    skipped_sessions[order.pos_session_id] = true;\n                } else if (existing_uids[order.uid]) {\n                    report.unpaid_skipped_existing += 1;\n                } else {\n                    orders.push(new exports.Order({},{\n                        pos: this,\n                        json: order,\n                    }));\n                }\n            }\n\n            orders = orders.sort(function(a,b){\n                return a.sequence_number - b.sequence_number;\n            });\n\n            if (orders.length) {\n                report.unpaid = orders.length;\n                this.get('orders').add(orders);\n            }\n\n            report.unpaid_skipped_sessions = _.keys(skipped_sessions);\n        }\n\n        return report;\n    },\n\n    _load_orders: function(){\n        var jsons = this.db.get_unpaid_orders();\n        var orders = [];\n        var not_loaded_count = 0;\n\n        for (var i = 0; i < jsons.length; i++) {\n            var json = jsons[i];\n            if (json.pos_session_id === this.pos_session.id) {\n                orders.push(new exports.Order({},{\n                    pos:  this,\n                    json: json,\n                }));\n            } else {\n                not_loaded_count += 1;\n            }\n        }\n\n        if (not_loaded_count) {\n            console.info('There are '+not_loaded_count+' locally saved unpaid orders belonging to another session');\n        }\n\n        orders = orders.sort(function(a,b){\n            return a.sequence_number - b.sequence_number;\n        });\n\n        if (orders.length) {\n            this.get('orders').add(orders);\n        }\n    },\n\n    /**\n     * Directly calls the requested service, instead of triggering a\n     * 'call_service' event up, which wouldn't work as services have no parent\n     *\n     * @param {OdooEvent} ev\n     */\n    _trigger_up: function (ev) {\n        if (ev.is_stopped()) {\n            return;\n        }\n        const payload = ev.data;\n        if (ev.name === 'call_service') {\n            let args = payload.args || [];\n            if (payload.service === 'ajax' && payload.method === 'rpc') {\n                // ajax service uses an extra 'target' argument for rpc\n                args = args.concat(ev.target);\n            }\n            const service = this.env.services[payload.service];\n            const result = service[payload.method].apply(service, args);\n            payload.callback(result);\n        }\n    },\n\n    electronic_payment_interfaces: {},\n\n    isProductQtyZero: function(qty) {\n        return utils.float_is_zero(qty, this.env.pos.dp['Product Unit of Measure']);\n    },\n\n    formatProductQty: function(qty) {\n        return field_utils.format.float(qty, { digits: [true, this.dp['Product Unit of Measure']] });\n    },\n\n    format_currency: function(amount, precision) {\n        var currency =\n            this && this.currency\n                ? this.currency\n                : { symbol: '$', position: 'after', rounding: 0.01, decimals: 2 };\n\n        amount = this.format_currency_no_symbol(amount, precision, currency);\n\n        if (currency.position === 'after') {\n            return amount + ' ' + (currency.symbol || '');\n        } else {\n            return (currency.symbol || '') + ' ' + amount;\n        }\n    },\n\n    format_currency_no_symbol: function(amount, precision, currency) {\n        if (!currency) {\n            currency =\n                this && this.currency\n                    ? this.currency\n                    : { symbol: '$', position: 'after', rounding: 0.01, decimals: 2 };\n        }\n        var decimals = currency.decimals;\n\n        if (precision && this.dp[precision] !== undefined) {\n            decimals = this.dp[precision];\n        }\n\n        if (typeof amount === 'number') {\n            amount = round_di(amount, decimals).toFixed(decimals);\n            amount = field_utils.format.float(round_di(amount, decimals), {\n                digits: [69, decimals],\n            });\n        }\n\n        return amount;\n    },\n\n    format_pr: function(value, precision) {\n        var decimals =\n            precision > 0\n                ? Math.max(0, Math.ceil(Math.log(1.0 / precision) / Math.log(10)))\n                : 0;\n        return value.toFixed(decimals);\n    },\n\n    round_decimals_currency(value) {\n        const decimals = this.currency.decimals;\n        return parseFloat(round_di(value, decimals).toFixed(decimals));\n    },\n\n    /**\n     * (value = 1.0000, decimals = 2) => '1'\n     * (value = 1.1234, decimals = 2) => '1.12'\n     * @param {number} value amount to format\n     */\n    formatFixed: function(value) {\n        const currency = this.currency || { decimals: 2 };\n        return `${Number(value.toFixed(currency.decimals || 0))}`;\n    },\n\n    disallowLineQuantityChange() {\n        return false;\n    },\n\n    getCurrencySymbol() {\n        return this.currency ? this.currency.symbol : '$';\n    },\n    /**\n     * Make the products corresponding to the given ids to be available_in_pos and\n     * fetch them to be added on the loaded products.\n     */\n    async _addProducts(ids){\n        await this.rpc({\n            model: 'product.product',\n            method: 'write',\n            args: [ids, {'available_in_pos': true}],\n            context: this.session.user_context,\n        });\n        let product_model = _.find(this.models, (model) => model.model === 'product.product');\n        let product = await this.rpc({\n            model: 'product.product',\n            method: 'read',\n            args: [ids, product_model.fields],\n            context: { ...this.session.user_context, ...product_model.context() },\n        });\n        product_model.loaded(this, product);\n    },\n    htmlToImgLetterRendering() {\n        return false;\n    },\n});\n\n/**\n * Call this function to map your PaymentInterface implementation to\n * the use_payment_terminal field. When the POS loads it will take\n * care of instantiating your interface and setting it on the right\n * payment methods.\n *\n * @param {string} use_payment_terminal - value used in the\n * use_payment_terminal selection field\n *\n * @param {Object} ImplementedPaymentInterface - implemented\n * PaymentInterface\n */\nexports.register_payment_method = function(use_payment_terminal, ImplementedPaymentInterface) {\n    exports.PosModel.prototype.electronic_payment_interfaces[use_payment_terminal] = ImplementedPaymentInterface;\n};\n\n// Add fields to the list of read fields when a model is loaded\n// by the point of sale.\n// e.g: module.load_fields(\"product.product\",['price','category'])\n\nexports.load_fields = function(model_name, fields) {\n    if (!(fields instanceof Array)) {\n        fields = [fields];\n    }\n\n    var models = exports.PosModel.prototype.models;\n    for (var i = 0; i < models.length; i++) {\n        var model = models[i];\n        if (model.model === model_name) {\n            // if 'fields' is empty all fields are loaded, so we do not need\n            // to modify the array\n            if ((model.fields instanceof Array) && model.fields.length > 0) {\n                model.fields = model.fields.concat(fields || []);\n            }\n        }\n    }\n};\n\n// Loads openerp models at the point of sale startup.\n// load_models take an array of model loader declarations.\n// - The models will be loaded in the array order.\n// - If no openerp model name is provided, no server data\n//   will be loaded, but the system can be used to preprocess\n//   data before load.\n// - loader arguments can be functions that return a dynamic\n//   value. The function takes the PosModel as the first argument\n//   and a temporary object that is shared by all models, and can\n//   be used to store transient information between model loads.\n// - There is no dependency management. The models must be loaded\n//   in the right order. Newly added models are loaded at the end\n//   but the after / before options can be used to load directly\n//   before / after another model.\n//\n// models: [{\n//  model: [string] the name of the openerp model to load.\n//  label: [string] The label displayed during load.\n//  fields: [[string]|function] the list of fields to be loaded.\n//          Empty Array / Null loads all fields.\n//  order:  [[string]|function] the models will be ordered by\n//          the provided fields\n//  domain: [domain|function] the domain that determines what\n//          models need to be loaded. Null loads everything\n//  ids:    [[id]|function] the id list of the models that must\n//          be loaded. Overrides domain.\n//  context: [Dict|function] the openerp context for the model read\n//  condition: [function] do not load the models if it evaluates to\n//             false.\n//  loaded: [function(self,model)] this function is called once the\n//          models have been loaded, with the data as second argument\n//          if the function returns a promise, the next model will\n//          wait until it resolves before loading.\n// }]\n//\n// options:\n//   before: [string] The model will be loaded before the named models\n//           (applies to both model name and label)\n//   after:  [string] The model will be loaded after the (last loaded)\n//           named model. (applies to both model name and label)\n//\nexports.load_models = function(models,options) {\n    options = options || {};\n    if (!(models instanceof Array)) {\n        models = [models];\n    }\n\n    var pmodels = exports.PosModel.prototype.models;\n    var index = pmodels.length;\n    if (options.before) {\n        for (var i = 0; i < pmodels.length; i++) {\n            if (    pmodels[i].model === options.before ||\n                    pmodels[i].label === options.before ){\n                index = i;\n                break;\n            }\n        }\n    } else if (options.after) {\n        for (var i = 0; i < pmodels.length; i++) {\n            if (    pmodels[i].model === options.after ||\n                    pmodels[i].label === options.after ){\n                index = i + 1;\n            }\n        }\n    }\n    pmodels.splice.apply(pmodels,[index,0].concat(models));\n};\n\nexports.Product = Backbone.Model.extend({\n    initialize: function(attr, options){\n        _.extend(this, options);\n    },\n    isAllowOnlyOneLot: function() {\n        const productUnit = this.get_unit();\n        return this.tracking === 'lot' || !productUnit || !productUnit.is_pos_groupable;\n    },\n    get_unit: function() {\n        var unit_id = this.uom_id;\n        if(!unit_id){\n            return undefined;\n        }\n        unit_id = unit_id[0];\n        if(!this.pos){\n            return undefined;\n        }\n        return this.pos.units_by_id[unit_id];\n    },\n    // Port of get_product_price on product.pricelist.\n    //\n    // Anything related to UOM can be ignored, the POS will always use\n    // the default UOM set on the product and the user cannot change\n    // it.\n    //\n    // Pricelist items do not have to be sorted. All\n    // product.pricelist.item records are loaded with a search_read\n    // and were automatically sorted based on their _order by the\n    // ORM. After that they are added in this order to the pricelists.\n    get_price: function(pricelist, quantity, price_extra){\n        var self = this;\n        var date = moment();\n\n        // In case of nested pricelists, it is necessary that all pricelists are made available in\n        // the POS. Display a basic alert to the user in this case.\n        if (pricelist === undefined) {\n            alert(_t(\n                'An error occurred when loading product prices. ' +\n                'Make sure all pricelists are available in the POS.'\n            ));\n        }\n\n        var category_ids = [];\n        var category = this.categ;\n        while (category) {\n            category_ids.push(category.id);\n            category = category.parent;\n        }\n\n        var pricelist_items = _.filter(pricelist.items, function (item) {\n            return (! item.product_tmpl_id || item.product_tmpl_id[0] === self.product_tmpl_id) &&\n                   (! item.product_id || item.product_id[0] === self.id) &&\n                   (! item.categ_id || _.contains(category_ids, item.categ_id[0])) &&\n                   (! item.date_start || moment(item.date_start).isSameOrBefore(date)) &&\n                   (! item.date_end || moment(item.date_end).isSameOrAfter(date));\n        });\n\n        var price = self.lst_price;\n        if (price_extra){\n            price += price_extra;\n        }\n        _.find(pricelist_items, function (rule) {\n            if (rule.min_quantity && quantity < rule.min_quantity) {\n                return false;\n            }\n\n            if (rule.base === 'pricelist') {\n                price = self.get_price(rule.base_pricelist, quantity);\n            } else if (rule.base === 'standard_price') {\n                price = self.standard_price;\n            }\n\n            if (rule.compute_price === 'fixed') {\n                price = rule.fixed_price;\n                return true;\n            } else if (rule.compute_price === 'percentage') {\n                price = price - (price * (rule.percent_price / 100));\n                return true;\n            } else {\n                var price_limit = price;\n                price = price - (price * (rule.price_discount / 100));\n                if (rule.price_round) {\n                    price = round_pr(price, rule.price_round);\n                }\n                if (rule.price_surcharge) {\n                    price += rule.price_surcharge;\n                }\n                if (rule.price_min_margin) {\n                    price = Math.max(price, price_limit + rule.price_min_margin);\n                }\n                if (rule.price_max_margin) {\n                    price = Math.min(price, price_limit + rule.price_max_margin);\n                }\n                return true;\n            }\n\n            return false;\n        });\n\n        // This return value has to be rounded with round_di before\n        // being used further. Note that this cannot happen here,\n        // because it would cause inconsistencies with the backend for\n        // pricelist that have base == 'pricelist'.\n        return price;\n    },\n});\n\nvar orderline_id = 1;\n\n// An orderline represent one element of the content of a client's shopping cart.\n// An orderline contains a product, its quantity, its price, discount. etc.\n// An Order contains zero or more Orderlines.\nexports.Orderline = Backbone.Model.extend({\n    initialize: function(attr,options){\n        this.pos   = options.pos;\n        this.order = options.order;\n        this.price_manually_set = options.price_manually_set || false;\n        if (options.json) {\n            try {\n                this.init_from_JSON(options.json);\n            } catch(error) {\n                console.error('ERROR: attempting to recover product ID', options.json.product_id,\n                    'not available in the point of sale. Correct the product or clean the browser cache.');\n            }\n            return;\n        }\n        this.product = options.product;\n        this.tax_ids = options.tax_ids;\n        this.set_product_lot(this.product);\n        this.set_quantity(1);\n        this.discount = 0;\n        this.discountStr = '0';\n        this.selected = false;\n        this.description = '';\n        this.price_extra = 0;\n        this.full_product_name = '';\n        this.id = orderline_id++;\n        this.customerNote = this.customerNote || '';\n\n        if (options.price) {\n            this.set_unit_price(options.price);\n        } else {\n            this.set_unit_price(this.product.get_price(this.order.pricelist, this.get_quantity()));\n        }\n    },\n    init_from_JSON: function(json) {\n        this.product = this.pos.db.get_product_by_id(json.product_id);\n        this.set_product_lot(this.product);\n        this.price = json.price_unit;\n        this.price_manually_set = json.price_manually_set;\n        this.set_discount(json.discount);\n        this.set_quantity(json.qty, 'do not recompute unit price');\n        this.set_description(json.description);\n        this.set_price_extra(json.price_extra);\n        this.set_full_product_name(json.full_product_name);\n        this.id = json.id ? json.id : orderline_id++;\n        orderline_id = Math.max(this.id+1,orderline_id);\n        var pack_lot_lines = json.pack_lot_ids;\n        for (var i = 0; i < pack_lot_lines.length; i++) {\n            var packlotline = pack_lot_lines[i][2];\n            var pack_lot_line = new exports.Packlotline({}, {'json': _.extend(packlotline, {'order_line':this})});\n            this.pack_lot_lines.add(pack_lot_line);\n        }\n        this.tax_ids = json.tax_ids && json.tax_ids.length !== 0 ? json.tax_ids[0][2] : undefined;\n        this.set_customer_note(json.customer_note);\n        this.refunded_qty = json.refunded_qty;\n        this.refunded_orderline_id = json.refunded_orderline_id;\n    },\n    clone: function(){\n        var orderline = new exports.Orderline({},{\n            pos: this.pos,\n            order: this.order,\n            product: this.product,\n            price: this.price,\n        });\n        orderline.order = null;\n        orderline.quantity = this.quantity;\n        orderline.quantityStr = this.quantityStr;\n        orderline.discount = this.discount;\n        orderline.price = this.price;\n        orderline.selected = false;\n        orderline.price_manually_set = this.price_manually_set;\n        orderline.customerNote = this.customerNote;\n        return orderline;\n    },\n    getPackLotLinesToEdit: function(isAllowOnlyOneLot) {\n        const currentPackLotLines = this.pack_lot_lines.models;\n        let nExtraLines = Math.abs(this.quantity) - currentPackLotLines.length;\n        nExtraLines = nExtraLines > 0 ? nExtraLines : 1;\n        const tempLines = currentPackLotLines\n            .map(lotLine => ({\n                id: lotLine.cid,\n                text: lotLine.get('lot_name'),\n            }))\n            .concat(\n                Array.from(Array(nExtraLines)).map(_ => ({\n                    text: '',\n                }))\n            );\n        return isAllowOnlyOneLot ? [tempLines[0]] : tempLines;\n    },\n    /**\n     * @param { modifiedPackLotLines, newPackLotLines }\n     *    @param {Object} modifiedPackLotLines key-value pair of String (the cid) & String (the new lot_name)\n     *    @param {Array} newPackLotLines array of { lot_name: String }\n     */\n    setPackLotLines: function({ modifiedPackLotLines, newPackLotLines }) {\n        // Set the new values for modified lot lines.\n        let lotLinesToRemove = [];\n        for (let lotLine of this.pack_lot_lines.models) {\n            const modifiedLotName = modifiedPackLotLines[lotLine.cid];\n            if (modifiedLotName) {\n                lotLine.set({ lot_name: modifiedLotName });\n            } else {\n                // We should not call lotLine.remove() here because\n                // we don't want to mutate the array while looping thru it.\n                lotLinesToRemove.push(lotLine);\n            }\n        }\n\n        // Remove those that needed to be removed.\n        for (let lotLine of lotLinesToRemove) {\n            lotLine.remove();\n        }\n\n        // Create new pack lot lines.\n        let newPackLotLine;\n        for (let newLotLine of newPackLotLines) {\n            newPackLotLine = new exports.Packlotline({}, { order_line: this });\n            newPackLotLine.set({ lot_name: newLotLine.lot_name });\n            this.pack_lot_lines.add(newPackLotLine);\n        }\n\n        // Set the quantity of the line based on number of pack lots.\n        this.pack_lot_lines.set_quantity_by_lot();\n    },\n    set_product_lot: function(product){\n        this.has_product_lot = product.tracking !== 'none';\n        this.pack_lot_lines  = this.has_product_lot && new PacklotlineCollection(null, {'order_line': this});\n    },\n    // sets a discount [0,100]%\n    set_discount: function(discount){\n        var parsed_discount = typeof(discount) === 'number' ? discount : isNaN(parseFloat(discount)) ? 0 : field_utils.parse.float('' + discount);\n        var disc = Math.min(Math.max(parsed_discount || 0, 0),100);\n        this.discount = disc;\n        this.discountStr = '' + disc;\n        this.trigger('change',this);\n    },\n    // returns the discount [0,100]%\n    get_discount: function(){\n        return this.discount;\n    },\n    get_discount_str: function(){\n        return this.discountStr;\n    },\n    set_description: function(description){\n        this.description = description || '';\n    },\n    set_price_extra: function(price_extra){\n        this.price_extra = parseFloat(price_extra) || 0.0;\n    },\n    set_full_product_name: function(full_product_name){\n        this.full_product_name = full_product_name || '';\n    },\n    get_price_extra: function () {\n        return this.price_extra;\n    },\n    // sets the quantity of the product. The quantity will be rounded according to the\n    // product's unity of measure properties. Quantities greater than zero will not get\n    // rounded to zero\n    // Return true if successfully set the quantity, otherwise, return false.\n    set_quantity: function(quantity, keep_price){\n        this.order.assert_editable();\n        if(quantity === 'remove'){\n            if (this.refunded_orderline_id in this.pos.toRefundLines) {\n                delete this.pos.toRefundLines[this.refunded_orderline_id];\n            }\n            this.order.remove_orderline(this);\n            return true;\n        }else{\n            var quant = typeof(quantity) === 'number' ? quantity : (field_utils.parse.float('' + quantity) || 0);\n            if (this.refunded_orderline_id in this.pos.toRefundLines) {\n                const toRefundDetail = this.pos.toRefundLines[this.refunded_orderline_id];\n                const maxQtyToRefund = toRefundDetail.orderline.qty - toRefundDetail.orderline.refundedQty\n                if (quant > 0) {\n                    Gui.showPopup('ErrorPopup', {\n                        title: _t('Positive quantity not allowed'),\n                        body: _t('Only a negative quantity is allowed for this refund line. Click on +/- to modify the quantity to be refunded.')\n                    });\n                    return false;\n                } else if (quant == 0) {\n                    toRefundDetail.qty = 0;\n                } else if (-quant <= maxQtyToRefund) {\n                    toRefundDetail.qty = -quant;\n                } else {\n                    Gui.showPopup('ErrorPopup', {\n                        title: _t('Greater than allowed'),\n                        body: _.str.sprintf(\n                            _t('The requested quantity to be refunded is higher than the refundable quantity of %s.'),\n                            this.pos.formatProductQty(maxQtyToRefund)\n                        ),\n                    });\n                    return false;\n                }\n            }\n            var unit = this.get_unit();\n            if(unit){\n                if (unit.rounding) {\n                    var decimals = this.pos.dp['Product Unit of Measure'];\n                    var rounding = Math.max(unit.rounding, Math.pow(10, -decimals));\n                    this.quantity    = round_pr(quant, rounding);\n                    this.quantityStr = field_utils.format.float(this.quantity, {digits: [69, decimals]});\n                } else {\n                    this.quantity    = round_pr(quant, 1);\n                    this.quantityStr = this.quantity.toFixed(0);\n                }\n            }else{\n                this.quantity    = quant;\n                this.quantityStr = '' + this.quantity;\n            }\n        }\n\n        // just like in sale.order changing the quantity will recompute the unit price\n        if (!keep_price && !this.price_manually_set && !(\n            this.pos.config.product_configurator && _.some(this.product.attribute_line_ids, (id) => id in this.pos.attributes_by_ptal_id))){\n            this.set_unit_price(this.product.get_price(this.order.pricelist, this.get_quantity(), this.get_price_extra()));\n            this.order.fix_tax_included_price(this);\n        }\n        this.trigger('change', this);\n        return true;\n    },\n    // return the quantity of product\n    get_quantity: function(){\n        return this.quantity;\n    },\n    get_quantity_str: function(){\n        return this.quantityStr;\n    },\n    get_quantity_str_with_unit: function(){\n        var unit = this.get_unit();\n        if(unit && !unit.is_pos_groupable){\n            return this.quantityStr + ' ' + unit.name;\n        }else{\n            return this.quantityStr;\n        }\n    },\n\n    get_lot_lines: function() {\n        return this.pack_lot_lines.models;\n    },\n\n    get_required_number_of_lots: function(){\n        var lots_required = 1;\n\n        if (this.product.tracking == 'serial') {\n            lots_required = Math.abs(this.quantity);\n        }\n\n        return lots_required;\n    },\n\n    has_valid_product_lot: function(){\n        if(!this.has_product_lot){\n            return true;\n        }\n        var valid_product_lot = this.pack_lot_lines.get_valid_lots();\n        return this.get_required_number_of_lots() === valid_product_lot.length;\n    },\n\n    // return the unit of measure of the product\n    get_unit: function(){\n        return this.product.get_unit();\n    },\n    // return the product of this orderline\n    get_product: function(){\n        return this.product;\n    },\n    get_full_product_name: function () {\n        if (this.full_product_name) {\n            return this.full_product_name\n        }\n        var full_name = this.product.display_name;\n        if (this.description) {\n            full_name += ` (${this.description})`;\n        }\n        return full_name;\n    },\n    // selects or deselects this orderline\n    set_selected: function(selected){\n        this.selected = selected;\n        // this trigger also triggers the change event of the collection.\n        this.trigger('change',this);\n        this.trigger('new-orderline-selected');\n    },\n    // returns true if this orderline is selected\n    is_selected: function(){\n        return this.selected;\n    },\n    // when we add an new orderline we want to merge it with the last line to see reduce the number of items\n    // in the orderline. This returns true if it makes sense to merge the two\n    can_be_merged_with: function(orderline){\n        var price = parseFloat(round_di(this.price || 0, this.pos.dp['Product Price']).toFixed(this.pos.dp['Product Price']));\n        var order_line_price = orderline.get_product().get_price(orderline.order.pricelist, this.get_quantity());\n        order_line_price = orderline.compute_fixed_price(order_line_price);\n        if( this.get_product().id !== orderline.get_product().id){    //only orderline of the same product can be merged\n            return false;\n        }else if(!this.get_unit() || !this.get_unit().is_pos_groupable){\n            return false;\n        }else if(this.get_discount() > 0){             // we don't merge discounted orderlines\n            return false;\n        }else if(!utils.float_is_zero(price - order_line_price - orderline.get_price_extra(),\n                    this.pos.currency.decimals)){\n            return false;\n        }else if(this.product.tracking == 'lot' && (this.pos.picking_type.use_create_lots || this.pos.picking_type.use_existing_lots)) {\n            return false;\n        }else if (this.description !== orderline.description) {\n            return false;\n        }else if (orderline.get_customer_note() !== this.get_customer_note()) {\n            return false;\n        } else if (this.refunded_orderline_id) {\n            return false;\n        }else{\n            return true;\n        }\n    },\n    merge: function(orderline){\n        this.order.assert_editable();\n        this.set_quantity(this.get_quantity() + orderline.get_quantity());\n    },\n    export_as_JSON: function() {\n        var pack_lot_ids = [];\n        if (this.has_product_lot){\n            this.pack_lot_lines.each(_.bind( function(item) {\n                return pack_lot_ids.push([0, 0, item.export_as_JSON()]);\n            }, this));\n        }\n        return {\n            qty: this.get_quantity(),\n            price_unit: this.get_unit_price(),\n            price_subtotal: this.get_price_without_tax(),\n            price_subtotal_incl: this.get_price_with_tax(),\n            discount: this.get_discount(),\n            product_id: this.get_product().id,\n            tax_ids: [[6, false, _.map(this.get_applicable_taxes(), function(tax){ return tax.id; })]],\n            id: this.id,\n            pack_lot_ids: pack_lot_ids,\n            description: this.description,\n            full_product_name: this.get_full_product_name(),\n            price_extra: this.get_price_extra(),\n            customer_note: this.get_customer_note(),\n            refunded_orderline_id: this.refunded_orderline_id,\n            price_manually_set: this.price_manually_set\n        };\n    },\n    //used to create a json of the ticket, to be sent to the printer\n    export_for_printing: function(){\n        return {\n            id: this.id,\n            quantity:           this.get_quantity(),\n            unit_name:          this.get_unit().name,\n            is_in_unit:         this.get_unit().id == this.pos.uom_unit_id,\n            price:              this.get_unit_display_price(),\n            discount:           this.get_discount(),\n            product_name:       this.get_product().display_name,\n            product_name_wrapped: this.generate_wrapped_product_name(),\n            price_lst:          this.get_lst_price(),\n            display_discount_policy:    this.display_discount_policy(),\n            price_display_one:  this.get_display_price_one(),\n            price_display :     this.get_display_price(),\n            price_with_tax :    this.get_price_with_tax(),\n            price_without_tax:  this.get_price_without_tax(),\n            price_with_tax_before_discount:  this.get_price_with_tax_before_discount(),\n            tax:                this.get_tax(),\n            product_description:      this.get_product().description,\n            product_description_sale: this.get_product().description_sale,\n            pack_lot_lines:      this.get_lot_lines(),\n            customer_note:      this.get_customer_note(),\n        };\n    },\n    generate_wrapped_product_name: function() {\n        var MAX_LENGTH = 24; // 40 * line ratio of .6\n        var wrapped = [];\n        var name = this.get_full_product_name();\n        var current_line = \"\";\n\n        while (name.length > 0) {\n            var space_index = name.indexOf(\" \");\n\n            if (space_index === -1) {\n                space_index = name.length;\n            }\n\n            if (current_line.length + space_index > MAX_LENGTH) {\n                if (current_line.length) {\n                    wrapped.push(current_line);\n                }\n                current_line = \"\";\n            }\n\n            current_line += name.slice(0, space_index + 1);\n            name = name.slice(space_index + 1);\n        }\n\n        if (current_line.length) {\n            wrapped.push(current_line);\n        }\n\n        return wrapped;\n    },\n    // changes the base price of the product for this orderline\n    set_unit_price: function(price){\n        this.order.assert_editable();\n        var parsed_price = !isNaN(price) ?\n            price :\n            isNaN(parseFloat(price)) ? 0 : field_utils.parse.float('' + price)\n        this.price = round_di(parsed_price || 0, this.pos.dp['Product Price']);\n        this.trigger('change',this);\n    },\n    get_unit_price: function(){\n        var digits = this.pos.dp['Product Price'];\n        // round and truncate to mimic _symbol_set behavior\n        return parseFloat(round_di(this.price || 0, digits).toFixed(digits));\n    },\n    get_unit_display_price: function(){\n        if (this.pos.config.iface_tax_included === 'total') {\n            var quantity = this.quantity;\n            this.quantity = 1.0;\n            var price = this.get_all_prices().priceWithTax;\n            this.quantity = quantity;\n            return price;\n        } else {\n            return this.get_unit_price();\n        }\n    },\n    get_base_price:    function(){\n        var rounding = this.pos.currency.rounding;\n        return round_pr(this.get_unit_price() * this.get_quantity() * (1 - this.get_discount()/100), rounding);\n    },\n    get_display_price_one: function(){\n        var rounding = this.pos.currency.rounding;\n        var price_unit = this.get_unit_price();\n        if (this.pos.config.iface_tax_included !== 'total') {\n            return round_pr(price_unit * (1.0 - (this.get_discount() / 100.0)), rounding);\n        } else {\n            var product =  this.get_product();\n            var taxes_ids = this.tax_ids || product.taxes_id;\n            var taxes =  this.pos.taxes;\n            var product_taxes = [];\n\n            _(taxes_ids).each(function(el){\n                product_taxes.push(_.detect(taxes, function(t){\n                    return t.id === el;\n                }));\n            });\n\n            var all_taxes = this.compute_all(product_taxes, price_unit, 1, this.pos.currency.rounding);\n\n            return round_pr(all_taxes.total_included * (1 - this.get_discount()/100), rounding);\n        }\n    },\n    get_display_price: function(){\n        if (this.pos.config.iface_tax_included === 'total') {\n            return this.get_price_with_tax();\n        } else {\n            return this.get_base_price();\n        }\n    },\n    get_price_without_tax: function(){\n        return this.get_all_prices().priceWithoutTax;\n    },\n    get_price_with_tax: function(){\n        return this.get_all_prices().priceWithTax;\n    },\n    get_price_with_tax_before_discount: function () {\n        return this.get_all_prices().priceWithTaxBeforeDiscount;\n    },\n    get_tax: function(){\n        return this.get_all_prices().tax;\n    },\n    get_applicable_taxes: function(){\n        var i;\n        // Shenaningans because we need\n        // to keep the taxes ordering.\n        var ptaxes_ids = this.tax_ids || this.get_product().taxes_id;\n        var ptaxes_set = {};\n        for (i = 0; i < ptaxes_ids.length; i++) {\n            ptaxes_set[ptaxes_ids[i]] = true;\n        }\n        var taxes = [];\n        for (i = 0; i < this.pos.taxes.length; i++) {\n            if (ptaxes_set[this.pos.taxes[i].id]) {\n                taxes.push(this.pos.taxes[i]);\n            }\n        }\n        return taxes;\n    },\n    get_tax_details: function(){\n        return this.get_all_prices().taxDetails;\n    },\n    get_taxes: function(){\n        var taxes_ids = this.tax_ids || this.get_product().taxes_id;\n        var taxes = [];\n        for (var i = 0; i < taxes_ids.length; i++) {\n            if (this.pos.taxes_by_id[taxes_ids[i]]) {\n                taxes.push(this.pos.taxes_by_id[taxes_ids[i]]);\n            }\n        }\n        return taxes;\n    },\n    _map_tax_fiscal_position: function(tax, order = false) {\n        var self = this;\n        var current_order = order || this.pos.get_order();\n        var order_fiscal_position = current_order && current_order.fiscal_position;\n        var taxes = [];\n\n        if (order_fiscal_position) {\n            var tax_mappings = _.filter(order_fiscal_position.fiscal_position_taxes_by_id, function (fiscal_position_tax) {\n                return fiscal_position_tax.tax_src_id[0] === tax.id;\n            });\n\n            if (tax_mappings && tax_mappings.length) {\n                _.each(tax_mappings, function(tm) {\n                    if (tm.tax_dest_id) {\n                        var taxe = self.pos.taxes_by_id[tm.tax_dest_id[0]];\n                        if (taxe) {\n                            taxes.push(taxe);\n                        }\n                    }\n                });\n            } else{\n                taxes.push(tax);\n            }\n        } else {\n            taxes.push(tax);\n        }\n\n        return taxes;\n    },\n    /**\n     * Mirror JS method of:\n     * _compute_amount in addons/account/models/account.py\n     */\n    _compute_all: function(tax, base_amount, quantity, price_exclude) {\n        if(price_exclude === undefined)\n            var price_include = tax.price_include;\n        else\n            var price_include = !price_exclude;\n        if (tax.amount_type === 'fixed') {\n            // Use sign on base_amount and abs on quantity to take into account the sign of the base amount,\n            // which includes the sign of the quantity and the sign of the price_unit\n            // Amount is the fixed price for the tax, it can be negative\n            // Base amount included the sign of the quantity and the sign of the unit price and when\n            // a product is returned, it can be done either by changing the sign of quantity or by changing the\n            // sign of the price unit.\n            // When the price unit is equal to 0, the sign of the quantity is absorbed in base_amount then\n            // a \"else\" case is needed.\n            if (base_amount)\n                return Math.sign(base_amount) * Math.abs(quantity) * tax.amount;\n            else\n                return quantity * tax.amount;\n        }\n        if (tax.amount_type === 'percent' && !price_include){\n            return base_amount * tax.amount / 100;\n        }\n        if (tax.amount_type === 'percent' && price_include){\n            return base_amount - (base_amount / (1 + tax.amount / 100));\n        }\n        if (tax.amount_type === 'division' && !price_include) {\n            return base_amount / (1 - tax.amount / 100) - base_amount;\n        }\n        if (tax.amount_type === 'division' && price_include) {\n            return base_amount - (base_amount * (tax.amount / 100));\n        }\n        return false;\n    },\n    /**\n     * Mirror JS method of:\n     * compute_all in addons/account/models/account.py\n     *\n     * Read comments in the python side method for more details about each sub-methods.\n     */\n    compute_all: function(taxes, price_unit, quantity, currency_rounding, handle_price_include=true) {\n        var self = this;\n\n        // 1) Flatten the taxes.\n\n        var _collect_taxes = function(taxes, all_taxes){\n            taxes.sort(function (tax1, tax2) {\n                return tax1.sequence - tax2.sequence;\n            });\n            _(taxes).each(function(tax){\n                if(tax.amount_type === 'group')\n                    all_taxes = _collect_taxes(tax.children_tax_ids, all_taxes);\n                else\n                    all_taxes.push(tax);\n            });\n            return all_taxes;\n        }\n        var collect_taxes = function(taxes){\n            return _collect_taxes(taxes, []);\n        }\n\n        taxes = collect_taxes(taxes);\n\n        // 2) Deal with the rounding methods\n\n        var round_tax = this.pos.company.tax_calculation_rounding_method != 'round_globally';\n\n        var initial_currency_rounding = currency_rounding;\n        if(!round_tax)\n            currency_rounding = currency_rounding * 0.00001;\n\n        // 3) Iterate the taxes in the reversed sequence order to retrieve the initial base of the computation.\n        var recompute_base = function(base_amount, fixed_amount, percent_amount, division_amount){\n             return (base_amount - fixed_amount) / (1.0 + percent_amount / 100.0) * (100 - division_amount) / 100;\n        }\n\n        var base = round_pr(price_unit * quantity, initial_currency_rounding);\n\n        var sign = 1;\n        if(base < 0){\n            base = -base;\n            sign = -1;\n        }\n\n        var total_included_checkpoints = {};\n        var i = taxes.length - 1;\n        var store_included_tax_total = true;\n\n        var incl_fixed_amount = 0.0;\n        var incl_percent_amount = 0.0;\n        var incl_division_amount = 0.0;\n\n        var cached_tax_amounts = {};\n        if (handle_price_include){\n            _(taxes.reverse()).each(function(tax){\n                if(tax.include_base_amount){\n                    base = recompute_base(base, incl_fixed_amount, incl_percent_amount, incl_division_amount);\n                    incl_fixed_amount = 0.0;\n                    incl_percent_amount = 0.0;\n                    incl_division_amount = 0.0;\n                    store_included_tax_total = true;\n                }\n                if(tax.price_include){\n                    if(tax.amount_type === 'percent')\n                        incl_percent_amount += tax.amount;\n                    else if(tax.amount_type === 'division')\n                        incl_division_amount += tax.amount;\n                    else if(tax.amount_type === 'fixed')\n                        incl_fixed_amount += Math.abs(quantity) * tax.amount\n                    else{\n                        var tax_amount = self._compute_all(tax, base, quantity);\n                        incl_fixed_amount += tax_amount;\n                        cached_tax_amounts[i] = tax_amount;\n                    }\n                    if(store_included_tax_total){\n                        total_included_checkpoints[i] = base;\n                        store_included_tax_total = false;\n                    }\n                }\n                i -= 1;\n            });\n        }\n\n        var total_excluded = round_pr(recompute_base(base, incl_fixed_amount, incl_percent_amount, incl_division_amount), initial_currency_rounding);\n        var total_included = total_excluded;\n\n        // 4) Iterate the taxes in the sequence order to fill missing base/amount values.\n\n        base = total_excluded;\n\n        var skip_checkpoint = false;\n\n        var taxes_vals = [];\n        i = 0;\n        var cumulated_tax_included_amount = 0;\n        _(taxes.reverse()).each(function(tax){\n            if(tax.price_include || tax.is_base_affected)\n                var tax_base_amount = base;\n            else\n                var tax_base_amount = total_excluded;\n\n            if(!skip_checkpoint && tax.price_include && total_included_checkpoints[i] !== undefined){\n                var tax_amount = total_included_checkpoints[i] - (base + cumulated_tax_included_amount);\n                cumulated_tax_included_amount = 0;\n            }else\n                var tax_amount = self._compute_all(tax, tax_base_amount, quantity, true);\n\n            tax_amount = round_pr(tax_amount, currency_rounding);\n\n            if(tax.price_include && total_included_checkpoints[i] === undefined)\n                cumulated_tax_included_amount += tax_amount;\n\n            taxes_vals.push({\n                'id': tax.id,\n                'name': tax.name,\n                'amount': sign * tax_amount,\n                'base': sign * round_pr(tax_base_amount, currency_rounding),\n            });\n\n            if(tax.include_base_amount){\n                base += tax_amount;\n                if(!tax.price_include)\n                    skip_checkpoint = true;\n            }\n\n            total_included += tax_amount;\n            i += 1;\n        });\n\n        return {\n            'taxes': taxes_vals,\n            'total_excluded': sign * round_pr(total_excluded, this.pos.currency.rounding),\n            'total_included': sign * round_pr(total_included, this.pos.currency.rounding),\n        }\n    },\n    get_all_prices: function(){\n        var self = this;\n\n        var price_unit = this.get_unit_price() * (1.0 - (this.get_discount() / 100.0));\n        var taxtotal = 0;\n\n        var product =  this.get_product();\n        var taxes_ids = this.tax_ids || product.taxes_id;\n        taxes_ids = _.filter(taxes_ids, t => t in this.pos.taxes_by_id);\n        var taxes =  this.pos.taxes;\n        var taxdetail = {};\n        var product_taxes = [];\n\n        _(taxes_ids).each(function(el){\n            var tax = _.detect(taxes, function(t){\n                return t.id === el;\n            });\n            product_taxes.push.apply(product_taxes, self._map_tax_fiscal_position(tax, self.order));\n        });\n        product_taxes = _.uniq(product_taxes, function(tax) { return tax.id; });\n\n        var all_taxes = this.compute_all(product_taxes, price_unit, this.get_quantity(), this.pos.currency.rounding);\n        var all_taxes_before_discount = this.compute_all(product_taxes, this.get_unit_price(), this.get_quantity(), this.pos.currency.rounding);\n        _(all_taxes.taxes).each(function(tax) {\n            taxtotal += tax.amount;\n            taxdetail[tax.id] = tax.amount;\n        });\n\n        return {\n            \"priceWithTax\": all_taxes.total_included,\n            \"priceWithoutTax\": all_taxes.total_excluded,\n            \"priceSumTaxVoid\": all_taxes.total_void,\n            \"priceWithTaxBeforeDiscount\": all_taxes_before_discount.total_included,\n            \"tax\": taxtotal,\n            \"taxDetails\": taxdetail,\n        };\n    },\n    display_discount_policy: function(){\n        return this.order.pricelist.discount_policy;\n    },\n    compute_fixed_price: function (price) {\n        var order = this.order;\n        if(order.fiscal_position) {\n            var taxes = this.get_taxes();\n            var mapped_included_taxes = [];\n            var new_included_taxes = [];\n            var self = this;\n            _(taxes).each(function(tax) {\n                var line_taxes = self._map_tax_fiscal_position(tax, order);\n                if (line_taxes.length && line_taxes[0].price_include){\n                    new_included_taxes = new_included_taxes.concat(line_taxes);\n                }\n                if(tax.price_include && !_.contains(line_taxes, tax)){\n                    mapped_included_taxes.push(tax);\n                }\n            });\n\n            if (mapped_included_taxes.length > 0) {\n                if (new_included_taxes.length > 0) {\n                    var price_without_taxes = this.compute_all(mapped_included_taxes, price, 1, order.pos.currency.rounding, true).total_excluded\n                    return this.compute_all(new_included_taxes, price_without_taxes, 1, order.pos.currency.rounding, false).total_included\n                }\n                else{\n                    return this.compute_all(mapped_included_taxes, price, 1, order.pos.currency.rounding, true).total_excluded;\n                }\n            }\n        }\n        return price;\n    },\n    get_fixed_lst_price: function(){\n        return this.compute_fixed_price(this.get_lst_price());\n    },\n    get_lst_price: function(){\n        return this.product.lst_price;\n    },\n    set_lst_price: function(price){\n      this.order.assert_editable();\n      this.product.lst_price = round_di(parseFloat(price) || 0, this.pos.dp['Product Price']);\n      this.trigger('change',this);\n    },\n    is_last_line: function() {\n        var order = this.pos.get_order();\n        var last_id = Object.keys(order.orderlines._byId)[Object.keys(order.orderlines._byId).length-1];\n        var selectedLine = order? order.selected_orderline: null;\n\n        return !selectedLine ? false : last_id === selectedLine.cid;\n    },\n    set_customer_note: function(note) {\n        this.customerNote = note;\n    },\n    get_customer_note: function() {\n        return this.customerNote;\n    },\n    get_total_cost: function() {\n        return this.product.standard_price * this.quantity;\n    },\n});\n\nvar OrderlineCollection = Backbone.Collection.extend({\n    model: exports.Orderline,\n});\n\nexports.Packlotline = Backbone.Model.extend({\n    defaults: {\n        lot_name: null\n    },\n    initialize: function(attributes, options){\n        this.order_line = options.order_line;\n        if (options.json) {\n            this.init_from_JSON(options.json);\n            return;\n        }\n    },\n\n    init_from_JSON: function(json) {\n        this.order_line = json.order_line;\n        this.set_lot_name(json.lot_name);\n    },\n\n    set_lot_name: function(name){\n        this.set({lot_name : _.str.trim(name) || null});\n    },\n\n    get_lot_name: function(){\n        return this.get('lot_name');\n    },\n\n    export_as_JSON: function(){\n        return {\n            lot_name: this.get_lot_name(),\n        };\n    },\n\n    add: function(){\n        var order_line = this.order_line,\n            index = this.collection.indexOf(this);\n        var new_lot_model = new exports.Packlotline({}, {'order_line': this.order_line});\n        this.collection.add(new_lot_model, {at: index + 1});\n        return new_lot_model;\n    },\n\n    remove: function(){\n        this.collection.remove(this);\n    }\n});\n\nvar PacklotlineCollection = Backbone.Collection.extend({\n    model: exports.Packlotline,\n    initialize: function(models, options) {\n        this.order_line = options.order_line;\n    },\n\n    get_valid_lots: function(){\n        return this.filter(function(model){\n            return model.get('lot_name');\n        });\n    },\n\n    set_quantity_by_lot: function() {\n        var valid_lots_quantity = this.get_valid_lots().length;\n        if (this.order_line.quantity < 0){\n            valid_lots_quantity = -valid_lots_quantity;\n        }\n        this.order_line.set_quantity(valid_lots_quantity);\n    }\n});\n\n// Every Paymentline contains a cashregister and an amount of money.\nexports.Paymentline = Backbone.Model.extend({\n    initialize: function(attributes, options) {\n        this.pos = options.pos;\n        this.order = options.order;\n        this.amount = 0;\n        this.selected = false;\n        this.cashier_receipt = '';\n        this.ticket = '';\n        this.payment_status = '';\n        this.card_type = '';\n        this.cardholder_name = '';\n        this.transaction_id = '';\n\n        if (options.json) {\n            this.init_from_JSON(options.json);\n            return;\n        }\n        this.payment_method = options.payment_method;\n        if (this.payment_method === undefined) {\n            throw new Error(_t('Please configure a payment method in your POS.'));\n        }\n        this.name = this.payment_method.name;\n    },\n    init_from_JSON: function(json){\n        this.amount = json.amount;\n        this.payment_method = this.pos.payment_methods_by_id[json.payment_method_id];\n        this.can_be_reversed = json.can_be_reversed;\n        this.name = this.payment_method.name;\n        this.payment_status = json.payment_status;\n        this.ticket = json.ticket;\n        this.card_type = json.card_type;\n        this.cardholder_name = json.cardholder_name;\n        this.transaction_id = json.transaction_id;\n        this.is_change = json.is_change;\n    },\n    //sets the amount of money on this payment line\n    set_amount: function(value){\n        this.order.assert_editable();\n        this.amount = round_di(parseFloat(value) || 0, this.pos.currency.decimals);\n        if (this.pos.config.iface_customer_facing_display) this.pos.send_current_order_to_customer_facing_display();\n        this.trigger('change',this);\n    },\n    // returns the amount of money on this paymentline\n    get_amount: function(){\n        return this.amount;\n    },\n    get_amount_str: function(){\n        return field_utils.format.float(this.amount, {digits: [69, this.pos.currency.decimals]});\n    },\n    set_selected: function(selected){\n        if(this.selected !== selected){\n            this.selected = selected;\n            this.trigger('change',this);\n        }\n    },\n    /**\n     * returns {string} payment status.\n     */\n    get_payment_status: function() {\n        return this.payment_status;\n    },\n\n    /**\n     * Set the new payment status.\n     *\n     * @param {string} value - new status.\n     */\n    set_payment_status: function(value) {\n        this.payment_status = value;\n        this.trigger('change', this);\n    },\n\n    /**\n     * Check if paymentline is done.\n     * Paymentline is done if there is no payment status or the payment status is done.\n     */\n    is_done: function() {\n        return this.get_payment_status() ? this.get_payment_status() === 'done' || this.get_payment_status() === 'reversed': true;\n    },\n\n    /**\n    * Set info to be printed on the cashier receipt. value should\n    * be compatible with both the QWeb and ESC/POS receipts.\n    *\n    * @param {string} value - receipt info\n    */\n    set_cashier_receipt: function (value) {\n        this.cashier_receipt = value;\n        this.trigger('change', this);\n    },\n\n    /**\n     * Set additional info to be printed on the receipts. value should\n     * be compatible with both the QWeb and ESC/POS receipts.\n     *\n     * @param {string} value - receipt info\n     */\n    set_receipt_info: function(value) {\n        this.ticket += value;\n        this.trigger('change', this);\n    },\n\n    // returns the associated cashregister\n    //exports as JSON for server communication\n    export_as_JSON: function(){\n        return {\n            name: time.datetime_to_str(new Date()),\n            payment_method_id: this.payment_method.id,\n            amount: this.get_amount(),\n            payment_status: this.payment_status,\n            can_be_reversed: this.can_be_resersed,\n            ticket: this.ticket,\n            card_type: this.card_type,\n            cardholder_name: this.cardholder_name,\n            transaction_id: this.transaction_id,\n        };\n    },\n    //exports as JSON for receipt printing\n    export_for_printing: function(){\n        return {\n            cid: this.cid,\n            amount: this.get_amount(),\n            name: this.name,\n            ticket: this.ticket,\n        };\n    },\n    // If payment status is a non-empty string, then it is an electronic payment.\n    // TODO: There has to be a less confusing way to distinguish simple payments\n    // from electronic transactions. Perhaps use a flag?\n    is_electronic: function() {\n        return Boolean(this.get_payment_status());\n    },\n});\n\nvar PaymentlineCollection = Backbone.Collection.extend({\n    model: exports.Paymentline,\n});\n\n// An order more or less represents the content of a client's shopping cart (the OrderLines)\n// plus the associated payment information (the Paymentlines)\n// there is always an active ('selected') order in the Pos, a new one is created\n// automaticaly once an order is completed and sent to the server.\nexports.Order = Backbone.Model.extend({\n    initialize: function(attributes,options){\n        Backbone.Model.prototype.initialize.apply(this, arguments);\n        var self = this;\n        options  = options || {};\n\n        this.locked         = false;\n        this.pos            = options.pos;\n        this.selected_orderline   = undefined;\n        this.selected_paymentline = undefined;\n        this.screen_data    = {};  // see Gui\n        this.temporary      = options.temporary || false;\n        this.creation_date  = new Date();\n        this.to_invoice     = false;\n        this.orderlines     = new OrderlineCollection();\n        this.paymentlines   = new PaymentlineCollection();\n        this.pos_session_id = this.pos.pos_session.id;\n        this.employee       = this.pos.employee;\n        this.finalized      = false; // if true, cannot be modified.\n        this.set_pricelist(this.pos.default_pricelist);\n\n        this.set({ client: null });\n\n        this.uiState = {\n            ReceiptScreen: new Context({\n                inputEmail: '',\n                // if null: not yet tried to send\n                // if false/true: tried sending email\n                emailSuccessful: null,\n                emailNotice: '',\n            }),\n            TipScreen: new Context({\n                inputTipAmount: '',\n            })\n        };\n\n        if (options.json) {\n            this.init_from_JSON(options.json);\n        } else {\n            this.sequence_number = this.pos.pos_session.sequence_number++;\n            this.uid  = this.generate_unique_id();\n            this.name = _.str.sprintf(_t(\"Order %s\"), this.uid);\n            this.validation_date = undefined;\n            this.fiscal_position = _.find(this.pos.fiscal_positions, function(fp) {\n                return fp.id === self.pos.config.default_fiscal_position_id[0];\n            });\n        }\n\n        this.on('change',              function(){ this.save_to_db(\"order:change\"); }, this);\n        this.orderlines.on('change',   function(){ this.save_to_db(\"orderline:change\"); }, this);\n        this.orderlines.on('add',      function(){ this.save_to_db(\"orderline:add\"); }, this);\n        this.orderlines.on('remove',   function(){ this.save_to_db(\"orderline:remove\"); }, this);\n        this.paymentlines.on('change', function(){ this.save_to_db(\"paymentline:change\"); }, this);\n        this.paymentlines.on('add',    function(){ this.save_to_db(\"paymentline:add\"); }, this);\n        this.paymentlines.on('remove', function(){ this.save_to_db(\"paymentline:rem\"); }, this);\n\n        if (this.pos.config.iface_customer_facing_display) {\n            this.paymentlines.on('add', this.pos.send_current_order_to_customer_facing_display, this.pos);\n            this.paymentlines.on('remove', this.pos.send_current_order_to_customer_facing_display, this.pos);\n        }\n\n        this.save_to_db();\n\n        return this;\n    },\n    save_to_db: function(){\n        if (!this.temporary && !this.locked) {\n            this.pos.db.save_unpaid_order(this);\n        }\n    },\n    /**\n     * Initialize PoS order from a JSON string.\n     *\n     * If the order was created in another session, the sequence number should be changed so it doesn't conflict\n     * with orders in the current session.\n     * Else, the sequence number of the session should follow on the sequence number of the loaded order.\n     *\n     * @param {object} json JSON representing one PoS order.\n     */\n    init_from_JSON: function(json) {\n        var client;\n        if (json.pos_session_id !== this.pos.pos_session.id) {\n            this.sequence_number = this.pos.pos_session.sequence_number++;\n        } else {\n            this.sequence_number = json.sequence_number;\n            this.pos.pos_session.sequence_number = Math.max(this.sequence_number+1,this.pos.pos_session.sequence_number);\n        }\n        this.session_id = this.pos.pos_session.id;\n        this.uid = json.uid;\n        this.name = _.str.sprintf(_t(\"Order %s\"), this.uid);\n        this.validation_date = json.creation_date;\n        this.server_id = json.server_id ? json.server_id : false;\n        this.user_id = json.user_id;\n\n        if (json.fiscal_position_id) {\n            var fiscal_position = _.find(this.pos.fiscal_positions, function (fp) {\n                return fp.id === json.fiscal_position_id;\n            });\n\n            if (fiscal_position) {\n                this.fiscal_position = fiscal_position;\n            } else {\n                console.error('ERROR: trying to load a fiscal position not available in the pos');\n            }\n        }\n\n        if (json.pricelist_id) {\n            this.pricelist = _.find(this.pos.pricelists, function (pricelist) {\n                return pricelist.id === json.pricelist_id;\n            });\n        } else {\n            this.pricelist = this.pos.default_pricelist;\n        }\n\n        if (json.partner_id) {\n            client = this.pos.db.get_partner_by_id(json.partner_id);\n            if (!client) {\n                console.error('ERROR: trying to load a partner not available in the pos');\n            }\n        } else {\n            client = null;\n        }\n        this.set_client(client);\n\n        this.temporary = false;     // FIXME\n        this.to_invoice = false;    // FIXME\n        this.to_ship = false;\n\n        var orderlines = json.lines;\n        for (var i = 0; i < orderlines.length; i++) {\n            var orderline = orderlines[i][2];\n            this.add_orderline(new exports.Orderline({}, {pos: this.pos, order: this, json: orderline}));\n        }\n\n        var paymentlines = json.statement_ids;\n        for (var i = 0; i < paymentlines.length; i++) {\n            var paymentline = paymentlines[i][2];\n            var newpaymentline = new exports.Paymentline({},{pos: this.pos, order: this, json: paymentline});\n            this.paymentlines.add(newpaymentline);\n\n            if (i === paymentlines.length - 1) {\n                this.select_paymentline(newpaymentline);\n            }\n        }\n\n        // Tag this order as 'locked' if it is already paid.\n        this.locked = ['paid', 'done', 'invoiced'].includes(json.state);\n        this.state = json.state;\n        this.amount_return = json.amount_return;\n        this.account_move = json.account_move;\n        this.backendId = json.id;\n        this.isFromClosedSession = json.is_session_closed;\n        this.is_tipped = json.is_tipped || false;\n        this.tip_amount = json.tip_amount || 0;\n    },\n    export_as_JSON: function() {\n        var orderLines, paymentLines;\n        orderLines = [];\n        this.orderlines.each(_.bind( function(item) {\n            return orderLines.push([0, 0, item.export_as_JSON()]);\n        }, this));\n        paymentLines = [];\n        this.paymentlines.each(_.bind( function(item) {\n            return paymentLines.push([0, 0, item.export_as_JSON()]);\n        }, this));\n        var json = {\n            name: this.get_name(),\n            amount_paid: this.get_total_paid() - this.get_change(),\n            amount_total: this.get_total_with_tax(),\n            amount_tax: this.get_total_tax(),\n            amount_return: this.get_change(),\n            lines: orderLines,\n            statement_ids: paymentLines,\n            pos_session_id: this.pos_session_id,\n            pricelist_id: this.pricelist ? this.pricelist.id : false,\n            partner_id: this.get_client() ? this.get_client().id : false,\n            user_id: this.pos.user.id,\n            uid: this.uid,\n            sequence_number: this.sequence_number,\n            creation_date: this.validation_date || this.creation_date, // todo: rename creation_date in master\n            fiscal_position_id: this.fiscal_position ? this.fiscal_position.id : false,\n            server_id: this.server_id ? this.server_id : false,\n            to_invoice: this.to_invoice ? this.to_invoice : false,\n            to_ship: this.to_ship ? this.to_ship : false,\n            is_tipped: this.is_tipped || false,\n            tip_amount: this.tip_amount || 0,\n        };\n        if (!this.is_paid && this.user_id) {\n            json.user_id = this.user_id;\n        }\n        return json;\n    },\n    export_for_printing: function(){\n        var orderlines = [];\n        var self = this;\n\n        this.orderlines.each(function(orderline){\n            orderlines.push(orderline.export_for_printing());\n        });\n\n        // If order is locked (paid), the 'change' is saved as negative payment,\n        // and is flagged with is_change = true. A receipt that is printed first\n        // time doesn't show this negative payment so we filter it out.\n        var paymentlines = this.paymentlines.models\n            .filter(function (paymentline) {\n                return !paymentline.is_change;\n            })\n            .map(function (paymentline) {\n                return paymentline.export_for_printing();\n            });\n        var client  = this.get('client');\n        var cashier = this.pos.get_cashier();\n        var company = this.pos.company;\n        var date    = new Date();\n\n        function is_html(subreceipt){\n            return subreceipt ? (subreceipt.split('\\n')[0].indexOf('<!DOCTYPE QWEB') >= 0) : false;\n        }\n\n        function render_html(subreceipt){\n            if (!is_html(subreceipt)) {\n                return subreceipt;\n            } else {\n                subreceipt = subreceipt.split('\\n').slice(1).join('\\n');\n                var qweb = new QWeb2.Engine();\n                    qweb.debug = config.isDebug();\n                    qweb.default_dict = _.clone(QWeb.default_dict);\n                    qweb.add_template('<templates><t t-name=\"subreceipt\">'+subreceipt+'</t></templates>');\n\n                return qweb.render('subreceipt',{'pos':self.pos,'order':self, 'receipt': receipt}) ;\n            }\n        }\n\n        var receipt = {\n            orderlines: orderlines,\n            paymentlines: paymentlines,\n            subtotal: this.get_subtotal(),\n            total_with_tax: this.get_total_with_tax(),\n            total_rounded: this.get_total_with_tax() + this.get_rounding_applied(),\n            total_without_tax: this.get_total_without_tax(),\n            total_tax: this.get_total_tax(),\n            total_paid: this.get_total_paid(),\n            total_discount: this.get_total_discount(),\n            rounding_applied: this.get_rounding_applied(),\n            tax_details: this.get_tax_details(),\n            change: this.locked ? this.amount_return : this.get_change(),\n            name : this.get_name(),\n            client: client ? client : null ,\n            invoice_id: null,   //TODO\n            cashier: cashier ? cashier.name : null,\n            precision: {\n                price: 2,\n                money: 2,\n                quantity: 3,\n            },\n            date: {\n                year: date.getFullYear(),\n                month: date.getMonth(),\n                date: date.getDate(),       // day of the month\n                day: date.getDay(),         // day of the week\n                hour: date.getHours(),\n                minute: date.getMinutes() ,\n                isostring: date.toISOString(),\n                localestring: this.formatted_validation_date,\n                validation_date: this.validation_date,\n            },\n            company:{\n                email: company.email,\n                website: company.website,\n                company_registry: company.company_registry,\n                contact_address: company.partner_id[1],\n                vat: company.vat,\n                vat_label: company.country && company.country.vat_label || _t('Tax ID'),\n                name: company.name,\n                phone: company.phone,\n                logo:  this.pos.company_logo_base64,\n            },\n            currency: this.pos.currency,\n        };\n\n        if (is_html(this.pos.config.receipt_header)){\n            receipt.header = '';\n            receipt.header_html = render_html(this.pos.config.receipt_header);\n        } else {\n            receipt.header = this.pos.config.receipt_header || '';\n        }\n\n        if (is_html(this.pos.config.receipt_footer)){\n            receipt.footer = '';\n            receipt.footer_html = render_html(this.pos.config.receipt_footer);\n        } else {\n            receipt.footer = this.pos.config.receipt_footer || '';\n        }\n\n        return receipt;\n    },\n    is_empty: function(){\n        return this.orderlines.models.length === 0;\n    },\n    generate_unique_id: function() {\n        // Generates a public identification number for the order.\n        // The generated number must be unique and sequential. They are made 12 digit long\n        // to fit into EAN-13 barcodes, should it be needed\n\n        function zero_pad(num,size){\n            var s = \"\"+num;\n            while (s.length < size) {\n                s = \"0\" + s;\n            }\n            return s;\n        }\n        return zero_pad(this.pos.pos_session.id,5) +'-'+\n               zero_pad(this.pos.pos_session.login_number,3) +'-'+\n               zero_pad(this.sequence_number,4);\n    },\n    get_name: function() {\n        return this.name;\n    },\n    assert_editable: function() {\n        if (this.finalized) {\n            throw new Error('Finalized Order cannot be modified');\n        }\n    },\n    /* ---- Order Lines --- */\n    add_orderline: function(line){\n        this.assert_editable();\n        if(line.order){\n            line.order.remove_orderline(line);\n        }\n        line.order = this;\n        this.orderlines.add(line);\n        this.select_orderline(this.get_last_orderline());\n    },\n    get_orderline: function(id){\n        var orderlines = this.orderlines.models;\n        for(var i = 0; i < orderlines.length; i++){\n            if(orderlines[i].id === id){\n                return orderlines[i];\n            }\n        }\n        return null;\n    },\n    get_orderlines: function(){\n        return this.orderlines.models;\n    },\n    get_last_orderline: function(){\n        return this.orderlines.at(this.orderlines.length -1);\n    },\n    get_tip: function() {\n        var tip_product = this.pos.db.get_product_by_id(this.pos.config.tip_product_id[0]);\n        var lines = this.get_orderlines();\n        if (!tip_product) {\n            return 0;\n        } else {\n            for (var i = 0; i < lines.length; i++) {\n                if (lines[i].get_product() === tip_product) {\n                    return lines[i].get_unit_price();\n                }\n            }\n            return 0;\n        }\n    },\n\n    initialize_validation_date: function () {\n        this.validation_date = new Date();\n        this.formatted_validation_date = field_utils.format.datetime(\n            moment(this.validation_date), {}, {timezone: false});\n    },\n\n    set_tip: function(tip) {\n        var tip_product = this.pos.db.get_product_by_id(this.pos.config.tip_product_id[0]);\n        var lines = this.get_orderlines();\n        if (tip_product) {\n            for (var i = 0; i < lines.length; i++) {\n                if (lines[i].get_product() === tip_product) {\n                    lines[i].set_unit_price(tip);\n                    lines[i].set_lst_price(tip);\n                    lines[i].price_manually_set = true;\n                    lines[i].order.tip_amount = tip;\n                    return;\n                }\n            }\n            return this.add_product(tip_product, {\n              is_tip: true,\n              quantity: 1,\n              price: tip,\n              lst_price: tip,\n              extras: {price_manually_set: true},\n            });\n        }\n    },\n    set_pricelist: function (pricelist) {\n        var self = this;\n        this.pricelist = pricelist;\n\n        var lines_to_recompute = _.filter(this.get_orderlines(), function (line) {\n            return ! line.price_manually_set;\n        });\n        _.each(lines_to_recompute, function (line) {\n            line.set_unit_price(line.product.get_price(self.pricelist, line.get_quantity(), line.get_price_extra()));\n            self.fix_tax_included_price(line);\n        });\n        this.trigger('change');\n    },\n    remove_orderline: function( line ){\n        this.assert_editable();\n        this.orderlines.remove(line);\n        this.select_orderline(this.get_last_orderline());\n    },\n\n    fix_tax_included_price: function(line){\n        line.set_unit_price(line.compute_fixed_price(line.price));\n    },\n\n    add_product: function(product, options){\n        if(this._printed){\n            this.destroy();\n            return this.pos.get_order().add_product(product, options);\n        }\n        this.assert_editable();\n        options = options || {};\n        var line = new exports.Orderline({}, {pos: this.pos, order: this, product: product});\n        this.fix_tax_included_price(line);\n\n        this.set_orderline_options(line, options);\n\n        var to_merge_orderline;\n        for (var i = 0; i < this.orderlines.length; i++) {\n            if(this.orderlines.at(i).can_be_merged_with(line) && options.merge !== false){\n                to_merge_orderline = this.orderlines.at(i);\n            }\n        }\n        if (to_merge_orderline){\n            to_merge_orderline.merge(line);\n            this.select_orderline(to_merge_orderline);\n        } else {\n            this.orderlines.add(line);\n            this.select_orderline(this.get_last_orderline());\n        }\n\n        if (options.draftPackLotLines) {\n            this.selected_orderline.setPackLotLines(options.draftPackLotLines);\n        }\n        if (this.pos.config.iface_customer_facing_display) {\n            this.pos.send_current_order_to_customer_facing_display();\n        }\n    },\n    set_orderline_options: function(orderline, options) {\n        if(options.quantity !== undefined){\n            orderline.set_quantity(options.quantity);\n        }\n\n        if (options.price_extra !== undefined){\n            orderline.price_extra = options.price_extra;\n            orderline.set_unit_price(orderline.product.get_price(this.pricelist, orderline.get_quantity(), options.price_extra));\n            this.fix_tax_included_price(orderline);\n        }\n\n        if(options.price !== undefined){\n            orderline.set_unit_price(options.price);\n            this.fix_tax_included_price(orderline);\n        }\n\n        if(options.lst_price !== undefined){\n            orderline.set_lst_price(options.lst_price);\n        }\n\n        if(options.discount !== undefined){\n            orderline.set_discount(options.discount);\n        }\n\n        if (options.description !== undefined){\n            orderline.description += options.description;\n        }\n\n        if(options.extras !== undefined){\n            for (var prop in options.extras) {\n                orderline[prop] = options.extras[prop];\n            }\n        }\n        if (options.is_tip) {\n            this.is_tipped = true;\n            this.tip_amount = options.price;\n        }\n        if (options.refunded_orderline_id) {\n            orderline.refunded_orderline_id = options.refunded_orderline_id;\n        }\n        if (options.tax_ids) {\n            orderline.tax_ids = options.tax_ids;\n        }\n    },\n    get_selected_orderline: function(){\n        return this.selected_orderline;\n    },\n    select_orderline: function(line){\n        if(line){\n            if(line !== this.selected_orderline){\n                // if line (new line to select) is not the same as the old\n                // selected_orderline, then we set the old line to false,\n                // and set the new line to true. Also, set the new line as\n                // the selected_orderline.\n                if(this.selected_orderline){\n                    this.selected_orderline.set_selected(false);\n                }\n                this.selected_orderline = line;\n                this.selected_orderline.set_selected(true);\n            }\n        }else{\n            this.selected_orderline = undefined;\n        }\n    },\n    deselect_orderline: function(){\n        if(this.selected_orderline){\n            this.selected_orderline.set_selected(false);\n            this.selected_orderline = undefined;\n        }\n    },\n\n    /* ---- Payment Lines --- */\n    add_paymentline: function(payment_method) {\n        this.assert_editable();\n        var newPaymentline = new exports.Paymentline({},{order: this, payment_method:payment_method, pos: this.pos});\n        newPaymentline.set_amount(this.get_due());\n        this.paymentlines.add(newPaymentline);\n        this.select_paymentline(newPaymentline);\n        if(this.pos.config.cash_rounding){\n          this.selected_paymentline.set_amount(0);\n          this.selected_paymentline.set_amount(this.get_due());\n        }\n        return newPaymentline;\n    },\n    get_paymentlines: function(){\n        return this.paymentlines.models;\n    },\n    /**\n     * Retrieve the paymentline with the specified cid\n     *\n     * @param {String} cid\n     */\n    get_paymentline: function (cid) {\n        var lines = this.get_paymentlines();\n        return lines.find(function (line) {\n            return line.cid === cid;\n        });\n    },\n    remove_paymentline: function(line){\n        this.assert_editable();\n        if(this.selected_paymentline === line){\n            this.select_paymentline(undefined);\n        }\n        this.paymentlines.remove(line);\n    },\n    clean_empty_paymentlines: function() {\n        var lines = this.paymentlines.models;\n        var empty = [];\n        for ( var i = 0; i < lines.length; i++) {\n            if (!lines[i].get_amount()) {\n                empty.push(lines[i]);\n            }\n        }\n        for ( var i = 0; i < empty.length; i++) {\n            this.remove_paymentline(empty[i]);\n        }\n    },\n    select_paymentline: function(line){\n        if(line !== this.selected_paymentline){\n            if(this.selected_paymentline){\n                this.selected_paymentline.set_selected(false);\n            }\n            this.selected_paymentline = line;\n            if(this.selected_paymentline){\n                this.selected_paymentline.set_selected(true);\n            }\n            this.trigger('change:selected_paymentline',this.selected_paymentline);\n        }\n    },\n    electronic_payment_in_progress: function() {\n        return this.get_paymentlines()\n            .some(function(pl) {\n                if (pl.payment_status) {\n                    return !['done', 'reversed'].includes(pl.payment_status);\n                } else {\n                    return false;\n                }\n            });\n    },\n    /**\n     * Stops a payment on the terminal if one is running\n     */\n    stop_electronic_payment: function () {\n        var lines = this.get_paymentlines();\n        var line = lines.find(function (line) {\n            var status = line.get_payment_status();\n            return status && !['done', 'reversed', 'reversing', 'pending', 'retry'].includes(status);\n        });\n        if (line) {\n            line.set_payment_status('waitingCancel');\n            line.payment_method.payment_terminal.send_payment_cancel(this, line.cid).finally(function () {\n                line.set_payment_status('retry');\n            });\n        }\n    },\n    /* ---- Payment Status --- */\n    get_subtotal: function(){\n        return round_pr(this.orderlines.reduce((function(sum, orderLine){\n            return sum + orderLine.get_display_price();\n        }), 0), this.pos.currency.rounding);\n    },\n    get_total_with_tax: function() {\n        return this.get_total_without_tax() + this.get_total_tax();\n    },\n    get_total_without_tax: function() {\n        return round_pr(this.orderlines.reduce((function(sum, orderLine) {\n            return sum + orderLine.get_price_without_tax();\n        }), 0), this.pos.currency.rounding);\n    },\n    get_total_discount: function() {\n        return round_pr(this.orderlines.reduce((function(sum, orderLine) {\n            sum += (orderLine.get_unit_price() * (orderLine.get_discount()/100) * orderLine.get_quantity());\n            if (orderLine.display_discount_policy() === 'without_discount'){\n                sum += ((orderLine.get_lst_price() - orderLine.get_unit_price()) * orderLine.get_quantity());\n            }\n            return sum;\n        }), 0), this.pos.currency.rounding);\n    },\n    get_total_tax: function() {\n        if (this.pos.company.tax_calculation_rounding_method === \"round_globally\") {\n            // As always, we need:\n            // 1. For each tax, sum their amount across all order lines\n            // 2. Round that result\n            // 3. Sum all those rounded amounts\n            var groupTaxes = {};\n            this.orderlines.each(function (line) {\n                var taxDetails = line.get_tax_details();\n                var taxIds = Object.keys(taxDetails);\n                for (var t = 0; t<taxIds.length; t++) {\n                    var taxId = taxIds[t];\n                    if (!(taxId in groupTaxes)) {\n                        groupTaxes[taxId] = 0;\n                    }\n                    groupTaxes[taxId] += taxDetails[taxId];\n                }\n            });\n\n            var sum = 0;\n            var taxIds = Object.keys(groupTaxes);\n            for (var j = 0; j<taxIds.length; j++) {\n                var taxAmount = groupTaxes[taxIds[j]];\n                sum += round_pr(taxAmount, this.pos.currency.rounding);\n            }\n            return sum;\n        } else {\n            return round_pr(this.orderlines.reduce((function(sum, orderLine) {\n                return sum + orderLine.get_tax();\n            }), 0), this.pos.currency.rounding);\n        }\n    },\n    get_total_paid: function() {\n        return round_pr(this.paymentlines.reduce((function(sum, paymentLine) {\n            if (paymentLine.is_done()) {\n                sum += paymentLine.get_amount();\n            }\n            return sum;\n        }), 0), this.pos.currency.rounding);\n    },\n    get_tax_details: function(){\n        var details = {};\n        var fulldetails = [];\n\n        this.orderlines.each(function(line){\n            var ldetails = line.get_tax_details();\n            for(var id in ldetails){\n                if(ldetails.hasOwnProperty(id)){\n                    details[id] = (details[id] || 0) + ldetails[id];\n                }\n            }\n        });\n\n        for(var id in details){\n            if(details.hasOwnProperty(id)){\n                fulldetails.push({amount: details[id], tax: this.pos.taxes_by_id[id], name: this.pos.taxes_by_id[id].name});\n            }\n        }\n\n        return fulldetails;\n    },\n    // Returns a total only for the orderlines with products belonging to the category\n    get_total_for_category_with_tax: function(categ_id){\n        var total = 0;\n        var self = this;\n\n        if (categ_id instanceof Array) {\n            for (var i = 0; i < categ_id.length; i++) {\n                total += this.get_total_for_category_with_tax(categ_id[i]);\n            }\n            return total;\n        }\n\n        this.orderlines.each(function(line){\n            if ( self.pos.db.category_contains(categ_id,line.product.id) ) {\n                total += line.get_price_with_tax();\n            }\n        });\n\n        return total;\n    },\n    get_total_for_taxes: function(tax_id){\n        var total = 0;\n\n        if (!(tax_id instanceof Array)) {\n            tax_id = [tax_id];\n        }\n\n        var tax_set = {};\n\n        for (var i = 0; i < tax_id.length; i++) {\n            tax_set[tax_id[i]] = true;\n        }\n\n        this.orderlines.each(line => {\n            var taxes_ids = this.tax_ids || line.get_product().taxes_id;\n            for (var i = 0; i < taxes_ids.length; i++) {\n                if (tax_set[taxes_ids[i]]) {\n                    total += line.get_price_with_tax();\n                    return;\n                }\n            }\n        });\n\n        return total;\n    },\n    get_change: function(paymentline) {\n        if (!paymentline) {\n            var change = this.get_total_paid() - this.get_total_with_tax() - this.get_rounding_applied();\n        } else {\n            var change = -this.get_total_with_tax();\n            var lines  = this.paymentlines.models;\n            for (var i = 0; i < lines.length; i++) {\n                change += lines[i].get_amount();\n                if (lines[i] === paymentline) {\n                    break;\n                }\n            }\n        }\n        return round_pr(Math.max(0,change), this.pos.currency.rounding);\n    },\n    get_due: function(paymentline) {\n        if (!paymentline) {\n            var due = this.get_total_with_tax() - this.get_total_paid() + this.get_rounding_applied();\n        } else {\n            var due = this.get_total_with_tax();\n            var lines = this.paymentlines.models;\n            for (var i = 0; i < lines.length; i++) {\n                if (lines[i] === paymentline) {\n                    break;\n                } else {\n                    due -= lines[i].get_amount();\n                }\n            }\n        }\n        return round_pr(due, this.pos.currency.rounding);\n    },\n    get_rounding_applied: function() {\n        if(this.pos.config.cash_rounding) {\n            const only_cash = this.pos.config.only_round_cash_method;\n            const paymentlines = this.get_paymentlines();\n            const last_line = paymentlines ? paymentlines[paymentlines.length-1]: false;\n            const last_line_is_cash = last_line ? last_line.payment_method.is_cash_count == true: false;\n            if (!only_cash || (only_cash && last_line_is_cash)) {\n                var remaining = this.get_total_with_tax() - this.get_total_paid();\n                var total = round_pr(remaining, this.pos.cash_rounding[0].rounding);\n                var sign = remaining > 0 ? 1.0 : -1.0;\n\n                var rounding_applied = total - remaining;\n                rounding_applied *= sign;\n                // because floor and ceil doesn't include decimals in calculation, we reuse the value of the half-up and adapt it.\n                if (utils.float_is_zero(rounding_applied, this.pos.currency.decimals)){\n                    // https://xkcd.com/217/\n                    return 0;\n                } else if(this.get_total_with_tax() < this.pos.cash_rounding[0].rounding) {\n                    return 0;\n                } else if(this.pos.cash_rounding[0].rounding_method === \"UP\" && rounding_applied < 0 && remaining > 0) {\n                    rounding_applied += this.pos.cash_rounding[0].rounding;\n                }\n                else if(this.pos.cash_rounding[0].rounding_method === \"UP\" && rounding_applied > 0 && remaining < 0) {\n                    rounding_applied -= this.pos.cash_rounding[0].rounding;\n                }\n                else if(this.pos.cash_rounding[0].rounding_method === \"DOWN\" && rounding_applied > 0 && remaining > 0){\n                    rounding_applied -= this.pos.cash_rounding[0].rounding;\n                }\n                else if(this.pos.cash_rounding[0].rounding_method === \"DOWN\" && rounding_applied < 0 && remaining < 0){\n                    rounding_applied += this.pos.cash_rounding[0].rounding;\n                }\n                return sign * rounding_applied;\n            }\n            else {\n                return 0;\n            }\n        }\n        return 0;\n    },\n    has_not_valid_rounding: function() {\n        if(!this.pos.config.cash_rounding || this.get_total_with_tax() < this.pos.cash_rounding[0].rounding)\n            return false;\n\n        const only_cash = this.pos.config.only_round_cash_method;\n        var lines = this.paymentlines.models;\n\n        for(var i = 0; i < lines.length; i++) {\n            var line = lines[i];\n            if (only_cash && !line.payment_method.is_cash_count)\n                continue;\n\n            if(!utils.float_is_zero(line.amount - round_pr(line.amount, this.pos.cash_rounding[0].rounding), 6))\n                return line;\n        }\n        return false;\n    },\n    is_paid: function(){\n        return this.get_due() <= 0 && this.check_paymentlines_rounding();\n    },\n    is_paid_with_cash: function(){\n        return !!this.paymentlines.find( function(pl){\n            return pl.payment_method.is_cash_count;\n        });\n    },\n    check_paymentlines_rounding: function() {\n        if(this.pos.config.cash_rounding) {\n            var cash_rounding = this.pos.cash_rounding[0].rounding;\n            var default_rounding = this.pos.currency.rounding;\n            for(var id in this.get_paymentlines()) {\n                var line = this.get_paymentlines()[id];\n                var diff = round_pr(round_pr(line.amount, cash_rounding) - round_pr(line.amount, default_rounding), default_rounding);\n                if(this.get_total_with_tax() < this.pos.cash_rounding[0].rounding)\n                    return true;\n                if(diff && line.payment_method.is_cash_count) {\n                    return false;\n                } else if(!this.pos.config.only_round_cash_method && diff) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return true;\n    },\n    get_total_cost: function() {\n        return this.orderlines.reduce((function(sum, orderLine) {\n            return sum + orderLine.get_total_cost();\n        }), 0)\n    },\n    finalize: function(){\n        this.destroy();\n    },\n    destroy: function(){\n        Backbone.Model.prototype.destroy.apply(this,arguments);\n        this.pos.db.remove_unpaid_order(this);\n    },\n    /* ---- Invoice --- */\n    set_to_invoice: function(to_invoice) {\n        this.assert_editable();\n        this.to_invoice = to_invoice;\n    },\n    is_to_invoice: function(){\n        return this.to_invoice;\n    },\n    /* ---- Client / Customer --- */\n    // the client related to the current order.\n    set_client: function(client){\n        this.assert_editable();\n        this.set('client',client);\n    },\n    get_client: function(){\n        return this.get('client');\n    },\n    get_client_name: function(){\n        var client = this.get('client');\n        return client ? client.name : \"\";\n    },\n    get_cardholder_name: function(){\n        var card_payment_line = this.paymentlines.find(pl => pl.cardholder_name);\n        return card_payment_line ? card_payment_line.cardholder_name : \"\";\n    },\n    /* ---- Screen Status --- */\n    // the order also stores the screen status, as the PoS supports\n    // different active screens per order. This method is used to\n    // store the screen status.\n    set_screen_data: function(value){\n        this.screen_data['value'] = value;\n    },\n    //see set_screen_data\n    get_screen_data: function(){\n        const screen = this.screen_data['value'];\n        // If no screen data is saved\n        //   no payment line -> product screen\n        //   with payment line -> payment screen\n        if (!screen) {\n            if (this.get_paymentlines().length > 0) return { name: 'PaymentScreen' };\n            return { name: 'ProductScreen' };\n        }\n        if (!this.finalized && this.get_paymentlines().length > 0) {\n            return { name: 'PaymentScreen' };\n        }\n        return screen;\n    },\n    wait_for_push_order: function () {\n        return false;\n    },\n    /**\n     * @returns {Object} object to use as props for instantiating OrderReceipt.\n     */\n    getOrderReceiptEnv: function() {\n        // Formerly get_receipt_render_env defined in ScreenWidget.\n        return {\n            order: this,\n            receipt: this.export_for_printing(),\n            orderlines: this.get_orderlines(),\n            paymentlines: this.get_paymentlines(),\n        };\n    },\n    updatePricelist: function(newClient) {\n        let newClientPricelist, newClientFiscalPosition;\n        const defaultFiscalPosition = this.pos.fiscal_positions.find(\n            (position) => position.id === this.pos.config.default_fiscal_position_id[0]\n        );\n        if (newClient) {\n            newClientFiscalPosition = newClient.property_account_position_id\n                ? this.pos.fiscal_positions.find(\n                      (position) => position.id === newClient.property_account_position_id[0]\n                  )\n                : defaultFiscalPosition;\n            newClientPricelist =\n                this.pos.pricelists.find(\n                    (pricelist) => pricelist.id === newClient.property_product_pricelist[0]\n                ) || this.pos.default_pricelist;\n        } else {\n            newClientFiscalPosition = defaultFiscalPosition;\n            newClientPricelist = this.pos.default_pricelist;\n        }\n        this.fiscal_position = newClientFiscalPosition;\n        this.set_pricelist(newClientPricelist);\n    },\n    /* ---- Ship later --- */\n    set_to_ship: function(to_ship) {\n        this.assert_editable();\n        this.to_ship = to_ship;\n    },\n    is_to_ship: function(){\n        return this.to_ship;\n    },\n    getHasRefundLines: function() {\n        for (const line of this.get_orderlines()) {\n            if (line.refunded_orderline_id) {\n                return true;\n            }\n        }\n        return false;\n    },\n});\n\nvar OrderCollection = Backbone.Collection.extend({\n    model: exports.Order,\n});\n\n// exports = {\n//     PosModel: PosModel,\n//     load_fields: load_fields,\n//     load_models: load_models,\n//     Orderline: Orderline,\n//     Order: Order,\n// };\nreturn exports;\n\n});\n", "odoo.define('point_of_sale.keyboard', function (require) {\n\"use strict\";\n\nvar Widget = require('web.Widget');\n\n// ---------- OnScreen Keyboard Widget ----------\n// A Widget that displays an onscreen keyboard.\n// There are two options when creating the widget :\n// \n// * 'keyboard_model' : 'simple' (default) | 'full' \n//   The 'full' emulates a PC keyboard, while 'simple' emulates an 'android' one.\n//\n// * 'input_selector  : (default: '.searchbox input') \n//   defines the dom element that the keyboard will write to.\n// \n// The widget is initially hidden. It can be shown with this.show(), and is \n// automatically shown when the input_selector gets focused.\n\nvar OnscreenKeyboardWidget = Widget.extend({\n    template: 'OnscreenKeyboardSimple', \n    init: function(parent, options){\n        this._super(parent,options);\n        options = options || {};\n\n        this.keyboard_model = options.keyboard_model || 'simple';\n        if(this.keyboard_model === 'full'){\n            this.template = 'OnscreenKeyboardFull';\n        }\n\n        this.input_selector = options.input_selector || '.searchbox input';\n        this.$target = null;\n\n        //Keyboard state\n        this.capslock = false;\n        this.shift    = false;\n        this.numlock  = false;\n    },\n    \n    connect : function(target){\n        var self = this;\n        this.$target = $(target);\n        this.$target.focus(function(){self.show();});\n    },\n    generateEvent: function(type,key){\n        var event = document.createEvent(\"KeyboardEvent\");\n        var initMethod =  event.initKeyboardEvent ? 'initKeyboardEvent' : 'initKeyEvent';\n        event[initMethod](  type,\n                            true, //bubbles\n                            true, //cancelable\n                            window, //viewArg\n                            false, //ctrl\n                            false, //alt\n                            false, //shift\n                            false, //meta\n                            ((typeof key.code === 'undefined') ? key.char.charCodeAt(0) : key.code),\n                            ((typeof key.char === 'undefined') ? String.fromCharCode(key.code) : key.char)\n                        );\n        return event;\n\n    },\n\n    // Write a character to the input zone\n    writeCharacter: function(character){\n        var input = this.$target[0];\n        input.dispatchEvent(this.generateEvent('keypress',{char: character}));\n        if(character !== '\\n'){\n            input.value += character;\n        }\n        input.dispatchEvent(this.generateEvent('keyup',{char: character}));\n    },\n    \n    // Removes the last character from the input zone.\n    deleteCharacter: function(){\n        var input = this.$target[0];\n        input.dispatchEvent(this.generateEvent('keypress',{code: 8}));\n        input.value = input.value.substr(0, input.value.length -1);\n        input.dispatchEvent(this.generateEvent('keyup',{code: 8}));\n    },\n    \n    // Clears the content of the input zone.\n    deleteAllCharacters: function(){\n        var input = this.$target[0];\n        if(input.value){\n            input.dispatchEvent(this.generateEvent('keypress',{code: 8}));\n            input.value = \"\";\n            input.dispatchEvent(this.generateEvent('keyup',{code: 8}));\n        }\n    },\n\n    // Makes the keyboard show and slide from the bottom of the screen.\n    show:  function(){\n        $('.keyboard_frame').show().css({'height':'235px'});\n    },\n    \n    // Makes the keyboard hide by sliding to the bottom of the screen.\n    hide:  function(){\n        $('.keyboard_frame')\n            .css({'height':'0'})\n            .hide();\n        this.reset();\n    },\n    \n    //What happens when the shift key is pressed : toggle case, remove capslock\n    toggleShift: function(){\n        $('.letter').toggleClass('uppercase');\n        $('.symbol span').toggle();\n        \n        this.shift = (this.shift === true) ? false : true;\n        this.capslock = false;\n    },\n    \n    //what happens when capslock is pressed : toggle case, set capslock\n    toggleCapsLock: function(){\n        $('.letter').toggleClass('uppercase');\n        this.capslock = true;\n    },\n    \n    //What happens when numlock is pressed : toggle symbols and numlock label \n    toggleNumLock: function(){\n        $('.symbol span').toggle();\n        $('.numlock span').toggle();\n        this.numlock = (this.numlock === true ) ? false : true;\n    },\n\n    //After a key is pressed, shift is disabled. \n    removeShift: function(){\n        if (this.shift === true) {\n            $('.symbol span').toggle();\n            if (this.capslock === false) $('.letter').toggleClass('uppercase');\n            \n            this.shift = false;\n        }\n    },\n\n    // Resets the keyboard to its original state; capslock: false, shift: false, numlock: false\n    reset: function(){\n        if(this.shift){\n            this.toggleShift();\n        }\n        if(this.capslock){\n            this.toggleCapsLock();\n        }\n        if(this.numlock){\n            this.toggleNumLock();\n        }\n    },\n\n    //called after the keyboard is in the DOM, sets up the key bindings.\n    start: function(){\n        var self = this;\n\n        //this.show();\n\n\n        $('.close_button').click(function(){ \n            self.deleteAllCharacters();\n            self.hide(); \n        });\n\n        // Keyboard key click handling\n        $('.keyboard li').click(function(){\n            \n            var $this = $(this),\n                character = $this.html(); // If it's a lowercase letter, nothing happens to this variable\n            \n            if ($this.hasClass('left-shift') || $this.hasClass('right-shift')) {\n                self.toggleShift();\n                return false;\n            }\n            \n            if ($this.hasClass('capslock')) {\n                self.toggleCapsLock();\n                return false;\n            }\n            \n            if ($this.hasClass('delete')) {\n                self.deleteCharacter();\n                return false;\n            }\n\n            if ($this.hasClass('numlock')){\n                self.toggleNumLock();\n                return false;\n            }\n            \n            // Special characters\n            if ($this.hasClass('symbol')) character = $('span:visible', $this).html();\n            if ($this.hasClass('space')) character = ' ';\n            if ($this.hasClass('tab')) character = \"\\t\";\n            if ($this.hasClass('return')) character = \"\\n\";\n            \n            // Uppercase letter\n            if ($this.hasClass('uppercase')) character = character.toUpperCase();\n            \n            // Remove shift once a key is clicked.\n            self.removeShift();\n\n            self.writeCharacter(character);\n        });\n    },\n});\n\nreturn {\n    OnscreenKeyboardWidget: OnscreenKeyboardWidget,\n};\n\n});\n", "odoo.define('point_of_sale.BarcodeReader', function (require) {\n\"use strict\";\n\nvar concurrency = require('web.concurrency');\nvar core = require('web.core');\nvar Mutex = concurrency.Mutex;\n\n// this module interfaces with the barcode reader. It assumes the barcode reader\n// is set-up to act like  a keyboard. Use connect() and disconnect() to activate\n// and deactivate the barcode reader. Use set_action_callbacks to tell it\n// what to do when it reads a barcode.\nvar BarcodeReader = core.Class.extend({\n    actions:[\n        'product',\n        'cashier',\n        'client',\n    ],\n\n    init: function (attributes) {\n        this.mutex = new Mutex();\n        this.pos = attributes.pos;\n        this.action_callbacks = {};\n        this.exclusive_callbacks = {};\n        this.proxy = attributes.proxy;\n        this.remote_scanning = false;\n        this.remote_active = 0;\n\n        this.barcode_parser = attributes.barcode_parser;\n\n        this.action_callback_stack = [];\n\n        core.bus.on('barcode_scanned', this, function (barcode) {\n            // use mutex to make sure scans are done one after the other\n            this.mutex.exec(async () => {\n                await this.scan(barcode);\n            });\n        });\n    },\n\n    set_barcode_parser: function (barcode_parser) {\n        this.barcode_parser = barcode_parser;\n    },\n\n    // when a barcode is scanned and parsed, the callback corresponding\n    // to its type is called with the parsed_barcode as a parameter.\n    // (parsed_barcode is the result of parse_barcode(barcode))\n    //\n    // callbacks is a Map of 'actions' : callback(parsed_barcode)\n    // that sets the callback for each action. if a callback for the\n    // specified action already exists, it is replaced.\n    //\n    // possible actions include :\n    // 'product' | 'cashier' | 'client' | 'discount'\n    set_action_callback: function (name, callback) {\n        if (this.action_callbacks[name]) {\n            this.action_callbacks[name].add(callback);\n        } else {\n            this.action_callbacks[name] = new Set([callback]);\n        }\n    },\n\n    remove_action_callback: function(name, callback) {\n        if (!callback) {\n            delete this.action_callbacks[name];\n            return;\n        }\n        const callbacks = this.action_callbacks[name];\n        if (callbacks) {\n            callbacks.delete(callback);\n            if (callbacks.size === 0) {\n                delete this.action_callbacks[name];\n            }\n        }\n    },\n\n    /**\n     * Allow setting of exclusive callbacks. If there are exclusive callbacks,\n     * these callbacks are called neglecting the regular callbacks. This is\n     * useful for rendered Components that wants to take exclusive access\n     * to the barcode reader.\n     *\n     * @param {String} name\n     * @param {Function} callback function that takes parsed barcode\n     */\n    set_exclusive_callback: function (name, callback) {\n        if (this.exclusive_callbacks[name]) {\n            this.exclusive_callbacks[name].add(callback);\n        } else {\n            this.exclusive_callbacks[name] = new Set([callback]);\n        }\n    },\n\n    remove_exclusive_callback: function (name, callback) {\n        if (!callback) {\n            delete this.exclusive_callbacks[name];\n            return;\n        }\n        const callbacks = this.exclusive_callbacks[name];\n        if (callbacks) {\n            callbacks.delete(callback);\n            if (callbacks.size === 0) {\n                delete this.exclusive_callbacks[name];\n            }\n        }\n    },\n\n    scan: async function (code) {\n        if (!code) return;\n\n        const callbacks = Object.keys(this.exclusive_callbacks).length\n            ? this.exclusive_callbacks\n            : this.action_callbacks;\n        let parsed_results = this.barcode_parser.parse_barcode(code);\n        if (! Array.isArray(parsed_results)) {\n            parsed_results = [parsed_results];\n        }\n        for (const parsed_result of parsed_results) {\n            if (callbacks[parsed_result.type]) {\n                for (const cb of callbacks[parsed_result.type]) {\n                    await cb(parsed_result);\n                }\n            } else if (callbacks.error) {\n                [...callbacks.error].map(cb => cb(parsed_result));\n            } else {\n                console.warn('Ignored Barcode Scan:', parsed_result);\n            }\n        }\n    },\n\n    // the barcode scanner will listen on the hw_proxy/scanner interface for\n    // scan events until disconnect_from_proxy is called\n    connect_to_proxy: function () {\n        var self = this;\n        this.remote_scanning = true;\n        if (this.remote_active >= 1) {\n            return;\n        }\n        this.remote_active = 1;\n\n        function waitforbarcode(){\n            return self.proxy.connection.rpc('/hw_proxy/scanner',{},{shadow: true, timeout:7500})\n                .then(function (barcode) {\n                    if (!self.remote_scanning) {\n                        self.remote_active = 0;\n                        return;\n                    }\n                    self.scan(barcode);\n                    waitforbarcode();\n                },\n                function () {\n                    if (!self.remote_scanning) {\n                        self.remote_active = 0;\n                        return;\n                    }\n                    waitforbarcode();\n                });\n        }\n        waitforbarcode();\n    },\n\n    // the barcode scanner will stop listening on the hw_proxy/scanner remote interface\n    disconnect_from_proxy: function () {\n        this.remote_scanning = false;\n    },\n});\n\nreturn BarcodeReader;\n\n});\n", "/* global html2canvas */\nodoo.define('point_of_sale.Printer', function (require) {\n\"use strict\";\n\nvar Session = require('web.Session');\nvar core = require('web.core');\nconst { Gui } = require('point_of_sale.Gui');\nvar _t = core._t;\n\n// IMPROVEMENT: This is too much. We can get away from this class.\nclass PrintResult {\n    constructor({ successful, message }) {\n        this.successful = successful;\n        this.message = message;\n    }\n}\n\nclass PrintResultGenerator {\n    IoTActionError() {\n        return new PrintResult({\n            successful: false,\n            message: {\n                title: _t('Connection to IoT Box failed'),\n                body: _t('Please check if the IoT Box is still connected.'),\n            },\n        });\n    }\n    IoTResultError() {\n        return new PrintResult({\n            successful: false,\n            message: {\n                title: _t('Connection to the printer failed'),\n                body: _t('Please check if the printer is still connected.'),\n            },\n        });\n    }\n    Successful() {\n        return new PrintResult({\n            successful: true,\n        });\n    }\n}\n\nvar PrinterMixin = {\n    init: function (pos) {\n        this.receipt_queue = [];\n        this.printResultGenerator = new PrintResultGenerator();\n        this.pos = pos;\n    },\n\n    /**\n     * Add the receipt to the queue of receipts to be printed and process it.\n     * We clear the print queue if printing is not successful.\n     * @param {String} receipt: The receipt to be printed, in HTML\n     * @returns {PrintResult}\n     */\n    print_receipt: async function(receipt) {\n        if (receipt) {\n            this.receipt_queue.push(receipt);\n        }\n        let image, sendPrintResult;\n        while (this.receipt_queue.length > 0) {\n            receipt = this.receipt_queue.shift();\n            image = await this.htmlToImg(receipt);\n            try {\n                sendPrintResult = await this.send_printing_job(image);\n            } catch (error) {\n                // Error in communicating to the IoT box.\n                this.receipt_queue.length = 0;\n                return this.printResultGenerator.IoTActionError();\n            }\n            // rpc call is okay but printing failed because\n            // IoT box can't find a printer.\n            if (!sendPrintResult || sendPrintResult.result === false) {\n                this.receipt_queue.length = 0;\n                return this.printResultGenerator.IoTResultError();\n            }\n        }\n        return this.printResultGenerator.Successful();\n    },\n\n    /**\n     * Generate a jpeg image from a canvas\n     * @param {DOMElement} canvas\n     */\n    process_canvas: function (canvas) {\n        return canvas.toDataURL('image/jpeg').replace('data:image/jpeg;base64,','');\n    },\n\n    /**\n     * Renders the html as an image to print it\n     * @param {String} receipt: The receipt to be printed, in HTML\n     */\n    htmlToImg: function (receipt) {\n        var self = this;\n        $('.pos-receipt-print').html(receipt);\n        var promise = new Promise(function (resolve, reject) {\n            self.receipt = $('.pos-receipt-print>.pos-receipt');\n            html2canvas(self.receipt[0], {\n                onparsed: function(queue) {\n                    queue.stack.ctx.height = Math.ceil(self.receipt.outerHeight() + self.receipt.offset().top);\n                    queue.stack.ctx.width = Math.ceil(self.receipt.outerWidth() + self.receipt.offset().left);\n                },\n                onrendered: function (canvas) {\n                    $('.pos-receipt-print').empty();\n                    resolve(self.process_canvas(canvas));\n                },\n                letterRendering: self.pos.htmlToImgLetterRendering(),\n            })\n        });\n        return promise;\n    },\n\n    _onIoTActionResult: function (data){\n        if (this.pos && (data === false || data.result === false)) {\n            Gui.showPopup('ErrorPopup',{\n                'title': _t('Connection to the printer failed'),\n                'body':  _t('Please check if the printer is still connected.'),\n            });\n        }\n    },\n\n    _onIoTActionFail: function () {\n        if (this.pos) {\n            Gui.showPopup('ErrorPopup',{\n                'title': _t('Connection to IoT Box failed'),\n                'body':  _t('Please check if the IoT Box is still connected.'),\n            });\n        }\n    },\n}\n\nvar Printer = core.Class.extend(PrinterMixin, {\n    init: function (url, pos) {\n        PrinterMixin.init.call(this, pos);\n        this.connection = new Session(undefined, url || 'http://localhost:8069', { use_cors: true});\n    },\n\n    /**\n     * Sends a command to the connected proxy to open the cashbox\n     * (the physical box where you store the cash). Updates the status of\n     * the printer with the answer from the proxy.\n     */\n    open_cashbox: function () {\n        var self = this;\n        return this.connection.rpc('/hw_proxy/default_printer_action', {\n            data: {\n                action: 'cashbox'\n            }\n        }).then(self._onIoTActionResult.bind(self))\n            .guardedCatch(self._onIoTActionFail.bind(self));\n    },\n\n    /**\n     * Sends the printing command the connected proxy\n     * @param {String} img : The receipt to be printed, as an image\n     */\n    send_printing_job: function (img) {\n        return this.connection.rpc('/hw_proxy/default_printer_action', {\n            data: {\n                action: 'print_receipt',\n                receipt: img,\n            }\n        });\n    },\n});\n\nreturn {\n    PrinterMixin: PrinterMixin,\n    Printer: Printer,\n    PrintResult,\n    PrintResultGenerator,\n}\n});\n", "odoo.define('point_of_sale.Gui', function (require) {\n    'use strict';\n\n    /**\n     * This module bridges the data classes (such as those defined in\n     * models.js) to the view (owl.Component) but not vice versa.\n     *\n     * The idea is to be able to perform side-effects to the user interface\n     * during calculation. Think of console.log during times we want to see\n     * the result of calculations. This is no different, except that instead\n     * of printing something in the console, we access a method in the user\n     * interface then the user interface reacts, e.g. calling `showPopup`.\n     *\n     * This however can be dangerous to the user interface as it can be possible\n     * that a rendered component is destroyed during the calculation. Because of\n     * this, we are going to limit external ui controls to those safe ones to\n     * use such as:\n     *  - `showPopup`\n     *  - `showTempScreen`\n     *\n     * IMPROVEMENT: After all, this Gui layer seems to be a good abstraction because\n     * there is a complete decoupling between data and view despite the data being\n     * able to use selected functionalities in the view layer. More formalized\n     * implementation is welcome.\n     */\n\n    const config = {};\n\n    /**\n     * Call this when the user interface is ready. Provide the component\n     * that will be used to control the ui.\n     * @param {owl.component} component component having the ui methods.\n     */\n    const configureGui = ({ component }) => {\n        config.component = component;\n        config.availableMethods = new Set([\n            'showPopup',\n            'showTempScreen',\n            'playSound',\n            'setSyncStatus',\n            'showNotification',\n        ]);\n    };\n\n    /**\n     * Import this and consume like so: `Gui.showPopup(<PopupName>, <props>)`.\n     * Like you would call `showPopup` in a component.\n     */\n    const Gui = new Proxy(config, {\n        get(target, key) {\n            const { component, availableMethods } = target;\n            if (!component) throw new Error(`Call 'configureGui' before using Gui.`);\n            const isMounted = component.__owl__.status === 3 /* mounted */;\n            if (availableMethods.has(key) && isMounted) {\n                return component[key].bind(component);\n            }\n        },\n    });\n\n    return { configureGui, Gui };\n});\n", "odoo.define('point_of_sale.PopupControllerMixin', function(require) {\n    'use strict';\n\n    const { useState } = owl;\n    const { useListener } = require('web.custom_hooks');\n\n    /**\n     * Allows the component declared with this mixin the ability show popup dynamically,\n     * provided the following:\n     *  1. The following element is declared in the template. It is where the Popup will be rendered.\n     *     `<t t-if=\"popup.isShown\" t-component=\"popup.component\" t-props=\"popupProps\" t-key=\"popup.name\" />`\n     *  2. The component should trigger `show-popup` event to show the popup and `close-popup` event\n     *     to close. In PosComponent, `showPopup` is conveniently declared to satisfy this requirement.\n     * @param {Function} x class definition to mix with during extension\n     */\n    const PopupControllerMixin = x =>\n        class extends x {\n            constructor() {\n                super(...arguments);\n                useListener('show-popup', this.__showPopup);\n                useListener('close-popup', this.__closePopup);\n\n                this.popup = useState({ isShown: false, name: null, component: null });\n                this.popupProps = {}; // We want to avoid making the props to become Proxy!\n            }\n            __showPopup(event) {\n                const { name, props, resolve } = event.detail;\n                const popupConstructor = this.constructor.components[name];\n                if (popupConstructor.dontShow) {\n                    resolve();\n                    return;\n                }\n                this.popup.isShown = true;\n                this.popup.name = name;\n                this.popup.component = popupConstructor;\n                this.popupProps = Object.assign({}, props, { resolve });\n            }\n            __closePopup() {\n                this.popup.isShown = false;\n            }\n        };\n\n    return PopupControllerMixin;\n});\n", "odoo.define('point_of_sale.ControlButtonsMixin', function (require) {\n    'use strict';\n\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * Component that has this mixin allows the use of `addControlButton`.\n     * All added control buttons that satisfies the condition can be accessed\n     * thru the `controlButtons` field of the Component's instance. These\n     * control buttons can then be rendered in the Component.\n     * @param {Function} x superclass\n     */\n    const ControlButtonsMixin = (x) => {\n        class Extended extends x {\n            get controlButtons() {\n                return this.constructor.controlButtons\n                    .filter((cb) => {\n                        return cb.condition.bind(this)();\n                    })\n                    .map((cb) =>\n                        Object.assign({}, cb, { component: Registries.Component.get(cb.component) })\n                    );\n            }\n        }\n        Extended.controlButtons = [];\n        /**\n         * @param {Object} controlButton\n         * @param {Function} controlButton.component\n         *      Base class that is added in the Registries.Component.\n         * @param {Function} controlButton.condition zero argument function that is bound\n         *      to the instance of ProductScreen, such that `this.env.pos` can be used\n         *      inside the function.\n         * @param {Array} [controlButton.position] array of two elements\n         *      [locator, relativeTo]\n         *      locator: string -> any of ('before', 'after', 'replace')\n         *      relativeTo: string -> other controlButtons component name\n         */\n        Extended.addControlButton = function (controlButton) {\n            // We set the name first.\n            if (!controlButton.name) {\n                controlButton.name = controlButton.component.name;\n            }\n\n            // If no position is set, we just push it to the array.\n            if (!controlButton.position) {\n                this.controlButtons.push(controlButton);\n            } else {\n                // Find where to put the new controlButton.\n                const [locator, relativeTo] = controlButton.position;\n                let whereIndex = -1;\n                for (let i = 0; i < this.controlButtons.length; i++) {\n                    if (this.controlButtons[i].name === relativeTo) {\n                        if (['before', 'replace'].includes(locator)) {\n                            whereIndex = i;\n                        } else if (locator === 'after') {\n                            whereIndex = i + 1;\n                        }\n                        break;\n                    }\n                }\n\n                // If found where to put, then perform the necessary mutation of\n                // the buttons array.\n                // Else, we just push this controlButton to the array.\n                if (whereIndex > -1) {\n                    this.controlButtons.splice(\n                        whereIndex,\n                        locator === 'replace' ? 1 : 0,\n                        controlButton\n                    );\n                } else {\n                    let warningMessage =\n                        `'${controlButton.name}' has invalid 'position' ([${locator}, ${relativeTo}]).` +\n                        'It is pushed to the controlButtons stack instead.';\n                    console.warn(warningMessage);\n                    this.controlButtons.push(controlButton);\n                }\n            }\n        };\n        return Extended;\n    };\n\n    return ControlButtonsMixin;\n});\n", "odoo.define('point_of_sale.Chrome', function(require) {\n    'use strict';\n\n    const { useState, useRef, useContext, useExternalListener } = owl.hooks;\n    const { debounce } = owl.utils;\n    const { loadCSS } = require('web.ajax');\n    const { useListener } = require('web.custom_hooks');\n    const { BarcodeEvents } = require('barcodes.BarcodeEvents');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const PopupControllerMixin = require('point_of_sale.PopupControllerMixin');\n    const Registries = require('point_of_sale.Registries');\n    const IndependentToOrderScreen = require('point_of_sale.IndependentToOrderScreen');\n    const contexts = require('point_of_sale.PosContext');\n    const { identifyError, posbus } = require('point_of_sale.utils');\n    const { odooExceptionTitleMap } = require(\"@web/core/errors/error_dialogs\");\n    const { ConnectionLostError, ConnectionAbortedError, RPCError } = require('@web/core/network/rpc_service');\n    const { useBus } = require(\"@web/core/utils/hooks\");\n\n    // This is kind of a trick.\n    // We get a reference to the whole exports so that\n    // when we create an instance of one of the classes,\n    // we instantiate the extended one.\n    const models = require('point_of_sale.models');\n\n    /**\n     * Chrome is the root component of the PoS App.\n     */\n    class Chrome extends PopupControllerMixin(PosComponent) {\n        constructor() {\n            super(...arguments);\n            useExternalListener(window, 'beforeunload', this._onBeforeUnload);\n            useListener('show-main-screen', this.__showScreen);\n            useListener('toggle-debug-widget', debounce(this._toggleDebugWidget, 100));\n            useListener('toggle-mobile-searchbar', this._toggleMobileSearchBar);\n            useListener('show-temp-screen', this.__showTempScreen);\n            useListener('close-temp-screen', this.__closeTempScreen);\n            useListener('close-pos', this._closePos);\n            useListener('loading-skip-callback', () => this._loadingSkipCallback());\n            useListener('play-sound', this._onPlaySound);\n            useListener('set-sync-status', this._onSetSyncStatus);\n            useListener('show-notification', this._onShowNotification);\n            useListener('close-notification', this._onCloseNotification);\n            useBus(posbus, 'start-cash-control', this.openCashControl);\n            NumberBuffer.activate();\n\n            this.chromeContext = useContext(contexts.chrome);\n\n            this.state = useState({\n                uiState: 'LOADING', // 'LOADING' | 'READY' | 'CLOSING'\n                debugWidgetIsShown: true,\n                mobileSearchBarIsShown: false,\n                hasBigScrollBars: false,\n                sound: { src: null },\n                notification: {\n                    isShown: false,\n                    message: '',\n                    duration: 2000,\n                }\n            });\n\n            this.loading = useState({\n                message: 'Loading',\n                skipButtonIsShown: false,\n            });\n\n            this.mainScreen = useState({ name: null, component: null });\n            this.mainScreenProps = {};\n\n            this.tempScreen = useState({ isShown: false, name: null, component: null });\n            this.tempScreenProps = {};\n\n            this.progressbar = useRef('progressbar');\n\n            this.previous_touch_y_coordinate = -1;\n        }\n\n        // OVERLOADED METHODS //\n\n        mounted() {\n            // remove default webclient handlers that induce click delay\n            $(document).off();\n            $(window).off();\n            $('html').off();\n            $('body').off();\n            // The above lines removed the bindings, but we really need them for the barcode\n            BarcodeEvents.start();\n        }\n        willUnmount() {\n            BarcodeEvents.stop();\n        }\n        destroy() {\n            super.destroy(...arguments);\n            this.env.pos.destroy();\n        }\n        catchError(error) {\n            console.error(error);\n        }\n\n        // GETTERS //\n\n        get clientScreenButtonIsShown() {\n            return this.env.pos.config.iface_customer_facing_display;\n        }\n\n        /**\n         * Used to give the `state.mobileSearchBarIsShown` value to main screen props\n         */\n        get mainScreenPropsFielded() {\n            return Object.assign({}, this.mainScreenProps, {\n                mobileSearchBarIsShown: this.state.mobileSearchBarIsShown,\n            });\n        }\n\n        /**\n         * Startup screen can be based on pos config so the startup screen\n         * is only determined after pos data is completely loaded.\n         *\n         * NOTE: Wait for pos data to be completed before calling this getter.\n         */\n        get startScreen() {\n            if (this.state.uiState !== 'READY') {\n                console.warn(\n                    `Accessing startScreen of Chrome component before 'state.uiState' to be 'READY' is not recommended.`\n                );\n            }\n            return { name: 'ProductScreen' };\n        }\n\n        // CONTROL METHODS //\n\n        /**\n         * Call this function after the Chrome component is mounted.\n         * This will load pos and assign it to the environment.\n         */\n        async start() {\n            try {\n                // Instead of passing chrome to the instantiation the PosModel,\n                // we inject functions needed by pos.\n                // This way, we somehow decoupled Chrome from PosModel.\n                // We can then test PosModel independently from Chrome by supplying\n                // mocked version of these default attributes.\n                const posModelDefaultAttributes = {\n                    env: this.env,\n                    rpc: this.rpc.bind(this),\n                    session: this.env.session,\n                    do_action: this.props.webClient.do_action.bind(this.props.webClient),\n                    setLoadingMessage: this.setLoadingMessage.bind(this),\n                    showLoadingSkip: this.showLoadingSkip.bind(this),\n                    setLoadingProgress: this.setLoadingProgress.bind(this),\n                };\n                this.env.pos = new models.PosModel(posModelDefaultAttributes);\n                await this.env.pos.ready;\n                // Load the saved `env.pos.toRefundLines` from localStorage when\n                // the PosModel is ready.\n                Object.assign(this.env.pos.toRefundLines, this.env.pos.db.load('TO_REFUND_LINES') || {});\n                this._buildChrome();\n                this._closeOtherTabs();\n                this.env.pos.set(\n                    'selectedCategoryId',\n                    this.env.pos.config.iface_start_categ_id\n                        ? this.env.pos.config.iface_start_categ_id[0]\n                        : 0\n                );\n                this.state.uiState = 'READY';\n                this.env.pos.on('change:selectedOrder', this._showSavedScreen, this);\n                this._showStartScreen();\n                if (_.isEmpty(this.env.pos.db.product_by_category_id)) {\n                    this._loadDemoData();\n                }\n                setTimeout(() => {\n                    // push order in the background, no need to await\n                    this.env.pos.push_orders();\n                    // Allow using the app even if not all the images are loaded.\n                    // Basically, preload the images in the background.\n                    this._preloadImages();\n                });\n            } catch (error) {\n                let title = 'Unknown Error',\n                    body;\n\n                if (error.message && [100, 200, 404, -32098].includes(error.message.code)) {\n                    // this is the signature of rpc error\n                    if (error.message.code === -32098) {\n                        title = 'Network Failure (XmlHttpRequestError)';\n                        body =\n                            'The Point of Sale could not be loaded due to a network problem.\\n' +\n                            'Please check your internet connection.';\n                    } else if (error.message.code === 200) {\n                        title = error.message.data.message || this.env._t('Server Error');\n                        body =\n                            error.message.data.debug ||\n                            this.env._t(\n                                'The server encountered an error while receiving your order.'\n                            );\n                    }\n                } else if (error instanceof Error) {\n                    title = error.message;\n                    body = error.stack;\n                }\n\n                await this.showPopup('ErrorTracebackPopup', {\n                    title,\n                    body,\n                    exitButtonIsShown: true,\n                });\n            }\n        }\n\n        openCashControl() {\n            if (this.shouldShowCashControl()) {\n                this.showPopup('CashOpeningPopup', { notEscapable: true });\n            }\n        }\n\n        shouldShowCashControl() {\n            return this.env.pos.config.cash_control && this.env.pos.pos_session.state == 'opening_control';\n        }\n\n        // EVENT HANDLERS //\n\n        _showStartScreen() {\n            const { name, props } = this.startScreen;\n            this.showScreen(name, props);\n        }\n        /**\n         * Show the screen saved in the order when the `selectedOrder` of pos is changed.\n         * @param {models.PosModel} pos\n         * @param {models.Order} newSelectedOrder\n         */\n        _showSavedScreen(pos, newSelectedOrder) {\n            const { name, props } = this._getSavedScreen(newSelectedOrder);\n            this.showScreen(name, props);\n        }\n        _getSavedScreen(order) {\n            return order.get_screen_data();\n        }\n        __showTempScreen(event) {\n            const { name, props, resolve } = event.detail;\n            this.tempScreen.isShown = true;\n            this.tempScreen.name = name;\n            this.tempScreen.component = this.constructor.components[name];\n            this.tempScreenProps = Object.assign({}, props, { resolve });\n        }\n        __closeTempScreen() {\n            this.tempScreen.isShown = false;\n        }\n        __showScreen({ detail: { name, props = {} } }) {\n            const component = this.constructor.components[name];\n            // 1. Set the information of the screen to display.\n            this.mainScreen.name = name;\n            this.mainScreen.component = component;\n            this.mainScreenProps = props;\n\n            // 2. Set some options\n            this.chromeContext.showOrderSelector = !component.hideOrderSelector;\n\n            // 3. Save the screen to the order.\n            //  - This screen is shown when the order is selected.\n            if (!(component.prototype instanceof IndependentToOrderScreen) && name !== \"ReprintReceiptScreen\") {\n                this._setScreenData(name, props);\n            }\n        }\n        /**\n         * Set the latest screen to the current order. This is done so that\n         * when the order is selected again, the ui returns to the latest screen\n         * saved in the order.\n         *\n         * @param {string} name Screen name\n         * @param {Object} props props for the Screen component\n         */\n        _setScreenData(name, props) {\n            const order = this.env.pos.get_order();\n            if (order) {\n                order.set_screen_data({ name, props });\n            }\n        }\n        async _closePos() {\n            // If pos is not properly loaded, we just go back to /web without\n            // doing anything in the order data.\n            if (!this.env.pos || this.env.pos.db.get_orders().length === 0) {\n                window.location = '/web#action=point_of_sale.action_client_pos_menu';\n            }\n\n            if (this.env.pos.db.get_orders().length) {\n                // If there are orders in the db left unsynced, we try to sync.\n                // If sync successful, close without asking.\n                // Otherwise, ask again saying that some orders are not yet synced.\n                try {\n                    await this.env.pos.push_orders();\n                    window.location = '/web#action=point_of_sale.action_client_pos_menu';\n                } catch (error) {\n                    console.warn(error);\n                    const reason = this.env.pos.get('failed')\n                        ? this.env._t(\n                              'Some orders could not be submitted to ' +\n                                  'the server due to configuration errors. ' +\n                                  'You can exit the Point of Sale, but do ' +\n                                  'not close the session before the issue ' +\n                                  'has been resolved.'\n                          )\n                        : this.env._t(\n                              'Some orders could not be submitted to ' +\n                                  'the server due to internet connection issues. ' +\n                                  'You can exit the Point of Sale, but do ' +\n                                  'not close the session before the issue ' +\n                                  'has been resolved.'\n                          );\n                    const { confirmed } = await this.showPopup('ConfirmPopup', {\n                        title: this.env._t('Offline Orders'),\n                        body: reason,\n                    });\n                    if (confirmed) {\n                        this.state.uiState = 'CLOSING';\n                        this.loading.skipButtonIsShown = false;\n                        this.setLoadingMessage(this.env._t('Closing ...'));\n                        window.location = '/web#action=point_of_sale.action_client_pos_menu';\n                    }\n                }\n            }\n        }\n        _toggleDebugWidget() {\n            this.state.debugWidgetIsShown = !this.state.debugWidgetIsShown;\n        }\n        _toggleMobileSearchBar({ detail: isSearchBarEnabled }) {\n            if (isSearchBarEnabled !== null) {\n                this.state.mobileSearchBarIsShown = isSearchBarEnabled;\n            } else {\n                this.state.mobileSearchBarIsShown = !this.state.mobileSearchBarIsShown;\n            }\n        }\n        _onPlaySound({ detail: name }) {\n            let src;\n            if (name === 'error') {\n                src = \"/point_of_sale/static/src/sounds/error.wav\";\n            } else if (name === 'bell') {\n                src = \"/point_of_sale/static/src/sounds/bell.wav\";\n            }\n            this.state.sound.src = src;\n        }\n        _onSetSyncStatus({ detail: { status, pending }}) {\n            this.env.pos.set('synch', { status, pending });\n        }\n        _onShowNotification({ detail: { message, duration } }) {\n            this.state.notification.isShown = true;\n            this.state.notification.message = message;\n            this.state.notification.duration = duration;\n        }\n        _onCloseNotification() {\n            this.state.notification.isShown = false;\n            this.state.notification.message = '';\n        }\n        /**\n         * Save `env.pos.toRefundLines` in localStorage on beforeunload - closing the\n         * browser, reloading or going to other page.\n         */\n        _onBeforeUnload() {\n            this.env.pos.db.save('TO_REFUND_LINES', this.env.pos.toRefundLines);\n        }\n\n        // TO PASS AS PARAMETERS //\n\n        setLoadingProgress(fac) {\n            if (this.progressbar.el) {\n                this.progressbar.el.style.width = `${Math.floor(fac * 100)}%`;\n            }\n        }\n        setLoadingMessage(msg, progress) {\n            this.loading.message = msg;\n            if (typeof progress !== 'undefined') {\n                this.setLoadingProgress(progress);\n            }\n        }\n        /**\n         * Show Skip button in the loading screen and allow to assign callback\n         * when the button is pressed.\n         *\n         * @param {Function} callback function to call when Skip button is pressed.\n         */\n        showLoadingSkip(callback) {\n            if (callback) {\n                this.loading.skipButtonIsShown = true;\n                this._loadingSkipCallback = callback;\n            }\n        }\n\n        get isTicketScreenShown() {\n            return this.mainScreen.name === 'TicketScreen';\n        }\n\n        // MISC METHODS //\n\n        async _loadDemoData() {\n            const { confirmed } = await this.showPopup('ConfirmPopup', {\n                title: this.env._t('You do not have any products'),\n                body: this.env._t(\n                    'Would you like to load demo data?'\n                ),\n                confirmText: this.env._t('Yes'),\n                cancelText: this.env._t('No')\n            });\n            if (confirmed) {\n                await this.rpc({\n                    'route': '/pos/load_onboarding_data',\n                });\n                this.env.pos.load_server_data();\n            }\n        }\n\n        _preloadImages() {\n            for (let product of this.env.pos.db.get_product_by_category(0)) {\n                const image = new Image();\n                image.src = `/web/image?model=product.product&field=image_128&id=${product.id}&write_date=${product.write_date}&unique=1`;\n            }\n            for (let category of Object.values(this.env.pos.db.category_by_id)) {\n                if (category.id == 0) continue;\n                const image = new Image();\n                image.src = `/web/image?model=pos.category&field=image_128&id=${category.id}&write_date=${category.write_date}&unique=1`;\n            }\n            const staticImages = ['backspace.png', 'bc-arrow-big.png'];\n            for (let imageName of staticImages) {\n                const image = new Image();\n                image.src = `/point_of_sale/static/src/img/${imageName}`;\n            }\n        }\n\n        _buildChrome() {\n            if ($.browser.chrome) {\n                var chrome_version = $.browser.version.split('.')[0];\n                if (parseInt(chrome_version, 10) >= 50) {\n                    loadCSS('/point_of_sale/static/src/css/chrome50.css');\n                }\n            }\n\n            if (this.env.pos.config.iface_big_scrollbars) {\n                this.state.hasBigScrollBars = true;\n            }\n\n            this._disableBackspaceBack();\n        }\n        // prevent backspace from performing a 'back' navigation\n        _disableBackspaceBack() {\n            $(document).on('keydown', function (e) {\n                if (e.which === 8 && !$(e.target).is('input, textarea')) {\n                    e.preventDefault();\n                }\n            });\n        }\n        _closeOtherTabs() {\n            localStorage['message'] = '';\n            localStorage['message'] = JSON.stringify({\n                message: 'close_tabs',\n                session: this.env.pos.pos_session.id,\n            });\n\n            window.addEventListener(\n                'storage',\n                (event) => {\n                    if (event.key === 'message' && event.newValue) {\n                        const msg = JSON.parse(event.newValue);\n                        if (\n                            msg.message === 'close_tabs' &&\n                            msg.session == this.env.pos.pos_session.id\n                        ) {\n                            console.info(\n                                'POS / Session opened in another window. EXITING POS'\n                            );\n                            this._closePos();\n                        }\n                    }\n                },\n                false\n            );\n        }\n        showCashMoveButton() {\n            return this.env.pos && this.env.pos.config && this.env.pos.config.cash_control;\n        }\n\n        // UNEXPECTED ERROR HANDLING //\n\n        /**\n         * This method is used to handle unexpected errors. It is registered to\n         * the `error_handlers` service when this component is properly mounted.\n         * See `onMounted` hook of the `ChromeAdapter` component.\n         * @param {*} env\n         * @param {UncaughtClientError | UncaughtPromiseError} error\n         * @param {*} originalError\n         * @returns {boolean}\n         */\n        errorHandler(env, error, originalError) {\n            if (!env.pos) return false;\n            const errorToHandle = identifyError(originalError);\n            // Assume that the unhandled falsey rejections can be ignored.\n            if (errorToHandle) {\n                this._errorHandler(error, errorToHandle);\n            }\n            return true;\n        }\n\n        _errorHandler(error, errorToHandle) {\n            if (errorToHandle instanceof RPCError) {\n                const { message, data } = errorToHandle;\n                if (odooExceptionTitleMap.has(errorToHandle.exceptionName)) {\n                    const title = odooExceptionTitleMap.get(errorToHandle.exceptionName).toString();\n                    this.showPopup('ErrorPopup', { title, body: data.message });\n                } else {\n                    this.showPopup('ErrorTracebackPopup', {\n                        title: message,\n                        body: data.message + '\\n' + data.debug + '\\n',\n                    });\n                }\n            } else if (errorToHandle instanceof ConnectionLostError) {\n                this.showPopup('OfflineErrorPopup', {\n                    title: this.env._t('Connection is lost'),\n                    body: this.env._t('Check the internet connection then try again.'),\n                });\n            } else if (errorToHandle instanceof ConnectionAbortedError) {\n                this.showPopup('OfflineErrorPopup', {\n                    title: this.env._t('Connection is aborted'),\n                    body: this.env._t('Check the internet connection then try again.'),\n                });\n            } else if (errorToHandle instanceof Error) {\n                // If `errorToHandle` is a normal Error (such as TypeError),\n                // the annotated traceback can be found from `error`.\n                this.showPopup('ErrorTracebackPopup', {\n                    // Hopefully the message is translated.\n                    title: `${errorToHandle.name}: ${errorToHandle.message}`,\n                    body: error.traceback,\n                });\n            } else {\n                // Hey developer. It's your fault that the error reach here.\n                // Please, throw an Error object in order to get stack trace of the error.\n                // At least we can find the file that throws the error when you look\n                // at the console.\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Unknown Error'),\n                    body: this.env._t('Unable to show information about this error.'),\n                });\n                console.error('Unknown error. Unable to show information about this error.', errorToHandle);\n            }\n        }\n    }\n    Chrome.template = 'Chrome';\n\n    Registries.Component.add(Chrome);\n\n    return Chrome;\n});\n", "odoo.define('point_of_sale.devices', function (require) {\n\"use strict\";\n\nvar core = require('web.core');\nvar mixins = require('web.mixins');\nvar Session = require('web.Session');\nvar Printer = require('point_of_sale.Printer').Printer;\n\n// the JobQueue schedules a sequence of 'jobs'. each job is\n// a function returning a promise. The queue waits for each job to finish\n// before launching the next. Each job can also be scheduled with a delay.\n// the  is used to prevent parallel requests to the proxy.\n\nvar JobQueue = function(){\n    var queue = [];\n    var running = false;\n    var scheduled_end_time = 0;\n    var end_of_queue = Promise.resolve();\n    var stoprepeat = false;\n\n    var run = function () {\n        var runNextJob = function () {\n            if (queue.length === 0) {\n                running = false;\n                scheduled_end_time = 0;\n                return Promise.resolve();\n            }\n            running = true;\n            var job = queue[0];\n            if (!job.opts.repeat || stoprepeat) {\n                queue.shift();\n                stoprepeat = false;\n            }\n\n            // the time scheduled for this job\n            scheduled_end_time = (new Date()).getTime() + (job.opts.duration || 0);\n\n            // we run the job and put in prom when it finishes\n            var prom = job.fun() || Promise.resolve();\n\n            var always = function () {\n                // we run the next job after the scheduled_end_time, even if it finishes before\n                return new Promise(function (resolve, reject) {\n                    setTimeout(\n                        resolve,\n                        Math.max(0, scheduled_end_time - (new Date()).getTime())\n                    );\n                });\n            };\n            // we don't care if a job fails ...\n            return prom.then(always, always).then(runNextJob);\n        };\n\n        if (!running) {\n            end_of_queue = runNextJob();\n        }\n    };\n\n    /**\n     * Adds a job to the schedule.\n     *\n     * @param {function} fun must return a promise\n     * @param {object} [opts]\n     * @param {number} [opts.duration] the job is guaranteed to finish no quicker than this (milisec)\n     * @param {boolean} [opts.repeat] if true, the job will be endlessly repeated\n     * @param {boolean} [opts.important] if true, the scheduled job cannot be canceled by a queue.clear()\n     */\n    this.schedule  = function (fun, opts) {\n        queue.push({fun:fun, opts:opts || {}});\n        if(!running){\n            run();\n        }\n    };\n\n    // remove all jobs from the schedule (except the ones marked as important)\n    this.clear = function(){\n        queue = _.filter(queue,function(job){return job.opts.important === true;});\n    };\n\n    // end the repetition of the current job\n    this.stoprepeat = function(){\n        stoprepeat = true;\n    };\n\n    /**\n     * Returns a promise that resolves when all scheduled jobs have been run.\n     * (jobs added after the call to this method are considered as well)\n     *\n     * @returns {Promise}\n     */\n    this.finished = function () {\n        return end_of_queue;\n    };\n\n};\n\n\n// this object interfaces with the local proxy to communicate to the various hardware devices\n// connected to the Point of Sale. As the communication only goes from the POS to the proxy,\n// methods are used both to signal an event, and to fetch information.\n\nvar ProxyDevice  = core.Class.extend(mixins.PropertiesMixin,{\n    init: function(parent,options){\n        mixins.PropertiesMixin.init.call(this);\n        var self = this;\n        this.setParent(parent);\n        options = options || {};\n\n        this.pos = parent;\n\n        this.weighing = false;\n        this.debug_weight = 0;\n        this.use_debug_weight = false;\n\n        this.paying = false;\n        this.default_payment_status = {\n            status: 'waiting',\n            message: '',\n            payment_method: undefined,\n            receipt_client: undefined,\n            receipt_shop:   undefined,\n        };\n        this.custom_payment_status = this.default_payment_status;\n\n        this.notifications = {};\n        this.bypass_proxy = false;\n\n        this.connection = null;\n        this.host       = '';\n        this.keptalive  = false;\n\n        this.set('status',{});\n\n        this.set_connection_status('disconnected');\n\n        this.on('change:status',this,function(eh,status){\n            status = status.newValue;\n            if(status.status === 'connected' && self.printer) {\n                self.printer.print_receipt();\n            }\n        });\n\n        this.posbox_supports_display = true;\n\n        window.hw_proxy = this;\n    },\n    set_connection_status: function(status, drivers, msg=''){\n        var oldstatus = this.get('status');\n        var newstatus = {};\n        newstatus.status = status;\n        newstatus.drivers = status === 'disconnected' ? {} : oldstatus.drivers;\n        newstatus.drivers = drivers ? drivers : newstatus.drivers;\n        newstatus.msg = msg;\n        this.set('status',newstatus);\n    },\n    disconnect: function(){\n        if(this.get('status').status !== 'disconnected'){\n            this.connection.destroy();\n            this.set_connection_status('disconnected');\n        }\n    },\n\n    /**\n     * Connects to the specified url.\n     *\n     * @param {string} url\n     * @returns {Promise}\n     */\n    connect: function(url){\n        var self = this;\n        this.connection = new Session(undefined,url, { use_cors: true});\n        this.host = url;\n        if (this.pos.config.iface_print_via_proxy) {\n            this.connect_to_printer();\n        }\n        this.set_connection_status('connecting',{});\n\n        return this.message('handshake').then(function(response){\n                if(response){\n                    self.set_connection_status('connected');\n                    localStorage.hw_proxy_url = url;\n                    self.keepalive();\n                }else{\n                    self.set_connection_status('disconnected');\n                    console.error('Connection refused by the Proxy');\n                }\n            },function(){\n                self.set_connection_status('disconnected');\n                console.error('Could not connect to the Proxy');\n            });\n    },\n\n    connect_to_printer: function () {\n        this.printer = new Printer(this.host, this.pos);\n    },\n\n    /**\n     * Find a proxy and connects to it.\n     *\n     * @param {Object} [options]\n     * @param {string} [options.force_ip] only try to connect to the specified ip.\n     * @param {string} [options.port] @see find_proxy\n     * @param {function} [options.progress] @see find_proxy\n     * @returns {Promise}\n     */\n    autoconnect: function (options) {\n        var self = this;\n        this.set_connection_status('connecting',{});\n        if (this.pos.config.iface_print_via_proxy) {\n            this.connect_to_printer();\n        }\n        var found_url = new Promise(function () {});\n\n        if (options.force_ip) {\n            // if the ip is forced by server config, bailout on fail\n            found_url = this.try_hard_to_connect(options.force_ip, options);\n        } else if (localStorage.hw_proxy_url) {\n            // try harder when we remember a good proxy url\n            found_url = this.try_hard_to_connect(localStorage.hw_proxy_url, options)\n                .catch(function () {\n                    if (window.location.protocol != 'https:') {\n                        return self.find_proxy(options);\n                    }\n                });\n        } else {\n            // just find something quick\n            if (window.location.protocol != 'https:'){\n                found_url = this.find_proxy(options);\n            }\n        }\n\n        var successProm = found_url.then(function (url) {\n            return self.connect(url);\n        });\n\n        successProm.catch(function () {\n            self.set_connection_status('disconnected');\n        });\n\n        return successProm;\n    },\n\n    // starts a loop that updates the connection status\n    keepalive: function () {\n        var self = this;\n\n        function status(){\n            var always = function () {\n                setTimeout(status, 5000);\n            };\n            self.connection.rpc('/hw_proxy/status_json',{},{shadow: true, timeout:2500})\n                .then(function (driver_status) {\n                    self.set_connection_status('connected',driver_status);\n                }, function () {\n                    if(self.get('status').status !== 'connecting'){\n                        self.set_connection_status('disconnected');\n                    }\n                }).then(always, always);\n        }\n\n        if (!this.keptalive) {\n            this.keptalive = true;\n            status();\n        }\n    },\n\n    /**\n     * @param {string} name\n     * @param {Object} [params]\n     * @returns {Promise}\n     */\n    message : function (name, params) {\n        var callbacks = this.notifications[name] || [];\n        for (var i = 0; i < callbacks.length; i++) {\n            callbacks[i](params);\n        }\n        if (this.get('status').status !== 'disconnected') {\n            return this.connection.rpc('/hw_proxy/' + name, params || {}, {shadow: true});\n        } else {\n            return Promise.reject();\n        }\n    },\n\n    /**\n     * Tries several time to connect to a known proxy url.\n     *\n     * @param {*} url\n     * @param {Object} [options]\n     * @param {string} [options.port=8069] what port to listen to\n     * @returns {Promise<string|Array>}\n     */\n    try_hard_to_connect: function (url, options) {\n        options   = options || {};\n        var protocol = window.location.protocol;\n        var port = ( !options.port && protocol == \"https:\") ? ':443' : ':' + (options.port || '8069');\n\n        this.set_connection_status('connecting');\n\n        if(url.indexOf('//') < 0){\n            url = protocol + '//' + url;\n        }\n\n        if(url.indexOf(':',5) < 0){\n            url = url + port;\n        }\n\n        // try real hard to connect to url, with a 1sec timeout and up to 'retries' retries\n        function try_real_hard_to_connect(url, retries) {\n            return Promise.resolve(\n                $.ajax({\n                    url: url + '/hw_proxy/hello',\n                    method: 'GET',\n                    timeout: 1000,\n                })\n                .then(function () {\n                    return Promise.resolve(url);\n                }, function (resp) {\n                    if (retries > 0) {\n                        return try_real_hard_to_connect(url, retries-1);\n                    } else {\n                        return Promise.reject([resp.statusText, url]);\n                    }\n                })\n            );\n        }\n\n        return try_real_hard_to_connect(url, 3);\n    },\n\n    /**\n     * Returns as a promise a valid host url that can be used as proxy.\n     *\n     * @param {Object} [options]\n     * @param {string} [options.port] what port to listen to (default 8069)\n     * @param {function} [options.progress] callback for search progress ( fac in [0,1] )\n     * @returns {Promise<string>} will be resolved with the proxy valid url\n     */\n    find_proxy: function(options){\n        options = options || {};\n        var self  = this;\n        var port  = ':' + (options.port || '8069');\n        var urls  = [];\n        var found = false;\n        var parallel = 8;\n        var threads  = [];\n        var progress = 0;\n\n\n        urls.push('http://localhost'+port);\n        for(var i = 0; i < 256; i++){\n            urls.push('http://192.168.0.'+i+port);\n            urls.push('http://192.168.1.'+i+port);\n            urls.push('http://10.0.0.'+i+port);\n        }\n\n        var prog_inc = 1/urls.length;\n\n        function update_progress(){\n            progress = found ? 1 : progress + prog_inc;\n            if(options.progress){\n                options.progress(progress);\n            }\n        }\n\n        function thread () {\n            var url = urls.shift();\n\n            if (!url || found || !self.searching_for_proxy) {\n                return Promise.resolve();\n            }\n\n            return Promise.resolve(\n                $.ajax({\n                    url: url + '/hw_proxy/hello',\n                    method: 'GET',\n                    timeout: 400,\n                }).then(function () {\n                    found = true;\n                    update_progress();\n                    return Promise.resolve(url);\n                }, function () {\n                    update_progress();\n                    return thread();\n                })\n            );\n        }\n\n        this.searching_for_proxy = true;\n\n        var len  = Math.min(parallel, urls.length);\n        for(i = 0; i < len; i++){\n            threads.push(thread());\n        }\n\n        return new Promise(function (resolve, reject) {\n            Promise.all(threads).then(function(results){\n                var urls = [];\n                for(var i = 0; i < results.length; i++){\n                    if(results[i]){\n                        urls.push(results[i]);\n                    }\n                }\n                resolve(urls[0]);\n            });\n        });\n    },\n\n    stop_searching: function(){\n        this.searching_for_proxy = false;\n        this.set_connection_status('disconnected');\n    },\n\n    // this allows the client to be notified when a proxy call is made. The notification\n    // callback will be executed with the same arguments as the proxy call\n    add_notification: function(name, callback){\n        if(!this.notifications[name]){\n            this.notifications[name] = [];\n        }\n        this.notifications[name].push(callback);\n    },\n\n    /**\n     * Returns the weight on the scale.\n     *\n     * @returns {Promise<Object>}\n     */\n    scale_read: function () {\n        var self = this;\n        if (self.use_debug_weight) {\n            return Promise.resolve({weight:this.debug_weight, unit:'Kg', info:'ok'});\n        }\n        return new Promise(function (resolve, reject) {\n            self.message('scale_read',{})\n            .then(function (weight) {\n                resolve(weight);\n            }, function () { //failed to read weight\n                resolve({weight:0.0, unit:'Kg', info:'ok'});\n            });\n        });\n    },\n\n    // sets a custom weight, ignoring the proxy returned value.\n    debug_set_weight: function(kg){\n        this.use_debug_weight = true;\n        this.debug_weight = kg;\n    },\n\n    // resets the custom weight and re-enable listening to the proxy for weight values\n    debug_reset_weight: function(){\n        this.use_debug_weight = false;\n        this.debug_weight = 0;\n    },\n\n    update_customer_facing_display: function(html) {\n        if (this.posbox_supports_display) {\n            return this.message('customer_facing_display',\n                { html: html },\n                { timeout: 5000 });\n        }\n    },\n\n    /**\n     * @param {string} html\n     * @returns {Promise}\n     */\n    take_ownership_over_client_screen: function(html) {\n        return this.message(\"take_control\", { html: html });\n    },\n\n    /**\n     * @returns {Promise}\n     */\n    test_ownership_of_client_screen: function() {\n        if (this.connection) {\n            return this.message(\"test_ownership\", {});\n        }\n        return Promise.reject({abort: true});\n    },\n\n    // asks the proxy to log some information, as with the debug.log you can provide several arguments.\n    log: function(){\n        return this.message('log',{'arguments': _.toArray(arguments)});\n    },\n\n});\n\nreturn {\n    JobQueue: JobQueue,\n    ProxyDevice: ProxyDevice,\n};\n\n});\n", "odoo.define('point_of_sale.PaymentInterface', function (require) {\n\"use strict\";\n\nvar core = require('web.core');\n\n/**\n * Implement this interface to support a new payment method in the POS:\n *\n * var PaymentInterface = require('point_of_sale.PaymentInterface');\n * var MyPayment = PaymentInterface.extend({\n *     ...\n * })\n *\n * To connect the interface to the right payment methods register it:\n *\n * var models = require('point_of_sale.models');\n * models.register_payment_method('my_payment', MyPayment);\n *\n * my_payment is the technical name of the added selection in\n * use_payment_terminal.\n *\n * If necessary new fields can be loaded on any model:\n *\n * models.load_fields('pos.payment.method', ['new_field1', 'new_field2']);\n */\nvar PaymentInterface = core.Class.extend({\n    init: function (pos, payment_method) {\n        this.pos = pos;\n        this.payment_method = payment_method;\n        this.supports_reversals = false;\n    },\n\n    /**\n     * Call this function to enable UI elements that allow a user to\n     * reverse a payment. This requires that you implement\n     * send_payment_reversal.\n     */\n    enable_reversals: function () {\n        this.supports_reversals = true;\n    },\n\n    /**\n     * Called when a user clicks the \"Send\" button in the\n     * interface. This should initiate a payment request and return a\n     * Promise that resolves when the final status of the payment line\n     * is set with set_payment_status.\n     *\n     * For successful transactions set_receipt_info() should be used\n     * to set info that should to be printed on the receipt. You\n     * should also set card_type and transaction_id on the line for\n     * successful transactions.\n     *\n     * @param {string} cid - The id of the paymentline\n     * @returns {Promise} resolved with a boolean that is false when\n     * the payment should be retried. Rejected when the status of the\n     * paymentline will be manually updated.\n     */\n    send_payment_request: function (cid) {},\n\n    /**\n     * Called when a user removes a payment line that's still waiting\n     * on send_payment_request to complete. Should execute some\n     * request to ensure the current payment request is\n     * cancelled. This is not to refund payments, only to cancel\n     * them. The payment line being cancelled will be deleted\n     * automatically after the returned promise resolves.\n     *\n     * @param {} order - The order of the paymentline\n     * @param {string} cid - The id of the paymentline\n     * @returns {Promise}\n     */\n    send_payment_cancel: function (order, cid) {},\n\n    /**\n     * This is an optional method. When implementing this make sure to\n     * call enable_reversals() in the constructor of your\n     * interface. This should reverse a previous payment with status\n     * 'done'. The paymentline will be removed based on returned\n     * Promise.\n     *\n     * @param {string} cid - The id of the paymentline\n     * @returns {Promise} returns true if the reversal was successful.\n     */\n    send_payment_reversal: function (cid) {},\n\n    /**\n     * Called when the payment screen in the POS is closed (by\n     * e.g. clicking the \"Back\" button). Could be used to cancel in\n     * progress payments.\n     */\n    close: function () {},\n});\n\nreturn PaymentInterface;\n});\n", "odoo.define('point_of_sale.custom_hooks', function (require) {\n    'use strict';\n\n    const { Component } = owl;\n    const { onMounted, onPatched, onWillUnmount } = owl.hooks;\n\n    /**\n     * Introduce error handlers in the component.\n     *\n     * IMPROVEMENT: This is a terrible hook. There could be a better way to handle\n     * the error when the order failed to sync.\n     */\n    function useErrorHandlers() {\n        const component = Component.current;\n\n        component._handlePushOrderError = async function (error) {\n            // This error handler receives `error` equivalent to `error.message` of the rpc error.\n            if (error.message === 'Backend Invoice') {\n                await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Please print the invoice from the backend'),\n                    body:\n                        this.env._t(\n                            'The order has been synchronized earlier. Please make the invoice from the backend for the order: '\n                        ) + error.data.order.name,\n                });\n            } else if (error.code < 0) {\n                // XmlHttpRequest Errors\n                const title = this.env._t('Unable to sync order');\n                const body = this.env._t(\n                    'Check the internet connection then try to sync again by clicking on the red wifi button (upper right of the screen).'\n                );\n                await this.showPopup('OfflineErrorPopup', { title, body });\n            } else if (error.code === 200) {\n                // OpenERP Server Errors\n                await this.showPopup('ErrorTracebackPopup', {\n                    title: error.data.message || this.env._t('Server Error'),\n                    body:\n                        error.data.debug ||\n                        this.env._t('The server encountered an error while receiving your order.'),\n                });\n            } else if (error.code === 700) {\n                // Fiscal module errors\n                await this.showPopup('ErrorPopup', {\n                    title: this.env._t('Fiscal data module error'),\n                    body:\n                        error.data.error.status ||\n                        this.env._t('The fiscal data module encountered an error while receiving your order.'),\n                });\n            } else {\n                // ???\n                await this.showPopup('ErrorPopup', {\n                    title: this.env._t('Unknown Error'),\n                    body: this.env._t(\n                        'The order could not be sent to the server due to an unknown error'\n                    ),\n                });\n            }\n        };\n    }\n\n    function useAutoFocusToLast() {\n        const current = Component.current;\n        let target = null;\n        function autofocus() {\n            const prevTarget = target;\n            const allInputs = current.el.querySelectorAll('input');\n            target = allInputs[allInputs.length - 1];\n            if (target && target !== prevTarget) {\n                target.focus();\n                target.selectionStart = target.selectionEnd = target.value.length;\n            }\n        }\n        onMounted(autofocus);\n        onPatched(autofocus);\n    }\n\n    /**\n     * Use this hook when you want to do something on previously selected and\n     * newly selected order when the order changes.\n     *\n     * Normally, a component is rendered then the current order is changed. When\n     * this happens, we want to rerender the component because the new information\n     * should be reflected in the screen. Additionally, we might want to remove listeners\n     * to the previous order and attach listeners to the new one. This hook is\n     * perfect for the described situation.\n     *\n     * Internally, this hook performs the following:\n     * 1. call newOrderCB on mounted\n     * 2. listen to order changes and perform the following sequence:\n     *    - call prevOrderCB(prevOrder)\n     *    - call newOrderCB(newOrder)\n     * 3. call prevOrderCB on willUnmount\n     *\n     * @param {Function} prevOrderCB apply this callback on the previous order\n     * @param {Function} newOrderCB apply this callback on the new order\n     */\n    function onChangeOrder(prevOrderCB, newOrderCB) {\n        const current = Component.current;\n        prevOrderCB = prevOrderCB ? prevOrderCB.bind(current) : () => {};\n        newOrderCB = newOrderCB ? newOrderCB.bind(current) : () => {};\n        onMounted(() => {\n            current.env.pos.on(\n                'change:selectedOrder',\n                async (pos, newOrder) => {\n                    await prevOrderCB(pos.previous('selectedOrder'));\n                    await newOrderCB(newOrder);\n                },\n                current\n            );\n            newOrderCB(current.env.pos.get_order());\n        });\n        onWillUnmount(() => {\n            current.env.pos.off('change:selectedOrder', null, current);\n            prevOrderCB(current.env.pos.get_order());\n        });\n    }\n\n    function useBarcodeReader(callbackMap, exclusive = false) {\n        const current = Component.current;\n        const barcodeReader = current.env.pos.barcode_reader;\n        for (let [key, callback] of Object.entries(callbackMap)) {\n            callbackMap[key] = callback.bind(current);\n        }\n        onMounted(() => {\n            if (barcodeReader) {\n                for (let key in callbackMap) {\n                    if (exclusive) {\n                        barcodeReader.set_exclusive_callback(key, callbackMap[key]);\n                    } else {\n                        barcodeReader.set_action_callback(key, callbackMap[key]);\n                    }\n                }\n            }\n        });\n        onWillUnmount(() => {\n            if (barcodeReader) {\n                for (let key in callbackMap) {\n                    if (exclusive) {\n                        barcodeReader.remove_exclusive_callback(key, callbackMap[key]);\n                    } else {\n                        barcodeReader.remove_action_callback(key, callbackMap[key]);\n                    }\n                }\n            }\n        });\n    }\n\n    return { useErrorHandlers, useAutoFocusToLast, onChangeOrder, useBarcodeReader };\n});\n", "odoo.define('point_of_sale.ProductScreen', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ControlButtonsMixin = require('point_of_sale.ControlButtonsMixin');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n    const { onChangeOrder, useBarcodeReader } = require('point_of_sale.custom_hooks');\n    const { isConnectionError, posbus } = require('point_of_sale.utils');\n    const { useState, onMounted } = owl.hooks;\n    const { parse } = require('web.field_utils');\n\n    class ProductScreen extends ControlButtonsMixin(PosComponent) {\n        constructor() {\n            super(...arguments);\n            useListener('update-selected-orderline', this._updateSelectedOrderline);\n            useListener('new-orderline-selected', this._newOrderlineSelected);\n            useListener('set-numpad-mode', this._setNumpadMode);\n            useListener('click-product', this._clickProduct);\n            useListener('click-customer', this._onClickCustomer);\n            useListener('click-pay', this._onClickPay);\n            useBarcodeReader({\n                product: this._barcodeProductAction,\n                weight: this._barcodeProductAction,\n                price: this._barcodeProductAction,\n                client: this._barcodeClientAction,\n                discount: this._barcodeDiscountAction,\n                error: this._barcodeErrorAction,\n            })\n            onChangeOrder(null, (newOrder) => newOrder && this.render());\n            NumberBuffer.use({\n                nonKeyboardInputEvent: 'numpad-click-input',\n                triggerAtInput: 'update-selected-orderline',\n                useWithBarcode: true,\n            });\n            // Call `reset` when the `onMounted` callback in `NumberBuffer.use` is done.\n            // We don't do this in the `mounted` lifecycle method because it is called before\n            // the callbacks in `onMounted` hook.\n            onMounted(() => NumberBuffer.reset());\n            this.state = useState({\n                numpadMode: 'quantity',\n                mobile_pane: this.props.mobile_pane || 'right',\n            });\n        }\n        mounted() {\n            posbus.trigger('start-cash-control');\n            this.env.pos.on('change:selectedClient', this.render, this);\n        }\n        willUnmount() {\n            this.env.pos.off('change:selectedClient', null, this);\n        }\n        /**\n         * To be overridden by modules that checks availability of\n         * connected scale.\n         * @see _onScaleNotAvailable\n         */\n        get isScaleAvailable() {\n            return true;\n        }\n        get client() {\n            return this.env.pos.get_client();\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n        async _getAddProductOptions(product, base_code) {\n            let price_extra = 0.0;\n            let draftPackLotLines, weight, description, packLotLinesToEdit;\n\n            if (this.env.pos.config.product_configurator && _.some(product.attribute_line_ids, (id) => id in this.env.pos.attributes_by_ptal_id)) {\n                let attributes = _.map(product.attribute_line_ids, (id) => this.env.pos.attributes_by_ptal_id[id])\n                                  .filter((attr) => attr !== undefined);\n                let { confirmed, payload } = await this.showPopup('ProductConfiguratorPopup', {\n                    product: product,\n                    attributes: attributes,\n                });\n\n                if (confirmed) {\n                    description = payload.selected_attributes.join(', ');\n                    price_extra += payload.price_extra;\n                } else {\n                    return;\n                }\n            }\n\n            // Gather lot information if required.\n            if (['serial', 'lot'].includes(product.tracking) && (this.env.pos.picking_type.use_create_lots || this.env.pos.picking_type.use_existing_lots)) {\n                const isAllowOnlyOneLot = product.isAllowOnlyOneLot();\n                if (isAllowOnlyOneLot) {\n                    packLotLinesToEdit = [];\n                } else {\n                    const orderline = this.currentOrder\n                        .get_orderlines()\n                        .filter(line => !line.get_discount())\n                        .find(line => line.product.id === product.id);\n                    if (orderline) {\n                        packLotLinesToEdit = orderline.getPackLotLinesToEdit();\n                    } else {\n                        packLotLinesToEdit = [];\n                    }\n                }\n                const { confirmed, payload } = await this.showPopup('EditListPopup', {\n                    title: this.env._t('Lot/Serial Number(s) Required'),\n                    isSingleItem: isAllowOnlyOneLot,\n                    array: packLotLinesToEdit,\n                });\n                if (confirmed) {\n                    // Segregate the old and new packlot lines\n                    const modifiedPackLotLines = Object.fromEntries(\n                        payload.newArray.filter(item => item.id).map(item => [item.id, item.text])\n                    );\n                    const newPackLotLines = payload.newArray\n                        .filter(item => !item.id)\n                        .map(item => ({ lot_name: item.text }));\n\n                    draftPackLotLines = { modifiedPackLotLines, newPackLotLines };\n                } else {\n                    // We don't proceed on adding product.\n                    return;\n                }\n            }\n\n            // Take the weight if necessary.\n            if (product.to_weight && this.env.pos.config.iface_electronic_scale) {\n                // Show the ScaleScreen to weigh the product.\n                if (this.isScaleAvailable) {\n                    const { confirmed, payload } = await this.showTempScreen('ScaleScreen', {\n                        product,\n                    });\n                    if (confirmed) {\n                        weight = payload.weight;\n                    } else {\n                        // do not add the product;\n                        return;\n                    }\n                } else {\n                    await this._onScaleNotAvailable();\n                }\n            }\n\n            if (base_code && this.env.pos.db.product_packaging_by_barcode[base_code.code]) {\n                weight = this.env.pos.db.product_packaging_by_barcode[base_code.code].qty;\n            }\n\n            return { draftPackLotLines, quantity: weight, description, price_extra };\n        }\n        async _clickProduct(event) {\n            if (!this.currentOrder) {\n                this.env.pos.add_new_order();\n            }\n            const product = event.detail;\n            const options = await this._getAddProductOptions(product);\n            // Do not add product if options is undefined.\n            if (!options) return;\n            // Add the product after having the extra information.\n            this.currentOrder.add_product(product, options);\n            NumberBuffer.reset();\n        }\n        _setNumpadMode(event) {\n            const { mode } = event.detail;\n            NumberBuffer.capture();\n            NumberBuffer.reset();\n            this.state.numpadMode = mode;\n        }\n        async _updateSelectedOrderline(event) {\n            if(this.state.numpadMode === 'quantity' && this.env.pos.disallowLineQuantityChange()) {\n                let order = this.env.pos.get_order();\n                let selectedLine = order.get_selected_orderline();\n                let lastId = order.orderlines.last().cid;\n                let currentQuantity = this.env.pos.get_order().get_selected_orderline().get_quantity();\n\n                if(selectedLine.noDecrease) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Invalid action'),\n                        body: this.env._t('You are not allowed to change this quantity'),\n                    });\n                    return;\n                }\n                const parsedInput = event.detail.buffer && parse.float(event.detail.buffer) || 0;\n                if(lastId != selectedLine.cid)\n                    this._showDecreaseQuantityPopup();\n                else if(currentQuantity < parsedInput)\n                    this._setValue(event.detail.buffer);\n                else if(parsedInput < currentQuantity)\n                    this._showDecreaseQuantityPopup();\n            } else {\n                let { buffer } = event.detail;\n                let val = buffer === null ? 'remove' : buffer;\n                this._setValue(val);\n            }\n        }\n        async _newOrderlineSelected() {\n            NumberBuffer.reset();\n            this.state.numpadMode = 'quantity';\n        }\n        _setValue(val) {\n            if (this.currentOrder.get_selected_orderline()) {\n                if (this.state.numpadMode === 'quantity') {\n                    const result = this.currentOrder.get_selected_orderline().set_quantity(val);\n                    if (!result) NumberBuffer.reset();\n                } else if (this.state.numpadMode === 'discount') {\n                    this.currentOrder.get_selected_orderline().set_discount(val);\n                } else if (this.state.numpadMode === 'price') {\n                    var selected_orderline = this.currentOrder.get_selected_orderline();\n                    selected_orderline.price_manually_set = true;\n                    selected_orderline.set_unit_price(val);\n                }\n                if (this.env.pos.config.iface_customer_facing_display) {\n                    this.env.pos.send_current_order_to_customer_facing_display();\n                }\n            }\n        }\n        async _barcodeProductAction(code) {\n            let product = this.env.pos.db.get_product_by_barcode(code.base_code);\n            if (!product) {\n                // find the barcode in the backend\n                let foundProductIds = [];\n                try {\n                    foundProductIds = await this.rpc({\n                        model: 'product.product',\n                        method: 'search',\n                        args: [[['barcode', '=', code.base_code]]],\n                        context: this.env.session.user_context,\n                    });\n                } catch (error) {\n                    if (isConnectionError(error)) {\n                        return this.showPopup('OfflineErrorPopup', {\n                            title: this.env._t('Network Error'),\n                            body: this.env._t(\"Product is not loaded. Tried loading the product from the server but there is a network error.\"),\n                        });\n                    } else {\n                        throw error;\n                    }\n                }\n                if (foundProductIds.length) {\n                    await this.env.pos._addProducts(foundProductIds);\n                    // assume that the result is unique.\n                    product = this.env.pos.db.get_product_by_id(foundProductIds[0]);\n                } else {\n                    return this._barcodeErrorAction(code);\n                }\n            }\n            const options = await this._getAddProductOptions(product, code);\n            // Do not proceed on adding the product when no options is returned.\n            // This is consistent with _clickProduct.\n            if (!options) return;\n\n            // update the options depending on the type of the scanned code\n            if (code.type === 'price') {\n                Object.assign(options, {\n                    price: code.value,\n                    extras: {\n                        price_manually_set: true,\n                    },\n                });\n            } else if (code.type === 'weight') {\n                Object.assign(options, {\n                    quantity: code.value,\n                    merge: false,\n                });\n            } else if (code.type === 'discount') {\n                Object.assign(options, {\n                    discount: code.value,\n                    merge: false,\n                });\n            }\n            this.currentOrder.add_product(product,  options)\n        }\n        _barcodeClientAction(code) {\n            const partner = this.env.pos.db.get_partner_by_barcode(code.code);\n            if (partner) {\n                if (this.currentOrder.get_client() !== partner) {\n                    this.currentOrder.set_client(partner);\n                    this.currentOrder.set_pricelist(\n                        _.findWhere(this.env.pos.pricelists, {\n                            id: partner.property_product_pricelist[0],\n                        }) || this.env.pos.default_pricelist\n                    );\n                }\n                return true;\n            }\n            this._barcodeErrorAction(code);\n            return false;\n        }\n        _barcodeDiscountAction(code) {\n            var last_orderline = this.currentOrder.get_last_orderline();\n            if (last_orderline) {\n                last_orderline.set_discount(code.value);\n            }\n        }\n        // IMPROVEMENT: The following two methods should be in PosScreenComponent?\n        // Why? Because once we start declaring barcode actions in different\n        // screens, these methods will also be declared over and over.\n        _barcodeErrorAction(code) {\n            this.showPopup('ErrorBarcodePopup', { code: this._codeRepr(code) });\n        }\n        _codeRepr(code) {\n            if (code.code.length > 32) {\n                return code.code.substring(0, 29) + '...';\n            } else {\n                return code.code;\n            }\n        }\n        async _displayAllControlPopup() {\n            await this.showPopup('ControlButtonPopup', {\n                controlButtons: this.controlButtons\n            });\n        }\n        /**\n         * override this method to perform procedure if the scale is not available.\n         * @see isScaleAvailable\n         */\n        async _onScaleNotAvailable() {}\n        async _showDecreaseQuantityPopup() {\n            const { confirmed, payload: inputNumber } = await this.showPopup('NumberPopup', {\n                startingValue: 0,\n                title: this.env._t('Set the new quantity'),\n            });\n            let newQuantity = inputNumber !== \"\" ? parse.float(inputNumber) : null;\n            if (confirmed && newQuantity !== null) {\n                let order = this.env.pos.get_order();\n                let selectedLine = this.env.pos.get_order().get_selected_orderline();\n                let currentQuantity = selectedLine.get_quantity()\n                if(selectedLine.is_last_line() && currentQuantity === 1 && newQuantity < currentQuantity)\n                    selectedLine.set_quantity(newQuantity);\n                else if(newQuantity >= currentQuantity)\n                    selectedLine.set_quantity(newQuantity);\n                else {\n                    let newLine = selectedLine.clone();\n                    let decreasedQuantity = currentQuantity - newQuantity\n                    newLine.order = order;\n\n                    newLine.set_quantity( - decreasedQuantity, true);\n                    order.add_orderline(newLine);\n                }\n            }\n        }\n        async _onClickCustomer() {\n            // IMPROVEMENT: This code snippet is very similar to selectClient of PaymentScreen.\n            const currentClient = this.currentOrder.get_client();\n            if (currentClient && this.currentOrder.getHasRefundLines()) {\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t(\"Can't change customer\"),\n                    body: _.str.sprintf(\n                        this.env._t(\n                            \"This order already has refund lines for %s. We can't change the customer associated to it. Create a new order for the new customer.\"\n                        ),\n                        currentClient.name\n                    ),\n                });\n                return;\n            }\n            const { confirmed, payload: newClient } = await this.showTempScreen(\n                'ClientListScreen',\n                { client: currentClient }\n            );\n            if (confirmed) {\n                this.currentOrder.set_client(newClient);\n                this.currentOrder.updatePricelist(newClient);\n            }\n        }\n        _onClickPay() {\n            this.showScreen('PaymentScreen');\n        }\n        switchPane() {\n            this.state.mobile_pane = this.state.mobile_pane === \"left\" ? \"right\" : \"left\";\n        }\n    }\n    ProductScreen.template = 'ProductScreen';\n\n    Registries.Component.add(ProductScreen);\n\n    return ProductScreen;\n});\n", "odoo.define('point_of_sale.ClientLine', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class ClientLine extends PosComponent {\n        get highlight() {\n            return this.props.partner !== this.props.selectedClient ? '' : 'highlight';\n        }\n    }\n    ClientLine.template = 'ClientLine';\n\n    Registries.Component.add(ClientLine);\n\n    return ClientLine;\n});\n", "odoo.define('point_of_sale.ClientDetailsEdit', function(require) {\n    'use strict';\n\n    const { _t } = require('web.core');\n    const { getDataURLFromFile } = require('web.utils');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class ClientDetailsEdit extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.intFields = ['country_id', 'state_id', 'property_product_pricelist'];\n            const partner = this.props.partner;\n            this.changes = {\n                'country_id': partner.country_id && partner.country_id[0],\n                'state_id': partner.state_id && partner.state_id[0],\n            };\n        }\n        mounted() {\n            this.env.bus.on('save-customer', this, this.saveChanges);\n        }\n        willUnmount() {\n            this.env.bus.off('save-customer', this);\n        }\n        get partnerImageUrl() {\n            // We prioritize image_1920 in the `changes` field because we want\n            // to show the uploaded image without fetching new data from the server.\n            const partner = this.props.partner;\n            if (this.changes.image_1920) {\n                return this.changes.image_1920;\n            } else if (partner.id) {\n                return `/web/image?model=res.partner&id=${partner.id}&field=avatar_128&write_date=${partner.write_date}&unique=1`;\n            } else {\n                return false;\n            }\n        }\n        /**\n         * Save to field `changes` all input changes from the form fields.\n         */\n        captureChange(event) {\n            this.changes[event.target.name] = event.target.value;\n        }\n        saveChanges() {\n            let processedChanges = {};\n            for (let [key, value] of Object.entries(this.changes)) {\n                if (this.intFields.includes(key)) {\n                    processedChanges[key] = parseInt(value) || false;\n                } else {\n                    processedChanges[key] = value;\n                }\n            }\n            if ((!this.props.partner.name && !processedChanges.name) ||\n                processedChanges.name === '' ){\n                return this.showPopup('ErrorPopup', {\n                  title: _t('A Customer Name Is Required'),\n                });\n            }\n            processedChanges.id = this.props.partner.id || false;\n            this.trigger('save-changes', { processedChanges });\n        }\n        async uploadImage(event) {\n            const file = event.target.files[0];\n            if (!file.type.match(/image.*/)) {\n                await this.showPopup('ErrorPopup', {\n                    title: this.env._t('Unsupported File Format'),\n                    body: this.env._t(\n                        'Only web-compatible Image formats such as .png or .jpeg are supported.'\n                    ),\n                });\n            } else {\n                const imageUrl = await getDataURLFromFile(file);\n                const loadedImage = await this._loadImage(imageUrl);\n                if (loadedImage) {\n                    const resizedImage = await this._resizeImage(loadedImage, 800, 600);\n                    this.changes.image_1920 = resizedImage.toDataURL();\n                    // Rerender to reflect the changes in the screen\n                    this.render();\n                }\n            }\n        }\n        _resizeImage(img, maxwidth, maxheight) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext('2d');\n            var ratio = 1;\n\n            if (img.width > maxwidth) {\n                ratio = maxwidth / img.width;\n            }\n            if (img.height * ratio > maxheight) {\n                ratio = maxheight / img.height;\n            }\n            var width = Math.floor(img.width * ratio);\n            var height = Math.floor(img.height * ratio);\n\n            canvas.width = width;\n            canvas.height = height;\n            ctx.drawImage(img, 0, 0, width, height);\n            return canvas;\n        }\n        /**\n         * Loading image is converted to a Promise to allow await when\n         * loading an image. It resolves to the loaded image if succesful,\n         * else, resolves to false.\n         *\n         * [Source](https://stackoverflow.com/questions/45788934/how-to-turn-this-callback-into-a-promise-using-async-await)\n         */\n        _loadImage(url) {\n            return new Promise((resolve) => {\n                const img = new Image();\n                img.addEventListener('load', () => resolve(img));\n                img.addEventListener('error', () => {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Loading Image Error'),\n                        body: this.env._t(\n                            'Encountered error when loading image. Please try again.'\n                        ),\n                    });\n                    resolve(false);\n                });\n                img.src = url;\n            });\n        }\n    }\n    ClientDetailsEdit.template = 'ClientDetailsEdit';\n\n    Registries.Component.add(ClientDetailsEdit);\n\n    return ClientDetailsEdit;\n});\n", "odoo.define('point_of_sale.ClientListScreen', function(require) {\n    'use strict';\n\n    const { debounce } = owl.utils;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { useListener } = require('web.custom_hooks');\n\n    /**\n     * Render this screen using `showTempScreen` to select client.\n     * When the shown screen is confirmed ('Set Customer' or 'Deselect Customer'\n     * button is clicked), the call to `showTempScreen` resolves to the\n     * selected client. E.g.\n     *\n     * ```js\n     * const { confirmed, payload: selectedClient } = await showTempScreen('ClientListScreen');\n     * if (confirmed) {\n     *   // do something with the selectedClient\n     * }\n     * ```\n     *\n     * @props client - originally selected client\n     */\n    class ClientListScreen extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click-save', () => this.env.bus.trigger('save-customer'));\n            useListener('click-edit', () => this.editClient());\n            useListener('save-changes', this.saveChanges);\n\n            // We are not using useState here because the object\n            // passed to useState converts the object and its contents\n            // to Observer proxy. Not sure of the side-effects of making\n            // a persistent object, such as pos, into owl.Observer. But it\n            // is better to be safe.\n            this.state = {\n                query: null,\n                selectedClient: this.props.client,\n                detailIsShown: false,\n                isEditMode: false,\n                editModeProps: {\n                    partner: {\n                        country_id: this.env.pos.company.country_id,\n                        state_id: this.env.pos.company.state_id,\n                    }\n                },\n            };\n            this.updateClientList = debounce(this.updateClientList, 70);\n        }\n        // Lifecycle hooks\n        back() {\n            if(this.state.detailIsShown) {\n                this.state.detailIsShown = false;\n                this.render();\n            } else {\n                this.props.resolve({ confirmed: false, payload: false });\n                this.trigger('close-temp-screen');\n            }\n        }\n        confirm() {\n            this.props.resolve({ confirmed: true, payload: this.state.selectedClient });\n            this.trigger('close-temp-screen');\n        }\n        // Getters\n\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n\n        get clients() {\n            let res;\n            if (this.state.query && this.state.query.trim() !== '') {\n                res = this.env.pos.db.search_partner(this.state.query.trim());\n            } else {\n                res = this.env.pos.db.get_partners_sorted(1000);\n            }\n            return res.sort(function (a, b) { return (a.name || '').localeCompare(b.name || '') });\n        }\n        get isNextButtonVisible() {\n            return this.state.selectedClient ? true : false;\n        }\n        /**\n         * Returns the text and command of the next button.\n         * The command field is used by the clickNext call.\n         */\n        get nextButton() {\n            if (!this.props.client) {\n                return { command: 'set', text: this.env._t('Set Customer') };\n            } else if (this.props.client && this.props.client === this.state.selectedClient) {\n                return { command: 'deselect', text: this.env._t('Deselect Customer') };\n            } else {\n                return { command: 'set', text: this.env._t('Change Customer') };\n            }\n        }\n\n        // Methods\n\n        // We declare this event handler as a debounce function in\n        // order to lower its trigger rate.\n        async updateClientList(event) {\n            var newClientList = await this.getNewClient();\n            this.state.query = event.target.value;\n            const clients = this.clients;\n            if (event.code === 'Enter' && clients.length === 1) {\n                this.state.selectedClient = clients[0];\n                this.clickNext();\n            } else {\n                this.render();\n            }\n        }\n        clickClient(event) {\n            let partner = event.detail.client;\n            if (this.state.selectedClient === partner) {\n                this.state.selectedClient = null;\n            } else {\n                this.state.selectedClient = partner;\n            }\n            this.render();\n        }\n        editClient() {\n            this.state.editModeProps = {\n                partner: this.state.selectedClient,\n            };\n            this.state.detailIsShown = true;\n            this.render();\n        }\n        clickNext() {\n            this.state.selectedClient = this.nextButton.command === 'set' ? this.state.selectedClient : null;\n            this.confirm();\n        }\n        activateEditMode(event) {\n            const { isNewClient } = event.detail;\n            this.state.isEditMode = true;\n            this.state.detailIsShown = true;\n            this.state.isNewClient = isNewClient;\n            if (!isNewClient) {\n                this.state.editModeProps = {\n                    partner: this.state.selectedClient,\n                };\n            }\n            this.render();\n        }\n        deactivateEditMode() {\n            this.state.isEditMode = false;\n            this.state.editModeProps = {\n                partner: {\n                    country_id: this.env.pos.company.country_id,\n                    state_id: this.env.pos.company.state_id,\n                },\n            };\n            this.render();\n        }\n        async saveChanges(event) {\n            try {\n                let partnerId = await this.rpc({\n                    model: 'res.partner',\n                    method: 'create_from_ui',\n                    args: [event.detail.processedChanges],\n                });\n                await this.env.pos.load_new_partners();\n                this.state.selectedClient = this.env.pos.db.get_partner_by_id(partnerId);\n                this.state.detailIsShown = false;\n                this.render();\n            } catch (error) {\n                if (error.message.code < 0) {\n                    await this.showPopup('OfflineErrorPopup', {\n                        title: this.env._t('Offline'),\n                        body: this.env._t('Unable to save changes.'),\n                    });\n                } else {\n                    throw error;\n                }\n            }\n        }\n        cancelEdit() {\n            this.deactivateEditMode();\n        }\n        async searchClient() {\n            let result = await this.getNewClient();\n            this.env.pos.db.add_partners(result);\n            if(!result.length) {\n                await this.showPopup('ErrorPopup', {\n                    title: '',\n                    body: this.env._t('No customer found'),\n                });\n            }\n            this.render();\n        }\n        async getNewClient() {\n            var domain = [];\n            if(this.state.query) {\n                domain = [[\"name\", \"ilike\", this.state.query + \"%\"]];\n            }\n            var fields = _.find(this.env.pos.models, function(model){ return model.label === 'load_partners'; }).fields;\n            var result = await this.rpc({\n                model: 'res.partner',\n                method: 'search_read',\n                args: [domain, fields],\n                kwargs: {\n                    limit: 10,\n                },\n            },{\n                timeout: 3000,\n                shadow: true,\n            });\n\n            return result;\n        }\n    }\n    ClientListScreen.template = 'ClientListScreen';\n\n    Registries.Component.add(ClientListScreen);\n\n    return ClientListScreen;\n});\n", "odoo.define('point_of_sale.InvoiceButton', function (require) {\n    'use strict';\n\n    const { useListener } = require('web.custom_hooks');\n    const { isConnectionError } = require('point_of_sale.utils');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class InvoiceButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this._onClick);\n        }\n        get isAlreadyInvoiced() {\n            if (!this.props.order) return false;\n            return Boolean(this.props.order.account_move);\n        }\n        get commandName() {\n            if (!this.props.order) {\n                return this.env._t('Invoice');\n            } else {\n                return this.isAlreadyInvoiced\n                    ? this.env._t('Reprint Invoice')\n                    : this.props.order.isFromClosedSession\n                    ? this.env._t('Cannot Invoice')\n                    : this.env._t('Invoice');\n            }\n        }\n        async _downloadInvoice(orderId) {\n            try {\n                const [orderWithInvoice] = await this.rpc({\n                    method: 'read',\n                    model: 'pos.order',\n                    args: [orderId, ['account_move']],\n                    kwargs: { load: false },\n                });\n                if (orderWithInvoice && orderWithInvoice.account_move) {\n                    await this.env.pos.do_action('account.account_invoices', {\n                        additional_context: {\n                            active_ids: [orderWithInvoice.account_move],\n                        },\n                    });\n                }\n            } catch (error) {\n                if (error instanceof Error) {\n                    throw error;\n                } else {\n                    // NOTE: error here is most probably undefined\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Network Error'),\n                        body: this.env._t('Unable to download invoice.'),\n                    });\n                }\n            }\n        }\n        async _invoiceOrder() {\n            const order = this.props.order;\n            if (!order) return;\n\n            const orderId = order.backendId;\n\n            // Part 0.1. If already invoiced, print the invoice.\n            if (this.isAlreadyInvoiced) {\n                await this._downloadInvoice(orderId);\n                return;\n            }\n\n            // Part 0.2. Check if order belongs to an active session.\n            // If not, do not allow invoicing.\n            if (order.isFromClosedSession) {\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Session is closed'),\n                    body: this.env._t('Cannot invoice order from closed session.'),\n                });\n                return;\n            }\n\n            // Part 1: Handle missing client.\n            // Write to pos.order the selected client.\n            if (!order.get_client()) {\n                const { confirmed: confirmedPopup } = await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Need customer to invoice'),\n                    body: this.env._t('Do you want to open the customer list to select customer?'),\n                });\n                if (!confirmedPopup) return;\n\n                const { confirmed: confirmedTempScreen, payload: newClient } = await this.showTempScreen(\n                    'ClientListScreen'\n                );\n                if (!confirmedTempScreen) return;\n\n                await this.rpc({\n                    model: 'pos.order',\n                    method: 'write',\n                    args: [[orderId], { partner_id: newClient.id }],\n                    kwargs: { context: this.env.session.user_context },\n                });\n            }\n\n            // Part 2: Invoice the order.\n            await this.rpc(\n                {\n                    model: 'pos.order',\n                    method: 'action_pos_order_invoice',\n                    args: [orderId],\n                    kwargs: { context: this.env.session.user_context },\n                },\n                {\n                    timeout: 30000,\n                    shadow: true,\n                }\n            );\n\n            // Part 3: Download invoice.\n            await this._downloadInvoice(orderId);\n            this.trigger('order-invoiced', orderId);\n        }\n        async _onClick() {\n            try {\n                await this._invoiceOrder();\n            } catch (error) {\n                if (isConnectionError(error)) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Network Error'),\n                        body: this.env._t('Unable to invoice order.'),\n                    });\n                } else {\n                    throw error;\n                }\n            }\n        }\n    }\n    InvoiceButton.template = 'InvoiceButton';\n    Registries.Component.add(InvoiceButton);\n\n    return InvoiceButton;\n});\n", "odoo.define('point_of_sale.ReprintReceiptButton', function (require) {\n    'use strict';\n\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class ReprintReceiptButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this._onClick);\n        }\n        async _onClick() {\n            if (!this.props.order) return;\n            this.showScreen('ReprintReceiptScreen', { order: this.props.order });\n        }\n    }\n    ReprintReceiptButton.template = 'ReprintReceiptButton';\n    Registries.Component.add(ReprintReceiptButton);\n\n    return ReprintReceiptButton;\n});\n", "odoo.define('point_of_sale.OrderDetails', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * @props {models.Order} order\n     */\n    class OrderDetails extends PosComponent {\n        get order() {\n            return this.props.order;\n        }\n        get orderlines() {\n            return this.order ? this.order.orderlines.models : [];\n        }\n        get total() {\n            return this.env.pos.format_currency(this.order ? this.order.get_total_with_tax() : 0);\n        }\n        get tax() {\n            return this.env.pos.format_currency(this.order ? this.order.get_total_tax() : 0)\n        }\n    }\n    OrderDetails.template = 'OrderDetails';\n\n    Registries.Component.add(OrderDetails);\n\n    return OrderDetails;\n});\n", "odoo.define('point_of_sale.OrderlineDetails', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { format } = require('web.field_utils');\n    const { round_precision: round_pr } = require('web.utils');\n\n    /**\n     * @props {pos.order.line} line\n     */\n    class OrderlineDetails extends PosComponent {\n        get line() {\n            const line = this.props.line;\n            const formatQty = (line) => {\n                const quantity = line.get_quantity();\n                const unit = line.get_unit();\n                const decimals = this.env.pos.dp['Product Unit of Measure'];\n                const rounding = Math.max(unit.rounding, Math.pow(10, -decimals));\n                const roundedQuantity = round_pr(quantity, rounding);\n                return format.float(roundedQuantity, { digits: [69, decimals] });\n            };\n            return {\n                productName: line.get_full_product_name(),\n                totalPrice: line.get_price_with_tax(),\n                quantity: formatQty(line),\n                unit: line.get_unit().name,\n                unitPrice: line.get_unit_price(),\n            };\n        }\n        get productName() {\n            return this.line.productName;\n        }\n        get totalPrice() {\n            return this.env.pos.format_currency(this.line.totalPrice);\n        }\n        get quantity() {\n            return this.line.quantity;\n        }\n        get unitPrice() {\n            return this.env.pos.format_currency(this.line.unitPrice);\n        }\n        get unit() {\n            return this.line.unit;\n        }\n        get pricePerUnit() {\n            return ` ${this.unit} at ${this.unitPrice} / ${this.unit}`;\n        }\n        get customerNote() {\n            return this.props.line.get_customer_note();\n        }\n        getToRefundDetail() {\n            return this.env.pos.toRefundLines[this.props.line.id];\n        }\n        hasRefundedQty() {\n            return !this.env.pos.isProductQtyZero(this.props.line.refunded_qty);\n        }\n        getFormattedRefundedQty() {\n            return this.env.pos.formatProductQty(this.props.line.refunded_qty);\n        }\n        hasToRefundQty() {\n            const toRefundDetail = this.getToRefundDetail();\n            return !this.env.pos.isProductQtyZero(toRefundDetail && toRefundDetail.qty);\n        }\n        getFormattedToRefundQty() {\n            const toRefundDetail = this.getToRefundDetail();\n            return this.env.pos.formatProductQty(toRefundDetail && toRefundDetail.qty);\n        }\n        getRefundingMessage() {\n            return _.str.sprintf(this.env._t('Refunding %s in '), this.getFormattedToRefundQty());\n        }\n        getToRefundMessage() {\n            return _.str.sprintf(this.env._t('To Refund: %s'), this.getFormattedToRefundQty());\n        }\n    }\n    OrderlineDetails.template = 'OrderlineDetails';\n\n    Registries.Component.add(OrderlineDetails);\n\n    return OrderlineDetails;\n});\n", "odoo.define('point_of_sale.ReprintReceiptScreen', function (require) {\n    'use strict';\n\n    const AbstractReceiptScreen = require('point_of_sale.AbstractReceiptScreen');\n    const Registries = require('point_of_sale.Registries');\n\n    const ReprintReceiptScreen = (AbstractReceiptScreen) => {\n        class ReprintReceiptScreen extends AbstractReceiptScreen {\n            mounted() {\n                this.printReceipt();\n            }\n            confirm() {\n                this.showScreen('TicketScreen', { reuseSavedUIState: true });\n            }\n            async printReceipt() {\n                if(this.env.pos.proxy.printer && this.env.pos.config.iface_print_skip_screen) {\n                    let result = await this._printReceipt();\n                    if(result)\n                        this.showScreen('TicketScreen', { reuseSavedUIState: true });\n                }\n            }\n            async tryReprint() {\n                await this._printReceipt();\n            }\n        }\n        ReprintReceiptScreen.template = 'ReprintReceiptScreen';\n        return ReprintReceiptScreen;\n    };\n    Registries.Component.addByExtending(ReprintReceiptScreen, AbstractReceiptScreen);\n\n    return ReprintReceiptScreen;\n});\n", "odoo.define('point_of_sale.TicketScreen', function (require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const models = require('point_of_sale.models');\n    const Registries = require('point_of_sale.Registries');\n    const IndependentToOrderScreen = require('point_of_sale.IndependentToOrderScreen');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const { useListener, useAutofocus } = require('web.custom_hooks');\n    const { posbus } = require('point_of_sale.utils');\n    const { parse } = require('web.field_utils');\n\n\n    class TicketScreen extends IndependentToOrderScreen {\n        constructor() {\n            super(...arguments);\n            useListener('close-screen', this._onCloseScreen);\n            useListener('filter-selected', this._onFilterSelected);\n            useListener('search', this._onSearch);\n            useListener('click-order', this._onClickOrder);\n            useListener('create-new-order', this._onCreateNewOrder);\n            useListener('delete-order', this._onDeleteOrder);\n            useListener('next-page', this._onNextPage);\n            useListener('prev-page', this._onPrevPage);\n            useListener('order-invoiced', this._onInvoiceOrder);\n            useListener('click-order-line', this._onClickOrderline);\n            useListener('click-refund-order-uid', this._onClickRefundOrderUid);\n            useListener('update-selected-orderline', this._onUpdateSelectedOrderline);\n            useListener('do-refund', this._onDoRefund);\n            useAutofocus({ selector: '.search input' });\n            NumberBuffer.use({\n                nonKeyboardInputEvent: 'numpad-click-input',\n                triggerAtInput: 'update-selected-orderline',\n            });\n            this._state = this.env.pos.TICKET_SCREEN_STATE;\n            this.state = useState({\n                showSearchBar: !this.env.isMobile,\n            });\n            const defaultUIState = this.props.reuseSavedUIState\n                ? this._state.ui\n                : {\n                      selectedSyncedOrderId: null,\n                      searchDetails: this.env.pos.getDefaultSearchDetails(),\n                      filter: null,\n                      selectedOrderlineIds: {},\n                  };\n            Object.assign(this._state.ui, defaultUIState, this.props.ui || {});\n        }\n        //#region LIFECYCLE METHODS\n        mounted() {\n            posbus.on('ticket-button-clicked', this, this.close);\n            this.env.pos.get('orders').on('add remove change', () => this.render(), this);\n            this.env.pos.on('change:selectedOrder', () => this.render(), this);\n            setTimeout(() => {\n                // Show updated list of synced orders when going back to the screen.\n                this._onFilterSelected({ detail: { filter: this._state.ui.filter } });\n            });\n        }\n        willUnmount() {\n            posbus.off('ticket-button-clicked', this);\n            this.env.pos.get('orders').off('add remove change', null, this);\n            this.env.pos.off('change:selectedOrder', null, this);\n        }\n        //#endregion\n        //#region EVENT HANDLERS\n        _onCloseScreen() {\n            this.close();\n        }\n        async _onFilterSelected(event) {\n            this._state.ui.filter = event.detail.filter;\n            if (this._state.ui.filter == 'SYNCED') {\n                await this._fetchSyncedOrders();\n            }\n            this.render();\n        }\n        async _onSearch(event) {\n            Object.assign(this._state.ui.searchDetails, event.detail);\n            if (this._state.ui.filter == 'SYNCED') {\n                this._state.syncedOrders.currentPage = 1;\n                await this._fetchSyncedOrders();\n            }\n            this.render();\n        }\n        _onClickOrder({ detail: clickedOrder }) {\n            if (!clickedOrder || clickedOrder.locked) {\n                if (this._state.ui.selectedSyncedOrderId == clickedOrder.backendId) {\n                    this._state.ui.selectedSyncedOrderId = null;\n                } else {\n                    this._state.ui.selectedSyncedOrderId = clickedOrder.backendId;\n                }\n                if (!this.getSelectedOrderlineId()) {\n                    // Automatically select the first orderline of the selected order.\n                    const firstLine = clickedOrder.get_orderlines()[0];\n                    if (firstLine) {\n                        this._state.ui.selectedOrderlineIds[clickedOrder.backendId] = firstLine.id;\n                    }\n                }\n                NumberBuffer.reset();\n            } else {\n                this._setOrder(clickedOrder);\n            }\n            this.render();\n        }\n        _onCreateNewOrder() {\n            this.env.pos.add_new_order();\n        }\n        async _onDeleteOrder({ detail: order }) {\n            const screen = order.get_screen_data();\n            if (['ProductScreen', 'PaymentScreen'].includes(screen.name) && order.get_orderlines().length > 0) {\n                const { confirmed } = await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Existing orderlines'),\n                    body: _.str.sprintf(\n                      this.env._t('%s has a total amount of %s, are you sure you want to delete this order ?'),\n                      order.name, this.getTotal(order)\n                    ),\n                });\n                if (!confirmed) return;\n            }\n            if (order && (await this._onBeforeDeleteOrder(order))) {\n                order.destroy({ reason: 'abandon' });\n                posbus.trigger('order-deleted');\n            }\n        }\n        async _onNextPage() {\n            if (this._state.syncedOrders.currentPage < this._getLastPage()) {\n                this._state.syncedOrders.currentPage += 1;\n                await this._fetchSyncedOrders();\n            }\n            this.render();\n        }\n        async _onPrevPage() {\n            if (this._state.syncedOrders.currentPage > 1) {\n                this._state.syncedOrders.currentPage -= 1;\n                await this._fetchSyncedOrders();\n            }\n            this.render();\n        }\n        async _onInvoiceOrder({ detail: orderId }) {\n            this.env.pos._invalidateSyncedOrdersCache([orderId]);\n            await this._fetchSyncedOrders();\n            this.render();\n        }\n        _onClickOrderline({ detail: orderline }) {\n            const order = this.getSelectedSyncedOrder();\n            this._state.ui.selectedOrderlineIds[order.backendId] = orderline.id;\n            NumberBuffer.reset();\n            this.render();\n        }\n        _onClickRefundOrderUid({ detail: orderUid }) {\n            // Open the refund order.\n            const refundOrder = this.env.pos.get('orders').models.find((order) => order.uid == orderUid);\n            if (refundOrder) {\n                this._setOrder(refundOrder);\n            }\n        }\n        _onUpdateSelectedOrderline({ detail }) {\n            const buffer = detail.buffer;\n            const order = this.getSelectedSyncedOrder();\n            if (!order) return NumberBuffer.reset();\n\n            const selectedOrderlineId = this.getSelectedOrderlineId();\n            const orderline = order.orderlines.models.find((line) => line.id == selectedOrderlineId);\n            if (!orderline) return NumberBuffer.reset();\n\n            const toRefundDetail = this._getToRefundDetail(orderline);\n            // When already linked to an order, do not modify the to refund quantity.\n            if (toRefundDetail.destinationOrderUid) return NumberBuffer.reset();\n\n            const refundableQty = toRefundDetail.orderline.qty - toRefundDetail.orderline.refundedQty;\n            if (refundableQty <= 0) return NumberBuffer.reset();\n\n            if (buffer == null || buffer == '') {\n                toRefundDetail.qty = 0;\n            } else {\n                const quantity = Math.abs(parse.float(buffer));\n                if (quantity > refundableQty) {\n                    NumberBuffer.reset();\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Maximum Exceeded'),\n                        body: _.str.sprintf(\n                            this.env._t(\n                                'The requested quantity to be refunded is higher than the ordered quantity. %s is requested while only %s can be refunded.'\n                            ),\n                            quantity,\n                            refundableQty\n                        ),\n                    });\n                } else {\n                    toRefundDetail.qty = quantity;\n                }\n            }\n            this.render();\n        }\n        async _onDoRefund() {\n            const order = this.getSelectedSyncedOrder();\n            if (!order) {\n                this._state.ui.highlightHeaderNote = !this._state.ui.highlightHeaderNote;\n                return this.render();\n            }\n\n            if (this._doesOrderHaveSoleItem(order)) {\n                this._prepareAutoRefundOnOrder(order);\n            }\n\n            const customer = order.get_client();\n\n            // Select the lines from toRefundLines (can come from different orders)\n            // such that:\n            //   - the quantity to refund is not zero\n            //   - if there is customer in the selected paid order, select the items\n            //     with the same orderPartnerId\n            //   - it is not yet linked to an active order (no destinationOrderUid)\n            const allToRefundDetails = Object.values(this.env.pos.toRefundLines).filter(\n                ({ qty, orderline, destinationOrderUid }) =>\n                    !this.env.pos.isProductQtyZero(qty) &&\n                    (customer ? orderline.orderPartnerId == customer.id : true) &&\n                    !destinationOrderUid\n            );\n            if (allToRefundDetails.length == 0) {\n                this._state.ui.highlightHeaderNote = !this._state.ui.highlightHeaderNote;\n                return this.render();\n            }\n\n            // The order that will contain the refund orderlines.\n            // Use the destinationOrder from props if the order to refund has the same\n            // customer as the destinationOrder.\n            const destinationOrder =\n                this.props.destinationOrder && customer === this.props.destinationOrder.get_client()\n                    ? this.props.destinationOrder\n                    : this.env.pos.add_new_order({ silent: true });\n\n            // Add orderline for each toRefundDetail to the destinationOrder.\n            for (const refundDetail of allToRefundDetails) {\n                const { qty, orderline } = refundDetail;\n                await destinationOrder.add_product(this.env.pos.db.get_product_by_id(orderline.productId), {\n                    quantity: -qty,\n                    price: orderline.price,\n                    lst_price: orderline.price,\n                    extras: { price_manually_set: true },\n                    merge: false,\n                    refunded_orderline_id: orderline.id,\n                    tax_ids: orderline.tax_ids,\n                    discount: orderline.discount,\n                });\n                refundDetail.destinationOrderUid = destinationOrder.uid;\n            }\n\n            // Set the customer to the destinationOrder.\n            if (customer && !destinationOrder.get_client()) {\n                destinationOrder.set_client(customer);\n            }\n\n            this._onCloseScreen();\n        }\n        //#endregion\n        //#region PUBLIC METHODS\n        getSelectedSyncedOrder() {\n            if (this._state.ui.filter == 'SYNCED') {\n                return this._state.syncedOrders.cache[this._state.ui.selectedSyncedOrderId];\n            } else {\n                return null;\n            }\n        }\n        getSelectedOrderlineId() {\n            return this._state.ui.selectedOrderlineIds[this._state.ui.selectedSyncedOrderId];\n        }\n        /**\n         * Override to conditionally show the new ticket button.\n         */\n        shouldShowNewOrderButton() {\n            return true;\n        }\n        getFilteredOrderList() {\n            if (this._state.ui.filter == 'SYNCED') return this._state.syncedOrders.toShow;\n            const filterCheck = (order) => {\n                if (this._state.ui.filter && this._state.ui.filter !== 'ACTIVE_ORDERS') {\n                    const screen = order.get_screen_data();\n                    return this._state.ui.filter === this._getScreenToStatusMap()[screen.name];\n                }\n                return true;\n            };\n            const { fieldName, searchTerm } = this._state.ui.searchDetails;\n            const searchField = this._getSearchFields()[fieldName];\n            const searchCheck = (order) => {\n                if (!searchField) return true;\n                const repr = searchField.repr(order);\n                if (repr === null) return true;\n                if (!searchTerm) return true;\n                return repr && repr.toString().toLowerCase().includes(searchTerm.toLowerCase());\n            };\n            const predicate = (order) => {\n                return filterCheck(order) && searchCheck(order);\n            };\n            return this._getOrderList().filter(predicate);\n        }\n        getDate(order) {\n            return moment(order.validation_date).format('YYYY-MM-DD hh:mm A');\n        }\n        getTotal(order) {\n            return this.env.pos.format_currency(order.get_total_with_tax());\n        }\n        getCustomer(order) {\n            return order.get_client_name();\n        }\n        getCardholderName(order) {\n            return order.get_cardholder_name();\n        }\n        getEmployee(order) {\n            return order.employee ? order.employee.name : '';\n        }\n        getStatus(order) {\n            if (order.locked) {\n                return this.env._t('Paid');\n            } else {\n                const screen = order.get_screen_data();\n                return this._getOrderStates().get(this._getScreenToStatusMap()[screen.name]).text;\n            }\n        }\n        /**\n         * Hide the delete button if one of the payments is a 'done' electronic payment.\n         */\n        shouldHideDeleteButton(order) {\n            return (\n                order.locked ||\n                order\n                    .get_paymentlines()\n                    .some((payment) => payment.is_electronic() && payment.get_payment_status() === 'done')\n            );\n        }\n        isHighlighted(order) {\n            if (this._state.ui.filter == 'SYNCED') {\n                const selectedOrder = this.getSelectedSyncedOrder();\n                return selectedOrder ? order.backendId == selectedOrder.backendId : false;\n            } else {\n                const activeOrder = this.env.pos.get_order();\n                return activeOrder ? activeOrder.uid == order.uid : false;\n            }\n        }\n        showCardholderName() {\n            return this.env.pos.payment_methods.some((method) => method.use_payment_terminal);\n        }\n        getSearchBarConfig() {\n            return {\n                searchFields: new Map(\n                    Object.entries(this._getSearchFields()).map(([key, val]) => [key, val.displayName])\n                ),\n                filter: { show: true, options: this._getFilterOptions() },\n                defaultSearchDetails: this._state.ui.searchDetails,\n                defaultFilter: this._state.ui.filter,\n            };\n        }\n        shouldShowPageControls() {\n            return this._state.ui.filter == 'SYNCED' && this._getLastPage() > 1;\n        }\n        getPageNumber() {\n            if (!this._state.syncedOrders.totalCount) {\n                return `1/1`;\n            } else {\n                return `${this._state.syncedOrders.currentPage}/${this._getLastPage()}`;\n            }\n        }\n        getSelectedClient() {\n            const order = this.getSelectedSyncedOrder();\n            return order ? order.get_client() : null;\n        }\n        getHasItemsToRefund() {\n            const order = this.getSelectedSyncedOrder();\n            if (!order) return false;\n            if (this._doesOrderHaveSoleItem(order)) return true;\n            const total = Object.values(this.env.pos.toRefundLines)\n                .filter(\n                    (toRefundDetail) =>\n                        toRefundDetail.orderline.orderUid === order.uid && !toRefundDetail.destinationOrderUid\n                )\n                .map((toRefundDetail) => toRefundDetail.qty)\n                .reduce((acc, val) => acc + val, 0);\n            return !this.env.pos.isProductQtyZero(total);\n        }\n        //#endregion\n        //#region PRIVATE METHODS\n        _doesOrderHaveSoleItem(order) {\n            const orderlines = order.get_orderlines();\n            if (orderlines.length !== 1) return false;\n            const theOrderline = orderlines[0];\n            const refundableQty = theOrderline.get_quantity() - theOrderline.refunded_qty;\n            return this.env.pos.isProductQtyZero(refundableQty - 1);\n        }\n        _prepareAutoRefundOnOrder(order) {\n            const selectedOrderlineId = this.getSelectedOrderlineId();\n            const orderline = order.orderlines.models.find((line) => line.id == selectedOrderlineId);\n            if (!orderline) return;\n\n            const toRefundDetail = this._getToRefundDetail(orderline);\n            const refundableQty = orderline.get_quantity() - orderline.refunded_qty;\n            if (this.env.pos.isProductQtyZero(refundableQty - 1)) {\n                toRefundDetail.qty = 1;\n            }\n        }\n        /**\n         * Returns the corresponding toRefundDetail of the given orderline.\n         * SIDE-EFFECT: Automatically creates a toRefundDetail object for\n         * the given orderline if it doesn't exist and returns it.\n         * @param {models.Orderline} orderline\n         * @returns\n         */\n        _getToRefundDetail(orderline) {\n            if (orderline.id in this.env.pos.toRefundLines) {\n                return this.env.pos.toRefundLines[orderline.id];\n            } else {\n                const customer = orderline.order.get_client();\n                const orderPartnerId = customer ? customer.id : false;\n                const newToRefundDetail = {\n                    qty: 0,\n                    orderline: {\n                        id: orderline.id,\n                        productId: orderline.product.id,\n                        price: orderline.price,\n                        qty: orderline.quantity,\n                        refundedQty: orderline.refunded_qty,\n                        orderUid: orderline.order.uid,\n                        orderBackendId: orderline.order.backendId,\n                        orderPartnerId,\n                        tax_ids: orderline.get_taxes().map(tax => tax.id),\n                        discount: orderline.discount,\n                    },\n                    destinationOrderUid: false,\n                };\n                this.env.pos.toRefundLines[orderline.id] = newToRefundDetail;\n                return newToRefundDetail;\n            }\n        }\n        _setOrder(order) {\n            this.env.pos.set_order(order);\n            if (order === this.env.pos.get_order()) {\n                this.close();\n            }\n        }\n        _getOrderList() {\n            return this.env.pos.get_order_list();\n        }\n        _getFilterOptions() {\n            const orderStates = this._getOrderStates();\n            orderStates.set('SYNCED', { text: this.env._t('Paid') });\n            return orderStates;\n        }\n        /**\n         * @returns {Record<string, { repr: (order: models.Order) => string, displayName: string, modelField: string }>}\n         */\n        _getSearchFields() {\n            const fields = {\n                RECEIPT_NUMBER: {\n                    repr: (order) => order.name,\n                    displayName: this.env._t('Receipt Number'),\n                    modelField: 'pos_reference',\n                },\n                DATE: {\n                    repr: (order) => moment(order.creation_date).format('YYYY-MM-DD hh:mm A'),\n                    displayName: this.env._t('Date'),\n                    modelField: 'date_order',\n                },\n                CUSTOMER: {\n                    repr: (order) => order.get_client_name(),\n                    displayName: this.env._t('Customer'),\n                    modelField: 'partner_id.display_name',\n                },\n            };\n\n            if (this.showCardholderName()) {\n                fields.CARDHOLDER_NAME = {\n                    repr: (order) => order.get_cardholder_name(),\n                    displayName: this.env._t('Cardholder Name'),\n                    modelField: 'payment_ids.cardholder_name',\n                };\n            }\n\n            return fields;\n        }\n        /**\n         * Maps the order screen params to order status.\n         */\n        _getScreenToStatusMap() {\n            return {\n                ProductScreen: 'ONGOING',\n                PaymentScreen: 'PAYMENT',\n                ReceiptScreen: 'RECEIPT',\n            };\n        }\n        /**\n         * Override to do something before deleting the order.\n         * Make sure to return true to proceed on deleting the order.\n         * @param {*} order\n         * @returns {boolean}\n         */\n        async _onBeforeDeleteOrder(order) {\n            return true;\n        }\n        _getOrderStates() {\n            // We need the items to be ordered, therefore, Map is used instead of normal object.\n            const states = new Map();\n            states.set('ACTIVE_ORDERS', {\n                text: this.env._t('All active orders'),\n            });\n            // The spaces are important to make sure the following states\n            // are under the category of `All active orders`.\n            states.set('ONGOING', {\n                text: this.env._t('Ongoing'),\n                indented: true,\n            });\n            states.set('PAYMENT', {\n                text: this.env._t('Payment'),\n                indented: true,\n            });\n            states.set('RECEIPT', {\n                text: this.env._t('Receipt'),\n                indented: true,\n            });\n            return states;\n        }\n        //#region SEARCH SYNCED ORDERS\n        _computeSyncedOrdersDomain() {\n            const { fieldName, searchTerm } = this._state.ui.searchDetails;\n            if (!searchTerm) return [];\n            const modelField = this._getSearchFields()[fieldName].modelField;\n            if (modelField) {\n                return [[modelField, 'ilike', `%${searchTerm}%`]];\n            } else {\n                return [];\n            }\n        }\n        /**\n         * Fetches the done orders from the backend that needs to be shown.\n         * If the order is already in cache, the full information about that\n         * order is not fetched anymore, instead, we use info from cache.\n         */\n        async _fetchSyncedOrders() {\n            const domain = this._computeSyncedOrdersDomain();\n            const limit = this._state.syncedOrders.nPerPage;\n            const offset = (this._state.syncedOrders.currentPage - 1) * this._state.syncedOrders.nPerPage;\n            const { ids, totalCount } = await this.rpc({\n                model: 'pos.order',\n                method: 'search_paid_order_ids',\n                kwargs: { config_id: this.env.pos.config.id, domain, limit, offset },\n                context: this.env.session.user_context,\n            });\n            const idsNotInCache = ids.filter((id) => !(id in this._state.syncedOrders.cache));\n            if (idsNotInCache.length > 0) {\n                const fetchedOrders = await this.rpc({\n                    model: 'pos.order',\n                    method: 'export_for_ui',\n                    args: [idsNotInCache],\n                    context: this.env.session.user_context,\n                });\n                // Check for missing products and load them in the PoS\n                await this.env.pos._loadMissingProducts(fetchedOrders);\n                // Cache these fetched orders so that next time, no need to fetch\n                // them again, unless invalidated. See `_onInvoiceOrder`.\n                fetchedOrders.forEach((order) => {\n                    this._state.syncedOrders.cache[order.id] = new models.Order({}, { pos: this.env.pos, json: order });\n                });\n            }\n            this._state.syncedOrders.totalCount = totalCount;\n            this._state.syncedOrders.toShow = ids.map((id) => this._state.syncedOrders.cache[id]);\n        }\n        _getLastPage() {\n            const totalCount = this._state.syncedOrders.totalCount;\n            const nPerPage = this._state.syncedOrders.nPerPage;\n            const remainder = totalCount % nPerPage;\n            if (remainder == 0) {\n                return totalCount / nPerPage;\n            } else {\n                return Math.ceil(totalCount / nPerPage);\n            }\n        }\n        //#endregion\n        //#endregion\n    }\n    TicketScreen.template = 'TicketScreen';\n    TicketScreen.defaultProps = {\n        destinationOrder: null,\n        // When passed as true, it will use the saved _state.ui as default\n        // value when this component is reinstantiated.\n        // After setting the default value, the _state.ui will be overridden\n        // by the passed props.ui if there is any.\n        reuseSavedUIState: false,\n        ui: {},\n    };\n\n    Registries.Component.add(TicketScreen);\n\n    return TicketScreen;\n});\n", "odoo.define('point_of_sale.PSNumpadInputButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PSNumpadInputButton extends PosComponent {\n        get _class() {\n            return this.props.changeClassTo || 'input-button number-char';\n        }\n    }\n    PSNumpadInputButton.template = 'PSNumpadInputButton';\n\n    Registries.Component.add(PSNumpadInputButton);\n\n    return PSNumpadInputButton;\n});\n", "odoo.define('point_of_sale.PaymentScreenNumpad', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PaymentScreenNumpad extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.decimalPoint = this.env._t.database.parameters.decimal_point;\n        }\n    }\n    PaymentScreenNumpad.template = 'PaymentScreenNumpad';\n\n    Registries.Component.add(PaymentScreenNumpad);\n\n    return PaymentScreenNumpad;\n});\n", "odoo.define('point_of_sale.PaymentScreenElectronicPayment', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PaymentScreenElectronicPayment extends PosComponent {\n        mounted() {\n            this.props.line.on('change', this.render, this);\n        }\n        willUnmount() {\n            if (this.props.line) {\n                // It could be that the line is deleted before unmounting the element.\n                this.props.line.off('change', null, this);\n            }\n        }\n    }\n    PaymentScreenElectronicPayment.template = 'PaymentScreenElectronicPayment';\n\n    Registries.Component.add(PaymentScreenElectronicPayment);\n\n    return PaymentScreenElectronicPayment;\n});\n", "odoo.define('point_of_sale.PaymentScreenPaymentLines', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PaymentScreenPaymentLines extends PosComponent {\n        formatLineAmount(paymentline) {\n            return this.env.pos.format_currency_no_symbol(paymentline.get_amount());\n        }\n        selectedLineClass(line) {\n            return { 'payment-terminal': line.get_payment_status() };\n        }\n        unselectedLineClass(line) {\n            return {};\n        }\n    }\n    PaymentScreenPaymentLines.template = 'PaymentScreenPaymentLines';\n\n    Registries.Component.add(PaymentScreenPaymentLines);\n\n    return PaymentScreenPaymentLines;\n});\n", "odoo.define('point_of_sale.PaymentScreenStatus', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PaymentScreenStatus extends PosComponent {\n        get changeText() {\n            return this.env.pos.format_currency(this.currentOrder.get_change());\n        }\n        get totalDueText() {\n            return this.env.pos.format_currency(\n                this.currentOrder.get_total_with_tax() + this.currentOrder.get_rounding_applied()\n            );\n        }\n        get remainingText() {\n            return this.env.pos.format_currency(\n                this.currentOrder.get_due() > 0 ? this.currentOrder.get_due() : 0\n            );\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n    }\n    PaymentScreenStatus.template = 'PaymentScreenStatus';\n\n    Registries.Component.add(PaymentScreenStatus);\n\n    return PaymentScreenStatus;\n});\n", "odoo.define('point_of_sale.PaymentMethodButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class PaymentMethodButton extends PosComponent {}\n    PaymentMethodButton.template = 'PaymentMethodButton';\n\n    Registries.Component.add(PaymentMethodButton);\n\n    return PaymentMethodButton;\n});\n", "odoo.define('point_of_sale.PaymentScreen', function (require) {\n    'use strict';\n\n    const { parse } = require('web.field_utils');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const { useErrorHandlers } = require('point_of_sale.custom_hooks');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n    const { onChangeOrder } = require('point_of_sale.custom_hooks');\n    const { isConnectionError } = require('point_of_sale.utils');\n\n    class PaymentScreen extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('delete-payment-line', this.deletePaymentLine);\n            useListener('select-payment-line', this.selectPaymentLine);\n            useListener('new-payment-line', this.addNewPaymentLine);\n            useListener('update-selected-paymentline', this._updateSelectedPaymentline);\n            useListener('send-payment-request', this._sendPaymentRequest);\n            useListener('send-payment-cancel', this._sendPaymentCancel);\n            useListener('send-payment-reverse', this._sendPaymentReverse);\n            useListener('send-force-done', this._sendForceDone);\n            NumberBuffer.use({\n                // The numberBuffer listens to this event to update its state.\n                // Basically means 'update the buffer when this event is triggered'\n                nonKeyboardInputEvent: 'input-from-numpad',\n                // When the buffer is updated, trigger this event.\n                // Note that the component listens to it.\n                triggerAtInput: 'update-selected-paymentline',\n            });\n            onChangeOrder(this._onPrevOrder, this._onNewOrder);\n            useErrorHandlers();\n            this.payment_interface = null;\n            this.error = false;\n            this.payment_methods_from_config = this.env.pos.payment_methods.filter(method => this.env.pos.config.payment_method_ids.includes(method.id));\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n        get paymentLines() {\n            return this.currentOrder.get_paymentlines();\n        }\n        get selectedPaymentLine() {\n            return this.currentOrder.selected_paymentline;\n        }\n        async selectClient() {\n            // IMPROVEMENT: This code snippet is repeated multiple times.\n            // Maybe it's better to create a function for it.\n            const currentClient = this.currentOrder.get_client();\n            const { confirmed, payload: newClient } = await this.showTempScreen(\n                'ClientListScreen',\n                { client: currentClient }\n            );\n            if (confirmed) {\n                this.currentOrder.set_client(newClient);\n                this.currentOrder.updatePricelist(newClient);\n            }\n        }\n        addNewPaymentLine({ detail: paymentMethod }) {\n            // original function: click_paymentmethods\n            if (this.currentOrder.electronic_payment_in_progress()) {\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Error'),\n                    body: this.env._t('There is already an electronic payment in progress.'),\n                });\n                return false;\n            } else {\n                this.currentOrder.add_paymentline(paymentMethod);\n                NumberBuffer.reset();\n                this.payment_interface = paymentMethod.payment_terminal;\n                if (this.payment_interface) {\n                    this.currentOrder.selected_paymentline.set_payment_status('pending');\n                }\n                return true;\n            }\n        }\n        _updateSelectedPaymentline() {\n            if (this.paymentLines.every((line) => line.paid)) {\n                this.currentOrder.add_paymentline(this.payment_methods_from_config[0]);\n            }\n            if (!this.selectedPaymentLine) return; // do nothing if no selected payment line\n            // disable changing amount on paymentlines with running or done payments on a payment terminal\n            const payment_terminal = this.selectedPaymentLine.payment_method.payment_terminal;\n            if (\n                payment_terminal &&\n                !['pending', 'retry'].includes(this.selectedPaymentLine.get_payment_status())\n            ) {\n                return;\n            }\n            if (NumberBuffer.get() === null) {\n                this.deletePaymentLine({ detail: { cid: this.selectedPaymentLine.cid } });\n            } else {\n                this.selectedPaymentLine.set_amount(NumberBuffer.getFloat());\n            }\n        }\n        toggleIsToInvoice() {\n            // click_invoice\n            this.currentOrder.set_to_invoice(!this.currentOrder.is_to_invoice());\n            this.render();\n        }\n        openCashbox() {\n            this.env.pos.proxy.printer.open_cashbox();\n        }\n        async addTip() {\n            // click_tip\n            const tip = this.currentOrder.get_tip();\n            const change = this.currentOrder.get_change();\n            let value = tip === 0 && change > 0 ? change : tip;\n\n            const { confirmed, payload } = await this.showPopup('NumberPopup', {\n                title: tip ? this.env._t('Change Tip') : this.env._t('Add Tip'),\n                startingValue: value,\n                isInputSelected: true,\n            });\n\n            if (confirmed) {\n                this.currentOrder.set_tip(parse.float(payload));\n            }\n        }\n        toggleIsToShip() {\n            // click_ship\n            this.currentOrder.set_to_ship(!this.currentOrder.is_to_ship());\n            this.render();\n        }\n        deletePaymentLine(event) {\n            var self = this;\n            const { cid } = event.detail;\n            const line = this.paymentLines.find((line) => line.cid === cid);\n\n            // If a paymentline with a payment terminal linked to\n            // it is removed, the terminal should get a cancel\n            // request.\n            if (['waiting', 'waitingCard', 'timeout'].includes(line.get_payment_status())) {\n                line.set_payment_status('waitingCancel');\n                line.payment_method.payment_terminal.send_payment_cancel(this.currentOrder, cid).then(function() {\n                    self.currentOrder.remove_paymentline(line);\n                    NumberBuffer.reset();\n                    self.render();\n                })\n            }\n            else if (line.get_payment_status() !== 'waitingCancel') {\n                this.currentOrder.remove_paymentline(line);\n                NumberBuffer.reset();\n                this.render();\n            }\n        }\n        selectPaymentLine(event) {\n            const { cid } = event.detail;\n            const line = this.paymentLines.find((line) => line.cid === cid);\n            this.currentOrder.select_paymentline(line);\n            NumberBuffer.reset();\n            this.render();\n        }\n        /**\n         * Returns false if the current order is empty and has no payments.\n         * @returns {boolean}\n         */\n        _isValidEmptyOrder() {\n            const order = this.currentOrder;\n            if (order.get_orderlines().length == 0) {\n                return order.get_paymentlines().length != 0;\n            } else {\n                return true;\n            }\n        }\n        async validateOrder(isForceValidate) {\n            if(this.env.pos.config.cash_rounding) {\n                if(!this.env.pos.get_order().check_paymentlines_rounding()) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Rounding error in payment lines'),\n                        body: this.env._t(\"The amount of your payment lines must be rounded to validate the transaction.\"),\n                    });\n                    return;\n                }\n            }\n            if (await this._isOrderValid(isForceValidate)) {\n                // remove pending payments before finalizing the validation\n                for (let line of this.paymentLines) {\n                    if (!line.is_done()) this.currentOrder.remove_paymentline(line);\n                }\n                await this._finalizeValidation();\n            }\n        }\n        async _finalizeValidation() {\n            if ((this.currentOrder.is_paid_with_cash() || this.currentOrder.get_change()) && this.env.pos.config.iface_cashdrawer) {\n                this.env.pos.proxy.printer.open_cashbox();\n            }\n\n            this.currentOrder.initialize_validation_date();\n            this.currentOrder.finalized = true;\n\n            let syncedOrderBackendIds = [];\n\n            try {\n                if (this.currentOrder.is_to_invoice()) {\n                    syncedOrderBackendIds = await this.env.pos.push_and_invoice_order(\n                        this.currentOrder\n                    );\n                } else {\n                    syncedOrderBackendIds = await this.env.pos.push_single_order(this.currentOrder);\n                }\n            } catch (error) {\n                if (error.code == 700)\n                    this.error = true;\n\n                if ('code' in error) {\n                    // We started putting `code` in the rejected object for invoicing error.\n                    // We can continue with that convention such that when the error has `code`,\n                    // then it is an error when invoicing. Besides, _handlePushOrderError was\n                    // introduce to handle invoicing error logic.\n                    await this._handlePushOrderError(error);\n                } else {\n                    // We don't block for connection error. But we rethrow for any other errors.\n                    if (isConnectionError(error)) {\n                        this.showPopup('OfflineErrorPopup', {\n                            title: this.env._t('Connection Error'),\n                            body: this.env._t('Order is not synced. Check your internet connection'),\n                        });\n                    } else {\n                        throw error;\n                    }\n                }\n            }\n            if (syncedOrderBackendIds.length && this.currentOrder.wait_for_push_order()) {\n                const result = await this._postPushOrderResolve(\n                    this.currentOrder,\n                    syncedOrderBackendIds\n                );\n                if (!result) {\n                    await this.showPopup('ErrorPopup', {\n                        title: this.env._t('Error: no internet connection.'),\n                        body: this.env._t('Some, if not all, post-processing after syncing order failed.'),\n                    });\n                }\n            }\n\n            this.showScreen(this.nextScreen);\n\n            // If we succeeded in syncing the current order, and\n            // there are still other orders that are left unsynced,\n            // we ask the user if he is willing to wait and sync them.\n            if (syncedOrderBackendIds.length && this.env.pos.db.get_orders().length) {\n                const { confirmed } = await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Remaining unsynced orders'),\n                    body: this.env._t(\n                        'There are unsynced orders. Do you want to sync these orders?'\n                    ),\n                });\n                if (confirmed) {\n                    // NOTE: Not yet sure if this should be awaited or not.\n                    // If awaited, some operations like changing screen\n                    // might not work.\n                    this.env.pos.push_orders();\n                }\n            }\n        }\n        get nextScreen() {\n            return !this.error? 'ReceiptScreen' : 'ProductScreen';\n        }\n        async _isOrderValid(isForceValidate) {\n            if (this.currentOrder.get_orderlines().length === 0 && this.currentOrder.is_to_invoice()) {\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Empty Order'),\n                    body: this.env._t(\n                        'There must be at least one product in your order before it can be validated and invoiced.'\n                    ),\n                });\n                return false;\n            }\n\n            const splitPayments = this.paymentLines.filter(payment => payment.payment_method.split_transactions)\n            if (splitPayments.length && !this.currentOrder.get_client()) {\n                const paymentMethod = splitPayments[0].payment_method\n                const { confirmed } = await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Customer Required'),\n                    body: _.str.sprintf(this.env._t('Customer is required for %s payment method.'), paymentMethod.name),\n                });\n                if (confirmed) {\n                    this.selectClient();\n                }\n                return false;\n            }\n\n            if ((this.currentOrder.is_to_invoice() || this.currentOrder.is_to_ship()) && !this.currentOrder.get_client()) {\n                const { confirmed } = await this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Please select the Customer'),\n                    body: this.env._t(\n                        'You need to select the customer before you can invoice or ship an order.'\n                    ),\n                });\n                if (confirmed) {\n                    this.selectClient();\n                }\n                return false;\n            }\n\n            var customer = this.currentOrder.get_client()\n            if (this.currentOrder.is_to_ship() && !(customer.name && customer.street && customer.city && customer.country_id)) {\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Incorrect address for shipping'),\n                    body: this.env._t('The selected customer needs an address.'),\n                });\n                return false;\n            }\n\n            if (!this.currentOrder.is_paid() || this.invoicing) {\n                return false;\n            }\n\n            if (this.currentOrder.has_not_valid_rounding()) {\n                var line = this.currentOrder.has_not_valid_rounding();\n                this.showPopup('ErrorPopup', {\n                    title: this.env._t('Incorrect rounding'),\n                    body: this.env._t(\n                        'You have to round your payments lines.' + line.amount + ' is not rounded.'\n                    ),\n                });\n                return false;\n            }\n\n            // The exact amount must be paid if there is no cash payment method defined.\n            if (\n                Math.abs(\n                    this.currentOrder.get_total_with_tax() - this.currentOrder.get_total_paid()  + this.currentOrder.get_rounding_applied()\n                ) > 0.00001\n            ) {\n                var cash = false;\n                for (var i = 0; i < this.env.pos.payment_methods.length; i++) {\n                    cash = cash || this.env.pos.payment_methods[i].is_cash_count;\n                }\n                if (!cash) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Cannot return change without a cash payment method'),\n                        body: this.env._t(\n                            'There is no cash payment method available in this point of sale to handle the change.\\n\\n Please pay the exact amount or add a cash payment method in the point of sale configuration'\n                        ),\n                    });\n                    return false;\n                }\n            }\n\n            // if the change is too large, it's probably an input error, make the user confirm.\n            if (\n                !isForceValidate &&\n                this.currentOrder.get_total_with_tax() > 0 &&\n                this.currentOrder.get_total_with_tax() * 1000 < this.currentOrder.get_total_paid()\n            ) {\n                this.showPopup('ConfirmPopup', {\n                    title: this.env._t('Please Confirm Large Amount'),\n                    body:\n                        this.env._t('Are you sure that the customer wants to  pay') +\n                        ' ' +\n                        this.env.pos.format_currency(this.currentOrder.get_total_paid()) +\n                        ' ' +\n                        this.env._t('for an order of') +\n                        ' ' +\n                        this.env.pos.format_currency(this.currentOrder.get_total_with_tax()) +\n                        ' ' +\n                        this.env._t('? Clicking \"Confirm\" will validate the payment.'),\n                }).then(({ confirmed }) => {\n                    if (confirmed) this.validateOrder(true);\n                });\n                return false;\n            }\n\n            if (!this._isValidEmptyOrder()) return false;\n\n            return true;\n        }\n        async _postPushOrderResolve(order, order_server_ids) {\n            return true;\n        }\n        async _sendPaymentRequest({ detail: line }) {\n            // Other payment lines can not be reversed anymore\n            this.paymentLines.forEach(function (line) {\n                line.can_be_reversed = false;\n            });\n\n            const payment_terminal = line.payment_method.payment_terminal;\n            line.set_payment_status('waiting');\n\n            const isPaymentSuccessful = await payment_terminal.send_payment_request(line.cid);\n            if (isPaymentSuccessful) {\n                line.set_payment_status('done');\n                line.can_be_reversed = payment_terminal.supports_reversals;\n            } else {\n                line.set_payment_status('retry');\n            }\n        }\n        async _sendPaymentCancel({ detail: line }) {\n            const payment_terminal = line.payment_method.payment_terminal;\n            line.set_payment_status('waitingCancel');\n            const isCancelSuccessful = await payment_terminal.send_payment_cancel(this.currentOrder, line.cid);\n            if (isCancelSuccessful) {\n                line.set_payment_status('retry');\n            } else {\n                line.set_payment_status('waitingCard');\n            }\n        }\n        async _sendPaymentReverse({ detail: line }) {\n            const payment_terminal = line.payment_method.payment_terminal;\n            line.set_payment_status('reversing');\n\n            const isReversalSuccessful = await payment_terminal.send_payment_reversal(line.cid);\n            if (isReversalSuccessful) {\n                line.set_amount(0);\n                line.set_payment_status('reversed');\n            } else {\n                line.can_be_reversed = false;\n                line.set_payment_status('done');\n            }\n        }\n        async _sendForceDone({ detail: line }) {\n            line.set_payment_status('done');\n        }\n        _onPrevOrder(prevOrder) {\n            prevOrder.off('change', null, this);\n            prevOrder.paymentlines.off('change', null, this);\n            if (prevOrder) {\n                prevOrder.stop_electronic_payment();\n            }\n        }\n        async _onNewOrder(newOrder) {\n            newOrder.on('change', this.render, this);\n            newOrder.paymentlines.on('change', this.render, this);\n            NumberBuffer.reset();\n            await this.render();\n        }\n    }\n    PaymentScreen.template = 'PaymentScreen';\n\n    Registries.Component.add(PaymentScreen);\n\n    return PaymentScreen;\n});\n", "odoo.define('point_of_sale.Orderline', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class Orderline extends PosComponent {\n        selectLine() {\n            this.trigger('select-line', { orderline: this.props.line });\n        }\n        lotIconClicked() {\n            this.trigger('edit-pack-lot-lines', { orderline: this.props.line });\n        }\n        get addedClasses() {\n            return {\n                selected: this.props.line.selected,\n            };\n        }\n        get customerNote() {\n            return this.props.line.get_customer_note();\n        }\n    }\n    Orderline.template = 'Orderline';\n\n    Registries.Component.add(Orderline);\n\n    return Orderline;\n});\n", "odoo.define('point_of_sale.OrderSummary', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class OrderSummary extends PosComponent {}\n    OrderSummary.template = 'OrderSummary';\n\n    Registries.Component.add(OrderSummary);\n\n    return OrderSummary;\n});\n", "odoo.define('point_of_sale.OrderWidget', function(require) {\n    'use strict';\n\n    const { useState, useRef, onPatched } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const { onChangeOrder } = require('point_of_sale.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class OrderWidget extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('select-line', this._selectLine);\n            useListener('edit-pack-lot-lines', this._editPackLotLines);\n            onChangeOrder(this._onPrevOrder, this._onNewOrder);\n            this.scrollableRef = useRef('scrollable');\n            this.scrollToBottom = false;\n            onPatched(() => {\n                // IMPROVEMENT\n                // This one just stays at the bottom of the orderlines list.\n                // Perhaps it is better to scroll to the added or modified orderline.\n                if (this.scrollToBottom) {\n                    this.scrollableRef.el.scrollTop = this.scrollableRef.el.scrollHeight;\n                    this.scrollToBottom = false;\n                }\n            });\n            this.state = useState({ total: 0, tax: 0 });\n            this._updateSummary();\n        }\n        get order() {\n            return this.env.pos.get_order();\n        }\n        get orderlinesArray() {\n            return this.order ? this.order.get_orderlines() : [];\n        }\n        _selectLine(event) {\n            this.order.select_orderline(event.detail.orderline);\n        }\n        // IMPROVEMENT: Might be better to lift this to ProductScreen\n        // because there is similar operation when clicking a product.\n        //\n        // Furthermore, what if a number different from 1 (or -1) is specified\n        // to an orderline that has product tracked by lot. Lot tracking (based\n        // on the current implementation) requires that 1 item per orderline is\n        // allowed.\n        async _editPackLotLines(event) {\n            const orderline = event.detail.orderline;\n            const isAllowOnlyOneLot = orderline.product.isAllowOnlyOneLot();\n            const packLotLinesToEdit = orderline.getPackLotLinesToEdit(isAllowOnlyOneLot);\n            const { confirmed, payload } = await this.showPopup('EditListPopup', {\n                title: this.env._t('Lot/Serial Number(s) Required'),\n                isSingleItem: isAllowOnlyOneLot,\n                array: packLotLinesToEdit,\n            });\n            if (confirmed) {\n                // Segregate the old and new packlot lines\n                const modifiedPackLotLines = Object.fromEntries(\n                    payload.newArray.filter(item => item.id).map(item => [item.id, item.text])\n                );\n                const newPackLotLines = payload.newArray\n                    .filter(item => !item.id)\n                    .map(item => ({ lot_name: item.text }));\n\n                orderline.setPackLotLines({ modifiedPackLotLines, newPackLotLines });\n            }\n            this.order.select_orderline(event.detail.orderline);\n        }\n        _onNewOrder(order) {\n            if (order) {\n                order.orderlines.on(\n                    'new-orderline-selected',\n                    () => this.trigger('new-orderline-selected'),\n                    this\n                );\n                order.orderlines.on('change', this._updateSummary, this);\n                order.orderlines.on(\n                    'add remove',\n                    () => {\n                        this.scrollToBottom = true;\n                        this._updateSummary();\n                    },\n                    this\n                );\n                order.on('change', this.render, this);\n            }\n            this._updateSummary();\n            this.trigger('new-orderline-selected');\n        }\n        _onPrevOrder(order) {\n            if (order) {\n                order.orderlines.off('new-orderline-selected', null, this);\n                order.orderlines.off('change', null, this);\n                order.orderlines.off('add remove', null, this);\n                order.off('change', null, this);\n            }\n        }\n        _updateSummary() {\n            const total = this.order ? this.order.get_total_with_tax() : 0;\n            const tax = this.order ? total - this.order.get_total_without_tax() : 0;\n            this.state.total = this.env.pos.format_currency(total);\n            this.state.tax = this.env.pos.format_currency(tax);\n            this.render();\n        }\n    }\n    OrderWidget.template = 'OrderWidget';\n\n    Registries.Component.add(OrderWidget);\n\n    return OrderWidget;\n});\n", "odoo.define('point_of_sale.NumpadWidget', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * @prop {'quantity' | 'price' | 'discount'} activeMode\n     * @prop {Array<'quantity' | 'price' | 'discount'>} disabledModes\n     * @prop {boolean} disableSign\n     * @event set-numpad-mode - triggered when mode button is clicked\n     * @event numpad-click-input - triggered when numpad button is clicked\n     *\n     * IMPROVEMENT: Whenever new-orderline-selected is triggered,\n     * numpad mode should be set to 'quantity'. Now that the mode state\n     * is lifted to the parent component, this improvement can be done in\n     * the parent component.\n     */\n    class NumpadWidget extends PosComponent {\n        mounted() {\n            // IMPROVEMENT: This listener shouldn't be here because in core point_of_sale\n            // there is no way of changing the cashier. Only when pos_hr is installed\n            // that this listener makes sense.\n            this.env.pos.on('change:cashier', () => {\n                if (!this.hasPriceControlRights && this.props.activeMode === 'price') {\n                    this.trigger('set-numpad-mode', { mode: 'quantity' });\n                }\n            });\n        }\n        willUnmount() {\n            this.env.pos.on('change:cashier', null, this);\n        }\n        get hasPriceControlRights() {\n            const cashier = this.env.pos.get('cashier') || this.env.pos.get_cashier();\n            return (\n                (!this.env.pos.config.restrict_price_control || cashier.role == 'manager') &&\n                !this.props.disabledModes.includes('price')\n            );\n        }\n        get hasManualDiscount() {\n            return this.env.pos.config.manual_discount && !this.props.disabledModes.includes('discount');\n        }\n        changeMode(mode) {\n            if (!this.hasPriceControlRights && mode === 'price') {\n                return;\n            }\n            if (!this.hasManualDiscount && mode === 'discount') {\n                return;\n            }\n            this.trigger('set-numpad-mode', { mode });\n        }\n        sendInput(key) {\n            this.trigger('numpad-click-input', { key });\n        }\n        get decimalSeparator() {\n            return this.env._t.database.parameters.decimal_point;\n        }\n    }\n    NumpadWidget.template = 'NumpadWidget';\n    NumpadWidget.defaultProps = {\n        disabledModes: [],\n        disableSign: false,\n    }\n\n    Registries.Component.add(NumpadWidget);\n\n    return NumpadWidget;\n});\n", "odoo.define('point_of_sale.ActionpadWidget', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * @props client\n     * @emits click-customer\n     * @emits click-pay\n     */\n    class ActionpadWidget extends PosComponent {\n        get isLongName() {\n            return this.client && this.client.name.length > 10;\n        }\n        get client() {\n            return this.props.client;\n        }\n    }\n    ActionpadWidget.template = 'ActionpadWidget';\n    ActionpadWidget.defaultProps = {\n        isActionButtonHighlighted: false,\n    }\n\n    Registries.Component.add(ActionpadWidget);\n\n    return ActionpadWidget;\n});\n", "odoo.define('point_of_sale.CategoryBreadcrumb', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class CategoryBreadcrumb extends PosComponent {}\n    CategoryBreadcrumb.template = 'CategoryBreadcrumb';\n\n    Registries.Component.add(CategoryBreadcrumb);\n\n    return CategoryBreadcrumb;\n});\n", "odoo.define('point_of_sale.CategoryButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class CategoryButton extends PosComponent {\n        get imageUrl() {\n            const category = this.props.category\n            return `/web/image?model=pos.category&field=image_128&id=${category.id}&write_date=${category.write_date}&unique=1`;\n        }\n    }\n    CategoryButton.template = 'CategoryButton';\n\n    Registries.Component.add(CategoryButton);\n\n    return CategoryButton;\n});\n", "odoo.define('point_of_sale.CategorySimpleButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class CategorySimpleButton extends PosComponent {}\n    CategorySimpleButton.template = 'CategorySimpleButton';\n\n    Registries.Component.add(CategorySimpleButton);\n\n    return CategorySimpleButton;\n});\n", "odoo.define('point_of_sale.HomeCategoryBreadcrumb', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { useListener } = require('web.custom_hooks');\n\n    class HomeCategoryBreadcrumb extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('categ-popup', this._categPopup);\n        }\n        get selectedCategoryId() {\n            return this.env.pos.get('selectedCategoryId');\n        }\n        async _categPopup() {\n            let selectionList = [{\n                id: 0,\n                label:'All Items',\n                isSelected: 0 === this.env.pos.get('selectedCategoryId'),\n                item: {id:0,name:'All Items'},\n            }];\n            let subs = this.props.subcategories.map(category => ({\n                id: category.id,\n                label: category.name,\n                isSelected: category.id === this.env.pos.get('selectedCategoryId'),\n                item: category,\n            }));\n            selectionList = selectionList.concat(subs);\n            const { confirmed, payload: selectedCategory } = await this.showPopup(\n                'SelectionPopup',\n                {\n                    title: this.env._t('Select the category'),\n                    list: selectionList,\n                }\n            );\n            if (confirmed) {\n                this.trigger('switch-category', selectedCategory.id);\n            }\n        }\n    }\n    HomeCategoryBreadcrumb.template = 'HomeCategoryBreadcrumb';\n\n    Registries.Component.add(HomeCategoryBreadcrumb);\n\n    return HomeCategoryBreadcrumb;\n});\n", "odoo.define('point_of_sale.ProductsWidgetControlPanel', function(require) {\n    'use strict';\n\n    const { useRef } = owl.hooks;\n    const { debounce } = owl.utils;\n    const { identifyError } = require('point_of_sale.utils');\n    const { ConnectionLostError, ConnectionAbortedError } = require('@web/core/network/rpc_service');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { posbus } = require('point_of_sale.utils');\n\n    class ProductsWidgetControlPanel extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.searchWordInput = useRef('search-word-input');\n            this.updateSearch = debounce(this.updateSearch, 100);\n        }\n        mounted() {\n            posbus.on('search-product-from-info-popup', this, this.searchProductFromInfo)\n        }\n        willUnmount() {\n            posbus.off('search-product-from-info-popup', this);\n        }\n\n        clearSearch() {\n            this.searchWordInput.el.value = '';\n            this.trigger('clear-search');\n        }\n        get displayCategImages() {\n            return this.env.pos.config.iface_display_categ_images && !this.env.isMobile;\n        }\n        updateSearch(event) {\n            this.trigger('update-search', event.target.value);\n            if (event.key === 'Enter') {\n                // We are passing the searchWordInput ref so that when necessary,\n                // it can be modified by the parent.\n                this.trigger('try-add-product', { searchWordInput: this.searchWordInput });\n            }\n        }\n        searchProductFromInfo(productName) {\n            this.searchWordInput.el.value = productName;\n            this.trigger('switch-category', 0);\n            this.trigger('update-search', productName);\n        }\n        _toggleMobileSearchbar() {\n            this.trigger('toggle-mobile-searchbar');\n        }\n        async loadProductFromDB() {\n            if(!this.searchWordInput.el.value)\n                return;\n\n            try {\n                let ProductIds = await this.rpc({\n                    model: 'product.product',\n                    method: 'search',\n                    args: [[['name', 'ilike', this.searchWordInput.el.value + \"%\"]]],\n                    context: this.env.session.user_context,\n                });\n                if(!ProductIds.length) {\n                    this.showPopup('ErrorPopup', {\n                        title: '',\n                        body: this.env._t(\"No product found\"),\n                    });\n                } else {\n                    await this.env.pos._addProducts(ProductIds);\n                }\n                this.trigger('update-product-list');\n            } catch (error) {\n                const identifiedError = identifyError(error)\n                if (identifiedError instanceof ConnectionLostError || identifiedError instanceof ConnectionAbortedError) {\n                    return this.showPopup('OfflineErrorPopup', {\n                        title: this.env._t('Network Error'),\n                        body: this.env._t(\"Product is not loaded. Tried loading the product from the server but there is a network error.\"),\n                    });\n                } else {\n                    throw error;\n                }\n            }\n        }\n    }\n    ProductsWidgetControlPanel.template = 'ProductsWidgetControlPanel';\n\n    Registries.Component.add(ProductsWidgetControlPanel);\n\n    return ProductsWidgetControlPanel;\n});\n", "odoo.define('point_of_sale.ProductItem', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const models = require('point_of_sale.models');\n\n    class ProductItem extends PosComponent {\n        /**\n         * For accessibility, pressing <space> should be like clicking the product.\n         * <enter> is not considered because it conflicts with the barcode.\n         *\n         * @param {KeyPressEvent} event\n         */\n        spaceClickProduct(event) {\n            if (event.which === 32) {\n                this.trigger('click-product', this.props.product);\n            }\n        }\n        get imageUrl() {\n            const product = this.props.product;\n            return `/web/image?model=product.product&field=image_128&id=${product.id}&write_date=${product.write_date}&unique=1`;\n        }\n        get pricelist() {\n            const current_order = this.env.pos.get_order();\n            if (current_order) {\n                return current_order.pricelist;\n            }\n            return this.env.pos.default_pricelist;\n        }\n        get price() {\n            const formattedUnitPrice = this.env.pos.format_currency(\n                this.props.product.get_price(this.pricelist, 1),\n                'Product Price'\n            );\n            if (this.props.product.to_weight) {\n                return `${formattedUnitPrice}/${\n                    this.env.pos.units_by_id[this.props.product.uom_id[0]].name\n                }`;\n            } else {\n                return formattedUnitPrice;\n            }\n        }\n        onProductInfoClick() {\n            this.showPopup('ProductInfoPopup', { product: this.props.product, quantity: 1 });\n        }\n    }\n    ProductItem.template = 'ProductItem';\n\n    Registries.Component.add(ProductItem);\n\n    return ProductItem;\n});\n", "odoo.define('point_of_sale.ProductList', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class ProductList extends PosComponent {}\n    ProductList.template = 'ProductList';\n\n    Registries.Component.add(ProductList);\n\n    return ProductList;\n});\n", "odoo.define('point_of_sale.ProductsWidget', function(require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class ProductsWidget extends PosComponent {\n        /**\n         * @param {Object} props\n         * @param {number?} props.startCategoryId\n         */\n        constructor() {\n            super(...arguments);\n            useListener('switch-category', this._switchCategory);\n            useListener('update-search', this._updateSearch);\n            useListener('try-add-product', this._tryAddProduct);\n            useListener('clear-search', this._clearSearch);\n            useListener('update-product-list', this._updateProductList);\n            this.state = useState({ searchWord: '' });\n        }\n        mounted() {\n            this.env.pos.on('change:selectedCategoryId', this.render, this);\n        }\n        willUnmount() {\n            this.env.pos.off('change:selectedCategoryId', null, this);\n            this.trigger('toggle-mobile-searchbar', false);\n        }\n        get selectedCategoryId() {\n            return this.env.pos.get('selectedCategoryId');\n        }\n        get searchWord() {\n            return this.state.searchWord.trim();\n        }\n        get productsToDisplay() {\n            let list = [];\n            if (this.searchWord !== '') {\n                list = this.env.pos.db.search_product_in_category(\n                    this.selectedCategoryId,\n                    this.searchWord\n                );\n            } else {\n                list = this.env.pos.db.get_product_by_category(this.selectedCategoryId);\n            }\n            return list.sort(function (a, b) { return a.display_name.localeCompare(b.display_name) });\n        }\n        get subcategories() {\n            return this.env.pos.db\n                .get_category_childs_ids(this.selectedCategoryId)\n                .map(id => this.env.pos.db.get_category_by_id(id));\n        }\n        get breadcrumbs() {\n            if (this.selectedCategoryId === this.env.pos.db.root_category_id) return [];\n            return [\n                ...this.env.pos.db\n                    .get_category_ancestors_ids(this.selectedCategoryId)\n                    .slice(1),\n                this.selectedCategoryId,\n            ].map(id => this.env.pos.db.get_category_by_id(id));\n        }\n        get hasNoCategories() {\n            return this.env.pos.db.get_category_childs_ids(0).length === 0;\n        }\n        _switchCategory(event) {\n            this.env.pos.set('selectedCategoryId', event.detail);\n        }\n        _updateSearch(event) {\n            this.state.searchWord = event.detail;\n        }\n        _tryAddProduct(event) {\n            const searchResults = this.productsToDisplay;\n            // If the search result contains one item, add the product and clear the search.\n            if (searchResults.length === 1) {\n                const { searchWordInput } = event.detail;\n                this.trigger('click-product', searchResults[0]);\n                // the value of the input element is not linked to the searchWord state,\n                // so we clear both the state and the element's value.\n                searchWordInput.el.value = '';\n                this._clearSearch();\n            }\n        }\n        _clearSearch() {\n            this.state.searchWord = '';\n        }\n        _updateProductList(event) {\n            this.render();\n            this.trigger('switch-category', 0);\n        }\n    }\n    ProductsWidget.template = 'ProductsWidget';\n\n    Registries.Component.add(ProductsWidget);\n\n    return ProductsWidget;\n});\n", "odoo.define('point_of_sale.WrappedProductNameLines', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class WrappedProductNameLines extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.line = this.props.line;\n        }\n    }\n    WrappedProductNameLines.template = 'WrappedProductNameLines';\n\n    Registries.Component.add(WrappedProductNameLines);\n\n    return WrappedProductNameLines;\n});\n", "odoo.define('point_of_sale.OrderReceipt', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class OrderReceipt extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this._receiptEnv = this.props.order.getOrderReceiptEnv();\n        }\n        willUpdateProps(nextProps) {\n            this._receiptEnv = nextProps.order.getOrderReceiptEnv();\n        }\n        get receipt() {\n            return this.receiptEnv.receipt;\n        }\n        get orderlines() {\n            return this.receiptEnv.orderlines;\n        }\n        get paymentlines() {\n            return this.receiptEnv.paymentlines;\n        }\n        get isTaxIncluded() {\n            return Math.abs(this.receipt.subtotal - this.receipt.total_with_tax) <= 0.000001;\n        }\n        get receiptEnv () {\n          return this._receiptEnv;\n        }\n        isSimple(line) {\n            return (\n                line.discount === 0 &&\n                line.is_in_unit &&\n                line.quantity === 1 &&\n                !(\n                    line.display_discount_policy == 'without_discount' &&\n                    line.price < line.price_lst\n                )\n            );\n        }\n    }\n    OrderReceipt.template = 'OrderReceipt';\n\n    Registries.Component.add(OrderReceipt);\n\n    return OrderReceipt;\n});\n", "odoo.define('point_of_sale.ReceiptScreen', function (require) {\n    'use strict';\n\n    const { Printer } = require('point_of_sale.Printer');\n    const { is_email } = require('web.utils');\n    const { useRef, useContext } = owl.hooks;\n    const { useErrorHandlers, onChangeOrder } = require('point_of_sale.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n    const AbstractReceiptScreen = require('point_of_sale.AbstractReceiptScreen');\n\n    const ReceiptScreen = (AbstractReceiptScreen) => {\n        class ReceiptScreen extends AbstractReceiptScreen {\n            constructor() {\n                super(...arguments);\n                useErrorHandlers();\n                onChangeOrder(null, (newOrder) => newOrder && this.render());\n                this.orderReceipt = useRef('order-receipt');\n                const order = this.currentOrder;\n                const client = order.get_client();\n                this.orderUiState = useContext(order.uiState.ReceiptScreen);\n                this.orderUiState.inputEmail = this.orderUiState.inputEmail || (client && client.email) || '';\n                this.is_email = is_email;\n            }\n            mounted() {\n                // Here, we send a task to the event loop that handles\n                // the printing of the receipt when the component is mounted.\n                // We are doing this because we want the receipt screen to be\n                // displayed regardless of what happen to the handleAutoPrint\n                // call.\n                setTimeout(async () => {\n                    let images = this.orderReceipt.el.getElementsByTagName('img');\n                    for(let image of images) {\n                        await image.decode();\n                    }\n                    await this.handleAutoPrint();\n                }, 0);\n            }\n            async onSendEmail() {\n                if (!is_email(this.orderUiState.inputEmail)) {\n                    this.orderUiState.emailSuccessful = false;\n                    this.orderUiState.emailNotice = this.env._t('Invalid email.');\n                    return;\n                }\n                try {\n                    await this._sendReceiptToCustomer();\n                    this.orderUiState.emailSuccessful = true;\n                    this.orderUiState.emailNotice = this.env._t('Email sent.');\n                } catch (error) {\n                    this.orderUiState.emailSuccessful = false;\n                    this.orderUiState.emailNotice = this.env._t('Sending email failed. Please try again.');\n                }\n            }\n            get orderAmountPlusTip() {\n                const order = this.currentOrder;\n                const orderTotalAmount = order.get_total_with_tax();\n                const tip_product_id = this.env.pos.config.tip_product_id && this.env.pos.config.tip_product_id[0];\n                const tipLine = order\n                    .get_orderlines()\n                    .find((line) => tip_product_id && line.product.id === tip_product_id);\n                const tipAmount = tipLine ? tipLine.get_all_prices().priceWithTax : 0;\n                const orderAmountStr = this.env.pos.format_currency(orderTotalAmount - tipAmount);\n                if (!tipAmount) return orderAmountStr;\n                const tipAmountStr = this.env.pos.format_currency(tipAmount);\n                return `${orderAmountStr} + ${tipAmountStr} tip`;\n            }\n            get currentOrder() {\n                return this.env.pos.get_order();\n            }\n            get nextScreen() {\n                return { name: 'ProductScreen' };\n            }\n            whenClosing() {\n                this.orderDone();\n            }\n            /**\n             * This function is called outside the rendering call stack. This way,\n             * we don't block the displaying of ReceiptScreen when it is mounted; additionally,\n             * any error that can happen during the printing does not affect the rendering.\n             */\n            async handleAutoPrint() {\n                if (this._shouldAutoPrint()) {\n                    await this.printReceipt();\n                    if (this.currentOrder._printed && this._shouldCloseImmediately()) {\n                        this.whenClosing();\n                    }\n                }\n            }\n            orderDone() {\n                this.currentOrder.finalize();\n                const { name, props } = this.nextScreen;\n                this.showScreen(name, props);\n            }\n            async printReceipt() {\n                const isPrinted = await this._printReceipt();\n                if (isPrinted) {\n                    this.currentOrder._printed = true;\n                }\n            }\n            _shouldAutoPrint() {\n                return this.env.pos.config.iface_print_auto && !this.currentOrder._printed;\n            }\n            _shouldCloseImmediately() {\n                var invoiced_finalized = this.currentOrder.is_to_invoice() ? this.currentOrder.finalized : true;\n                return this.env.pos.proxy.printer && this.env.pos.config.iface_print_skip_screen && invoiced_finalized;\n            }\n            async _sendReceiptToCustomer() {\n                const printer = new Printer(null, this.env.pos);\n                const receiptString = this.orderReceipt.comp.el.outerHTML;\n                const ticketImage = await printer.htmlToImg(receiptString);\n                const order = this.currentOrder;\n                const client = order.get_client();\n                const orderName = order.get_name();\n                const orderClient = { email: this.orderUiState.inputEmail, name: client ? client.name : this.orderUiState.inputEmail };\n                const order_server_id = this.env.pos.validated_orders_name_server_id_map[orderName];\n                await this.rpc({\n                    model: 'pos.order',\n                    method: 'action_receipt_to_customer',\n                    args: [[order_server_id], orderName, orderClient, ticketImage],\n                });\n            }\n        }\n        ReceiptScreen.template = 'ReceiptScreen';\n        return ReceiptScreen;\n    };\n\n    Registries.Component.addByExtending(ReceiptScreen, AbstractReceiptScreen);\n\n    return ReceiptScreen;\n});\n", "odoo.define('point_of_sale.ScaleScreen', function(require) {\n    'use strict';\n\n    const { useState, useExternalListener } = owl.hooks;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const { round_precision: round_pr } = require('web.utils');\n    const Registries = require('point_of_sale.Registries');\n\n    class ScaleScreen extends PosComponent {\n        /**\n         * @param {Object} props\n         * @param {Object} props.product The product to weight.\n         */\n        constructor() {\n            super(...arguments);\n            useExternalListener(document, 'keyup', this._onHotkeys);\n            this.state = useState({ weight: 0 });\n        }\n        mounted() {\n            // start the scale reading\n            this._readScale();\n        }\n        willUnmount() {\n            // stop the scale reading\n            this.env.pos.proxy_queue.clear();\n        }\n        back() {\n            this.props.resolve({ confirmed: false, payload: null });\n            this.trigger('close-temp-screen');\n        }\n        confirm() {\n            this.props.resolve({\n                confirmed: true,\n                payload: { weight: this.state.weight },\n            });\n            this.trigger('close-temp-screen');\n        }\n        _onHotkeys(event) {\n            if (event.key === 'Escape') {\n                this.back();\n            } else if (event.key === 'Enter') {\n                this.confirm();\n            }\n        }\n        _readScale() {\n            this.env.pos.proxy_queue.schedule(this._setWeight.bind(this), {\n                duration: 500,\n                repeat: true,\n            });\n        }\n        async _setWeight() {\n            const reading = await this.env.pos.proxy.scale_read();\n            this.state.weight = reading.weight;\n        }\n        get _activePricelist() {\n            const current_order = this.env.pos.get_order();\n            let current_pricelist = this.env.pos.default_pricelist;\n            if (current_order) {\n                current_pricelist = current_order.pricelist;\n            }\n            return current_pricelist;\n        }\n        get productWeightString() {\n            const defaultstr = (this.state.weight || 0).toFixed(3) + ' Kg';\n            if (!this.props.product || !this.env.pos) {\n                return defaultstr;\n            }\n            const unit_id = this.props.product.uom_id;\n            if (!unit_id) {\n                return defaultstr;\n            }\n            const unit = this.env.pos.units_by_id[unit_id[0]];\n            const weight = round_pr(this.state.weight || 0, unit.rounding);\n            let weightstr = weight.toFixed(Math.ceil(Math.log(1.0 / unit.rounding) / Math.log(10)));\n            weightstr += ' ' + unit.name;\n            return weightstr;\n        }\n        get computedPriceString() {\n            return this.env.pos.format_currency(this.productPrice * this.state.weight);\n        }\n        get productPrice() {\n            const product = this.props.product;\n            return (product ? product.get_price(this._activePricelist, this.state.weight) : 0) || 0;\n        }\n        get productName() {\n            return (\n                (this.props.product ? this.props.product.display_name : undefined) ||\n                'Unnamed Product'\n            );\n        }\n        get productUom() {\n            return this.props.product\n                ? this.env.pos.units_by_id[this.props.product.uom_id[0]].name\n                : '';\n        }\n    }\n    ScaleScreen.template = 'ScaleScreen';\n\n    Registries.Component.add(ScaleScreen);\n\n    return ScaleScreen;\n});\n", "odoo.define('point_of_sale.CashierName', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    // Previously UsernameWidget\n    class CashierName extends PosComponent {\n        get username() {\n            const { name } = this.env.pos.get_cashier();\n            return name ? name : '';\n        }\n        get avatar() {\n            const { user_id } = this.env.pos.get_cashier();\n            const id = user_id && user_id.length ? user_id[0] : -1;\n            return `/web/image/res.users/${id}/avatar_128`;\n        }\n    }\n    CashierName.template = 'CashierName';\n\n    Registries.Component.add(CashierName);\n\n    return CashierName;\n});\n", "odoo.define('point_of_sale.ProxyStatus', function(require) {\n    'use strict';\n\n    const { useState } = owl;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    // Previously ProxyStatusWidget\n    class ProxyStatus extends PosComponent {\n        constructor() {\n            super(...arguments);\n            const initialProxyStatus = this.env.pos.proxy.get('status');\n            this.state = useState({\n                status: initialProxyStatus.status,\n                msg: initialProxyStatus.msg,\n            });\n            this.statuses = ['connected', 'connecting', 'disconnected', 'warning'];\n            this.index = 0;\n        }\n        mounted() {\n            this.env.pos.proxy.on('change:status', this, this._onChangeStatus);\n        }\n        willUnmount() {\n            this.env.pos.proxy.off('change:status', this, this._onChangeStatus);\n        }\n        async onClick() {\n            try {\n                await this.env.pos.connect_to_proxy();\n            } catch (error) {\n                if (error instanceof Error) {\n                    throw error;\n                } else {\n                    this.showPopup('ErrorPopup', error);\n                }\n            }\n        }\n        _onChangeStatus(posProxy, statusChange) {\n            this._setStatus(statusChange.newValue);\n        }\n        _setStatus(newStatus) {\n            if (newStatus.status === 'connected') {\n                var warning = false;\n                var msg = '';\n                if (this.env.pos.config.iface_scan_via_proxy) {\n                    var scannerStatus = newStatus.drivers.scanner\n                        ? newStatus.drivers.scanner.status\n                        : false;\n                    if (scannerStatus != 'connected' && scannerStatus != 'connecting') {\n                        warning = true;\n                        msg += this.env._t('Scanner');\n                    }\n                }\n                if (\n                    this.env.pos.config.iface_print_via_proxy ||\n                    this.env.pos.config.iface_cashdrawer\n                ) {\n                    var printerStatus = newStatus.drivers.printer\n                        ? newStatus.drivers.printer.status\n                        : false;\n                    if (printerStatus != 'connected' && printerStatus != 'connecting') {\n                        warning = true;\n                        msg = msg ? msg + ' & ' : msg;\n                        msg += this.env._t('Printer');\n                    }\n                }\n                if (this.env.pos.config.iface_electronic_scale) {\n                    var scaleStatus = newStatus.drivers.scale\n                        ? newStatus.drivers.scale.status\n                        : false;\n                    if (scaleStatus != 'connected' && scaleStatus != 'connecting') {\n                        warning = true;\n                        msg = msg ? msg + ' & ' : msg;\n                        msg += this.env._t('Scale');\n                    }\n                }\n                msg = msg ? msg + ' ' + this.env._t('Offline') : msg;\n\n                this.state.status = warning ? 'warning' : 'connected';\n                this.state.msg = msg;\n            } else {\n                this.state.status = newStatus.status;\n                this.state.msg = newStatus.msg || '';\n            }\n        }\n    }\n    ProxyStatus.template = 'ProxyStatus';\n\n    Registries.Component.add(ProxyStatus);\n\n    return ProxyStatus;\n});\n", "odoo.define('point_of_sale.SyncNotification', function(require) {\n    'use strict';\n\n    const { useState } = owl;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    // Previously SynchNotificationWidget\n    class SyncNotification extends PosComponent {\n        constructor() {\n            super(...arguments);\n            const synch = this.env.pos.get('synch');\n            this.state = useState({ status: synch.status, msg: synch.pending });\n        }\n        mounted() {\n            this.env.pos.on(\n                'change:synch',\n                (pos, synch) => {\n                    this.state.status = synch.status;\n                    this.state.msg = synch.pending;\n                },\n                this\n            );\n        }\n        willUnmount() {\n            this.env.pos.on('change:synch', null, this);\n        }\n        onClick() {\n            this.env.pos.push_orders(null, { show_error: true });\n        }\n    }\n    SyncNotification.template = 'SyncNotification';\n\n    Registries.Component.add(SyncNotification);\n\n    return SyncNotification;\n});\n", "odoo.define('point_of_sale.HeaderButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    // Previously HeaderButtonWidget\n    // This is the close session button\n    class HeaderButton extends PosComponent {\n        onClick() {\n            this.showPopup('ClosePosPopup');\n        }\n    }\n    HeaderButton.template = 'HeaderButton';\n\n    Registries.Component.add(HeaderButton);\n\n    return HeaderButton;\n});\n", "odoo.define('point_of_sale.SaleDetailsButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class SaleDetailsButton extends PosComponent {\n        async onClick() {\n            // IMPROVEMENT: Perhaps put this logic in a parent component\n            // so that for unit testing, we can check if this simple\n            // component correctly triggers an event.\n            const saleDetails = await this.rpc({\n                model: 'report.point_of_sale.report_saledetails',\n                method: 'get_sale_details',\n                args: [false, false, false, [this.env.pos.pos_session.id]],\n            });\n            const report = this.env.qweb.renderToString(\n                'SaleDetailsReport',\n                Object.assign({}, saleDetails, {\n                    date: new Date().toLocaleString(),\n                    pos: this.env.pos,\n                })\n            );\n            const printResult = await this.env.pos.proxy.printer.print_receipt(report);\n            if (!printResult.successful) {\n                await this.showPopup('ErrorPopup', {\n                    title: printResult.message.title,\n                    body: printResult.message.body,\n                });\n            }\n        }\n    }\n    SaleDetailsButton.template = 'SaleDetailsButton';\n\n    Registries.Component.add(SaleDetailsButton);\n\n    return SaleDetailsButton;\n});\n", "odoo.define('point_of_sale.CashMoveButton', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { _t } = require('web.core');\n\n    const TRANSLATED_CASH_MOVE_TYPE = {\n        in: _t('in'),\n        out: _t('out'),\n    };\n\n    class CashMoveButton extends PosComponent {\n        async onClick() {\n            const { confirmed, payload } = await this.showPopup('CashMovePopup');\n            if (!confirmed) return;\n            const { type, amount, reason } = payload;\n            const translatedType = TRANSLATED_CASH_MOVE_TYPE[type];\n            const formattedAmount = this.env.pos.format_currency(amount);\n            if (!amount) {\n                return this.showNotification(\n                    _.str.sprintf(this.env._t('Cash in/out of %s is ignored.'), formattedAmount),\n                    3000\n                );\n            }\n            const extras = { formattedAmount, translatedType };\n            await this.rpc({\n                model: 'pos.session',\n                method: 'try_cash_in_out',\n                args: [[this.env.pos.pos_session.id], type, amount, reason, extras],\n            });\n            if (this.env.pos.proxy.printer) {\n                const renderedReceipt = this.env.qweb.renderToString('point_of_sale.CashMoveReceipt', {\n                    _receipt: this._getReceiptInfo({ ...payload, translatedType, formattedAmount }),\n                });\n                const printResult = await this.env.pos.proxy.printer.print_receipt(renderedReceipt);\n                if (!printResult.successful) {\n                    this.showPopup('ErrorPopup', { title: printResult.message.title, body: printResult.message.body });\n                }\n            }\n            this.showNotification(\n                _.str.sprintf(this.env._t('Successfully made a cash %s of %s.'), type, formattedAmount),\n                3000\n            );\n        }\n        _getReceiptInfo(payload) {\n            const result = { ...payload };\n            result.cashier = this.env.pos.get_cashier();\n            result.company = this.env.pos.company;\n            return result;\n        }\n    }\n    CashMoveButton.template = 'point_of_sale.CashMoveButton';\n\n    Registries.Component.add(CashMoveButton);\n\n    return CashMoveButton;\n});\n", "odoo.define('point_of_sale.TicketButton', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const { posbus } = require('point_of_sale.utils');\n\n    class TicketButton extends PosComponent {\n        onClick() {\n            if (this.props.isTicketScreenShown) {\n                posbus.trigger('ticket-button-clicked');\n            } else {\n                this.showScreen('TicketScreen');\n            }\n        }\n        willPatch() {\n            posbus.off('order-deleted', this);\n        }\n        patched() {\n            posbus.on('order-deleted', this, this.render);\n        }\n        mounted() {\n            posbus.on('order-deleted', this, this.render);\n        }\n        willUnmount() {\n            posbus.off('order-deleted', this);\n        }\n        get count() {\n            if (this.env.pos) {\n                return this.env.pos.get_order_list().length;\n            } else {\n                return 0;\n            }\n        }\n    }\n    TicketButton.template = 'TicketButton';\n\n    Registries.Component.add(TicketButton);\n\n    return TicketButton;\n});\n", "odoo.define('point_of_sale.CurrencyAmount', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class CurrencyAmount extends PosComponent {}\n    CurrencyAmount.template = 'CurrencyAmount';\n\n    Registries.Component.add(CurrencyAmount);\n\n    return CurrencyAmount;\n});\n", "odoo.define('point_of_sale.Draggable', function(require) {\n    'use strict';\n\n    const { useExternalListener } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * Wrap an element or a component with { position: absolute } to make it\n     * draggable around the limitArea or the nearest positioned ancestor.\n     *\n     * e.g.\n     * ```\n     * <div class=\"limit-area\">\n     *   <Draggable limitArea=\"'.limit-area'\">\n     *     <div class=\"popup\">\n     *       <header class=\"drag-handle\"></header>\n     *     </div>\n     *     <div class=\"popup body\"></div>\n     *   </Draggable>\n     * </div>\n     * ```\n     *\n     * In the above snippet, if the popup div is { position: absolute },\n     * then it becomes draggable around the .limit-area element if it is dragged\n     * thru its Header -- because of the .drag-handle element.\n     *\n     * @trigger 'drag-end' when dragging ended with payload `{ loc: { top, left } }`\n     */\n    class Draggable extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.isDragging = false;\n            this.dx = 0;\n            this.dy = 0;\n            // drag with mouse\n            useExternalListener(document, 'mousemove', this.move);\n            useExternalListener(document, 'mouseup', this.endDrag);\n            // drag with touch\n            useExternalListener(document, 'touchmove', this.move);\n            useExternalListener(document, 'touchend', this.endDrag);\n\n            useListener('mousedown', '.drag-handle', this.startDrag);\n            useListener('touchstart', '.drag-handle', this.startDrag);\n        }\n        mounted() {\n            this.limitArea = this.props.limitArea\n                ? document.querySelector(this.props.limitArea)\n                : this.el.offsetParent;\n            this.limitAreaBoundingRect = this.limitArea.getBoundingClientRect();\n            if (this.limitArea === this.el.offsetParent) {\n                this.limitLeft = 0;\n                this.limitTop = 0;\n                this.limitRight = this.limitAreaBoundingRect.width;\n                this.limitBottom = this.limitAreaBoundingRect.height;\n            } else {\n                this.limitLeft = -this.el.offsetParent.offsetLeft;\n                this.limitTop = -this.el.offsetParent.offsetTop;\n                this.limitRight =\n                    this.limitAreaBoundingRect.width - this.el.offsetParent.offsetLeft;\n                this.limitBottom =\n                    this.limitAreaBoundingRect.height - this.el.offsetParent.offsetTop;\n            }\n            this.limitAreaWidth = this.limitAreaBoundingRect.width;\n            this.limitAreaHeight = this.limitAreaBoundingRect.height;\n\n            // absolutely position the element then remove the transform.\n            const elBoundingRect = this.el.getBoundingClientRect();\n            this.el.style.top = `${elBoundingRect.top}px`;\n            this.el.style.left = `${elBoundingRect.left}px`;\n            this.el.style.transform = 'none';\n        }\n        startDrag(event) {\n            let realEvent;\n            if (event instanceof CustomEvent) {\n                realEvent = event.detail;\n            } else {\n                realEvent = event;\n            }\n            const { x, y } = this._getEventLoc(realEvent);\n            this.isDragging = true;\n            this.dx = this.el.offsetLeft - x;\n            this.dy = this.el.offsetTop - y;\n            event.stopPropagation();\n        }\n        move(event) {\n            if (this.isDragging) {\n                const { x: pointerX, y: pointerY } = this._getEventLoc(event);\n                const posLeft = this._getPosLeft(pointerX, this.dx);\n                const posTop = this._getPosTop(pointerY, this.dy);\n                this.el.style.left = `${posLeft}px`;\n                this.el.style.top = `${posTop}px`;\n            }\n        }\n        endDrag() {\n            if (this.isDragging) {\n                this.isDragging = false;\n                this.trigger('drag-end', {\n                    loc: { top: this.el.offsetTop, left: this.el.offsetLeft },\n                });\n            }\n        }\n        _getEventLoc(event) {\n            let coordX, coordY;\n            if (event.touches && event.touches[0]) {\n                coordX = event.touches[0].clientX;\n                coordY = event.touches[0].clientY;\n            } else {\n                coordX = event.clientX;\n                coordY = event.clientY;\n            }\n            return {\n                x: coordX,\n                y: coordY,\n            };\n        }\n        _getPosLeft(pointerX, dx) {\n            const posLeft = pointerX + dx;\n            if (posLeft < this.limitLeft) {\n                return this.limitLeft;\n            } else if (posLeft > this.limitRight - this.el.offsetWidth) {\n                return this.limitRight - this.el.offsetWidth;\n            }\n            return posLeft;\n        }\n        _getPosTop(pointerY, dy) {\n            const posTop = pointerY + dy;\n            if (posTop < this.limitTop) {\n                return this.limitTop;\n            } else if (posTop > this.limitBottom - this.el.offsetHeight) {\n                return this.limitBottom - this.el.offsetHeight;\n            }\n            return posTop;\n        }\n    }\n    Draggable.template = 'Draggable';\n\n    Registries.Component.add(Draggable);\n\n    return Draggable;\n});\n", "odoo.define('point_of_sale.NotificationSound', function (require) {\n    'use strict';\n\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class NotificationSound extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('ended', () => (this.props.sound.src = null));\n        }\n    }\n    NotificationSound.template = 'NotificationSound';\n\n    Registries.Component.add(NotificationSound);\n\n    return NotificationSound;\n});\n", "odoo.define('point_of_sale.IndependentToOrderScreen', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n\n    class IndependentToOrderScreen extends PosComponent {\n        /**\n         * Alias the forceTriggerSelectedOrder method as it also\n         * means 'closing' this screen.\n         */\n        close() {\n            this.forceTriggerSelectedOrder();\n        }\n        forceTriggerSelectedOrder() {\n            // Calling this method forcefully trigger change\n            // on the selectedOrder attribute, which then shows the screen of the\n            // current order, essentially closing this screen.\n            this.env.pos.trigger('change:selectedOrder', this.env.pos, this.env.pos.get_order());\n        }\n    }\n\n    return IndependentToOrderScreen;\n});\n", "odoo.define('point_of_sale.AbstractReceiptScreen', function (require) {\n    'use strict';\n\n    const { useRef } = owl.hooks;\n    const { nextFrame } = require('point_of_sale.utils');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * This relies on the assumption that there is a reference to\n     * `order-receipt` so it is important to declare a `t-ref` to\n     * `order-receipt` in the template of the Component that extends\n     * this abstract component.\n     */\n    class AbstractReceiptScreen extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.orderReceipt = useRef('order-receipt');\n        }\n        async _printReceipt() {\n            if (this.env.pos.proxy.printer) {\n                const printResult = await this.env.pos.proxy.printer.print_receipt(this.orderReceipt.el.outerHTML);\n                if (printResult.successful) {\n                    return true;\n                } else {\n                    const { confirmed } = await this.showPopup('ConfirmPopup', {\n                        title: printResult.message.title,\n                        body: 'Do you want to print using the web printer?',\n                    });\n                    if (confirmed) {\n                        // We want to call the _printWeb when the popup is fully gone\n                        // from the screen which happens after the next animation frame.\n                        await nextFrame();\n                        return await this._printWeb();\n                    }\n                    return false;\n                }\n            } else {\n                return await this._printWeb();\n            }\n        }\n        async _printWeb() {\n            try {\n                window.print();\n                return true;\n            } catch (err) {\n                await this.showPopup('ErrorPopup', {\n                    title: this.env._t('Printing is not supported on some browsers'),\n                    body: this.env._t(\n                        'Printing is not supported on some browsers due to no default printing protocol ' +\n                            'is available. It is possible to print your tickets by making use of an IoT Box.'\n                    ),\n                });\n                return false;\n            }\n        }\n    }\n\n    Registries.Component.add(AbstractReceiptScreen);\n\n    return AbstractReceiptScreen;\n});\n", "odoo.define('point_of_sale.SearchBar', function (require) {\n    'use strict';\n\n    const { useState, useExternalListener } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * This is a simple configurable search bar component. It has search fields\n     * and selection filter. Search fields allow the users to specify the type\n     * of their searches. The filter is a dropdown menu for selection. Depending on\n     * user's action, this component emits corresponding event with the action\n     * information (payload).\n     *\n     * TODO: This component can be made more generic and be able to replace\n     * all the search bars across pos ui.\n     *\n     * @prop {{\n     *  config: {\n     *      searchFields: Map<string, string>,\n     *      filter: { show: boolean, options: Map<string, { text: string, indented: boolean? }> }\n     *  },\n     *  placeholder: string,\n     * }}\n     * @emits search @payload { fieldName: string, searchTerm: '' }\n     * @emits filter-selected @payload { filter: string }\n     *\n     * NOTE: The payload of the emitted event is accessible via the `detail`\n     * field of the event.\n     */\n    class SearchBar extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useExternalListener(window, 'click', this._hideOptions);\n            useListener('click-search-field', this._onClickSearchField);\n            useListener('select-filter', this._onSelectFilter);\n            this.filterOptionsList = [...this.props.config.filter.options.keys()];\n            this.searchFieldsList = [...this.props.config.searchFields.keys()];\n            const defaultSearchFieldId = this.searchFieldsList.indexOf(\n                this.props.config.defaultSearchDetails.fieldName\n            );\n            this.state = useState({\n                searchInput: this.props.config.defaultSearchDetails.searchTerm || '',\n                selectedSearchFieldId: defaultSearchFieldId == -1 ? 0 : defaultSearchFieldId,\n                showSearchFields: false,\n                showFilterOptions: false,\n                selectedFilter: this.props.config.defaultFilter || this.filterOptionsList[0],\n            });\n        }\n        _onSelectFilter({ detail: key }) {\n            this.state.selectedFilter = key;\n            this.trigger('filter-selected', { filter: this.state.selectedFilter });\n        }\n        /**\n         * When pressing vertical arrow keys, do not move the input cursor.\n         */\n        onSearchInputKeydown(event) {\n            if (['ArrowUp', 'ArrowDown'].includes(event.key)) {\n                event.preventDefault();\n            }\n        }\n        /**\n         * When vertical arrow keys are pressed, select fields for searching.\n         * When enter key is pressed, trigger search event if there is searchInput.\n         */\n        onSearchInputKeyup(event) {\n            if (['ArrowUp', 'ArrowDown'].includes(event.key)) {\n                this.state.selectedSearchFieldId = this._fieldIdToSelect(event.key);\n            } else if (event.key === 'Enter' || this.state.searchInput == '') {\n                this._onClickSearchField({ detail: this.searchFieldsList[this.state.selectedSearchFieldId] });\n            } else {\n                if (this.state.selectedSearchFieldId === -1 && this.searchFieldsList.length) {\n                    this.state.selectedSearchFieldId = 0;\n                }\n                this.state.showSearchFields = true;\n            }\n        }\n        /**\n         * Called when a search field is clicked.\n         */\n        _onClickSearchField({ detail: fieldName }) {\n            this.state.showSearchFields = false;\n            this.trigger('search', { fieldName, searchTerm: this.state.searchInput });\n        }\n        /**\n         * Given an arrow key, return the next selectedSearchFieldId.\n         * E.g. If the selectedSearchFieldId is 1 and ArrowDown is pressed, return 2.\n         *\n         * @param {string} key vertical arrow key\n         */\n        _fieldIdToSelect(key) {\n            const length = this.searchFieldsList.length;\n            if (!length) return null;\n            if (this.state.selectedSearchFieldId === -1) return 0;\n            const current = this.state.selectedSearchFieldId || length;\n            return (current + (key === 'ArrowDown' ? 1 : -1)) % length;\n        }\n        _hideOptions() {\n            this.state.showFilterOptions = false;\n            this.state.showSearchFields = false;\n        }\n    }\n    SearchBar.template = 'point_of_sale.SearchBar';\n    Registries.Component.add(SearchBar);\n\n    return SearchBar;\n});\n", "odoo.define('point_of_sale.DebugWidget', function (require) {\n    'use strict';\n\n    const { useState } = owl;\n    const { useRef } = owl.hooks;\n    const { getFileAsText } = require('point_of_sale.utils');\n    const { parse } = require('web.field_utils');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class DebugWidget extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.state = useState({\n                barcodeInput: '',\n                weightInput: '',\n                isPaidOrdersReady: false,\n                isUnpaidOrdersReady: false,\n                buffer: NumberBuffer.get(),\n            });\n\n            // NOTE: Perhaps this can still be improved.\n            // What we do here is loop thru the `event` elements\n            // then we assign animation that happens when the event is triggered\n            // in the proxy. E.g. if open_cashbox is sent, the open_cashbox element\n            // changes color from '#6CD11D' to '#1E1E1E' for a duration of 2sec.\n            this.eventElementsRef = {};\n            this.animations = {};\n            for (let eventName of ['open_cashbox', 'print_receipt', 'scale_read']) {\n                this.eventElementsRef[eventName] = useRef(eventName);\n                this.env.pos.proxy.add_notification(\n                    eventName,\n                    (() => {\n                        if (this.animations[eventName]) {\n                            this.animations[eventName].cancel();\n                        }\n                        const eventElement = this.eventElementsRef[eventName].el;\n                        eventElement.style.backgroundColor = '#6CD11D';\n                        this.animations[eventName] = eventElement.animate(\n                            { backgroundColor: ['#6CD11D', '#1E1E1E'] },\n                            2000\n                        );\n                    }).bind(this)\n                );\n            }\n        }\n        mounted() {\n            NumberBuffer.on('buffer-update', this, this._onBufferUpdate);\n        }\n        willUnmount() {\n            NumberBuffer.off('buffer-update', this, this._onBufferUpdate);\n        }\n        toggleWidget() {\n            this.state.isShown = !this.state.isShown;\n        }\n        setWeight() {\n            var weightInKg = parse.float(this.state.weightInput);\n            if (!isNaN(weightInKg)) {\n                this.env.pos.proxy.debug_set_weight(weightInKg);\n            }\n        }\n        resetWeight() {\n            this.state.weightInput = '';\n            this.env.pos.proxy.debug_reset_weight();\n        }\n        async barcodeScan() {\n            await this.env.pos.barcode_reader.scan(this.state.barcodeInput);\n        }\n        async barcodeScanEAN() {\n            const ean = this.env.pos.barcode_reader.barcode_parser.sanitize_ean(\n                this.state.barcodeInput || '0'\n            );\n            this.state.barcodeInput = ean;\n            await this.env.pos.barcode_reader.scan(ean);\n        }\n        async deleteOrders() {\n            const { confirmed } = await this.showPopup('ConfirmPopup', {\n                title: this.env._t('Delete Paid Orders ?'),\n                body: this.env._t(\n                    'This operation will permanently destroy all paid orders from the local storage. You will lose all the data. This operation cannot be undone.'\n                ),\n            });\n            if (confirmed) {\n                this.env.pos.db.remove_all_orders();\n                this.env.pos.set_synch('connected', 0);\n            }\n        }\n        async deleteUnpaidOrders() {\n            const { confirmed } = await this.showPopup('ConfirmPopup', {\n                title: this.env._t('Delete Unpaid Orders ?'),\n                body: this.env._t(\n                    'This operation will destroy all unpaid orders in the browser. You will lose all the unsaved data and exit the point of sale. This operation cannot be undone.'\n                ),\n            });\n            if (confirmed) {\n                this.env.pos.db.remove_all_unpaid_orders();\n                window.location = '/';\n            }\n        }\n        _createBlob(contents) {\n            if (typeof contents !== 'string') {\n                contents = JSON.stringify(contents, null, 2);\n            }\n            return new Blob([contents]);\n        }\n        // IMPROVEMENT: Duplicated codes for downloading paid and unpaid orders.\n        // The implementation can be better.\n        preparePaidOrders() {\n            try {\n                this.paidOrdersBlob = this._createBlob(this.env.pos.export_paid_orders());\n                this.state.isPaidOrdersReady = true;\n            } catch (error) {\n                console.warn(error);\n            }\n        }\n        get paidOrdersFilename() {\n            return `${this.env._t('paid orders')} ${moment().format('YYYY-MM-DD-HH-mm-ss')}.json`;\n        }\n        get paidOrdersURL() {\n            var URL = window.URL || window.webkitURL;\n            return URL.createObjectURL(this.paidOrdersBlob);\n        }\n        prepareUnpaidOrders() {\n            try {\n                this.unpaidOrdersBlob = this._createBlob(this.env.pos.export_unpaid_orders());\n                this.state.isUnpaidOrdersReady = true;\n            } catch (error) {\n                console.warn(error);\n            }\n        }\n        get unpaidOrdersFilename() {\n            return `${this.env._t('unpaid orders')} ${moment().format('YYYY-MM-DD-HH-mm-ss')}.json`;\n        }\n        get unpaidOrdersURL() {\n            var URL = window.URL || window.webkitURL;\n            return URL.createObjectURL(this.unpaidOrdersBlob);\n        }\n        async importOrders(event) {\n            const file = event.target.files[0];\n            if (file) {\n                const report = this.env.pos.import_orders(await getFileAsText(file));\n                await this.showPopup('OrderImportPopup', { report });\n            }\n        }\n        refreshDisplay() {\n            this.env.pos.proxy.message('display_refresh', {});\n        }\n        _onBufferUpdate(buffer) {\n            this.state.buffer = buffer;\n        }\n        get bufferRepr() {\n            return `\"${this.state.buffer}\"`;\n        }\n    }\n    DebugWidget.template = 'DebugWidget';\n\n    Registries.Component.add(DebugWidget);\n\n    return DebugWidget;\n});\n", "odoo.define('point_of_sale.AbstractAwaitablePopup', function (require) {\n    'use strict';\n\n    const { useExternalListener } = owl.hooks;\n    const PosComponent = require('point_of_sale.PosComponent');\n\n    /**\n     * Implement this abstract class by extending it like so:\n     * ```js\n     * class ConcretePopup extends AbstractAwaitablePopup {\n     *   async getPayload() {\n     *     return 'result';\n     *   }\n     * }\n     * ConcretePopup.template = owl.tags.xml`\n     *   <div>\n     *     <button t-on-click=\"confirm\">Okay</button>\n     *     <button t-on-click=\"cancel\">Cancel</button>\n     *   </div>\n     * `\n     * ```\n     *\n     * The concrete popup can now be instantiated and be awaited for\n     * the user's response like so:\n     * ```js\n     * const { confirmed, payload } = await this.showPopup('ConcretePopup');\n     * // based on the implementation above,\n     * // if confirmed, payload = 'result'\n     * //    otherwise, payload = null\n     * ```\n     */\n    class AbstractAwaitablePopup extends PosComponent {\n        constructor() {\n            super(...arguments);\n            if (!this.props.notEscapable) {\n                useExternalListener(window, 'keyup', this._cancelAtEscape);\n            }\n        }\n        async confirm() {\n            this.props.resolve({ confirmed: true, payload: await this.getPayload() });\n            this.trigger('close-popup');\n        }\n        cancel() {\n            this.props.resolve({ confirmed: false, payload: null });\n            this.trigger('close-popup');\n        }\n        _cancelAtEscape(event) {\n            if (event.key === 'Escape') {\n                this.cancel();\n            }\n        }\n        /**\n         * Override this in the concrete popup implementation to set the\n         * payload when the popup is confirmed.\n         */\n        async getPayload() {\n            return null;\n        }\n    }\n\n    return AbstractAwaitablePopup;\n});\n", "odoo.define('point_of_sale.ErrorPopup', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly ErrorPopupWidget\n    class ErrorPopup extends AbstractAwaitablePopup {\n        mounted() {\n            this.playSound('error');\n        }\n    }\n    ErrorPopup.template = 'ErrorPopup';\n    ErrorPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Error'),\n        body: '',\n    };\n\n    Registries.Component.add(ErrorPopup);\n\n    return ErrorPopup;\n});\n", "odoo.define('point_of_sale.ErrorBarcodePopup', function(require) {\n    'use strict';\n\n    const ErrorPopup = require('point_of_sale.ErrorPopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly ErrorBarcodePopupWidget\n    class ErrorBarcodePopup extends ErrorPopup {\n        get translatedMessage() {\n            return this.env._t(this.props.message);\n        }\n    }\n    ErrorBarcodePopup.template = 'ErrorBarcodePopup';\n    ErrorBarcodePopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Error'),\n        body: '',\n        message:\n            _lt('The Point of Sale could not find any product, client, employee or action associated with the scanned barcode.'),\n    };\n\n    Registries.Component.add(ErrorBarcodePopup);\n\n    return ErrorBarcodePopup;\n});\n", "odoo.define('point_of_sale.ConfirmPopup', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly ConfirmPopupWidget\n    class ConfirmPopup extends AbstractAwaitablePopup {}\n    ConfirmPopup.template = 'ConfirmPopup';\n    ConfirmPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Confirm ?'),\n        body: '',\n    };\n\n    Registries.Component.add(ConfirmPopup);\n\n    return ConfirmPopup;\n});\n", "odoo.define('point_of_sale.CashMovePopup', function (require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _t } = require('web.core');\n    const { parse } = require('web.field_utils');\n\n    class CashMovePopup extends AbstractAwaitablePopup {\n        setup() {\n            this.state = owl.hooks.useState({\n                inputType: '', // '' | 'in' | 'out'\n                inputAmount: '',\n                inputReason: '',\n                inputHasError: false,\n            });\n            this.inputAmountRef = owl.hooks.useRef('input-amount-ref');\n        }\n        confirm() {\n            try {\n                parse.float(this.state.inputAmount);\n            } catch (error) {\n                this.state.inputHasError = true;\n                this.errorMessage = this.env._t('Invalid amount');\n                return;\n            }\n            if (this.state.inputType == '') {\n                this.state.inputHasError = true;\n                this.errorMessage = this.env._t('Select either Cash In or Cash Out before confirming.');\n                return;\n            }\n            return super.confirm();\n        }\n        onClickButton(type) {\n            this.state.inputType = type;\n            this.state.inputHasError = false;\n            this.inputAmountRef.el && this.inputAmountRef.el.focus();\n        }\n        getPayload() {\n            return {\n                amount: parse.float(this.state.inputAmount),\n                reason: this.state.inputReason.trim(),\n                type: this.state.inputType,\n            };\n        }\n    }\n    CashMovePopup.template = 'point_of_sale.CashMovePopup';\n    CashMovePopup.defaultProps = {\n        cancelText: _t('Cancel'),\n        title: _t('Cash In/Out'),\n    };\n\n    Registries.Component.add(CashMovePopup);\n\n    return CashMovePopup;\n});\n", "odoo.define('point_of_sale.ControlButtonPopup', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    class ControlButtonPopup extends AbstractAwaitablePopup {\n        /**\n         * @param {Object} props\n         * @param {string} props.startingValue\n         */\n        constructor() {\n            super(...arguments);\n            this.controlButtons = this.props.controlButtons;\n        }\n    }\n    ControlButtonPopup.template = 'ControlButtonPopup';\n    ControlButtonPopup.defaultProps = {\n        cancelText: _lt('Back'),\n        controlButtons: []\n    };\n\n    Registries.Component.add(ControlButtonPopup);\n\n    return ControlButtonPopup;\n});\n", "odoo.define('point_of_sale.TextInputPopup', function(require) {\n    'use strict';\n\n    const { useState, useRef } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly TextInputPopupWidget\n    class TextInputPopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            this.state = useState({ inputValue: this.props.startingValue });\n            this.inputRef = useRef('input');\n        }\n        mounted() {\n            this.inputRef.el.focus();\n        }\n        getPayload() {\n            return this.state.inputValue;\n        }\n    }\n    TextInputPopup.template = 'TextInputPopup';\n    TextInputPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: '',\n        body: '',\n        startingValue: '',\n    };\n\n    Registries.Component.add(TextInputPopup);\n\n    return TextInputPopup;\n});\n", "odoo.define('point_of_sale.TextAreaPopup', function(require) {\n    'use strict';\n\n    const { useState, useRef } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly TextAreaPopupWidget\n    // IMPROVEMENT: This code is very similar to TextInputPopup.\n    //      Combining them would reduce the code.\n    class TextAreaPopup extends AbstractAwaitablePopup {\n        /**\n         * @param {Object} props\n         * @param {string} props.startingValue\n         */\n        constructor() {\n            super(...arguments);\n            this.state = useState({ inputValue: this.props.startingValue });\n            this.inputRef = useRef('input');\n        }\n        mounted() {\n            this.inputRef.el.focus();\n        }\n        getPayload() {\n            return this.state.inputValue;\n        }\n    }\n    TextAreaPopup.template = 'TextAreaPopup';\n    TextAreaPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: '',\n        body: '',\n    };\n\n    Registries.Component.add(TextAreaPopup);\n\n    return TextAreaPopup;\n});\n", "odoo.define('point_of_sale.ErrorTracebackPopup', function(require) {\n    'use strict';\n\n    const ErrorPopup = require('point_of_sale.ErrorPopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly ErrorTracebackPopupWidget\n    class ErrorTracebackPopup extends ErrorPopup {\n        get tracebackUrl() {\n            const blob = new Blob([this.props.body]);\n            const URL = window.URL || window.webkitURL;\n            return URL.createObjectURL(blob);\n        }\n        get tracebackFilename() {\n            return `${this.env._t('error')} ${moment().format('YYYY-MM-DD-HH-mm-ss')}.txt`;\n        }\n        emailTraceback() {\n            const address = this.env.pos.company.email;\n            const subject = this.env._t('IMPORTANT: Bug Report From Odoo Point Of Sale');\n            window.open(\n                'mailto:' +\n                    address +\n                    '?subject=' +\n                    (subject ? window.encodeURIComponent(subject) : '') +\n                    '&body=' +\n                    (this.props.body ? window.encodeURIComponent(this.props.body) : '')\n            );\n        }\n    }\n    ErrorTracebackPopup.template = 'ErrorTracebackPopup';\n    ErrorTracebackPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Error with Traceback'),\n        body: '',\n        exitButtonIsShown: false,\n        exitButtonText: _lt('Exit Pos'),\n        exitButtonTrigger: 'close-pos'\n    };\n\n    Registries.Component.add(ErrorTracebackPopup);\n\n    return ErrorTracebackPopup;\n});\n", "odoo.define('point_of_sale.SelectionPopup', function (require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly SelectionPopupWidget\n    class SelectionPopup extends AbstractAwaitablePopup {\n        /**\n         * Value of the `item` key of the selected element in the Selection\n         * Array is the payload of this popup.\n         *\n         * @param {Object} props\n         * @param {String} [props.confirmText='Confirm']\n         * @param {String} [props.cancelText='Cancel']\n         * @param {String} [props.title='Select']\n         * @param {String} [props.body='']\n         * @param {Array<Selection>} [props.list=[]]\n         *      Selection {\n         *          id: integer,\n         *          label: string,\n         *          isSelected: boolean,\n         *          item: any,\n         *      }\n         */\n        constructor() {\n            super(...arguments);\n            this.state = useState({ selectedId: this.props.list.find((item) => item.isSelected) });\n        }\n        selectItem(itemId) {\n            this.state.selectedId = itemId;\n            this.confirm();\n        }\n        /**\n         * We send as payload of the response the selected item.\n         *\n         * @override\n         */\n        getPayload() {\n            const selected = this.props.list.find((item) => this.state.selectedId === item.id);\n            return selected && selected.item;\n        }\n    }\n    SelectionPopup.template = 'SelectionPopup';\n    SelectionPopup.defaultProps = {\n        confirmText: _lt('Confirm'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Select'),\n        body: '',\n        list: [],\n    };\n\n    Registries.Component.add(SelectionPopup);\n\n    return SelectionPopup;\n});\n", "odoo.define('point_of_sale.EditListInput', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class EditListInput extends PosComponent {\n        onKeyup(event) {\n            if (event.key === \"Enter\" && event.target.value.trim() !== '') {\n                this.trigger('create-new-item');\n            }\n        }\n    }\n    EditListInput.template = 'EditListInput';\n\n    Registries.Component.add(EditListInput);\n\n    return EditListInput;\n});\n", "odoo.define('point_of_sale.EditListPopup', function(require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { useAutoFocusToLast } = require('point_of_sale.custom_hooks');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    /**\n     * Given a array of { id, text }, we show the user this popup to be able to modify this given array.\n     * (used to replace PackLotLinePopupWidget)\n     *\n     * The expected return of showPopup when this popup is used is an array of { _id, [id], text }.\n     *   - _id is the assigned unique identifier for each item.\n     *   - id is the original id. if not provided, then it means that the item is new.\n     *   - text is the modified/unmodified text.\n     *\n     * Example:\n     *\n     * ```\n     *   -- perhaps inside a click handler --\n     *   // gather the items to edit\n     *   const names = [{ id: 1, text: 'Joseph'}, { id: 2, text: 'Kaykay' }];\n     *\n     *   // supply the items to the popup and wait for user's response\n     *   // when user pressed `confirm` in the popup, the changes he made will be returned by the showPopup function.\n     *   const { confirmed, payload: newNames } = await this.showPopup('EditListPopup', {\n     *     title: \"Can you confirm this item?\",\n     *     array: names })\n     *\n     *   // we then consume the new data. In this example, it is only logged.\n     *   if (confirmed) {\n     *     console.log(newNames);\n     *     // the above might log the following:\n     *     // [{ _id: 1, id: 1, text: 'Joseph Caburnay' }, { _id: 2, id: 2, 'Kaykay' }, { _id: 3, 'James' }]\n     *     // The result showed that the original item with id=1 was changed to have text 'Joseph Caburnay' from 'Joseph'\n     *     // The one with id=2 did not change. And a new item with text='James' is added.\n     *   }\n     * ```\n     */\n    class EditListPopup extends AbstractAwaitablePopup {\n        /**\n         * @param {String} title required title of popup\n         * @param {Array} [props.array=[]] the array of { id, text } to be edited or an array of strings\n         * @param {Boolean} [props.isSingleItem=false] true if only allowed to edit single item (the first item)\n         */\n        constructor() {\n            super(...arguments);\n            this._id = 0;\n            this.state = useState({ array: this._initialize(this.props.array) });\n            useAutoFocusToLast();\n        }\n        _nextId() {\n            return this._id++;\n        }\n        _emptyItem() {\n            return {\n                text: '',\n                _id: this._nextId(),\n            };\n        }\n        _initialize(array) {\n            // If no array is provided, we initialize with one empty item.\n            if (array.length === 0) return [this._emptyItem()];\n            // Put _id for each item. It will serve as unique identifier of each item.\n            return array.map((item) => Object.assign({}, { _id: this._nextId() }, typeof item === 'object'? item: { 'text': item}));\n        }\n        removeItem(event) {\n            const itemToRemove = event.detail;\n            this.state.array.splice(\n                this.state.array.findIndex(item => item._id == itemToRemove._id),\n                1\n            );\n            // We keep a minimum of one empty item in the popup.\n            if (this.state.array.length === 0) {\n                this.state.array.push(this._emptyItem());\n            }\n        }\n        createNewItem() {\n            if (this.props.isSingleItem) return;\n            this.state.array.push(this._emptyItem());\n        }\n        /**\n         * @override\n         */\n        getPayload() {\n            return {\n                newArray: this.state.array\n                    .filter((item) => item.text.trim() !== '')\n                    .map((item) => Object.assign({}, item)),\n            };\n        }\n    }\n    EditListPopup.template = 'EditListPopup';\n    EditListPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        array: [],\n        isSingleItem: false,\n    };\n\n    Registries.Component.add(EditListPopup);\n\n    return EditListPopup;\n});\n", "odoo.define('point_of_sale.NumberPopup', function(require) {\n    'use strict';\n    var core = require('web.core');\n    var _t = core._t;\n\n    const { useState } = owl;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    // formerly NumberPopupWidget\n    class NumberPopup extends AbstractAwaitablePopup {\n        /**\n         * @param {Object} props\n         * @param {Boolean} props.isPassword Show password popup.\n         * @param {number|null} props.startingValue Starting value of the popup.\n         * @param {Boolean} props.isInputSelected Input is highlighted and will reset upon a change.\n         *\n         * Resolve to { confirmed, payload } when used with showPopup method.\n         * @confirmed {Boolean}\n         * @payload {String}\n         */\n        constructor() {\n            super(...arguments);\n            useListener('accept-input', this.confirm);\n            useListener('close-this-popup', this.cancel);\n            let startingBuffer = '';\n            if (typeof this.props.startingValue === 'number' && this.props.startingValue > 0) {\n                startingBuffer = this.props.startingValue.toString().replace('.', this.decimalSeparator);\n            }\n            this.state = useState({ buffer: startingBuffer, toStartOver: this.props.isInputSelected });\n            NumberBuffer.use({\n                nonKeyboardInputEvent: 'numpad-click-input',\n                triggerAtEnter: 'accept-input',\n                triggerAtEscape: 'close-this-popup',\n                state: this.state,\n            });\n        }\n        get decimalSeparator() {\n            return this.env._t.database.parameters.decimal_point;\n        }\n        get inputBuffer() {\n            if (this.state.buffer === null) {\n                return '';\n            }\n            if (this.props.isPassword) {\n                return this.state.buffer.replace(/./g, '\u2022');\n            } else {\n                return this.state.buffer;\n            }\n        }\n        confirm(event) {\n            if (NumberBuffer.get()) {\n                super.confirm();\n            }\n        }\n        sendInput(key) {\n            this.trigger('numpad-click-input', { key });\n        }\n        getPayload() {\n            return NumberBuffer.get();\n        }\n    }\n    NumberPopup.template = 'NumberPopup';\n    NumberPopup.defaultProps = {\n        confirmText: _t('Ok'),\n        cancelText: _t('Cancel'),\n        title: _t('Confirm ?'),\n        body: '',\n        cheap: false,\n        startingValue: null,\n        isPassword: false,\n    };\n\n    Registries.Component.add(NumberPopup);\n\n    return NumberPopup;\n});\n", "odoo.define('point_of_sale.OfflineErrorPopup', function(require) {\n    'use strict';\n\n    const ErrorPopup = require('point_of_sale.ErrorPopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    /**\n     * This is a special kind of error popup as it introduces\n     * an option to not show it again.\n     */\n    class OfflineErrorPopup extends ErrorPopup {\n        dontShowAgain() {\n            this.constructor.dontShow = true;\n            this.cancel();\n        }\n    }\n    OfflineErrorPopup.template = 'OfflineErrorPopup';\n    OfflineErrorPopup.dontShow = false;\n    OfflineErrorPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        title: _lt('Offline Error'),\n        body: _lt('Either the server is inaccessible or browser is not connected online.'),\n    };\n\n    Registries.Component.add(OfflineErrorPopup);\n\n    return OfflineErrorPopup;\n});\n", "odoo.define('point_of_sale.OrderImportPopup', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { _lt } = require('@web/core/l10n/translation');\n\n    // formerly OrderImportPopupWidget\n    class OrderImportPopup extends AbstractAwaitablePopup {\n        get unpaidSkipped() {\n            return (\n                (this.props.report.unpaid_skipped_existing || 0) +\n                (this.props.report.unpaid_skipped_session || 0)\n            );\n        }\n        getPayload() {}\n    }\n    OrderImportPopup.template = 'OrderImportPopup';\n    OrderImportPopup.defaultProps = {\n        confirmText: _lt('Ok'),\n        cancelText: _lt('Cancel'),\n        body: '',\n    };\n\n    Registries.Component.add(OrderImportPopup);\n\n    return OrderImportPopup;\n});\n", "odoo.define('point_of_sale.ProductConfiguratorPopup', function(require) {\n    'use strict';\n\n    const { useState, useSubEnv } = owl.hooks;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n\n    class ProductConfiguratorPopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            useSubEnv({ attribute_components: [] });\n        }\n\n        getPayload() {\n            var selected_attributes = [];\n            var price_extra = 0.0;\n\n            this.env.attribute_components.forEach((attribute_component) => {\n                let { value, extra } = attribute_component.getValue();\n                selected_attributes.push(value);\n                price_extra += extra;\n            });\n\n            return {\n                selected_attributes,\n                price_extra,\n            };\n        }\n    }\n    ProductConfiguratorPopup.template = 'ProductConfiguratorPopup';\n    Registries.Component.add(ProductConfiguratorPopup);\n\n    class BaseProductAttribute extends PosComponent {\n        constructor() {\n            super(...arguments);\n\n            this.env.attribute_components.push(this);\n\n            this.attribute = this.props.attribute;\n            this.values = this.attribute.values;\n            this.state = useState({\n                selected_value: parseFloat(this.values[0].id),\n                custom_value: '',\n            });\n        }\n\n        getValue() {\n            let selected_value = this.values.find((val) => val.id === parseFloat(this.state.selected_value));\n            let value = selected_value.name;\n            if (selected_value.is_custom && this.state.custom_value) {\n                value += `: ${this.state.custom_value}`;\n            }\n\n            return {\n                value,\n                extra: selected_value.price_extra\n            };\n        }\n    }\n\n    class RadioProductAttribute extends BaseProductAttribute {\n        mounted() {\n            // With radio buttons `t-model` selects the default input by searching for inputs with\n            // a matching `value` attribute. In our case, we use `t-att-value` so `value` is\n            // not found yet and no radio is selected by default.\n            // We then manually select the first input of each radio attribute.\n            $(this.el).find('input[type=\"radio\"]:first').prop('checked', true);\n        }\n    }\n    RadioProductAttribute.template = 'RadioProductAttribute';\n    Registries.Component.add(RadioProductAttribute);\n\n    class SelectProductAttribute extends BaseProductAttribute { }\n    SelectProductAttribute.template = 'SelectProductAttribute';\n    Registries.Component.add(SelectProductAttribute);\n\n    class ColorProductAttribute extends BaseProductAttribute {}\n    ColorProductAttribute.template = 'ColorProductAttribute';\n    Registries.Component.add(ColorProductAttribute);\n\n    return {\n        ProductConfiguratorPopup,\n        BaseProductAttribute,\n        RadioProductAttribute,\n        SelectProductAttribute,\n        ColorProductAttribute,\n    };\n});\n", "odoo.define('point_of_sale.CashOpeningPopup', function(require) {\n    'use strict';\n\n    const { useState, useRef } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n\n\n    class CashOpeningPopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            this.manualInputCashCount = null;\n            this.state = useState({\n                notes: \"\",\n                openingCash: this.env.pos.bank_statement.balance_start || 0,\n            });\n            this.moneyDetailsRef = useRef('moneyDetails');\n        }\n        openDetailsPopup() {\n            if (this.moneyDetailsRef.comp.isClosed()){\n                this.moneyDetailsRef.comp.openPopup();\n                this.state.openingCash = 0;\n                this.state.notes = \"\";\n                if (this.manualInputCashCount) {\n                    this.moneyDetailsRef.comp.reset();\n                }\n            }\n        }\n        startSession() {\n            this.env.pos.bank_statement.balance_start = this.state.openingCash;\n            this.env.pos.pos_session.state = 'opened';\n            this.rpc({\n                   model: 'pos.session',\n                    method: 'set_cashbox_pos',\n                    args: [this.env.pos.pos_session.id, this.state.openingCash, this.state.notes],\n                });\n            this.cancel(); // close popup\n        }\n        updateCashOpening(event) {\n            const { total, moneyDetailsNotes } = event.detail;\n            this.state.openingCash = total;\n            if (moneyDetailsNotes) {\n                this.state.notes = moneyDetailsNotes;\n            }\n            this.manualInputCashCount = false;\n        }\n        handleInputChange() {\n            this.manualInputCashCount = true;\n            this.state.notes = \"\";\n        }\n    }\n\n    CashOpeningPopup.template = 'CashOpeningPopup';\n    Registries.Component.add(CashOpeningPopup);\n\n    return CashOpeningPopup;\n});\n", "odoo.define('point_of_sale.ProductInfoPopup', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { posbus } = require('point_of_sale.utils')\n    const { ConnectionLostError } = require('@web/core/network/rpc_service')\n\n    /**\n     * This popup needs to be self-dependent because it needs to be called from different place. In order to avoid code\n     * Props:\n     *  {\n     *      product: a product object\n     *      quantity: number\n     *  }\n     */\n    class ProductInfoPopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n        }\n        async willStart() {\n            const order = this.env.pos.get_order();\n            try {\n                // check back-end method `get_product_info_pos` to see what it returns\n                // We do this so it's easier to override the value returned and use it in the component template later\n                this.productInfo = await this.rpc({\n                    model: 'product.product',\n                    method: 'get_product_info_pos',\n                    args: [[this.props.product.id],\n                        this.props.product.get_price(order.pricelist, this.props.quantity),\n                        this.props.quantity,\n                        this.env.pos.config_id],\n                    kwargs: {context: this.env.session.user_context},\n                });\n\n                const priceWithoutTax = this.productInfo['all_prices']['price_without_tax'];\n                const margin = priceWithoutTax - this.props.product.standard_price;\n                const orderPriceWithoutTax = order.get_total_without_tax();\n                const orderCost = order.get_total_cost();\n                const orderMargin = orderPriceWithoutTax - orderCost;\n\n                this.costCurrency = this.env.pos.format_currency(this.props.product.standard_price);\n                this.marginCurrency = this.env.pos.format_currency(margin);\n                this.marginPercent = priceWithoutTax ? Math.round(margin/priceWithoutTax * 10000) / 100 : 0;\n                this.orderPriceWithoutTaxCurrency = this.env.pos.format_currency(orderPriceWithoutTax);\n                this.orderCostCurrency = this.env.pos.format_currency(orderCost);\n                this.orderMarginCurrency = this.env.pos.format_currency(orderMargin);\n                this.orderMarginPercent = orderPriceWithoutTax ? Math.round(orderMargin/orderPriceWithoutTax * 10000) / 100 : 0;\n            } catch (error) {\n                this.error = error;\n            }\n        }\n        /*\n         * Since this popup need to be self dependent, in case of an error, the popup need to be closed on its own.\n         */\n        mounted() {\n            if (this.error) {\n                this.cancel();\n                if (this.error.message instanceof ConnectionLostError) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Network Error'),\n                        body: this.env._t('Cannot access product information screen if offline.'),\n                    });\n                } else {\n                    throw this.error;\n                }\n            }\n        }\n        searchProduct(productName) {\n            posbus.trigger('search-product-from-info-popup', productName);\n            this.cancel()\n        }\n    }\n\n    ProductInfoPopup.template = 'ProductInfoPopup';\n    Registries.Component.add(ProductInfoPopup);\n});\n", "odoo.define('point_of_sale.OrderlineCustomerNoteButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class OrderlineCustomerNoteButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        async onClick() {\n            const selectedOrderline = this.env.pos.get_order().get_selected_orderline();\n            if (!selectedOrderline) return;\n\n            const { confirmed, payload: inputNote } = await this.showPopup('TextAreaPopup', {\n                startingValue: selectedOrderline.get_customer_note(),\n                title: this.env._t('Add Customer Note'),\n            });\n\n            if (confirmed) {\n                selectedOrderline.set_customer_note(inputNote);\n            }\n        }\n    }\n    OrderlineCustomerNoteButton.template = 'OrderlineCustomerNoteButton';\n\n    ProductScreen.addControlButton({\n        component: OrderlineCustomerNoteButton,\n        condition: function() {\n            return this.env.pos.config.iface_orderline_customer_notes;\n        },\n    });\n\n    Registries.Component.add(OrderlineCustomerNoteButton);\n\n    return OrderlineCustomerNoteButton;\n});\n", "odoo.define('point_of_sale.ClosePosPopup', function(require) {\n    'use strict';\n\n    const { useState, useRef } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    const { identifyError } = require('point_of_sale.utils');\n    const { ConnectionLostError, ConnectionAbortedError} = require('@web/core/network/rpc_service')\n\n    /**\n     * This popup needs to be self-dependent because it needs to be called from different place.\n     */\n    class ClosePosPopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            this.manualInputCashCount = false;\n            this.cashControl = this.env.pos.config.cash_control;\n            this.moneyDetailsRef = useRef('moneyDetails');\n            this.closeSessionClicked = false;\n            this.moneyDetails = null;\n            this.state = useState({});\n        }\n        async willStart() {\n            try {\n                const closingData = await this.rpc({\n                    model: 'pos.session',\n                    method: 'get_closing_control_data',\n                    args: [[this.env.pos.pos_session.id]]\n                });\n                this.ordersDetails = closingData.orders_details;\n                this.paymentsAmount = closingData.payments_amount;\n                this.payLaterAmount = closingData.pay_later_amount;\n                this.openingNotes = closingData.opening_notes;\n                this.defaultCashDetails = closingData.default_cash_details;\n                this.otherPaymentMethods = closingData.other_payment_methods;\n                this.isManager = closingData.is_manager;\n                this.amountAuthorizedDiff = closingData.amount_authorized_diff;\n\n                // component state and refs definition\n                const state = {notes: '', acceptClosing: false, payments: {}};\n                if (this.cashControl) {\n                    state.payments[this.defaultCashDetails.id] = {counted: 0, difference: -this.defaultCashDetails.amount, number: 0};\n                }\n                if (this.otherPaymentMethods.length > 0) {\n                    this.otherPaymentMethods.forEach(pm => {\n                        if (pm.type === 'bank') {\n                            state.payments[pm.id] = {counted: this.env.pos.round_decimals_currency(pm.amount), difference: 0, number: pm.number}\n                        }\n                    })\n                }\n                Object.assign(this.state, state);\n            } catch (error) {\n                this.error = error;\n            }\n        }\n        /*\n         * Since this popup need to be self dependent, in case of an error, the popup need to be closed on its own.\n         */\n        mounted() {\n            if (this.error) {\n                this.cancel();\n                if (identifyError(this.error) instanceof ConnectionLostError) {\n                    this.showPopup('ErrorPopup', {\n                        title: this.env._t('Network Error'),\n                        body: this.env._t('Please check your internet connection and try again.'),\n                    });\n                } else {\n                    throw this.error;\n                }\n            }\n        }\n        openDetailsPopup() {\n            if (this.moneyDetailsRef.comp.isClosed()){\n                this.moneyDetailsRef.comp.openPopup();\n                this.state.payments[this.defaultCashDetails.id].counted = 0;\n                this.state.payments[this.defaultCashDetails.id].difference = -this.defaultCashDetails.amount;\n                this.state.notes = '';\n                if (this.manualInputCashCount) {\n                    this.moneyDetailsRef.comp.reset();\n                }\n            }\n        }\n        handleInputChange(paymentId) {\n            let expectedAmount;\n            if (paymentId === this.defaultCashDetails.id) {\n                this.manualInputCashCount = true;\n                this.state.notes = '';\n                expectedAmount = this.defaultCashDetails.amount;\n            } else {\n                expectedAmount = this.otherPaymentMethods.find(pm => paymentId === pm.id).amount;\n            }\n            this.state.payments[paymentId].difference =\n                this.env.pos.round_decimals_currency(this.state.payments[paymentId].counted - expectedAmount);\n            this.state.acceptClosing = false;\n        }\n        updateCountedCash(event) {\n            const { total, moneyDetailsNotes, moneyDetails } = event.detail;\n            this.state.payments[this.defaultCashDetails.id].counted = total;\n            this.state.payments[this.defaultCashDetails.id].difference =\n                this.env.pos.round_decimals_currency(this.state.payments[[this.defaultCashDetails.id]].counted - this.defaultCashDetails.amount);\n            if (moneyDetailsNotes) {\n                this.state.notes = moneyDetailsNotes;\n            }\n            this.manualInputCashCount = false;\n            this.moneyDetails = moneyDetails;\n            this.state.acceptClosing = false;\n        }\n        hasDifference() {\n            return Object.entries(this.state.payments).find(pm => pm[1].difference != 0);\n        }\n        hasUserAuthority() {\n            const absDifferences = Object.entries(this.state.payments).map(pm => Math.abs(pm[1].difference));\n            return this.isManager || this.amountAuthorizedDiff == null || Math.max(...absDifferences) <= this.amountAuthorizedDiff;\n        }\n        canCloseSession() {\n            return !this.cashControl || !this.hasDifference() || this.state.acceptClosing;\n        }\n        canCancel() {\n            return true;\n        }\n        cancelPopup() {\n            if (this.canCancel()) {\n                this.cancel();\n            }\n        }\n        closePos() {\n            this.trigger('close-pos');\n        }\n        async closeSession() {\n            if (this.canCloseSession() && !this.closeSessionClicked) {\n                this.closeSessionClicked = true;\n                let response;\n                if (this.cashControl) {\n                     response = await this.rpc({\n                        model: 'pos.session',\n                        method: 'post_closing_cash_details',\n                        args: [this.env.pos.pos_session.id],\n                        kwargs: {\n                            counted_cash: this.state.payments[this.defaultCashDetails.id].counted,\n                        }\n                    })\n                    if (!response.successful) {\n                        return this.handleClosingError(response);\n                    }\n                }\n                await this.rpc({\n                    model: 'pos.session',\n                    method: 'update_closing_control_state_session',\n                    args: [this.env.pos.pos_session.id, this.state.notes]\n                })\n                try {\n                    const bankPaymentMethodDiffPairs = this.otherPaymentMethods\n                        .filter((pm) => pm.type == 'bank')\n                        .map((pm) => [pm.id, this.state.payments[pm.id].difference]);\n                    response = await this.rpc({\n                        model: 'pos.session',\n                        method: 'close_session_from_ui',\n                        args: [this.env.pos.pos_session.id, bankPaymentMethodDiffPairs],\n                    });\n                    if (!response.successful) {\n                        return this.handleClosingError(response);\n                    }\n                    window.location = '/web#action=point_of_sale.action_client_pos_menu';\n                } catch (error) {\n                    const iError = identifyError(error);\n                    if (iError instanceof ConnectionLostError || iError instanceof ConnectionAbortedError) {\n                        await this.showPopup('ErrorPopup', {\n                            title: this.env._t('Network Error'),\n                            body: this.env._t('Cannot close the session when offline.'),\n                        });\n                    } else {\n                        await this.showPopup('ErrorPopup', {\n                            title: this.env._t('Closing session error'),\n                            body: this.env._t(\n                                'An error has occurred when trying to close the session.\\n' +\n                                'You will be redirected to the back-end to manually close the session.')\n                        })\n                        window.location = '/web#action=point_of_sale.action_client_pos_menu';\n                    }\n                }\n                this.closeSessionClicked = false;\n            }\n        }\n        async handleClosingError(response) {\n            await this.showPopup('ErrorPopup', {title: 'Error', body: response.message});\n            if (response.redirect) {\n                window.location = '/web#action=point_of_sale.action_client_pos_menu';\n            }\n        }\n        _getShowDiff(pm) {\n            return pm.type == 'bank' && pm.number !== 0;\n        }\n    }\n\n    ClosePosPopup.template = 'ClosePosPopup';\n    Registries.Component.add(ClosePosPopup);\n\n    return ClosePosPopup;\n});\n", "odoo.define('point_of_sale.MoneyDetailsPopup', function(require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * Even if this component has a \"confirm and cancel\"-like buttons, this should not be an AbstractAwaitablePopup.\n     * We currently cannot show two popups at the same time, what we do is mount this component with its parent\n     * and hide it with some css. The confirm button will just trigger an event to the parent.\n     */\n    class MoneyDetailsPopup extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.currency = this.env.pos.currency;\n            this.state = useState({\n                moneyDetails: Object.fromEntries(this.env.pos.bills.map(bill => ([bill.value, 0]))),\n                total: 0,\n            });\n        }\n        get firstHalfMoneyDetails() {\n            const moneyDetailsKeys = Object.keys(this.state.moneyDetails).sort((a, b) => a - b);\n            return moneyDetailsKeys.slice(0, moneyDetailsKeys.length/2);\n        }\n        get lastHalfMoneyDetails() {\n            const moneyDetailsKeys = Object.keys(this.state.moneyDetails).sort((a, b) => a - b);\n            return moneyDetailsKeys.slice(moneyDetailsKeys.length/2, moneyDetailsKeys.length);\n        }\n        isClosed() {\n            return this.el.classList.contains('invisible')\n        }\n        openPopup() {\n            this.el.classList.remove('invisible');\n        }\n        updateMoneyDetailsAmount() {\n            let total = Object.entries(this.state.moneyDetails).reduce((total, money) => total + money[0] * money[1], 0);\n            this.state.total = this.env.pos.round_decimals_currency(total);\n        }\n        _closePopup() {\n            this.el.classList.add('invisible');\n        }\n        confirm() {\n            let moneyDetailsNotes = this.state.total  ? 'Money details: \\n' : null;\n            this.env.pos.bills.forEach(bill => {\n                if (this.state.moneyDetails[bill.value]) {\n                    moneyDetailsNotes += `  - ${this.state.moneyDetails[bill.value]} x ${this.env.pos.format_currency(bill.value)}\\n`;\n                }\n            })\n            const payload = { total: this.state.total, moneyDetailsNotes, moneyDetails: { ...this.state.moneyDetails }};\n            this.trigger('money-details-validated', payload);\n            this._closePopup();\n        }\n        reset() {\n            for (let key in this.state.moneyDetails) { this.state.moneyDetails[key] = 0 }\n            this.state.total = 0;\n        }\n        discard() {\n            this.reset();\n            this._closePopup();\n        }\n    }\n\n    MoneyDetailsPopup.template = 'MoneyDetailsPopup';\n    Registries.Component.add(MoneyDetailsPopup);\n\n    return MoneyDetailsPopup;\n\n});\n", "odoo.define('point_of_sale.SetPricelistButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class SetPricelistButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        mounted() {\n            this.env.pos.get('orders').on('add remove change', () => this.render(), this);\n            this.env.pos.on('change:selectedOrder', () => this.render(), this);\n        }\n        willUnmount() {\n            this.env.pos.get('orders').off('add remove change', null, this);\n            this.env.pos.off('change:selectedOrder', null, this);\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n        get currentPricelistName() {\n            const order = this.currentOrder;\n            return order && order.pricelist\n                ? order.pricelist.display_name\n                : this.env._t('Pricelist');\n        }\n        async onClick() {\n            // Create the list to be passed to the SelectionPopup.\n            // Pricelist object is passed as item in the list because it\n            // is the object that will be returned when the popup is confirmed.\n            const selectionList = this.env.pos.pricelists.map(pricelist => ({\n                id: pricelist.id,\n                label: pricelist.name,\n                isSelected: pricelist.id === this.currentOrder.pricelist.id,\n                item: pricelist,\n            }));\n\n            const { confirmed, payload: selectedPricelist } = await this.showPopup(\n                'SelectionPopup',\n                {\n                    title: this.env._t('Select the pricelist'),\n                    list: selectionList,\n                }\n            );\n\n            if (confirmed) {\n                this.currentOrder.set_pricelist(selectedPricelist);\n            }\n        }\n    }\n    SetPricelistButton.template = 'SetPricelistButton';\n\n    ProductScreen.addControlButton({\n        component: SetPricelistButton,\n        condition: function() {\n            return this.env.pos.config.use_pricelist && this.env.pos.pricelists.length > 1;\n        },\n    });\n\n    Registries.Component.add(SetPricelistButton);\n\n    return SetPricelistButton;\n});\n", "odoo.define('point_of_sale.SetFiscalPositionButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class SetFiscalPositionButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        mounted() {\n            this.env.pos.get('orders').on('add remove change', () => this.render(), this);\n            this.env.pos.on('change:selectedOrder', () => this.render(), this);\n        }\n        willUnmount() {\n            this.env.pos.get('orders').off('add remove change', null, this);\n            this.env.pos.off('change:selectedOrder', null, this);\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n        get currentFiscalPositionName() {\n            return this.currentOrder && this.currentOrder.fiscal_position\n                ? this.currentOrder.fiscal_position.display_name\n                : this.env._t('Tax');\n        }\n        async onClick() {\n            const currentFiscalPosition = this.currentOrder.fiscal_position;\n            const fiscalPosList = [\n                {\n                    id: -1,\n                    label: this.env._t('None'),\n                    isSelected: !currentFiscalPosition,\n                },\n            ];\n            for (let fiscalPos of this.env.pos.fiscal_positions) {\n                fiscalPosList.push({\n                    id: fiscalPos.id,\n                    label: fiscalPos.name,\n                    isSelected: currentFiscalPosition\n                        ? fiscalPos.id === currentFiscalPosition.id\n                        : false,\n                    item: fiscalPos,\n                });\n            }\n            const { confirmed, payload: selectedFiscalPosition } = await this.showPopup(\n                'SelectionPopup',\n                {\n                    title: this.env._t('Select Fiscal Position'),\n                    list: fiscalPosList,\n                }\n            );\n            if (confirmed) {\n                this.currentOrder.fiscal_position = selectedFiscalPosition;\n                // IMPROVEMENT: The following is the old implementation and I believe\n                // there could be a better way of doing it.\n                for (let line of this.currentOrder.orderlines.models) {\n                    line.set_quantity(line.quantity);\n                }\n                this.currentOrder.trigger('change');\n            }\n        }\n    }\n    SetFiscalPositionButton.template = 'SetFiscalPositionButton';\n\n    ProductScreen.addControlButton({\n        component: SetFiscalPositionButton,\n        condition: function() {\n            return this.env.pos.fiscal_positions.length > 0;\n        },\n        position: ['before', 'SetPricelistButton'],\n    });\n\n    Registries.Component.add(SetFiscalPositionButton);\n\n    return SetFiscalPositionButton;\n});\n", "odoo.define('point_of_sale.ProductInfoButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class ProductInfoButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        mounted() {\n            this.env.pos.get('orders').on('add remove change', () => this.render(), this);\n            this.env.pos.on('change:selectedOrder', () => this.render(), this);\n        }\n        willUnmount() {\n            this.env.pos.get('orders').off('add remove change', null, this);\n            this.env.pos.off('change:selectedOrder', null, this);\n        }\n        onClick() {\n            const orderline = this.env.pos.get_order().get_selected_orderline();\n            if (orderline) {\n                const product = orderline.get_product();\n                const quantity = orderline.get_quantity();\n                this.showPopup('ProductInfoPopup', { product, quantity });\n            }\n        }\n    }\n    ProductInfoButton.template = 'ProductInfoButton';\n\n    ProductScreen.addControlButton({\n        component: ProductInfoButton,\n        condition: () => true,\n        position: ['before', 'SetFiscalPositionButton'],\n    });\n\n    Registries.Component.add(ProductInfoButton);\n\n    return ProductInfoButton;\n});\n", "odoo.define('point_of_sale.RefundButton', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const Registries = require('point_of_sale.Registries');\n    const { useListener } = require('web.custom_hooks');\n\n    class RefundButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this._onClick);\n        }\n        _onClick() {\n            const customer = this.env.pos.get_order().get_client();\n            const searchDetails = customer ? { fieldName: 'CUSTOMER', searchTerm: customer.name } : {};\n            this.trigger('close-popup');\n            this.showScreen('TicketScreen', {\n                ui: { filter: 'SYNCED', searchDetails },\n                destinationOrder: this.env.pos.get_order(),\n            });\n        }\n    }\n    RefundButton.template = 'point_of_sale.RefundButton';\n\n    ProductScreen.addControlButton({\n        component: RefundButton,\n        condition: function () {\n            return true;\n        },\n    });\n\n    Registries.Component.add(RefundButton);\n\n    return RefundButton;\n});\n", "odoo.define('point_of_sale.ClientScreenButton', function(require) {\n    'use strict';\n\n    const { useState } = owl;\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    // Formerly ClientScreenWidget\n    class ClientScreenButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.local = this.env.pos.config.iface_customer_facing_display_local && !this.env.pos.config.iface_customer_facing_display_proxy;\n            this.state = useState({ status: this.local ? 'success' : 'failure' });\n            this._start();\n        }\n        get message() {\n            return {\n                success: '',\n                warning: this.env._t('Connected, Not Owned'),\n                failure: this.env._t('Disconnected'),\n                not_found: this.env._t('Client Screen Unsupported. Please upgrade the IoT Box'),\n            }[this.state.status];\n        }\n        onClick() {\n            if (this.local) {\n                return this.onClickLocal();\n            } else {\n                return this.onClickProxy();\n            }\n        }\n        async onClickLocal() {\n            this.env.pos.customer_display = window.open('', 'Customer Display', 'height=600,width=900');\n            const renderedHtml = await this.env.pos.render_html_for_customer_facing_display();\n            var $renderedHtml = $('<div>').html(renderedHtml);\n            $(this.env.pos.customer_display.document.body).html($renderedHtml.find('.pos-customer_facing_display'));\n            $(this.env.pos.customer_display.document.head).html($renderedHtml.find('.resources').html());\n        }\n        async onClickProxy() {\n            try {\n                const renderedHtml = await this.env.pos.render_html_for_customer_facing_display();\n                let ownership = await this.env.pos.proxy.take_ownership_over_client_screen(\n                    renderedHtml\n                );\n                if (typeof ownership === 'string') {\n                    ownership = JSON.parse(ownership);\n                }\n                if (ownership.status === 'success') {\n                    this.state.status = 'success';\n                } else {\n                    this.state.status = 'warning';\n                }\n                if (!this.env.pos.proxy.posbox_supports_display) {\n                    this.env.pos.proxy.posbox_supports_display = true;\n                    this._start();\n                }\n            } catch (error) {\n                if (typeof error == 'undefined') {\n                    this.state.status = 'failure';\n                } else {\n                    this.state.status = 'not_found';\n                }\n            }\n        }\n        _start() {\n            if (this.local) {\n                return;\n            }\n\n            const self = this;\n            async function loop() {\n                if (self.env.pos.proxy.posbox_supports_display) {\n                    try {\n                        let ownership = await self.env.pos.proxy.test_ownership_of_client_screen();\n                        if (typeof ownership === 'string') {\n                            ownership = JSON.parse(ownership);\n                        }\n                        if (ownership.status === 'OWNER') {\n                            self.state.status = 'success';\n                        } else {\n                            self.state.status = 'warning';\n                        }\n                        setTimeout(loop, 3000);\n                    } catch (error) {\n                        if (error.abort) {\n                            // Stop the loop\n                            return;\n                        }\n                        if (typeof error == 'undefined') {\n                            self.state.status = 'failure';\n                        } else {\n                            self.state.status = 'not_found';\n                            self.env.pos.proxy.posbox_supports_display = false;\n                        }\n                        setTimeout(loop, 3000);\n                    }\n                }\n            }\n            loop();\n        }\n    }\n    ClientScreenButton.template = 'ClientScreenButton';\n\n    Registries.Component.add(ClientScreenButton);\n\n    return ClientScreenButton;\n});\n", "odoo.define('point_of_sale.NumberBuffer', function(require) {\n    'use strict';\n\n    const { Component } = owl;\n    const { EventBus } = owl.core;\n    const { onMounted, onWillUnmount, useExternalListener } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const { parse } = require('web.field_utils');\n    const { BarcodeEvents } = require('barcodes.BarcodeEvents');\n    const { _t } = require('web.core');\n    const { Gui } = require('point_of_sale.Gui');\n\n    const INPUT_KEYS = new Set(\n        ['Delete', 'Backspace', '+1', '+2', '+5', '+10', '+20', '+50'].concat('0123456789+-.,'.split(''))\n    );\n    const CONTROL_KEYS = new Set(['Enter', 'Esc']);\n    const ALLOWED_KEYS = new Set([...INPUT_KEYS, ...CONTROL_KEYS]);\n    const getDefaultConfig = () => ({\n        decimalPoint: false,\n        triggerAtEnter: false,\n        triggerAtEsc: false,\n        triggerAtInput: false,\n        nonKeyboardInputEvent: false,\n        useWithBarcode: false,\n    });\n\n    /**\n     * This is a singleton.\n     *\n     * Only one component can `use` the buffer at a time.\n     * This is done by keeping track of each component (and its\n     * corresponding state and config) using a stack (bufferHolderStack).\n     * The component on top of the stack is the one that currently\n     * `holds` the buffer.\n     *\n     * When the current component is unmounted, the top of the stack\n     * is popped and NumberBuffer is set up again for the new component\n     * on top of the stack.\n     *\n     * Usage\n     * =====\n     * - Activate in the construction of root component. `NumberBuffer.activate()`\n     * - Use the buffer in a child component by calling `NumberBuffer.use(<config>)`\n     *   in the constructor of the child component.\n     * - The component that `uses` the buffer has access to the following instance\n     *   methods of the NumberBuffer:\n     *   - get()\n     *   - set(val)\n     *   - reset()\n     *   - getFloat()\n     *   - capture()\n     *\n     * Note\n     * ====\n     * - No need to instantiate as it is a singleton created before exporting in this module.\n     *\n     * Possible Improvements\n     * =====================\n     * - Relieve the buffer from responsibility of handling `Enter` and other control keys.\n     * - Make the constants (ALLOWED_KEYS, etc.) more configurable.\n     * - Write more integration tests. NumberPopup can be used as test component.\n     */\n    class NumberBuffer extends EventBus {\n        constructor() {\n            super();\n            this.isReset = false;\n            this.bufferHolderStack = [];\n        }\n        /**\n         * @returns {String} value of the buffer, e.g. '-95.79'\n         */\n        get() {\n            return this.state ? this.state.buffer : null;\n        }\n        /**\n         * Takes a string that is convertible to float, and set it as\n         * value of the buffer. e.g. val = '2.99';\n         *\n         * @param {String} val\n         */\n        set(val) {\n            this.state.buffer = !isNaN(parseFloat(val)) ? val : '';\n            this.trigger('buffer-update', this.state.buffer);\n        }\n        /**\n         * Resets the buffer to empty string.\n         */\n        reset() {\n            this.isReset = true;\n            this.state.buffer = '';\n            this.trigger('buffer-update', this.state.buffer);\n        }\n        /**\n         * Calling this function, we immediately invoke the `handler` method\n         * that handles the contents of the input events buffer (`eventsBuffer`).\n         * This is helpful when we don't want to wait for the timeout that\n         * is supposed to invoke the handler.\n         */\n        capture() {\n            if (this.handler) {\n                clearTimeout(this._timeout);\n                this.handler();\n                delete this.handler;\n            }\n        }\n        /**\n         * @returns {number} float equivalent of the value of buffer\n         */\n        getFloat() {\n            return parse.float(this.get());\n        }\n        /**\n         * Add keyup listener to window via the useExternalListener hook.\n         * When the component calling this is unmounted, the listener is also\n         * removed from window.\n         */\n        activate() {\n            this.defaultDecimalPoint = _t.database.parameters.decimal_point;\n            useExternalListener(window, 'keyup', this._onKeyboardInput.bind(this));\n        }\n        /**\n         * @param {Object} config Use to setup the buffer\n         * @param {String|null} config.decimalPoint The decimal character.\n         * @param {String|null} config.triggerAtEnter Event triggered when 'Enter' key is pressed.\n         * @param {String|null} config.triggerAtEsc Event triggered when 'Esc' key is pressed.\n         * @param {String|null} config.triggerAtInput Event triggered for every accepted input.\n         * @param {String|null} config.nonKeyboardInputEvent Also listen to a non-keyboard input event\n         *      that carries a payload of { key }. The key is checked if it is a valid input. If valid,\n         *      the number buffer is modified just as it is modified when a keyboard key is pressed.\n         * @param {Boolean} config.useWithBarcode Whether this buffer is used with barcode.\n         * @emits config.triggerAtEnter when 'Enter' key is pressed.\n         * @emits config.triggerAtEsc when 'Esc' key is pressed.\n         * @emits config.triggerAtInput when an input is accepted.\n         */\n        use(config) {\n            this.eventsBuffer = [];\n            const currentComponent = Component.current;\n            config = Object.assign(getDefaultConfig(), config);\n            onMounted(() => {\n                this.bufferHolderStack.push({\n                    component: currentComponent,\n                    state: config.state ? config.state : { buffer: '', toStartOver: false },\n                    config,\n                });\n                this._setUp();\n            });\n            onWillUnmount(() => {\n                this.bufferHolderStack.pop();\n                this._setUp();\n            });\n            // Add listener that accepts non keyboard inputs\n            if (typeof config.nonKeyboardInputEvent === 'string') {\n                useListener(config.nonKeyboardInputEvent, this._onNonKeyboardInput.bind(this));\n            }\n        }\n        get _currentBufferHolder() {\n            return this.bufferHolderStack[this.bufferHolderStack.length - 1];\n        }\n        _setUp() {\n            if (!this._currentBufferHolder) return;\n            const { component, state, config } = this._currentBufferHolder;\n            this.component = component;\n            this.state = state;\n            this.config = config;\n            this.decimalPoint = config.decimalPoint || this.defaultDecimalPoint;\n            this.maxTimeBetweenKeys = this.config.useWithBarcode\n                ? BarcodeEvents.max_time_between_keys_in_ms\n                : 0;\n        }\n        _onKeyboardInput(event) {\n            return this._bufferEvents(this._onInput(event => event.key))(event);\n        }\n        _onNonKeyboardInput(event) {\n            return this._bufferEvents(this._onInput(event => event.detail.key))(event);\n        }\n        _bufferEvents(handler) {\n            return event => {\n                if (['INPUT', 'TEXTAREA'].includes(event.target.tagName) || !this.eventsBuffer) return;\n                clearTimeout(this._timeout);\n                this.eventsBuffer.push(event);\n                this._timeout = setTimeout(handler, this.maxTimeBetweenKeys);\n                this.handler = handler\n            };\n        }\n        _onInput(keyAccessor) {\n            return () => {\n                if (this.eventsBuffer.length <= 2) {\n                    // Check first the buffer if its contents are all valid\n                    // number input.\n                    for (let event of this.eventsBuffer) {\n                        if (!ALLOWED_KEYS.has(keyAccessor(event))) {\n                            this.eventsBuffer = [];\n                            return;\n                        }\n                    }\n                    // At this point, all the events in buffer\n                    // contains number input. It's now okay to handle\n                    // each input.\n                    for (let event of this.eventsBuffer) {\n                        this._handleInput(keyAccessor(event));\n                        event.preventDefault();\n                        event.stopPropagation();\n                    }\n                }\n                this.eventsBuffer = [];\n            };\n        }\n        _handleInput(key) {\n            if (key === 'Enter' && this.config.triggerAtEnter) {\n                this.component.trigger(this.config.triggerAtEnter, this.state);\n            } else if (key === 'Esc' && this.config.triggerAtEsc) {\n                this.component.trigger(this.config.triggerAtEsc, this.state);\n            } else if (INPUT_KEYS.has(key)) {\n                this._updateBuffer(key);\n                if (this.config.triggerAtInput)\n                    this.component.trigger(this.config.triggerAtInput, { buffer: this.state.buffer, key });\n            }\n        }\n        /**\n         * Updates the current buffer state using the given input.\n         * @param {String} input valid input\n         */\n        _updateBuffer(input) {\n            const isEmpty = val => {\n                return val === '' || val === null;\n            };\n            if (input === undefined || input === null) return;\n            let isFirstInput = isEmpty(this.state.buffer);\n            if (input === ',' || input === '.') {\n                if (this.state.toStartOver) {\n                    this.state.buffer = '';\n                }\n                if (isFirstInput) {\n                    this.state.buffer = '0' + this.decimalPoint;\n                } else if (!this.state.buffer.length || this.state.buffer === '-') {\n                    this.state.buffer += '0' + this.decimalPoint;\n                } else if (this.state.buffer.indexOf(this.decimalPoint) < 0) {\n                    this.state.buffer = this.state.buffer + this.decimalPoint;\n                }\n            } else if (input === 'Delete') {\n                if (this.isReset) {\n                    this.state.buffer = '';\n                    this.isReset = false;\n                    return;\n                }\n                this.state.buffer = isEmpty(this.state.buffer) ? null : '';\n            } else if (input === 'Backspace') {\n                if (this.isReset) {\n                    this.state.buffer = '';\n                    this.isReset = false;\n                    return;\n                }\n                if (this.state.toStartOver) {\n                    this.state.buffer = '';\n                }\n                const buffer = this.state.buffer;\n                if (isEmpty(buffer)) {\n                    this.state.buffer = null;\n                } else {\n                    const nCharToRemove = buffer[buffer.length - 1] === this.decimalPoint ? 2 : 1;\n                    this.state.buffer = buffer.substring(0, buffer.length - nCharToRemove);\n                }\n            } else if (input === '+') {\n                if (this.state.buffer[0] === '-') {\n                    this.state.buffer = this.state.buffer.substring(1, this.state.buffer.length);\n                }\n            } else if (input === '-') {\n                if (isFirstInput) {\n                    this.state.buffer = '-0';\n                } else if (this.state.buffer[0] === '-') {\n                    this.state.buffer = this.state.buffer.substring(1, this.state.buffer.length);\n                } else {\n                    this.state.buffer = '-' + this.state.buffer;\n                }\n            } else if (input[0] === '+' && !isNaN(parseFloat(input))) {\n                // when input is like '+10', '+50', etc\n                const inputValue = parse.float(input.slice(1));\n                const currentBufferValue = this.state.buffer ? parse.float(this.state.buffer) : 0;\n                this.state.buffer = this.component.env.pos.formatFixed(\n                    inputValue + currentBufferValue\n                );\n            } else if (!isNaN(parseInt(input, 10))) {\n                if (this.state.toStartOver) {  // when we want to erase the current buffer for a new value\n                    this.state.buffer = '';\n                }\n                if (isFirstInput) {\n                    this.state.buffer = '' + input;\n                } else if (this.state.buffer.length > 12) {\n                    Gui.playSound('bell');\n                } else {\n                    this.state.buffer += input;\n                }\n            }\n            if (this.state.buffer === '-') {\n                this.state.buffer = '';\n            }\n            // once an input is accepted and updated the buffer,\n            // the buffer should not be in reset state anymore.\n            this.isReset = false;\n            // it should not be in a start the buffer over state anymore.\n            this.state.toStartOver = false;\n\n            this.trigger('buffer-update', this.state.buffer);\n        }\n    }\n\n    return new NumberBuffer();\n});\n", "odoo.define('point_of_sale.MobileOrderWidget', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class MobileOrderWidget extends PosComponent {\n        constructor() {\n            super(...arguments);\n            this.update();\n        }\n        get order() {\n            return this.env.pos.get_order();\n        }\n        mounted() {\n          this.order.on('change', () => {\n              this.update();\n              this.render();\n          });\n          this.order.orderlines.on('change', () => {\n              this.update();\n              this.render();\n          });\n        }\n        update() {\n            const total = this.order ? this.order.get_total_with_tax() : 0;\n            const tax = this.order ? total - this.order.get_total_without_tax() : 0;\n            this.total = this.env.pos.format_currency(total);\n            this.items_number = this.order ? this.order.orderlines.reduce((items_number,line) => items_number + line.quantity, 0) : 0;\n        }\n    }\n\n    MobileOrderWidget.template = 'MobileOrderWidget';\n\n    Registries.Component.add(MobileOrderWidget);\n\n    return MobileOrderWidget;\n});\n", "odoo.define('point_of_sale.Notification', function (require) {\n    'use strict';\n\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    class Notification extends PosComponent {\n        constructor() {\n            super(...arguments)\n            useListener('click', this.closeNotification);\n        }\n        mounted() {\n            setTimeout(() => {\n                this.closeNotification();\n            }, this.props.duration)\n        }\n    }\n    Notification.template = 'Notification';\n\n    Registries.Component.add(Notification);\n\n    return Notification;\n});\n", "odoo.define('point_of_sale.WkAlertPopUp', function(require) {\n    'use strict';\n\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n\n    class WkCPAlertPopUp extends AbstractAwaitablePopup {\n        getPayload() {\n            return null;\n        }\n    }\n    WkCPAlertPopUp.template = 'WkCPAlertPopUp';\n    WkCPAlertPopUp.defaultProps = {\n        title: 'Confirm ?',\n        body: '',\n    };\n\n    Registries.Component.add(WkCPAlertPopUp);\n\n    return WkCPAlertPopUp;\n\n\n});", "/* Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) */\n/* See LICENSE file for full copyright and licensing details. */\n/* License URL : <https://store.webkul.com/license.html/> */\nodoo.define('pos_create_product.PosResBarcodeErrorPopUp', function(require){\n\"use strict\";    \n    const Registries = require('point_of_sale.Registries');\n    const ErrorBarcodePopup = require('point_of_sale.ErrorBarcodePopup');\n\n\n    var PosResBarcodeErrorPopUp = ErrorBarcodePopup =>\n        class extends ErrorBarcodePopup {\n\t\t\tcreate_new_product(){\n                this.showPopup('ProductCreatePopupWidget',{\n                    code:this.props.code\n                })\n            }\n        }\n\n\n    Registries.Component.extend(ErrorBarcodePopup, PosResBarcodeErrorPopUp);\n\n\tRegistries.Component.freeze();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    \n});", "/* Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) */\n/* See LICENSE file for full copyright and licensing details. */\n/* License URL : <https://store.webkul.com/license.html/> */\nodoo.define('pos_create_product.SuccessNotifyPopopWidget', function(require){\n\"use strict\";    \n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n    class SuccessNotifyPopopWidget extends AbstractAwaitablePopup {\n\n        mounted(){\n            var self = this;\n            $('.order_status').show();\n            $('.order_status').removeClass('creation_done');\n            $('.show_tick').hide();\n            setTimeout(function(){\n                $('.order_status').addClass('creation_done');\n                  $('.show_tick').show();\n                $('.order_status').css({'border-color':'#5cb85c'})\n            },500)\n            setTimeout(function(){\n                self.cancel();\n            },1500)\n        }\n    \n    }\n    SuccessNotifyPopopWidget.template = 'SuccessNotifyPopopWidget';\n    SuccessNotifyPopopWidget.defaultProps = {\n        body:''\n    };\n\n    Registries.Component.add(SuccessNotifyPopopWidget);\n\n\n    return SuccessNotifyPopopWidget;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    \n});", "/* Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) */\n/* See LICENSE file for full copyright and licensing details. */\n/* License URL : <https://store.webkul.com/license.html/> */\nodoo.define('pos_create_product.ProductCreatePopupWidget', function(require){\n\"use strict\";\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const { useState, useRef } = owl.hooks;\n    const Registries = require('point_of_sale.Registries');\n    const rpc = require('web.rpc');\n    var pos_model = require('point_of_sale.models');\n    var model_list = pos_model.PosModel.prototype.models\n    var product_fields;\n\n    pos_model.load_fields('account.tax',['type_tax_use']);\n\n    for(var i = 0,len = model_list.length;i<len;i++){\n        if(model_list[i].model == \"product.product\"){\n            product_fields = model_list[i].fields;\n            break;\n        }\n    }\n\n    class ProductCreatePopupWidget extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            this.state = useState({ options: this.props });\n        }\n        wk_tab_select(event){\n            var content_div_id ='#wk' +event.currentTarget.id\n\t\t\tif(content_div_id){\n\t\t\t\t$('.tab-content').removeClass('current');\n\t\t\t\t$('.tab-link').removeClass('current');\n                $(event.currentTarget).addClass('current');\n\t\t\t    $(content_div_id).addClass('current');\n\t\t\t}\n\n        }\n        wk_create_and_add_product(){\n            var self = this;\n            var result = self.wk_create_product(true);\n        }\n        wk_create_product(flag){\n            var self = this;\n            var flag = (flag && flag==true)? true: false;\n            var name = $('.info_input.name').val().trim();\n            var price = $('.info_input.price').val();\n            var barcode = $('.info_input.barcode').val();\n            if(barcode && barcode!=''){\n                self.props.barcode = barcode;\n                let barcode_product = self.env.pos.db.get_product_by_barcode(barcode);\n                if(barcode_product){\n                    $('#main_tab').click();\n                    $('.info_input.barcode').removeClass('text_shake');\n                    $('.info_input.barcode').focus();\n                    $('.info_input.barcode').addClass('text_shake');\n                    $('.wk_barcode_exist').show();\n                    setTimeout(function(){\n                        $('.wk_barcode_exist').hide();\n                    },800);\n                    $('.info_input.barcode').addClass('text_shake');\n                    return;\n                }\n            }\n            if(name == ''){\n                $('#main_tab').click();\n                $('.info_input.name').focus(function(){\n                    $('.info_input.name').removeClass('text_shake');\n                });\n                $('.info_input.name').addClass('text_shake');\n                return;\n            }\n            else if(price == \"\"){\n                $('#main_tab').click();\n                $('.info_input.price').focus(function(){\n                    $('.info_input.price').removeClass('text_shake');\n                });\n                $('.info_input.price').addClass('text_shake');\n                return;\n            }\n            else{\n                var type = $('.product_type.advance_details').val();\n                var standard_price = $('.cost_price.advance_details').val() || 0;\n                var categ_id = $('.categ_id.advance_details').val();\n                var pos_categ_id = $('.pos_categ_id.advance_details').val();\n                var pos_uom_id = $('.uom_id.advance_details').val();\n                var categ_id = $('.categ_id.advance_details').val();\n                var default_code = $('.default_code.advance_details').val();\n                var taxes = $.map($('.advance_table.taxes:checked'), function(c){return parseInt(c.value); });\n                var product_details={\n                    'name':name,\n                    'list_price':price,\n                    'type':type,\n                    'standard_price':standard_price,\n                    'categ_id':parseInt(categ_id),\n                    'pos_categ_id':parseInt(pos_categ_id),\n                    'taxes_id':taxes,\n                    'default_code':default_code,\n                    'barcode':self.state.options.barcode,\n                    'available_in_pos':true,\n                    'uom_id':parseInt(pos_uom_id),\n                    'uom_po_id':parseInt(pos_uom_id),\n                }\n                rpc.query({\n\t\t\t\t\tmodel:'product.product',\n\t\t\t\t\tmethod:'create_product',\n\t\t\t\t\targs:[product_details,product_fields]\n\t\t\t\t})\n                .then(function(result){\n                    if(result && result.product){\n                        product_details.id= result.product[0].id;\n                        result = self.wk_add_product(result.product[0]);\n                        if(flag && result && result!=undefined){\n                            self.env.pos.get_order().add_product(result);\n                        }\n                    }\n                    else{\n                        self.showPopup('WkCPAlertPopUp', {\n                            title: ('Failed To create product'),\n                            body: result.error,\n                        });\n                    }\n                })\n                .catch(function(unused, event){\n                    var order = self.env.pos.get_order();\n                    if(!product_details.barcode || product_details.barcode !=''){\n                        let product_id =  product_details.name + product_details.list_price;\n                        product_details.id = product_id.replace(' ','');\n                    }\n                    else\n                        product_details.id = product_details.barcode;\n                    product_details.tracking = \"none\";\n                    product_details.display_name = name;\n                    product_details.lst_price = price;\n                    if(categ_id){\n                        var categ = _(self.env.pos.product_categories).filter(function(item) {\n                            return item.id !== categ_id\n                        });\n                        if(categ)\n                            product_details.categ_id = [categ[0],categ.name]\n                    }\n                    if(pos_categ_id){\n                        let pos_categ = self.env.pos.db.category_by_id[pos_categ_id];\n                        product_details.pos_categ_id = [pos_categ.id,pos_categ.name];\n                    }\n                    let product_uom = _.find(self.env.pos.units_by_id)\n                    if(product_uom)\n                        product_details.uom_id = [product_uom.id,product_uom.name];\n                    if(event)\n                        if(event.preventDefault)\n                            event.preventDefault()\n                    var result = self.wk_add_product(product_details);\n                    order.product_data.push(product_details);\n                    order.save_to_db();\n                    if(flag && result && result!=undefined){\n                        self.env.pos.get_order().add_product(result);\n                    }\n                });\n            }\n        }\n        mounted() {\n            var self = this;\n\t\t\tsetTimeout(function(){\n\t\t\t\t$('.move').addClass('complete');\n            },500)\n            $('.info_input.price').attr('placeholder',\"Amount (\"+self.env.pos.currency.symbol+\")\")\n            $('.cost_price.advance_details').attr('placeholder',\" Amount (\"+self.env.pos.currency.symbol+\")\")\n        }\n        wk_add_product(product){\n            var self = this;\n            var product =  new pos_model.Product({}, product);\n            product.pos = self.env.pos;\n            self.env.pos.db.product_by_id[product.id] = product;\n            self.env.pos.db.product_by_category_id[0].unshift(product.id);\n            if(product.pos_categ_id && product.pos_categ_id.length){\n        if(self.env.pos.db.product_by_category_id[product.pos_categ_id[0]])\n                    self.env.pos.db.product_by_category_id[product.pos_categ_id[0]].unshift(product.id);\n                self.env.pos.db.category_search_string[self.env.pos.db.root_category_id] += self.env.pos.db._product_search_string(product)\n                self.env.pos.db.category_search_string[product.pos_categ_id[0]] += self.env.pos.db._product_search_string(product)\n            }\n            else\n                self.env.pos.db.category_search_string[self.env.pos.db.root_category_id] += self.env.pos.db._product_search_string(product)\n            if(product.barcode)\n                self.env.pos.db.product_by_barcode[product.barcode] = product;\n\n            self.showPopup('SuccessNotifyPopopWidget',{\n            });\n            return product\n        }\n\n    }\n    ProductCreatePopupWidget.template = 'ProductCreatePopupWidget';\n    ProductCreatePopupWidget.defaultProps = {\n    };\n\n    Registries.Component.add(ProductCreatePopupWidget);\n\n\n    return ProductCreatePopupWidget;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n});\n", "/* Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) */\n/* See LICENSE file for full copyright and licensing details. */\n/* License URL : <https://store.webkul.com/license.html/> */\nodoo.define('pos_create_product.pos_create_product', function(require){\n\"use strict\";\n    var core = require('web.core');\n    var Chrome = require('point_of_sale.Chrome');\n    var QWeb = core.qweb;\n    var pos_model = require('point_of_sale.models');\n    var rpc = require('web.rpc')    \n    var SuperOrder = pos_model.Order;    \n    var SuperPosModel = pos_model.PosModel.prototype;\n    var ProductScreen = require('point_of_sale.ProductScreen');\n    const Registries = require('point_of_sale.Registries');\n\n\n    var PosResChrome = Chrome =>\n        class extends Chrome {\n\t\t\tcreate_new_product(){\n\n                var self = this;\n                this.showPopup('ProductCreatePopupWidget',{});\n\t\t\t}\n\t\t}\n\n    Registries.Component.extend(Chrome, PosResChrome);\n\n    Registries.Component.freeze();\n    \n    var PosResProductScreen = ProductScreen =>\n        class extends ProductScreen {\n            _barcodeErrorAction(code) {\n                this.showPopup('ErrorBarcodePopup', { code: this._codeRepr(code) ,message:'The Point of Sale could not find any product associated with the scanned barcode. Please create a new product associatedto this barcode'});\n        }\n    }\n\n    Registries.Component.extend(ProductScreen, PosResProductScreen);\n\n    Registries.Component.freeze();\n    \n\n    pos_model.Order = pos_model.Order.extend({\n        initialize: function(attributes,options){\n            var self = this;\n            self.product_data=[];            \n            SuperOrder.prototype.initialize.call(this,attributes,options);\n        },\n\n        init_from_JSON: function(json) {\n            var self = this;\n            if (json.product_data && json.product_data.length){\n                this.product_data = json.product_data;\n                self.wk_add_product(json.product_data);\n                self.product_data = json.product_data;  \n            }\n            SuperOrder.prototype.init_from_JSON.call(this,json);\n        },\n\n        wk_add_product: function(product_data){\n            var self = this;\n            product_data.forEach(element => {\n                var product =  new pos_model.Product({}, element);            \n                self.pos.db.product_by_id[product.id] = product;\n                if(product.barcode)\n                    self.pos.db.product_by_barcode[product.barcode] = product;                    \n            });\n        },\n        \n\t\texport_as_JSON: function() {\n\t\t\tvar self = this;\n\t\t\tvar loaded=SuperOrder.prototype.export_as_JSON.call(this);\n\t\t\tloaded.product_data=self.product_data;  \n\t\t\treturn loaded;\n\t\t},\n    });\n    \n    pos_model.PosModel = pos_model.PosModel.extend({\n        _save_to_server: function (orders, options) {\n            var self = this;\n            return SuperPosModel._save_to_server.call(this,orders,options).then(function(return_dict){\n                if(return_dict){\n                    _.forEach(return_dict, function(data){\n                        if(data.product_details != null){\n                        var product_details = data.product_details ;\n                        product_details.forEach(element => {                        \n                            for (var key in element){\n                                let product = element[key];\n                                delete self.db.product_by_id[key]\n                                product =  new pos_model.Product({}, product);\n                                self.db.product_by_id[product.id] = product;\n                                self.db.product_by_category_id[0].unshift(product.id);\n                                self.db.product_by_category_id[0] = self.db.product_by_category_id[0].filter(function(item) { \n                                    return item !== key\n                                });\n                                if(product.pos_categ_id && product.pos_categ_id.length){\n                                    if(self.pos.db.product_by_category_id[product.pos_categ_id[0]])\n                                        self.db.product_by_category_id[product.pos_categ_id[0]].unshift(product.id)\n                                        self.db.product_by_category_id[product.pos_categ_id[0]] = self.db.product_by_category_id[product.pos_categ_id[0]].filter(function(item) { \n                                            return item !== key\n                                        });\n                                }\n                                self.db.product_by_barcode[product.barcode] = product;\n                            }\n                        });\n                        if(self.chrome && self.chrome.screens && self.chrome.screens.products && self.chrome.screens.products.product_categories_widget )\n                            self.chrome.screens.products.product_categories_widget.renderElement()\n                        }\n                    });\n                }\n                return return_dict\n            });\n        }\n    });\n\n});", "odoo.define('pos_discount.DiscountButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n\n    class DiscountButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        async onClick() {\n            var self = this;\n            const { confirmed, payload } = await this.showPopup('NumberPopup',{\n                title: this.env._t('Discount Percentage'),\n                startingValue: this.env.pos.config.discount_pc,\n                isInputSelected: true\n            });\n            if (confirmed) {\n                const val = Math.round(Math.max(0,Math.min(100,parseFloat(payload))));\n                await self.apply_discount(val);\n            }\n        }\n\n        async apply_discount(pc) {\n            var order    = this.env.pos.get_order();\n            var lines    = order.get_orderlines();\n            var product  = this.env.pos.db.get_product_by_id(this.env.pos.config.discount_product_id[0]);\n            if (product === undefined) {\n                await this.showPopup('ErrorPopup', {\n                    title : this.env._t(\"No discount product found\"),\n                    body  : this.env._t(\"The discount product seems misconfigured. Make sure it is flagged as 'Can be Sold' and 'Available in Point of Sale'.\"),\n                });\n                return;\n            }\n\n            // Remove existing discounts\n            for (const line of lines) {\n                if (line.get_product() === product) {\n                    order.remove_orderline(line);\n                }\n            }\n\n            // Add discount\n            // We add the price as manually set to avoid recomputation when changing customer.\n            var base_to_discount = order.get_total_without_tax();\n            if (product.taxes_id.length){\n                var first_tax = this.env.pos.taxes_by_id[product.taxes_id[0]];\n                if (first_tax.price_include) {\n                    base_to_discount = order.get_total_with_tax();\n                }\n            }\n            var discount = - pc / 100.0 * base_to_discount;\n\n            if( discount < 0 ){\n                order.add_product(product, {\n                    price: discount,\n                    lst_price: discount,\n                    extras: {\n                        price_manually_set: true,\n                    },\n                });\n            }\n        }\n    }\n    DiscountButton.template = 'DiscountButton';\n\n    ProductScreen.addControlButton({\n        component: DiscountButton,\n        condition: function() {\n            return this.env.pos.config.module_pos_discount && this.env.pos.config.discount_product_id;\n        },\n    });\n\n    Registries.Component.add(DiscountButton);\n\n    return DiscountButton;\n});\n", "odoo.define('pos_discount.models', function (require) {\n  \"use strict\";\n\n  var models = require('point_of_sale.models');\n\n  var existing_models = models.PosModel.prototype.models;\n  var product_index = _.findIndex(existing_models, function (model) {\n      return model.model === \"product.product\";\n  });\n  var product_model = existing_models[product_index];\n\n  models.load_models([{\n    model:  product_model.model,\n    fields: product_model.fields,\n    order:  product_model.order,\n    domain: function(self) {return [['id', '=', self.config.discount_product_id[0]]];},\n    context: product_model.context,\n    loaded: product_model.loaded,\n  }]);\n\n});\n", "odoo.define('pos_epson_printer.pos_epson_printer', function (require) {\n\"use strict\";\n\nvar models = require('point_of_sale.models');\nvar EpsonPrinter = require('pos_epson_printer.Printer');\n\nvar posmodel_super = models.PosModel.prototype;\nmodels.PosModel = models.PosModel.extend({\n    after_load_server_data: function () {\n        var self = this;\n        return posmodel_super.after_load_server_data.apply(this, arguments).then(function () {\n            if (self.config.other_devices && self.config.epson_printer_ip) {\n                self.proxy.printer = new EpsonPrinter(self.config.epson_printer_ip , self);\n            }\n        });\n    },\n});\n\n});\n", "\nodoo.define('pos_epson_printer.Printer', function (require) {\n\"use strict\";\n\nvar core = require('web.core');\nvar { PrinterMixin, PrintResult, PrintResultGenerator } = require('point_of_sale.Printer');\n\nvar QWeb = core.qweb;\nvar _t = core._t;\n\nclass EpsonPrintResultGenerator extends PrintResultGenerator {\n    constructor(address) {\n        super();\n        this.address = address;\n    }\n\n    IoTActionError() {\n        var printRes = new PrintResult({\n            successful: false,\n            message: {\n                title: _t('Connection to the printer failed'),\n                body: _t('Please check if the printer is still connected.'),\n            }\n        });\n\n        if (window.location.protocol === 'https:') {\n            printRes.message.body += _.str.sprintf(\n                _t('If you are on a secure server (HTTPS) please make sure you manually accepted the certificate by accessing %s'),\n                this.address\n            );\n        }\n\n        return printRes;\n    }\n\n    IoTResultError() {\n        return new PrintResult({\n            successful: false,\n            message: {\n                title: _t('Printing failed'),\n                body: _t('Please check if the printer has enough paper and is ready to print.'),\n            },\n        });\n    }\n}\n\nvar EpsonPrinter = core.Class.extend(PrinterMixin, {\n    init(ip, pos) {\n        PrinterMixin.init.call(this, pos);\n        var url = window.location.protocol + '//' + ip;\n        this.address = url + '/cgi-bin/epos/service.cgi?devid=local_printer';\n        this.printResultGenerator = new EpsonPrintResultGenerator(url);\n    },\n\n\n    /**\n     * Transform a (potentially colored) canvas into a monochrome raster image.\n     * We will use Floyd-Steinberg dithering.\n     */\n    _canvasToRaster(canvas) {\n        var imageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);\n        var pixels = imageData.data;\n        var width = imageData.width;\n        var height = imageData.height;\n        var errors = Array.from(Array(width), _ => Array(height).fill(0));\n        var rasterData = new Array(width * height).fill(0);\n\n        for (var y = 0; y < height; y++) {\n            for (var x = 0; x < width; x++) {\n                var idx, oldColor, newColor;\n\n                // Compute grayscale level. Those coefficients were found online\n                // as R, G and B have different impacts on the darkness\n                // perception (e.g. pure blue is darker than red or green).\n                idx = (y * width + x) * 4;\n                oldColor = pixels[idx] * 0.299 + pixels[idx+1] * 0.587 + pixels[idx+2] * 0.114;\n\n                // Propagate the error from neighbor pixels \n                oldColor += errors[x][y];\n                oldColor = Math.min(255, Math.max(0, oldColor));\n\n                if (oldColor < 128) {\n                    // This pixel should be black\n                    newColor = 0;\n                    rasterData[y * width + x] = 1;\n                } else {\n                    // This pixel should be white\n                    newColor = 255;\n                    rasterData[y * width + x] = 0;\n                }\n\n                // Propagate the error to the following pixels, based on\n                // Floyd-Steinberg dithering.\n                var error = oldColor - newColor;\n                if (error) {\n                    if (x < width - 1) {\n                        // Pixel on the right\n                        errors[x + 1][y] += 7/16 * error;\n                    }\n                    if (x > 0 && y < height - 1) {\n                        // Pixel on the bottom left\n                        errors[x - 1][y + 1] += 3/16 * error;\n                    }\n                    if (y < height - 1) {\n                        // Pixel below\n                        errors[x][y + 1] += 5/16 * error;\n                    }\n                    if (x < width - 1 && y < height - 1) {\n                        // Pixel on the bottom right\n                        errors[x + 1][y + 1] += 1/16 * error;\n                    }\n                }\n            }\n        }\n\n        return rasterData.join('');\n    },\n\n    /**\n     * Base 64 encode a raster image\n     */\n    _encodeRaster(rasterData) {\n        var encodedData = '';\n        for(var i = 0; i < rasterData.length; i+=8){\n            var sub = rasterData.substr(i, 8);\n            encodedData += String.fromCharCode(parseInt(sub, 2));\n        }\n        return btoa(encodedData);\n    },\n\n    /**\n     * Create the raster data from a canvas\n     * \n     * @override\n     */\n    process_canvas(canvas) {\n        var rasterData = this._canvasToRaster(canvas);\n        var encodedData = this._encodeRaster(rasterData);\n        return QWeb.render('ePOSPrintImage', {\n            image: encodedData,\n            width: canvas.width,\n            height: canvas.height,\n        });\n    },\n\n    /**\n     * @override\n     */\n    open_cashbox() {\n        var pulse = QWeb.render('ePOSDrawer');\n        this.send_printing_job(pulse);\n    },\n\n    /**\n     * @override\n     */\n    async send_printing_job(img) {\n        const res = await $.ajax({\n            url: this.address,\n            method: 'POST',\n            data: img,\n        });\n        return $(res).find('response').attr('success') === 'true';\n    },\n});\n\nreturn EpsonPrinter;\n\n});\n", "odoo.define('pos_sale.models', function (require) {\n    \"use strict\";\n\nvar models = require('point_of_sale.models');\n\n\n\nvar existing_models = models.PosModel.prototype.models;\nvar product_index = _.findIndex(existing_models, function (model) {\n    return model.model === \"product.product\";\n});\nvar product_model = existing_models[product_index];\n\nmodels.load_models([{\n  model:  product_model.model,\n  fields: product_model.fields,\n  order:  product_model.order,\n  domain: function(self) {return [['id', '=', self.config.down_payment_product_id[0]]];},\n  context: product_model.context,\n  loaded: product_model.loaded,\n}]);\n\nmodels.load_fields(\"product.product\", [\"invoice_policy\", \"type\"]);\n\nvar super_order_line_model = models.Orderline.prototype;\nmodels.Orderline = models.Orderline.extend({\n  initialize: function (attributes, options) {\n      super_order_line_model.initialize.apply(this, arguments);\n      // It is possible that this orderline is initialized using `init_from_JSON`,\n      // meaning, it is loaded from localStorage or from export_for_ui. This means\n      // that some fields has already been assigned. Therefore, we only set the options\n      // when the original value is falsy.\n      this.sale_order_origin_id = this.sale_order_origin_id || options.sale_order_origin_id;\n      this.sale_order_line_id = this.sale_order_line_id || options.sale_order_line_id;\n      this.down_payment_details = this.down_payment_details || options.down_payment_details;\n      this.customerNote = this.customerNote || options.customer_note;\n  },\n  init_from_JSON: function (json) {\n      super_order_line_model.init_from_JSON.apply(this, arguments);\n      this.sale_order_origin_id = json.sale_order_origin_id;\n      this.sale_order_line_id = json.sale_order_line_id;\n      this.down_payment_details = json.down_payment_details && JSON.parse(json.down_payment_details);\n  },\n  export_as_JSON: function () {\n      const json = super_order_line_model.export_as_JSON.apply(this, arguments);\n      json.sale_order_origin_id = this.sale_order_origin_id;\n      json.sale_order_line_id = this.sale_order_line_id;\n      json.down_payment_details = this.down_payment_details && JSON.stringify(this.down_payment_details);\n      return json;\n  },\n  get_sale_order: function(){\n      if(this.sale_order_origin_id) {\n        let value = {\n            'name': this.sale_order_origin_id.name,\n            'details': this.down_payment_details || false\n        }\n\n        return value;\n      }\n      return false;\n  },\n  export_for_printing: function() {\n    var json = super_order_line_model.export_for_printing.apply(this,arguments);\n    json.down_payment_details =  this.down_payment_details;\n    if (this.sale_order_origin_id) {\n        json.so_reference = this.sale_order_origin_id.name;\n    }\n    return json;\n  },\n  /**\n   * Set quantity based on the give sale order line.\n   * @param {'sale.order.line'} saleOrderLine\n   */\n  setQuantityFromSOL: function(saleOrderLine) {\n      if (this.product.type === 'service') {\n        this.set_quantity(saleOrderLine.qty_to_invoice);\n      } else {\n        this.set_quantity(saleOrderLine.product_uom_qty - Math.max(saleOrderLine.qty_delivered, saleOrderLine.qty_invoiced));\n      }\n  }\n});\n\n});\n", "odoo.define('pos_sale.SetSaleOrderButton', function(require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const { useListener } = require('web.custom_hooks');\n    const Registries = require('point_of_sale.Registries');\n    const { isConnectionError } = require('point_of_sale.utils');\n\n    class SetSaleOrderButton extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click', this.onClick);\n        }\n        mounted() {\n            this.env.pos.get('orders').on('add remove change', () => this.render(), this);\n            this.env.pos.on('change:selectedOrder', () => this.render(), this);\n        }\n        willUnmount() {\n            this.env.pos.get('orders').off('add remove change', null, this);\n            this.env.pos.off('change:selectedOrder', null, this);\n        }\n        get currentOrder() {\n            return this.env.pos.get_order();\n        }\n        async onClick() {\n          try {\n              // ping the server, if no error, show the screen\n              await this.rpc({\n                  model: 'sale.order',\n                  method: 'browse',\n                  args: [[]],\n                  kwargs: { context: this.env.session.user_context },\n              });\n              this.trigger('close-popup');\n              this.showScreen('SaleOrderManagementScreen');\n          } catch (error) {\n              if (isConnectionError(error)) {\n                  this.showPopup('ErrorPopup', {\n                      title: this.env._t('Network Error'),\n                      body: this.env._t('Cannot access order management screen if offline.'),\n                  });\n              } else {\n                  throw error;\n              }\n          }\n        }\n    }\n    SetSaleOrderButton.template = 'SetSaleOrderButton';\n\n    ProductScreen.addControlButton({\n        component: SetSaleOrderButton,\n        condition: function() {\n            return true;\n        },\n    });\n\n    Registries.Component.add(SetSaleOrderButton);\n\n    return SetSaleOrderButton;\n});\n", "odoo.define('point_of_sale.MobileSaleOrderManagementScreen', function (require) {\n    const SaleOrderManagementScreen = require('pos_sale.SaleOrderManagementScreen');\n    const Registries = require('point_of_sale.Registries');\n    const { useListener } = require('web.custom_hooks');\n    const { useState } = owl.hooks;\n\n    const MobileSaleOrderManagementScreen = (SaleOrderManagementScreen) => {\n        class MobileSaleOrderManagementScreen extends SaleOrderManagementScreen {\n            constructor() {\n                super(...arguments);\n                useListener('click-order', this._onShowDetails)\n                this.mobileState = useState({ showDetails: false });\n            }\n            _onShowDetails() {\n                this.mobileState.showDetails = true;\n            }\n        }\n        MobileSaleOrderManagementScreen.template = 'MobileSaleOrderManagementScreen';\n        return MobileSaleOrderManagementScreen;\n    };\n\n    Registries.Component.addByExtending(MobileSaleOrderManagementScreen, SaleOrderManagementScreen);\n\n    return MobileSaleOrderManagementScreen;\n});\n", "odoo.define('pos_sale.SaleOrderFetcher', function (require) {\n    'use strict';\n\n    const { EventBus } = owl.core;\n    const { Gui } = require('point_of_sale.Gui');\n    const { isConnectionError } = require('point_of_sale.utils');\n    const models = require('point_of_sale.models');\n\n    class SaleOrderFetcher extends EventBus {\n        constructor() {\n            super();\n            this.currentPage = 1;\n            this.ordersToShow = [];\n            this.totalCount = 0;\n        }\n\n\n        /**\n         * for nPerPage = 10\n         * +--------+----------+\n         * | nItems | lastPage |\n         * +--------+----------+\n         * |     2  |       1  |\n         * |    10  |       1  |\n         * |    11  |       2  |\n         * |    30  |       3  |\n         * |    35  |       4  |\n         * +--------+----------+\n         */\n        get lastPage() {\n            const nItems = this.totalCount;\n            return Math.trunc(nItems / (this.nPerPage + 1)) + 1;\n        }\n        /**\n         * Calling this methods populates the `ordersToShow` then trigger `update` event.\n         * @related get\n         *\n         * NOTE: This is tightly-coupled with pagination. So if the current page contains all\n         * active orders, it will not fetch anything from the server but only sets `ordersToShow`\n         * to the active orders that fits the current page.\n         */\n        async fetch() {\n            try {\n                let limit, offset;\n                let start, end;\n                // Show orders from the backend.\n                offset =\n                    this.nPerPage +\n                    (this.currentPage - 1 - 1) *\n                        this.nPerPage;\n                limit = this.nPerPage;\n                this.ordersToShow = await this._fetch(limit, offset);\n\n                this.trigger('update');\n            } catch (error) {\n                if (isConnectionError(error)) {\n                    Gui.showPopup('ErrorPopup', {\n                        title: this.comp.env._t('Network Error'),\n                        body: this.comp.env._t('Unable to fetch orders if offline.'),\n                    });\n                    Gui.setSyncStatus('error');\n                } else {\n                    throw error;\n                }\n            }\n        }\n        /**\n         * This returns the orders from the backend that needs to be shown.\n         * If the order is already in cache, the full information about that\n         * order is not fetched anymore, instead, we use info from cache.\n         *\n         * @param {number} limit\n         * @param {number} offset\n         */\n        async _fetch(limit, offset) {\n            const sale_orders = await this._getOrderIdsForCurrentPage(limit, offset);\n\n            this.totalCount = sale_orders.length;\n            return sale_orders;\n        }\n        async _getOrderIdsForCurrentPage(limit, offset) {\n            return await this.rpc({\n                model: 'sale.order',\n                method: 'search_read',\n                args: [this.searchDomain ? this.searchDomain : [], ['name', 'partner_id', 'amount_total', 'date_order', 'state', 'user_id'], offset, limit],\n                context: this.comp.env.session.user_context,\n            });\n        }\n\n        nextPage() {\n            if (this.currentPage < this.lastPage) {\n                this.currentPage += 1;\n                this.fetch();\n            }\n        }\n        prevPage() {\n            if (this.currentPage > 1) {\n                this.currentPage -= 1;\n                this.fetch();\n            }\n        }\n        /**\n         * @param {integer|undefined} id id of the cached order\n         * @returns {Array<models.Order>}\n         */\n        get(id) {\n            return this.ordersToShow;\n        }\n        setSearchDomain(searchDomain) {\n            this.searchDomain = searchDomain;\n        }\n        setComponent(comp) {\n            this.comp = comp;\n            return this;\n        }\n        setNPerPage(val) {\n            this.nPerPage = val;\n        }\n        setPage(page) {\n            this.currentPage = page;\n        }\n\n        async rpc() {\n            Gui.setSyncStatus('connecting');\n            const result = await this.comp.rpc(...arguments);\n            Gui.setSyncStatus('connected');\n            return result;\n        }\n    }\n\n    return new SaleOrderFetcher();\n});\n", "odoo.define('pos_sale.SaleOrderList', function (require) {\n    'use strict';\n\n    const { useState } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * @props {models.Order} [initHighlightedOrder] initially highligted order\n     * @props {Array<models.Order>} orders\n     */\n    class SaleOrderList extends PosComponent {\n        constructor() {\n            super(...arguments);\n            useListener('click-order', this._onClickOrder);\n            this.state = useState({ highlightedOrder: this.props.initHighlightedOrder || null });\n        }\n        get highlightedOrder() {\n            return this.state.highlightedOrder;\n        }\n        _onClickOrder({ detail: order }) {\n            this.state.highlightedOrder = order;\n        }\n    }\n    SaleOrderList.template = 'SaleOrderList';\n\n    Registries.Component.add(SaleOrderList);\n\n    return SaleOrderList;\n});\n", "odoo.define('pos_sale.SaleOrderManagementControlPanel', function (require) {\n    'use strict';\n\n    const { useContext } = owl.hooks;\n    const { useAutofocus, useListener } = require('web.custom_hooks');\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n    const SaleOrderFetcher = require('pos_sale.SaleOrderFetcher');\n    const contexts = require('point_of_sale.PosContext');\n\n    // NOTE: These are constants so that they are only instantiated once\n    // and they can be used efficiently by the OrderManagementControlPanel.\n    const VALID_SEARCH_TAGS = new Set(['date', 'customer', 'client', 'name', 'order']);\n    const FIELD_MAP = {\n        date: 'date_order',\n        customer: 'partner_id.display_name',\n        client: 'partner_id.display_name',\n        name: 'name',\n        order: 'name',\n    };\n    const SEARCH_FIELDS = ['name', 'partner_id.display_name', 'date_order'];\n\n    /**\n     * @emits close-screen\n     * @emits prev-page\n     * @emits next-page\n     * @emits search\n     */\n    class SaleOrderManagementControlPanel extends PosComponent {\n        constructor() {\n            super(...arguments);\n            // We are using context because we want the `searchString` to be alive\n            // even if this component is destroyed (unmounted).\n            this.orderManagementContext = useContext(contexts.orderManagement);\n            useListener('clear-search', this._onClearSearch);\n            useAutofocus({ selector: 'input' });\n\n            let currentClient = this.env.pos.get_client();\n            if (currentClient) {\n                this.orderManagementContext.searchString = currentClient.name;\n                let domain = this._computeDomain();\n                SaleOrderFetcher.setSearchDomain(domain);\n            }\n        }\n        onInputKeydown(event) {\n            if (event.key === 'Enter') {\n                this.trigger('search', this._computeDomain());\n            }\n        }\n        get showPageControls() {\n            return SaleOrderFetcher.lastPage > 1;\n        }\n        get pageNumber() {\n            const currentPage = SaleOrderFetcher.currentPage;\n            const lastPage = SaleOrderFetcher.lastPage;\n            return isNaN(lastPage) ? '' : `(${currentPage}/${lastPage})`;\n        }\n        get validSearchTags() {\n            return VALID_SEARCH_TAGS;\n        }\n        get fieldMap() {\n            return FIELD_MAP;\n        }\n        get searchFields() {\n            return SEARCH_FIELDS;\n        }\n        /**\n         * E.g. 1\n         * ```\n         *   searchString = 'Customer 1'\n         *   result = [\n         *      '|',\n         *      '|',\n         *      ['pos_reference', 'ilike', '%Customer 1%'],\n         *      ['partner_id.display_name', 'ilike', '%Customer 1%'],\n         *      ['date_order', 'ilike', '%Customer 1%']\n         *   ]\n         * ```\n         *\n         * E.g. 2\n         * ```\n         *   searchString = 'date: 2020-05'\n         *   result = [\n         *      ['date_order', 'ilike', '%2020-05%']\n         *   ]\n         * ```\n         *\n         * E.g. 3\n         * ```\n         *   searchString = 'customer: Steward, date: 2020-05-01'\n         *   result = [\n         *      ['partner_id.display_name', 'ilike', '%Steward%'],\n         *      ['date_order', 'ilike', '%2020-05-01%']\n         *   ]\n         * ```\n         */\n        _computeDomain() {\n            let domain = [['state', '!=', 'cancel'],['invoice_status', '!=', 'invoiced']];\n            const input = this.orderManagementContext.searchString.trim();\n            if (!input) return domain;\n\n            const searchConditions = this.orderManagementContext.searchString.split(/[,&]\\s*/);\n            if (searchConditions.length === 1) {\n                let cond = searchConditions[0].split(/:\\s*/);\n                if (cond.length === 1) {\n                  domain = domain.concat(Array(this.searchFields.length - 1).fill('|'));\n                  domain = domain.concat(this.searchFields.map((field) => [field, 'ilike', `%${cond[0]}%`]));\n                  return domain;\n                }\n            }\n\n            for (let cond of searchConditions) {\n                let [tag, value] = cond.split(/:\\s*/);\n                if (!this.validSearchTags.has(tag)) continue;\n                domain.push([this.fieldMap[tag], 'ilike', `%${value}%`]);\n            }\n            return domain;\n        }\n        _onClearSearch() {\n            this.orderManagementContext.searchString = '';\n            this.onInputKeydown({ key: 'Enter' });\n        }\n    }\n    SaleOrderManagementControlPanel.template = 'SaleOrderManagementControlPanel';\n\n    Registries.Component.add(SaleOrderManagementControlPanel);\n\n    return SaleOrderManagementControlPanel;\n});\n", "odoo.define('pos_sale.SaleOrderManagementScreen', function (require) {\n    'use strict';\n\n    const { sprintf } = require('web.utils');\n    const { parse } = require('web.field_utils');\n    const { useContext } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const ControlButtonsMixin = require('point_of_sale.ControlButtonsMixin');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n    const Registries = require('point_of_sale.Registries');\n    const SaleOrderFetcher = require('pos_sale.SaleOrderFetcher');\n    const IndependentToOrderScreen = require('point_of_sale.IndependentToOrderScreen');\n    const contexts = require('point_of_sale.PosContext');\n    const models = require('point_of_sale.models');\n\n    class SaleOrderManagementScreen extends ControlButtonsMixin(IndependentToOrderScreen) {\n        constructor() {\n            super(...arguments);\n            useListener('close-screen', this.close);\n            useListener('click-sale-order', this._onClickSaleOrder);\n            useListener('next-page', this._onNextPage);\n            useListener('prev-page', this._onPrevPage);\n            useListener('search', this._onSearch);\n\n            SaleOrderFetcher.setComponent(this);\n            this.orderManagementContext = useContext(contexts.orderManagement);\n        }\n        mounted() {\n            SaleOrderFetcher.on('update', this, this.render);\n            this.env.pos.get('orders').on('add remove', this.render, this);\n\n            // calculate how many can fit in the screen.\n            // It is based on the height of the header element.\n            // So the result is only accurate if each row is just single line.\n            const flexContainer = this.el.querySelector('.flex-container');\n            const cpEl = this.el.querySelector('.control-panel');\n            const headerEl = this.el.querySelector('.header-row');\n            const val = Math.trunc(\n                (flexContainer.offsetHeight - cpEl.offsetHeight - headerEl.offsetHeight) /\n                    headerEl.offsetHeight\n            );\n            SaleOrderFetcher.setNPerPage(val);\n\n            // Fetch the order after mounting so that order management screen\n            // is shown while fetching.\n            setTimeout(() => SaleOrderFetcher.fetch(), 0);\n        }\n        willUnmount() {\n            SaleOrderFetcher.off('update', this);\n            this.env.pos.get('orders').off('add remove', null, this);\n        }\n        get selectedClient() {\n            const order = this.orderManagementContext.selectedOrder;\n            return order ? order.get_client() : null;\n        }\n        get orders() {\n            return SaleOrderFetcher.get();\n        }\n        async _setNumpadMode(event) {\n            const { mode } = event.detail;\n            this.numpadMode = mode;\n            NumberBuffer.reset();\n        }\n        _onNextPage() {\n            SaleOrderFetcher.nextPage();\n        }\n        _onPrevPage() {\n            SaleOrderFetcher.prevPage();\n        }\n        _onSearch({ detail: domain }) {\n            SaleOrderFetcher.setSearchDomain(domain);\n            SaleOrderFetcher.setPage(1);\n            SaleOrderFetcher.fetch();\n        }\n        async _onClickSaleOrder(event) {\n            const clickedOrder = event.detail;\n            const { confirmed, payload: selectedOption } = await this.showPopup('SelectionPopup',\n                {\n                    title: this.env._t('What do you want to do?'),\n                    list: [{id:\"0\", label: \"Apply a down payment\", item: false}, {id:\"1\", label: \"Settle the order\", item: true}],\n                });\n\n            if(confirmed){\n              let currentPOSOrder = this.env.pos.get_order();\n              let sale_order = await this._getSaleOrder(clickedOrder.id);\n              try {\n                await this.env.pos.load_new_partners();\n              }\n              catch (error){\n              }\n              currentPOSOrder.set_client(this.env.pos.db.get_partner_by_id(sale_order.partner_id[0]));\n              let orderFiscalPos = sale_order.fiscal_position_id ? this.env.pos.fiscal_positions.find(\n                  (position) => position.id === sale_order.fiscal_position_id[0]\n              )\n              : false;\n              if (orderFiscalPos){\n                  currentPOSOrder.fiscal_position = orderFiscalPos;\n              }\n              let orderPricelist = sale_order.pricelist_id ? this.env.pos.pricelists.find(\n                  (pricelist) => pricelist.id === sale_order.pricelist_id[0]\n              )\n              : false;\n              if (orderPricelist){\n                  currentPOSOrder.set_pricelist(orderPricelist);\n              }\n\n              if (selectedOption){\n                // settle the order\n                let lines = sale_order.order_line;\n                let product_to_add_in_pos = lines.filter(line => !this.env.pos.db.get_product_by_id(line.product_id[0])).map(line => line.product_id[0]);\n                if (product_to_add_in_pos.length){\n                    const { confirmed } = await this.showPopup('ConfirmPopup', {\n                        title: this.env._t('Products not available in POS'),\n                        body:\n                            this.env._t(\n                                'Some of the products in your Sale Order are not available in POS, do you want to import them?'\n                            ),\n                        confirmText: this.env._t('Yes'),\n                        cancelText: this.env._t('No'),\n                    });\n                    if (confirmed){\n                        await this.env.pos._addProducts(product_to_add_in_pos);\n                    }\n\n                }\n\n                /**\n                 * This variable will have 3 values, `undefined | false | true`.\n                 * Initially, it is `undefined`. When looping thru each sale.order.line,\n                 * when a line comes with lots (`.lot_names`), we use these lot names\n                 * as the pack lot of the generated pos.order.line. We ask the user\n                 * if he wants to use the lots that come with the sale.order.lines to\n                 * be used on the corresponding pos.order.line only once. So, once the\n                 * `useLoadedLots` becomes true, it will be true for the succeeding lines,\n                 * and vice versa.\n                 */\n                let useLoadedLots;\n\n                for (var i = 0; i < lines.length; i++) {\n                    let line = lines[i];\n                    if (!this.env.pos.db.get_product_by_id(line.product_id[0])){\n                        continue;\n                    }\n\n                    let new_line = new models.Orderline({}, {\n                        pos: this.env.pos,\n                        order: this.env.pos.get_order(),\n                        product: this.env.pos.db.get_product_by_id(line.product_id[0]),\n                        price: line.price_unit,\n                        tax_ids: orderFiscalPos ? undefined : line.tax_id,\n                        price_manually_set: true,\n                        sale_order_origin_id: clickedOrder,\n                        sale_order_line_id: line,\n                        customer_note: line.customer_note,\n                    });\n\n                    if (\n                        new_line.get_product().tracking !== 'none' &&\n                        (this.env.pos.picking_type.use_create_lots || this.env.pos.picking_type.use_existing_lots) &&\n                        line.lot_names.length > 0\n                    ) {\n                        // Ask once when `useLoadedLots` is undefined, then reuse it's value on the succeeding lines.\n                        const { confirmed } =\n                            useLoadedLots === undefined\n                                ? await this.showPopup('ConfirmPopup', {\n                                      title: this.env._t('SN/Lots Loading'),\n                                      body: this.env._t(\n                                          'Do you want to load the SN/Lots linked to the Sales Order?'\n                                      ),\n                                      confirmText: this.env._t('Yes'),\n                                      cancelText: this.env._t('No'),\n                                  })\n                                : { confirmed: useLoadedLots };\n                        useLoadedLots = confirmed;\n                        if (useLoadedLots) {\n                            new_line.setPackLotLines({\n                                modifiedPackLotLines: [],\n                                newPackLotLines: (line.lot_names || []).map((name) => ({ lot_name: name })),\n                            });\n                        }\n                    }\n                    new_line.setQuantityFromSOL(line);\n                    new_line.set_unit_price(line.price_unit);\n                    new_line.set_discount(line.discount);\n                    this.env.pos.get_order().add_orderline(new_line);\n                }\n              }\n              else {\n                // apply a downpayment\n                if (this.env.pos.config.down_payment_product_id){\n\n                    let lines = sale_order.order_line;\n                    let tab = [];\n\n                    for (let i=0; i<lines.length; i++) {\n                        tab[i] = {\n                            'product_name': lines[i].product_id[1],\n                            'product_uom_qty': lines[i].product_uom_qty,\n                            'price_unit': lines[i].price_unit,\n                            'total': lines[i].price_total,\n                        };\n                    }\n\n                    let down_payment = sale_order.amount_total;\n                    const { confirmed, payload } = await this.showPopup('NumberPopup', {\n                        title: sprintf(this.env._t(\"Percentage of %s\"), this.env.pos.format_currency(sale_order.amount_total)),\n                        startingValue: 0,\n                    });\n                    if (confirmed){\n                        down_payment = sale_order.amount_total * parse.float(payload) / 100;\n                    }\n\n\n                    let new_line = new models.Orderline({}, {\n                        pos: this.env.pos,\n                        order: this.env.pos.get_order(),\n                        product: this.env.pos.db.get_product_by_id(this.env.pos.config.down_payment_product_id[0]),\n                        price: down_payment,\n                        price_manually_set: true,\n                        sale_order_origin_id: clickedOrder,\n                        down_payment_details: tab,\n                    });\n                    new_line.set_unit_price(down_payment);\n                    this.env.pos.get_order().add_orderline(new_line);\n                }\n                else {\n                    const title = this.env._t('No down payment product');\n                    const body = this.env._t(\n                        \"It seems that you didn't configure a down payment product in your point of sale.\\\n                        You can go to your point of sale configuration to choose one.\"\n                    );\n                    await this.showPopup('ErrorPopup', { title, body });\n                }\n              }\n\n              currentPOSOrder.trigger('change');\n              this.close();\n            }\n\n        }\n\n        async _getSaleOrder(id) {\n            let sale_order = await this.rpc({\n                model: 'sale.order',\n                method: 'read',\n                args: [[id],['order_line', 'partner_id', 'pricelist_id', 'fiscal_position_id', 'amount_total', 'amount_untaxed']],\n                context: this.env.session.user_context,\n              });\n\n            let sale_lines = await this._getSOLines(sale_order[0].order_line);\n            sale_order[0].order_line = sale_lines;\n\n            return sale_order[0];\n        }\n\n        async _getSOLines(ids) {\n          let so_lines = await this.rpc({\n              model: 'sale.order.line',\n              method: 'read_converted',\n              args: [ids],\n              context: this.env.session.user_context,\n          });\n          return so_lines;\n        }\n\n    }\n    SaleOrderManagementScreen.template = 'SaleOrderManagementScreen';\n    SaleOrderManagementScreen.hideOrderSelector = true;\n\n    Registries.Component.add(SaleOrderManagementScreen);\n\n    return SaleOrderManagementScreen;\n});\n", "odoo.define('pos_sale.SaleOrderRow', function (require) {\n    'use strict';\n\n    const PosComponent = require('point_of_sale.PosComponent');\n    const Registries = require('point_of_sale.Registries');\n\n    /**\n     * @props {models.Order} order\n     * @props columns\n     * @emits click-order\n     */\n    class SaleOrderRow extends PosComponent {\n        get order() {\n            return this.props.order;\n        }\n        get highlighted() {\n            const highlightedOrder = this.props.highlightedOrder;\n            return !highlightedOrder ? false : highlightedOrder.backendId === this.props.order.backendId;\n        }\n\n        // Column getters //\n\n        get name() {\n            return this.order.name;\n        }\n        get date() {\n            return moment(this.order.date_order).format('YYYY-MM-DD hh:mm A');\n        }\n        get customer() {\n            const customer = this.order.partner_id;\n            return customer ? customer[1] : null;\n        }\n        get total() {\n            return this.env.pos.format_currency(this.order.amount_total);\n        }\n        get state() {\n            let state_mapping = {\n              'draft': this.env._t('Quotation'),\n              'sent': this.env._t('Quotation Sent'),\n              'sale': this.env._t('Sales Order'),\n              'done': this.env._t('Locked'),\n              'cancel': this.env._t('Cancelled'),\n            };\n\n            return state_mapping[this.order.state];\n        }\n        get salesman() {\n            const salesman = this.order.user_id;\n            return salesman ? salesman[1] : null;\n        }\n    }\n    SaleOrderRow.template = 'SaleOrderRow';\n\n    Registries.Component.add(SaleOrderRow);\n\n    return SaleOrderRow;\n});\n", "odoo.define('pos_sale.ProductScreen', function (require) {\n    'use strict';\n\n    const ProductScreen = require('point_of_sale.ProductScreen');\n    const Registries = require('point_of_sale.Registries');\n\n    const PosSaleProductScreen = (ProductScreen) =>\n        class extends ProductScreen {\n            async _newOrderlineSelected() {\n                await super._newOrderlineSelected();\n                this._setNumpadModeToPrice();\n            }\n            mounted() {\n                super.mounted();\n                this._setNumpadModeToPrice();\n            }\n            _setNumpadModeToPrice() {\n                if (this.currentOrder) {\n                    const selectedOrderline = this.currentOrder.get_selected_orderline();\n                    if (selectedOrderline && selectedOrderline.product.id === selectedOrderline.pos.config.down_payment_product_id[0]) {\n                        this.state.numpadMode = 'price';\n                    }\n                }\n            }\n        };\n\n    Registries.Component.extend(ProductScreen, PosSaleProductScreen);\n\n    return ProductScreen;\n});\n", "odoo.define('pos_global_discount_selection.DiscountButton', function(require) {\n    'use strict';\n\n    const PosDiscountButton = require('pos_discount.DiscountButton');\n    const Registries = require('point_of_sale.Registries');\n\n    const AmountDiscountButton = (PosDiscountButton) =>\n        class extends PosDiscountButton {\n\n            async discountPopup(discount_type) {\n                var self = this;\n\n                const { confirmed, payload } = await this.showPopup('NumberPopup',{\n                    title: this.env._t('Discount'),\n                    startingValue: this.env.pos.config.discount_pc,\n                    isInputSelected: true\n                });\n                var val = 0;\n                if (confirmed) {\n                    if (discount_type === 'amount') {\n                        val = Math.max(0,Math.min(100,parseFloat(payload)));\n                    } else {\n                        val = Math.round(Math.max(0,Math.min(100,parseFloat(payload))));\n                    }\n                    await self.apply_discount(val, discount_type);\n                }\n            }\n\n            async onClick() {\n\n                var discount_type = false;\n\n                if (this.env.pos.config.global_discount_type === 'percentage') {\n                    discount_type = 'percentage';\n                } else if (this.env.pos.config.global_discount_type === 'amount') {\n                    discount_type = 'amount';\n                } else {\n                    const { confirmed } = await this.showPopup('ConfirmPopup', {\n                        title: this.env._t('Select Discount Type'),\n                        body: this.env._t(\n                            'Please select the type of global discount to be applied'\n                        ),\n                        confirmText: this.env._t('Percentage'),\n                        cancelText: this.env._t('Amount'),\n                    });\n                    if (confirmed) {\n                        discount_type = 'percentage';\n                    }\n                    else {\n                        discount_type = 'amount';\n                    }\n                }\n\n                await this.discountPopup(discount_type);\n            }\n\n            async apply_discount(pc, discount_type) {\n                var order    = this.env.pos.get_order();\n                var lines    = order.get_orderlines();\n                var product  = this.env.pos.db.get_product_by_id(this.env.pos.config.discount_product_id[0]);\n                if (product === undefined) {\n                    await this.showPopup('ErrorPopup', {\n                        title : this.env._t(\"No discount product found\"),\n                        body  : this.env._t(\"The discount product seems misconfigured. Make sure it is flagged as 'Can be Sold' and 'Available in Point of Sale'.\"),\n                    });\n                    return;\n                }\n\n                // Remove existing discounts\n                var i = 0;\n                while ( i < lines.length ) {\n                    if (lines[i].get_product() === product) {\n                        order.remove_orderline(lines[i]);\n                    } else {\n                        i++;\n                    }\n                }\n\n                // Add discount\n                var discount = 0;\n                // Check the type of discount selected\n                if (discount_type === 'percentage') {\n                    // We add the price as manually set to avoid recomputation when changing customer.\n                    var base_to_discount = order.get_total_without_tax();\n                    if (product.taxes_id.length){\n                        var first_tax = this.env.pos.taxes_by_id[product.taxes_id[0]];\n                        if (first_tax.price_include) {\n                            base_to_discount = order.get_total_with_tax();\n                        }\n                    }\n                    discount = - pc / 100.0 * base_to_discount;\n                } else {\n                    discount = - pc;\n                }\n\n                if( discount < 0 ){\n                    order.add_product(product, {\n                        price: discount,\n                        lst_price: discount,\n                        extras: {\n                            price_manually_set: true,\n                        },\n                    });\n                }\n            }\n        };\n\n    Registries.Component.extend(PosDiscountButton, AmountDiscountButton);\n    return PosDiscountButton;\n\n});\n", "odoo.define('point_of_sale.pos_keyboard_shortcut', function(require) {\n    'use strict';\n    const { Component } = owl;\n    const { EventBus } = owl.core;\n    const { onMounted, onWillUnmount, useExternalListener } = owl.hooks;\n    const { useListener } = require('web.custom_hooks');\n    const { parse } = require('web.field_utils');\n    const { BarcodeEvents } = require('barcodes.BarcodeEvents');\n    const { _t } = require('web.core');\n    const INPUT_KEYS = new Set(\n        ['Delete', 'Backspace', '+1', '+2', '+5', '+10', '+20', '+50'].concat('0123456789+-.,'.split(''))\n    );\n    const CONTROL_KEYS = new Set(['Esc']);\n    const ALLOWED_KEYS = new Set([...INPUT_KEYS, ...CONTROL_KEYS]);\n    const getDefaultConfig = () => ({\n        decimalPoint: false,\n        triggerAtEnter: false,\n        triggerAtEsc: false,\n        triggerAtInput: false,\n        nonKeyboardInputEvent: false,\n        useWithBarcode: false,\n    });\n    var fired = false;\n\n    /**\n     * @prop {'quantiy' | 'price' | 'discount'} activeMode\n     * @event set-numpad-mode - triggered when mode button is clicked\n     * @event numpad-click-input - triggered when numpad button is clicked\n     *\n     * IMPROVEMENT: Whenever new-orderline-selected is triggered,\n     * numpad mode should be set to 'quantity'. Now that the mode state\n     * is lifted to the parent component, this improvement can be done in\n     * the parent component.\n     */\n\n    class NumberKeyboardBuffer extends EventBus {\n        constructor() {\n            super();\n            this.isReset = false;\n            this.bufferHolderStack = [];\n        }\n        /**\n         * @returns {String} value of the buffer, e.g. '-95.79'\n         */\n        get() {\n            return this.state ? this.state.buffer : null;\n        }\n        /**\n         * Takes a string that is convertible to float, and set it as\n         * value of the buffer. e.g. val = '2.99';\n         *\n         * @param {String} val\n         */\n        set(val) {\n            this.state.buffer = !isNaN(parseFloat(val)) ? val : '';\n            this.trigger('buffer-update', this.state.buffer);\n        }\n        /**\n         * Resets the buffer to empty string.\n         */\n        reset() {\n            this.isReset = true;\n            this.state.buffer = '';\n            this.trigger('buffer-update', this.state.buffer);\n        }\n        capture() {\n            if (this.handler) {\n                clearTimeout(this._timeout);\n                this.handler();\n                delete this.handler;\n            }\n        }\n        /**\n         * @returns {number} float equivalent of the value of buffer\n         */\n        getFloat() {\n            return parse.float(this.get());\n        }\n        activate() {\n            this.defaultDecimalPoint = _t.database.parameters.decimal_point;\n            useExternalListener(window, 'keyup', this._onKeyboardShortcutInput.bind(this));\n        }\n        /**\n         * @param {Object} config Use to setup the buffer\n         * @param {String|null} config.decimalPoint The decimal character.\n         * @param {String|null} config.triggerAtEnter Event triggered when 'Enter' key is pressed.\n         * @param {String|null} config.triggerAtEsc Event triggered when 'Esc' key is pressed.\n         * @param {String|null} config.triggerAtInput Event triggered for every accepted input.\n         * @param {String|null} config.nonKeyboardInputEvent Also listen to a non-keyboard input event\n         *      that carries a payload of { key }. The key is checked if it is a valid input. If valid,\n         *      the number buffer is modified just as it is modified when a keyboard key is pressed.\n         * @param {Boolean} config.useWithBarcode Whether this buffer is used with barcode.\n         * @emits config.triggerAtEnter when 'Enter' key is pressed.\n         * @emits config.triggerAtEsc when 'Esc' key is pressed.\n         * @emits config.triggerAtInput when an input is accepted.\n         */\n        use(config) {\n            this.eventsBuffer = [];\n            const currentComponent = Component.current;\n            config = Object.assign(getDefaultConfig(), config);\n            onMounted(() => {\n                this.bufferHolderStack.push({\n                    component: currentComponent,\n                    state: config.state ? config.state : { buffer: '' },\n                    config,\n                });\n                this._setUp();\n            });\n            onWillUnmount(() => {\n                this.bufferHolderStack.pop();\n                this._setUp();\n            });\n            // Add listener that accepts non keyboard inputs\n            if (typeof config.nonKeyboardInputEvent === 'string') {\n                useListener(config.nonKeyboardInputEvent, this._onNonKeyboardShortcutInput.bind(this));\n            }\n        }\n        get _currentBufferHolder() {\n            return this.bufferHolderStack[this.bufferHolderStack.length - 1];\n        }\n        _setUp() {\n            if (!this._currentBufferHolder) return;\n            const { component, state, config } = this._currentBufferHolder;\n            this.component = component;\n            this.state = state;\n            this.config = config;\n            this.decimalPoint = config.decimalPoint || this.defaultDecimalPoint;\n            this.maxTimeBetweenKeys = this.config.useWithBarcode\n                ? BarcodeEvents.max_time_between_keys_in_ms\n                : 0;\n        }\n        _onKeyboardShortcutInput(event) {\n            return this._bufferEvents(this._onInput(event => event.key))(event);\n        }\n        _onNonKeyboardShortcutInput(event) {\n            return this._bufferEvents(this._onInput(event => event.detail.key))(event);\n        }\n        _bufferEvents(handler) {\n            return event => {\n                if (['INPUT', 'TEXTAREA'].includes(event.target.tagName) || !this.eventsBuffer) return;\n                clearTimeout(this._timeout);\n                this.eventsBuffer.push(event);\n                this._timeout = setTimeout(handler, this.maxTimeBetweenKeys);\n                this.handler = handler\n            };\n        }\n        _onInput(keyAccessor) {\n            return () => {\n                if (this.eventsBuffer.length <= 2) {\n                    // Check first the buffer if its contents are all valid\n                    // number input.\n                    for (let event of this.eventsBuffer) {\n                        if (!ALLOWED_KEYS.has(keyAccessor(event))) {\n                            this.eventsBuffer = [];\n                            this.perform_event(event);\n                            return;\n                        }\n                    }\n                    // At this point, all the events in buffer\n                    // contains number input. It's now okay to handle\n                    // each input.\n                    for (let event of this.eventsBuffer) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                    }\n                }\n                this.eventsBuffer = [];\n            };\n        }\n        scroll_cashier(shortcut_pressed){\n            if(shortcut_pressed == 'ARROWDOWN'){\n                if($('.selection-item').hasClass('selected')){\n                    var current = $('.selection-item.selected')\n                    if(current.next().hasClass('selection-item')){\n                        current.next().addClass('selected');\n                        current.removeClass('selected');\n                        var index = $('.selection-item.selected').index();\n                        $('.selection.scrollable-y').animate({\n                            scrollTop: 50*index\n                        },50);\n                    }\n                    else{\n                        current.removeClass('selected')\n                        $('.selection.scrollable-y div:first-child').addClass('selected')\n                        $('.selection.scrollable-y').animate({\n                            scrollTop: 0\n                        },50);\n                    }\n                }\n                else\n                    $('.selection.scrollable-y div:first-child').addClass('selected')\n            }\n            if(shortcut_pressed == 'ARROWUP'){\n                if($('.selection-item').hasClass('selected')){\n                    var current = $('.selection-item.selected')\n                    if(current.prev().hasClass('selection-item')){\n                        current.prev().addClass('selected');\n                        current.removeClass('selected');\n                        var index = $('.selection-item.selected').index();\n                        $('.selection.scrollable-y').animate({\n                            scrollTop: 50*index\n                        },50);\n                    }\n                    else{\n                        current.removeClass('selected')\n                        $('.selection.scrollable-y div:last-child').addClass('selected')\n                        var index = $('.selection-item.selected').index();\n                        $('.selection.scrollable-y').animate({\n                            scrollTop: 50*index\n                        },50);\n                    }\n                }\n                else\n                    $('.selection.scrollable-y div:first-child').addClass('selected')\n            }\n        }\n        remove_classes(){\n            $('.actionpad button:nth-child(1)').removeClass('overlay')\n            $('.button.set-customer').removeClass('overlay')\n            $('.button.pay').removeClass('overlay')\n            $(\"button.mode-button:contains(Qty)\").removeClass('overlay');\n            $(\"button.mode-button:contains(Disc)\").removeClass('overlay');\n            $(\"button.mode-button:contains(Price)\").removeClass('overlay');\n            $('.username').removeClass('overlay')\n            $('.button.new-customer').removeClass('overlay')\n            $('.button.back').removeClass('overlay')\n            $(\".button.paymentmethod\").removeClass('overlay')\n            $('.button.print').removeClass('overlay');\n            $(\"div.status-buttons div:nth-child(3)\").removeClass('overlay')\n            $('.header-button.close_button').removeClass('overlay')\n            $(\".ticket-button\").removeClass('overlay')\n            $(\".pads .control-buttons .control-button:contains(Info)\").removeClass('overlay')\n            $(\".pads .control-buttons .control-button:contains(Refund)\").removeClass('overlay')\n            $('.hidden_tags').hide();\n            $('.hidden_tags_header').hide();\n            $('.button.back').removeClass('overlay');\n            $(\".button.print\").removeClass('overlay');\n            $(\".button.next\").removeClass('overlay');\n            $(\".button.js_invoice\").removeClass('overlay');\n            $(\".customer-button .button\").removeClass('overlay');\n            $(\".button.next\").removeClass('overlay');\n            return false\n        }\n        perform_event(e){\n            var self = this;\n            if(self.component.env.pos.config.enable_shortcuts){\n                var product_screen = $(\".product-screen.screen\").is(':visible');\n                var payment_screen = $(\".payment-screen.screen\").is(':visible');\n                var clientlist_screen = $(\".clientlist-screen.screen\").is(':visible');\n                var receipt_screen = $(\".receipt-screen.screen\").is(':visible');\n                var ticket_screen = $(\".ticket-screen.screen\").is(':visible');\n\n                var shortcut_pressed = e.key.toUpperCase();\n                var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n\n                if (product_screen){\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    if(e.keyCode == 17){\n                        if(fired){\n                            fired = false;\n                            self.remove_classes();\n                        }\n                        else{\n                            fired = true;\n                            var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n                            if(all_shortcuts.customer_screen){\n                                $('.button.set-customer span').html(all_shortcuts.customer_screen.toUpperCase())\n                                $('.button.set-customer').addClass('overlay');\n                            }\n                            if(all_shortcuts.next_screen){\n                                $('.button.pay span:last-child').html(all_shortcuts.next_screen.toUpperCase())\n                                $('.button.pay').addClass('overlay');\n                            }\n                            if(all_shortcuts.select_qty){\n                                $(\"button.mode-button:contains(Qty) span\").html(all_shortcuts.select_qty.toUpperCase())\n                                $(\"button.mode-button:contains(Qty)\").addClass('overlay');\n                            }\n                            if(all_shortcuts.select_discount){\n                                $(\"button.mode-button:contains(Disc) span\").html(all_shortcuts.select_discount.toUpperCase())\n                                $(\"button.mode-button:contains(Disc)\").addClass('overlay');\n                            }\n                            if(all_shortcuts.select_info){\n\n                                $(\".pads .control-buttons .control-button:contains(Info) span\").html(all_shortcuts.select_info.toUpperCase())\n                                $(\".pads .control-buttons .control-button:contains(Info)\").addClass('overlay');\n                            }\n                            if(all_shortcuts.select_refund){\n                                $(\".pads .control-buttons .control-button:contains(Refund) span\").html(all_shortcuts.select_refund.toUpperCase())\n                                $(\".pads .control-buttons .control-button:contains(Refund)\").addClass('overlay');\n                            }\n\n\n\n                            if(all_shortcuts.select_price){\n                                $(\"button.mode-button:contains(Price) span\").html(all_shortcuts.select_price.toUpperCase())\n                                $(\"button.mode-button:contains(Price)\").addClass('overlay');\n                            }\n\n                            if(all_shortcuts.select_user){\n                                $('span.username span').html(all_shortcuts.select_user.toUpperCase());\n                                $('span.username').addClass('overlay')\n                            }\n                            if(all_shortcuts.refresh){\n                                $(\"div.status-buttons div:nth-child(3) span\").html(all_shortcuts.refresh.toUpperCase());\n                                $(\"div.status-buttons div:nth-child(3)\").addClass('overlay')\n                            }\n\n                            if(all_shortcuts.see_all_order){\n                                $(\".ticket-button div:nth-child(2) span\").html(all_shortcuts.see_all_order.toUpperCase());\n                                $(\".ticket-button\").addClass('overlay')\n                            }\n                            if($('.header-button.close_button').length){\n                                if(all_shortcuts.close_pos){\n                                    $('.header-button.close_button span').html(all_shortcuts.close_pos.toUpperCase());\n                                    $('.header-button.close_button').addClass('overlay')\n                                }\n                            }\n                            $('.hidden_tags').show();\n                            $('.hidden_tags_header').show();\n\n                        }\n                    }\n\n                    if(!is_popup){\n                        if(all_shortcuts.next_screen && (shortcut_pressed == all_shortcuts.next_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.pay').click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.customer_screen && (shortcut_pressed == all_shortcuts.customer_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.set-customer').click();\n                            setTimeout(function(){\n                                $('.searchbox-client input').focus();\n                            },50);\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.create_customer && (shortcut_pressed == all_shortcuts.create_customer.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.set-customer').click();\n                            setTimeout(function(){\n                                $('.button.new-customer').click();\n                                setTimeout(function(){\n                                    $('.detail.client-name').focus();\n                                },100);\n                            },100);\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.search_product && (shortcut_pressed == all_shortcuts.search_product.toUpperCase())){\n                            e.preventDefault();\n                            $('.search-box input').focus();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.select_qty && (shortcut_pressed == all_shortcuts.select_qty.toUpperCase())){\n                            e.preventDefault();\n                            $(\"button.mode-button:contains(Qty)\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.select_discount && (shortcut_pressed == all_shortcuts.select_discount.toUpperCase())){\n                            e.preventDefault();\n                            $(\"button.mode-button:contains(Disc)\").click();\n                            fired = self.remove_classes();\n                        }\n\n                        if(all_shortcuts.select_info && (shortcut_pressed == all_shortcuts.select_info.toUpperCase())){\n\n                            e.preventDefault();\n                            $(\".pads .control-buttons .control-button:contains(Info)\").click();\n                            fired = self.remove_classes();\n                        }\n\n                        if(all_shortcuts.select_refund && (shortcut_pressed == all_shortcuts.select_refund.toUpperCase())){\n                            e.preventDefault();\n                            $(\".pads .control-buttons .control-button:contains(Refund)\").click();\n                            fired = self.remove_classes();\n                        }\n                        // $(\".ticket-button div:nth-child(2) span\").html(all_shortcuts.see_all_order.toUpperCase());\n                        // $(\".ticket-button\").addClass('overlay')\n\n                        if(all_shortcuts.select_price && (shortcut_pressed == all_shortcuts.select_price.toUpperCase())){\n                            e.preventDefault();\n                            $(\"button.mode-button:contains(Price)\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.see_all_order && (shortcut_pressed == all_shortcuts.see_all_order.toUpperCase())){\n                            e.preventDefault();\n                            $(\"div.ticket-button\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.select_user && (shortcut_pressed == all_shortcuts.select_user.toUpperCase())){\n                            e.preventDefault();\n                            $(\"span.username\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.refresh && (shortcut_pressed == all_shortcuts.refresh.toUpperCase())){\n                            e.preventDefault();\n                            $(\"div.status-buttons div:nth-child(3)\").click();\n                            fired = self.remove_classes();\n                        }\n                        if($('.header-button.close_button').length){\n                            if(all_shortcuts.close_pos && (shortcut_pressed == all_shortcuts.close_pos.toUpperCase())){\n                                e.preventDefault();\n                                $(\".header-button.close_button\").click();\n                                fired = self.remove_classes();\n                            }\n                        }\n                        if($('.product-list article').is(':focus')){\n                            if(e.key.toUpperCase() == all_shortcuts.navigate_product_right.toUpperCase()){\n                                if(document.activeElement.nextSibling && document.activeElement.nextSibling.className == 'product')\n                                    document.activeElement.nextSibling.focus();\n                                else\n                                    $('.product-list article:first-child').focus();\n                            }\n                            if(e.key.toUpperCase() == all_shortcuts.navigate_product_left.toUpperCase()){\n                                if(document.activeElement.previousSibling && document.activeElement.previousSibling.className == 'product')\n                                    document.activeElement.previousSibling.focus();\n                                else\n                                    $('.product-list article:last-child').focus();\n                            }\n                            if(e.key.toUpperCase() == 'ARROWDOWN'){\n                                if($('.product-list article').is(':focus')){\n                                    for (var i = 0; i < Math.floor($('.product-list').width()/140); i++) {\n                                        if(document.activeElement.nextSibling){\n                                            document.activeElement.nextSibling.focus();\n                                        }\n                                        else{\n                                            $('.product-list article:first-child').focus();\n                                            break;\n                                        }\n                                    }\n                                }\n                            }\n                            if(e.key.toUpperCase() == 'ARROWUP'){\n                                if($('.product-list article').is(':focus')){\n                                    for (var i = 0; i < Math.floor($('.product-list').width()/140); i++) {\n                                        if(document.activeElement.previousSibling && document.activeElement.previousSibling.className == 'product')\n                                            document.activeElement.previousSibling.focus();\n                                        else{\n                                            $('.product-list article:last-child').focus();\n                                            break;\n                                        }\n                                    }\n                                }\n                            }\n                            if(e.key.toUpperCase() == 'ENTER'){\n                                if($(\".product\").is(\":focus\")){\n                                    if(e.keyCode == 13 && document.activeElement && (document.activeElement.className == 'product')){\n                                        let product_id = document.activeElement.getAttribute('data-product-id');\n                                        $(\"[data-product-id~='\"+product_id+\"']\").click();\n                                        $(\"[data-product-id~='\"+product_id+\"']\").focus();\n                                    }\n                                }\n                            }\n                            fired = self.remove_classes();\n                        }\n\n                        if(!$('.product-list article').is(':focus')){\n                            if(e.key.toUpperCase() == 'ARROWUP'){\n                                if($('li.orderline.selected').length){\n                                    $('li.orderline.selected').prev().click();\n                                    if($('li.orderline.selected').prev().length){\n                                        $('.product-screen.screen .order-container').animate({\n                                            scrollTop: $('li.orderline.selected').offset().top - $('.product-screen.screen .order-container').offset().top - $('.product-screen.screen .order-container').offset().top - $('.product-screen.screen .order-container').offset().top + $('.product-screen.screen .order-container').scrollTop()\n                                        },50);\n                                    }\n                                }\n                            }\n                            if(e.key.toUpperCase() == 'ARROWDOWN'){\n                                if($('li.orderline.selected').length){\n                                    $('li.orderline.selected').next().click();\n                                    if($('li.orderline.selected').next().length){\n                                        $('.product-screen.screen .order-container').animate({\n                                            scrollTop: $('li.orderline.selected').offset().top - $('.product-screen.screen .order-container').offset().top + $('.product-screen.screen .order-container').scrollTop()\n                                        },50);\n                                    }\n                                }\n                            }\n                            fired = self.remove_classes();\n                        }\n                    } else {\n                        // Employee Selection\n                        if(shortcut_pressed == 'ARROWDOWN'){\n                            self.scroll_cashier(shortcut_pressed);\n                        }\n                        if(shortcut_pressed == 'ARROWUP'){\n                            self.scroll_cashier(shortcut_pressed);\n                        }\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n                    }\n                }\n                else if(ticket_screen){\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    if(!is_popup){\n                        if(all_shortcuts.back_screen && (shortcut_pressed == all_shortcuts.back_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('button.discard').click();\n                        }\n                        if(all_shortcuts.search_product && (shortcut_pressed == all_shortcuts.search_product.toUpperCase())){\n                            e.preventDefault();\n                            $('.search input').focus();\n                        }\n                    }\n                    else{\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n\n                    }\n                }\n                else if(clientlist_screen){\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    if(e.keyCode == 17){\n                        if(fired){\n                            fired = false;\n                            self.remove_classes();\n                        }\n                        else{\n                            fired = true;\n                            var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n                            if(all_shortcuts.back_screen){\n                                $(\".button.back span\").html(all_shortcuts.back_screen.toUpperCase());\n                                $(\".button.back\").addClass('overlay')\n                            }\n                            if(all_shortcuts.create_customer){\n                                $(\".button.new-customer span\").html(all_shortcuts.create_customer.toUpperCase());\n                                $(\".button.new-customer\").addClass('overlay')\n                            }\n                            $('.hidden_tags').show();\n                            $('.hidden_tags_header').show();\n                        }\n                    }\n                    if(!is_popup){\n                        if(all_shortcuts.back_screen && (shortcut_pressed == all_shortcuts.back_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.back').click();\n                        }\n                        if(all_shortcuts.search_product && (shortcut_pressed == all_shortcuts.search_product.toUpperCase())){\n                            e.preventDefault();\n                            $('.searchbox-client input').focus();\n                        }\n                        if(all_shortcuts.create_customer && (shortcut_pressed == all_shortcuts.create_customer.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.new-customer').click();\n                            fired = self.remove_classes();\n                        }\n                        if(e.key.toUpperCase() == 'ARROWDOWN'){\n                            if($('.client-list .client-list-contents .highlight').length){\n                                $('.client-list .client-list-contents .highlight').next().click();\n                                if($('.client-list .client-list-contents .highlight').offset() && $('.subwindow-container-fix.touch-scrollable.scrollable-y').offset()){\n                                    $('.subwindow-container-fix.touch-scrollable.scrollable-y').animate({\n                                        scrollTop: $('.client-list .client-list-contents .highlight').offset().top - $('.subwindow-container-fix.touch-scrollable.scrollable-y').offset().top + $('.subwindow-container-fix.touch-scrollable.scrollable-y').scrollTop()\n                                    },50);\n                                }\n                            }\n                            else\n                                $('.client-list .client-list-contents tr:first-child').click()\n                        }\n                        if(e.key.toUpperCase() == 'ARROWUP'){\n                            if($('.client-list .client-list-contents .highlight').length){\n                                $('.client-list .client-list-contents .highlight').prev().click();\n                                if($('.client-list .client-list-contents .highlight').offset() && $('.subwindow-container-fix.touch-scrollable.scrollable-y').offset()){\n                                    $('.subwindow-container-fix.touch-scrollable.scrollable-y').animate({\n                                        scrollTop: $('.client-list .client-list-contents .highlight').offset().top - $('.subwindow-container-fix.touch-scrollable.scrollable-y').offset().top + $('.subwindow-container-fix.touch-scrollable.scrollable-y').scrollTop()\n                                    },50)\n                                }\n                            }\n                            else\n                                $('.client-list .client-list-contents tr:first-child').click()\n                        }\n                        if(e.key.toUpperCase() == 'ENTER'){\n                            if($(\".client-line.highlight\").is(\":visible\")){\n                                $('.button.next.highlight').click()\n                            }\n                        }\n                    }\n                    else{\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n                    }\n                }\n                else if(payment_screen){\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    // CONTROL_KEYS == 17\n                    if(e.keyCode == 17){\n                        if(fired){\n                            fired = false;\n                            self.remove_classes();\n                        }\n                        else{\n                            fired = true;\n                            var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n                            if(all_shortcuts.select_user){\n                                $('span.username span').html(all_shortcuts.select_user.toUpperCase());\n                                $('span.username').addClass('overlay')\n                            }\n                            if(all_shortcuts.refresh){\n                                $(\"div.status-buttons div:nth-child(3) span\").html(all_shortcuts.refresh.toUpperCase());\n                                $(\"div.status-buttons div:nth-child(3)\").addClass('overlay')\n                            }\n                            if(all_shortcuts.see_all_order){\n                                $(\".ticket-button div:nth-child(2) span\").html(all_shortcuts.see_all_order.toUpperCase());\n                                $(\".ticket-button\").addClass('overlay')\n                            }\n                            if($('.header-button.close_button').length){\n                                if(all_shortcuts.close_pos){\n                                    $('.header-button.close_button span').html(all_shortcuts.close_pos.toUpperCase());\n                                    $('.header-button.close_button').addClass('overlay')\n                                }\n                            }\n                            if(all_shortcuts.back_screen){\n                                $(\".button.back span.hidden_tags\").html(all_shortcuts.back_screen.toUpperCase());\n                                $(\".button.back\").addClass('overlay')\n                            }\n                            if(all_shortcuts.order_invoice){\n                                $(\".button.js_invoice span.hidden_tags\").html(all_shortcuts.order_invoice.toUpperCase());\n                                $(\".button.js_invoice\").addClass('overlay')\n                            }\n                            if(all_shortcuts.customer_screen){\n                                $(\".customer-button .button span.hidden_tags\").html(all_shortcuts.customer_screen.toUpperCase());\n                                $(\".customer-button .button\").addClass('overlay')\n                            }\n                            if ($(\".button.next\").is(':visible')){\n                                $(\".button.next span.hidden_tags\").html('ENTER');\n                                $(\".button.next\").addClass('overlay')\n                            }\n                            var journal_key_shortcuts = []\n                            _.each(self.component.env.pos.journal_key,function(value){\n                                var dict_values = {\n                                    'id'  : value.payment_method_id[0],\n                                    'key' : value.key_journals,\n                                }\n                                journal_key_shortcuts.push(dict_values);\n                            });\n                            _.each(journal_key_shortcuts, function(value){\n                                if(value.key){\n                                    $(\"[data-payment-id~='\"+value.id+\"']\").siblings('.hidden_tags').html(value.key)\n                                    $(\"[data-payment-id~='\"+value.id+\"']\").parent().addClass('overlay')\n                                }\n                            });\n                            $('.hidden_tags').show();\n                            $('.hidden_tags_header').show();\n                        }\n                    }\n                    if(!is_popup){\n                        if(all_shortcuts.back_screen && (shortcut_pressed == all_shortcuts.back_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.back').click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.customer_screen && (shortcut_pressed ==  all_shortcuts.customer_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.customer-button .button').click();\n                            setTimeout(function(){\n                                $('.searchbox-client input').focus();\n                                fired = self.remove_classes();\n                            },50);\n                        }\n                        if(all_shortcuts.order_invoice && (shortcut_pressed == all_shortcuts.order_invoice.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.js_invoice').click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.see_all_order && (shortcut_pressed == all_shortcuts.see_all_order.toUpperCase())){\n                            e.preventDefault();\n                            $(\"div.ticket-button\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.select_user && (shortcut_pressed == all_shortcuts.select_user.toUpperCase())){\n                            e.preventDefault();\n                            $(\"span.username\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.refresh && (shortcut_pressed == all_shortcuts.refresh.toUpperCase())){\n                            e.preventDefault();\n                            $(\"div.status-buttons div:nth-child(3)\").click();\n                            fired = self.remove_classes();\n                        }\n                        if($('.header-button.close_button').length){\n                            if(all_shortcuts.close_pos && (shortcut_pressed == all_shortcuts.close_pos.toUpperCase())){\n                                e.preventDefault();\n                                $(\".header-button.close_button\").click();\n                                fired = self.remove_classes();\n                            }\n                        }\n                        if(e.key.toUpperCase() == 'ENTER'){\n                            if($(\".button.next\").is(\":visible\")){\n                                $('.button.next').click()\n                            }\n                            fired = self.remove_classes();\n                        }\n                        var journal_key_shortcuts = []\n                        _.each(self.component.env.pos.journal_key,function(value){\n                            var dict_values = {\n                                'id'  : value.payment_method_id[0],\n                                'key' : value.key_journals,\n                            }\n                            journal_key_shortcuts.push(dict_values);\n                        });\n                        _.each(journal_key_shortcuts, function(value){\n                            if(value.key && (value.key.toUpperCase() == shortcut_pressed)){\n                                fired = self.remove_classes();\n                                self.click_paymentmethods(value.id);\n                            }\n                        });\n                    } else {\n                        // Employee Selection\n                        if(shortcut_pressed == 'ARROWDOWN'){\n                            self.scroll_cashier(shortcut_pressed);\n                        }\n                        if(shortcut_pressed == 'ARROWUP'){\n                            self.scroll_cashier(shortcut_pressed);\n                        }\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n                    }\n                }\n                else if(receipt_screen){\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    if(e.keyCode == 17){\n                        if(fired){\n                            fired = false;\n                            self.remove_classes();\n                        }\n                        else{\n                            fired = true;\n                            var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n                            if(all_shortcuts.select_user){\n                                $('span.username span').html(all_shortcuts.select_user.toUpperCase());\n                                $('span.username').addClass('overlay')\n                            }\n                            if(all_shortcuts.refresh){\n                                $(\"div.status-buttons div:nth-child(3) span\").html(all_shortcuts.refresh.toUpperCase());\n                                $(\"div.status-buttons div:nth-child(3)\").addClass('overlay')\n                            }\n                            if(all_shortcuts.see_all_order){\n                                $(\".ticket-button div:nth-child(2) span\").html(all_shortcuts.see_all_order.toUpperCase());\n                                $(\".ticket-button\").addClass('overlay')\n                            }\n                            if($('.header-button.close_button').length){\n                                if(all_shortcuts.close_pos){\n                                    $('.header-button.close_button span').html(all_shortcuts.close_pos.toUpperCase());\n                                    $('.header-button.close_button').addClass('overlay')\n                                }\n                            }\n                            if(all_shortcuts.back_screen){\n                                $(\".button.back span.hidden_tags\").html(all_shortcuts.back_screen.toUpperCase());\n                                $(\".button.back\").addClass('overlay')\n                            }\n\n                            if(all_shortcuts.print_receipt){\n                                $(\".button.print span.hidden_tags\").html(all_shortcuts.print_receipt.toUpperCase());\n                                $(\".button.print\").addClass('overlay')\n                            }\n                            if(all_shortcuts.next_screen_show){\n                                $(\".button.next span.hidden_tags\").html(all_shortcuts.next_screen_show.toUpperCase());\n                                $(\".button.next\").addClass('overlay')\n                            }\n\n                            $('.hidden_tags').show();\n                            $('.hidden_tags_header').show();\n                        }\n                    }\n                    if(!is_popup){\n                        if(all_shortcuts.next_screen_show && (shortcut_pressed == all_shortcuts.next_screen_show.toUpperCase())){\n                            e.preventDefault();\n                            $(\".button.next\").click();\n                            fired = self.remove_classes();\n                        }\n                        if(all_shortcuts.print_receipt && (shortcut_pressed == all_shortcuts.print_receipt.toUpperCase())){\n                            e.preventDefault();\n                            $(\".button.print\").click();\n                            fired = self.remove_classes();\n                        }\n                    }\n                    else {\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n                    }\n                }\n                else{\n                    var is_popup = $(\"div.popups\").is(\":visible\")\n                    if(e.keyCode == 17){\n                        if(fired){\n                            fired = false;\n                            self.remove_classes();\n                        }\n                        else{\n                            fired = true;\n                            var all_shortcuts = self.component.env.pos.db.shortcuts_by_id[self.component.env.pos.config.select_shortcut[0]];\n                            if(all_shortcuts.back_screen){\n                                $(\".button.back span.hidden_tags\").html(all_shortcuts.back_screen.toUpperCase());\n                                $(\".button.back\").addClass('overlay')\n                            }\n                            $('.hidden_tags').show();\n                            $('.hidden_tags_header').show();\n                        }\n                    }\n                    if(!is_popup){\n                        if(all_shortcuts.back_screen && (shortcut_pressed == all_shortcuts.back_screen.toUpperCase())){\n                            e.preventDefault();\n                            $('.button.back').click();\n                            fired = self.remove_classes();\n                        }\n                    }\n                    else{\n                        if(shortcut_pressed == 'ENTER'){\n                            $('.button.confirm').click();\n                        }\n                    }\n                }\n            }\n        }\n        click_paymentmethods(payment_id){\n            $(\"[data-payment-id~='\"+payment_id+\"']\").parent().click()\n        }\n    }\n\n    return new NumberKeyboardBuffer();\n});\n", "/* Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) */\n/* See LICENSE file for full copyright and licensing details. */\n/* License URL : <https://store.webkul.com/license.html/> */\nodoo.define('pos_keyboard_shortcut.pos_keyboard_shortcut', function(require){\n    \"use strict\";\n        var models = require('point_of_sale.models');\n        const Registries = require('point_of_sale.Registries');\n        const Chrome = require('point_of_sale.Chrome');\n        const ProductScreen = require('point_of_sale.ProductScreen');\n        const NumberBufferShortcut = require('point_of_sale.pos_keyboard_shortcut');\n        const PaymentMethodButton = require('point_of_sale.PaymentMethodButton');\n\n        models.load_models([{\n            model:'pos.keyboard.shortcuts',\n            field: [],\n            loaded: function(self, result){\n                if(self.config.enable_shortcuts && self.config.select_shortcut){\n                    self.db.shortcuts_by_id = {};\n                    _.each(result, function(shortcut){\n                        if (self.config.select_shortcut[0] == shortcut.id){\n                            self.db.shortcuts_by_id[shortcut.id] = shortcut;\n                        }\n                    });\n                }\n            }\n        },{\n            model:'pos.payment.method.key',\n            field: [],\n            loaded: function(self, result){\n                if(self.config.enable_shortcuts && self.config.select_shortcut){\n                    var shortcut = self.db.shortcuts_by_id[self.config.select_shortcut[0]]\n                    if (shortcut){\n                        self.journal_key = [];\n                        self.db.journal_key_by_id = {}\n                        _.each(result, function(journal){\n                            if(shortcut.payment_methods.includes(journal.id)){\n                                self.db.journal_key_by_id[journal.id] = journal;\n                                self.journal_key.push(journal)\n                            }\n                        });\n                    }\n                }\n            }\n        }], {'after': 'pos.config'});\n\n        // Inherit Chrome----------------\n        const PosResChrome = (Chrome) =>\n            class extends Chrome {\n                constructor() {\n                    super(...arguments);\n                    NumberBufferShortcut.activate();\n                }\n            };\n        Registries.Component.extend(Chrome, PosResChrome);\n\n        // Inherit ProductScreen----------------\n        const PosResProductScreen = (ProductScreen) =>\n            class extends ProductScreen {\n                constructor() {\n                    super(...arguments);\n                    NumberBufferShortcut.use({\n                        triggerAtInput: 'update-page',\n                    });\n                }\n            }\n        PaymentMethodButton.template = 'ShortcutsPaymentMethodButton';\n        Registries.Component.extend(ProductScreen, PosResProductScreen);\n\n    });\n", "odoo.define('pos_sale_product_configurator.models', function (require) {\n    \"use strict\";\n\n    const { Gui } = require('point_of_sale.Gui');\n    var models = require('point_of_sale.models');\n\n    models.load_fields(\"product.product\", [\"optional_product_ids\"]);\n    models.load_fields(\"pos.config\", [\"iface_open_product_info\"]);\n\n    const super_order_model = models.Order.prototype;\n    models.Order = models.Order.extend({\n        async add_product(product, options) {\n            super_order_model.add_product.apply(this, arguments);\n            if (this.pos.config.iface_open_product_info && product.optional_product_ids.length) {\n                // The `optional_product_ids` only contains ids of the product templates and not the product itself\n                // We don't load all the product template in the pos, so it'll be hard to know if the id comes from\n                // a product available in POS. We send a quick cal to the back end to verify.\n                const isProductLoaded = await this.pos.rpc(\n                    {\n                        model: 'product.product',\n                        method: 'has_optional_product_in_pos',\n                        args: [[product.id]]\n                    }\n                );\n                if (isProductLoaded) {\n                    Gui.showPopup('ProductInfoPopup', {product, quantity: this.get_selected_orderline().get_quantity()});\n                }\n            }\n        }\n    })\n})\n", "odoo.define('pos_supplier_reference.models', function(require) {\n    'use strict';\n\n    var models = require('point_of_sale.models');\n    var DB = require('point_of_sale.DB');\n\n    models.load_fields(\"pos.payment.method\", [\"is_provide_payment_ref\"]);\n\n    models.load_fields(\"pos.payment\", [\"payment_reference\"]);\n\n    var _super_paymentline = models.Paymentline.prototype;\n    models.Paymentline = models.Paymentline.extend({\n        initialize: function(attr, options) {\n            _super_paymentline.initialize.apply(this, arguments);\n            this.payment_reference = this.payment_reference || '';\n        },\n        init_from_JSON: function(json) {\n            _super_paymentline.init_from_JSON.apply(this, arguments);\n            this.payment_reference = json.payment_reference;\n        },\n        export_as_JSON: function () {\n            var json = _super_paymentline.export_as_JSON.call(this);\n            json.payment_reference = this.payment_reference || \"\";\n            return json;\n        },\n    });\n\n    models.Order = models.Order.extend({\n        get_payment_reference: function () {\n            var reference_payment_line = this.paymentlines.find(pl => pl.payment_reference !== \"\");\n            return reference_payment_line ? reference_payment_line.payment_reference : \"\";\n        }\n    });\n\n    DB.include({\n        _product_search_string: function(product) {\n            let p_name = product.display_name;\n            p_name = p_name.replace(/\\s/g, '');\n\n            var str = p_name + \"|\" + product.display_name;\n            if (product.barcode) {\n                str += '|' + product.barcode;\n            }\n            if (product.default_code) {\n                str += '|' + product.default_code;\n            }\n            if (product.description) {\n                str += '|' + product.description;\n            }\n            if (product.description_sale) {\n                str += '|' + product.description_sale;\n            }\n            str  = product.id + ':' + str.replace(/:/g,'') + '\\n';\n            return str;\n        },\n    });\n});\n", "odoo.define('pos_supplier_reference.ReferencePopup', function(require) {\n    'use strict';\n\n    const { useState, useRef } = owl.hooks;\n    const AbstractAwaitablePopup = require('point_of_sale.AbstractAwaitablePopup');\n    const Registries = require('point_of_sale.Registries');\n\n    class ReferencePopup extends AbstractAwaitablePopup {\n        constructor() {\n            super(...arguments);\n            this.state = useState({ inputValue: this.props.startingValue });\n            this.inputRef = useRef('input');\n        }\n        mounted() {\n            this.inputRef.el.focus();\n        }\n        getPayload() {\n            return this.state.inputValue;\n        }\n    }\n    ReferencePopup.template = 'ReferencePopup';\n    ReferencePopup.defaultProps = {\n        confirmText: 'Ok',\n        cancelText: 'Cancel',\n        title: '',\n        body: '',\n        startingValue: '',\n    };\n\n    Registries.Component.add(ReferencePopup);\n\n    return ReferencePopup;\n});\n", "odoo.define('pos_supplier_reference.PaymentScreen', function(require) {\n    'use strict';\n\n    const Registries = require('point_of_sale.Registries');\n    const PaymentScreen = require('point_of_sale.PaymentScreen');\n    const NumberBuffer = require('point_of_sale.NumberBuffer');\n\n    const PaymentScreenReference = PaymentScreen => class extends PaymentScreen {\n        async addNewPaymentLine({ detail: paymentMethod }) {\n            if (paymentMethod.is_provide_payment_ref) {\n                let { confirmed, payload } = await this.showPopup('ReferencePopup', {\n                    title: this.env._t('Supplier Reference'),\n                    startingValue: null,\n                });\n                if (!confirmed) return false;\n                super.addNewPaymentLine(...arguments);\n                if (confirmed) {\n                    if (payload) {\n                        this.currentOrder.selected_paymentline.payment_reference = payload;\n                    }else {\n                        return false;\n                    }\n                }\n            }else\n                super.addNewPaymentLine(...arguments);\n        }\n    };\n\n    Registries.Component.extend(PaymentScreen, PaymentScreenReference);\n\n    return PaymentScreen;\n\n});\n", "odoo.define('pos_supplier_reference.TicketScreen', function(require) {\n    'use strict';\n\n    const Registries = require('point_of_sale.Registries');\n    const TicketScreen = require('point_of_sale.TicketScreen');\n\n    const TicketScreenPaymentSearch = TicketScreen =>\n        class extends TicketScreen {\n\n            _getSearchFields() {\n                const fields = super._getSearchFields();\n                 fields.PAYMENT_REFERENCE = {\n                    repr: (order) => order.get_payment_reference(),\n                    displayName: this.env._t('Supplier Reference'),\n                    modelField: 'payment_ids.payment_reference',\n                 }\n                return fields;\n            }\n\n            getPaymentReference(order) {\n                return order.get_payment_reference();\n            }\n\n        };\n        Registries.Component.extend(TicketScreen, TicketScreenPaymentSearch);\n\n    return TicketScreenPaymentSearch;\n});\n", "odoo.define('pos_supplier_reference.OrderReceiptExt', function(require) {\n    'use strict';\n\n    const OrderReceipt = require('point_of_sale.OrderReceipt');\n    const Registries = require('point_of_sale.Registries');\n\n    const OrderReceiptExt = (OrderReceipt) =>\n        class extends OrderReceipt {\n\n            get payment_references() {\n                let refs = [];\n                _.each(this.receiptEnv.paymentlines, function (l) {\n                    if (l.payment_reference) {\n                        refs.push(l.payment_reference);\n                    }\n                });\n                return refs;\n            }\n        };\n\n    Registries.Component.extend(OrderReceipt, OrderReceiptExt);\n\n    return OrderReceiptExt;\n});\n"], "file": "/web/assets/2699-bdf3162/point_of_sale.assets.js", "sourceRoot": "../../../"}